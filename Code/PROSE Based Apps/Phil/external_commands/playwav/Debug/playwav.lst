Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:   1


PC     Object              I  Line    Source 
                           A     1    
                           A     2    ; Command: "Playwav [filename]" -plays .wav fil
                           A     3    ;
                           A     4    ; Any sample size supported
                           A     5    ; wav file must be 8 bit / mono / unsigned 
                           A     6    ; Sample rate max 48800 Hz
                           A     7    
                           A     8    ;----------------------------------------------
                           A     9    
       0000010A            A    10    amoeba_version_req	equ	10ah			; 0 = d
       0000003B            A    11    prose_version_req	equ 03bh			; 0 = d
       00000001            A    12    ADL_mode			equ 1				; 0 if 
       00010000            A    13    load_location		equ 10000h			; anywh
                           A    14    
                           B     0    			include	'PROSE_header.asm'
                           B     1    
                           B     2    ;----------------------------------------------
                           B     3    
                           C     0    include "ez80_cpu_equates.asm"
                           C     1    ;--- EZ80 Internal Ports ----------------------
                           C     2    
       0000009A            C     3    PB_DR			equ 09ah
       0000009B            C     4    PB_DDR			equ 09bh
       0000009C            C     5    PB_ALT1			equ 09ch
       0000009D            C     6    PB_ALT2			equ 09dh
                           C     7    
       0000009E            C     8    PC_DR			equ 09eh
       0000009F            C     9    PC_DDR			equ 09fh
       000000A0            C    10    PC_ALT1			equ 0a0h
       000000A1            C    11    PC_ALT2			equ 0a1h
                           C    12    
       000000A2            C    13    PD_DR			equ 0a2h
       000000A3            C    14    PD_DDR			equ 0a3h
       000000A4            C    15    PD_ALT1			equ 0a4h
       000000A5            C    16    PD_ALT2			equ 0a5h
                           C    17    
       000000C0            C    18    UART0_RBR		equ 0c0h
       000000C0            C    19    UART0_THR		equ 0c0h
       000000C0            C    20    UART0_BRG_L		equ 0c0h
       000000C1            C    21    UART0_BRG_H		equ 0c1h
       000000C1            C    22    UART0_IER		equ 0c1h
       000000C2            C    23    UART0_FCTL		equ 0c2h
       000000C3            C    24    UART0_LCTL		equ 0c3h
       000000C4            C    25    UART0_MCTL		equ 0c4h
       000000C5            C    26    UART0_LSR		equ 0c5h
       000000C6            C    27    UART0_MSR		equ 0c6h
                           C    28    
       000000A8            C    29    CS0_LBR			equ 0a8h			;eZ80 wait 
       000000A9            C    30    CS0_UBR			equ 0a9h
       000000AA            C    31    CS0_CTL			equ 0aah			
       000000AB            C    32    CS1_LBR			equ 0abh			;eZ80 wait 
       000000AC            C    33    CS1_UBR			equ 0ach
Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:   2


PC     Object              I  Line    Source ..\..\..\..\..\Includes\ez80_cpu_equates.asm
       000000AD            C    34    CS1_CTL			equ 0adh
       000000AE            C    35    CS2_LBR			equ 0aeh			;eZ80 wait 
       000000AF            C    36    CS2_UBR			equ 0afh
       000000B0            C    37    CS2_CTL			equ 0b0h
       000000B1            C    38    CS3_LBR			equ 0b1h			;eZ80 wait 
       000000B2            C    39    CS3_UBR			equ 0b2h
       000000B3            C    40    CS3_CTL			equ 0b3h
                           C    41    
       00000080            C    42    TMR0_CTL		equ 080h			;timer 0 eq
       00000081            C    43    TMR0_DR_L		equ 081h
       00000081            C    44    TMR0_RR_L		equ 081h
       00000082            C    45    TMR0_DR_H		equ 082h
       00000082            C    46    TMR0_RR_H		equ 082h
       00000092            C    47    TMR_ISS			equ 092h
                           C    48    
       00000083            C    49    TMR1_CTL		equ 083h 
       00000084            C    50    TMR1_RR_L		equ 084h
       00000085            C    51    TMR1_RR_H		equ 085h
                           C    52    
       000000ED            C    53    RTC_CTRL		equ 0edh			;RTC equate
       000000EC            C    54    RTC_ACTRL		equ 0ech
       000000E0            C    55    RTC_SEC			equ 0e0h
       000000E1            C    56    RTC_MIN			equ 0e1h
       000000E2            C    57    RTC_HRS			equ 0e2h
       000000E3            C    58    RTC_DOW			equ 0e3h
       000000E4            C    59    RTC_DOM			equ 0e4h
       000000E5            C    60    RTC_MON			equ 0e5h
       000000E6            C    61    RTC_YR			equ 0e6h
       000000E7            C    62    RTC_CEN			equ 0e7h
                           C    63    
                           C    64    ;----------------------------------------------
                           B     5    
                           C     0    include "amoeba_hardware_equates.asm"
                           C     1    ;-- AMOEBA Hardware equates -------------------
                           C     2    
       00000000            C     3    port_pic_data  			equ 000h
       00000001            C     4    port_pic_ctrl			equ 001h
       00000001            C     5    port_hw_flags			equ 001h
       00000002            C     6    port_sdc_ctrl			equ 002h	; this is a
       00000002            C     7    port_keyboard_data		equ 002h
       00000003            C     8    port_sdc_data		 	equ 003h	
       00000004            C     9    port_memory_paging		equ 004h
       00000005            C    10    port_irq_ctrl			equ 005h
       00000005            C    11    port_irq_flags			equ 005h
       00000006            C    12    port_nmi_ack			equ 006h
       00000007            C    13    port_ps2_ctrl			equ 007h
       00000008            C    14    port_selector			equ 008h
       00000006            C    15    port_mouse_data			equ 006h
       00000009            C    16    port_clear_flags			equ 009h
       0000000A            C    17    port_hw_enable			equ 00ah
                           C    18    
       00000000            C    19    sdc_power				equ 0		;(port_sd_c
Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:   3


PC     Object              I  Line    Source ..\..\..\..\..\Includes\amoeba_hardware_equates.asm
       00000001            C    20    sdc_cs					equ 1		;(port_sd_c
       00000002            C    21    sdc_speed				equ 2 		;(port_sd_c
                           C    22    
       00000004            C    23    sdc_serializer_busy		equ 4 		;(port_hw_f
       00000005            C    24    vrt						equ 5		;(port_hw_f
                           C    25    
                           C    26    
                           C    27    ;-- Memory locations --------------------------
                           C    28    
       00000000            C    29    sysram_addr				equ 0000000h
       00800000            C    30    vram_a_addr				equ 0800000h
       00C00000            C    31    vram_b_addr				equ 0c00000h
                           C    32    
                           C    33    ;-- Hardware registers ------------------------
                           C    34    
       00FF0000            C    35    hw_palette				equ 0ff0000h
       00FF0800            C    36    hw_sprite_registers		equ 0ff0800h
       00FF1000            C    37    hw_video_parameters		equ 0ff1000h
       00FF1400            C    38    hw_audio_registers		equ 0ff1400h
       00FF1800            C    39    hw_video_settings		equ 0ff1800h
                           C    40    
       00FF1000            C    41    tilemap_parameters		equ hw_video_parameters
       00FF1020            C    42    bitmap_parameters		equ hw_video_parameters
                           C    43    
       00FF1800            C    44    video_control			equ hw_video_settings+0
       00FF1801            C    45    sprite_control			equ hw_video_settings+0
       00FF1802            C    46    bgnd_palette_select		equ hw_video_settings+0
       00FF1803            C    47    sprite_palette_select	equ hw_video_settings+0
       00FF1804            C    48    right_border_position	equ hw_video_settings+0
       00FF1805            C    49    irq_line_lo				equ hw_video_settings+0
       00FF1806            C    50    irq_line_hi				equ hw_video_settings+0
                           C    51    
                           C    52    ;----------------------------------------------
                           B     7    
                           C     0    include "prose_kernal_labels.asm"
                           C     1    ;--------- PROSE Kernal Routine labels --------
                           C     2    		
       00000000            C     3    kr_mount_volumes				equ 00h	
       00000001            C     4    kr_get_device_info				equ 01h	
       00000002            C     5    kr_check_volume_format			equ 02h	
       00000003            C     6    kr_change_volume				equ 03h	
       00000004            C     7    kr_get_volume_info				equ 04h	
       00000005            C     8    kr_format_device				equ 05h	
       00000006            C     9    kr_make_dir						equ 06h
                           C    10    
       00000007            C    11    kr_change_dir					equ 07h	
       00000008            C    12    kr_parent_dir					equ 08h	
       00000009            C    13    kr_root_dir						equ 09h
       0000000A            C    14    kr_delete_dir					equ 0ah
                           C    15    
       0000000B            C    16    kr_find_file					equ 0bh
       0000000B            C    17    kr_open_file					equ 0bh		; p
Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:   4


PC     Object              I  Line    Source ..\..\..\..\..\Includes\prose_kernal_labels.asm
                           C    18    
       0000000C            C    19    kr_set_file_pointer				equ 0ch
       0000000D            C    20    kr_set_load_length				equ 0dh
       0000000E            C    21    kr_read_file					equ 0eh
                           C    22    
       0000000F            C    23    kr_erase_file					equ 0fh
       00000010            C    24    kr_rename_file					equ 10h
       00000011            C    25    kr_create_file					equ 11h
       00000012            C    26    kr_write_file					equ 12h
       00000013            C    27    kr_get_total_sectors			equ 13h
       00000014            C    28    kr_dir_list_first_entry			equ 14h
       00000015            C    29    kr_dir_list_get_entry			equ 15h
       00000016            C    30    kr_dir_list_next_entry			equ 16h
                           C    31    
       00000017            C    32    kr_read_sector					equ 17h
       00000018            C    33    kr_write_sector					equ 18h
       00000019            C    34    kr_file_sector_list				equ 19h
       0000001A            C    35    kr_get_dir_cluster				equ 1ah
       0000001B            C    36    kr_set_dir_cluster				equ 1bh
       0000001C            C    37    kr_get_dir_name					equ 1ch
       0000001D            C    38    kr_wait_key						equ 1dh
       0000001E            C    39    kr_get_key						equ 1eh
                           C    40    
       0000001F            C    41    kr_get_key_mod_flags			equ 1fh
       00000020            C    42    kr_serial_receive_header		equ 20h
       00000021            C    43    kr_serial_receive_file			equ 21h
       00000022            C    44    kr_serial_send_file				equ 22h
       00000023            C    45    kr_serial_tx_byte				equ 23h
       00000024            C    46    kr_serial_rx_byte				equ 24h
                           C    47    
       00000025            C    48    kr_print_string					equ 25h
       00000026            C    49    kr_clear_screen					equ 26h
       00000027            C    50    kr_wait_vrt						equ 27h
       00000028            C    51    kr_set_cursor_position			equ 28h
       00000029            C    52    kr_plot_char					equ 29h
       0000002A            C    53    kr_set_pen						equ 2ah
       0000002B            C    54    kr_background_colours			equ 2bh
       0000002C            C    55    kr_draw_cursor					equ 2ch
       0000002D            C    56    kr_get_pen						equ 2dh
       0000002E            C    57    kr_scroll_up					equ 2eh
       0000002F            C    58    kr_os_display					equ 2fh
                           C    59    
       00000030            C    60    kr_get_display_size				equ 30h	
       00000030            C    61    kr_get_video_mode				equ 30h		;pr
                           C    62    
       00000031            C    63    kr_get_charmap_addr_xy			equ 31h
       00000032            C    64    kr_get_cursor_position			equ 32h
                           C    65    
       00000033            C    66    kr_set_envar					equ 33h
       00000034            C    67    kr_get_envar					equ 34h
       00000035            C    68    kr_delete_envar					equ 35h
                           C    69    
Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:   5


PC     Object              I  Line    Source ..\..\..\..\..\Includes\prose_kernal_labels.asm
       00000036            C    70    kr_init_mouse					equ 36h 	; n
                           C    71    
       00000037            C    72    kr_get_mouse_position			equ 37h
                           C    73    
       00000038            C    74    kr_get_mouse_motion				equ 38h
       00000038            C    75    kr_get_mouse_counters			equ 38h		;pr
                           C    76    
       00000039            C    77    kr_time_delay					equ 39h
       0000003A            C    78    kr_compare_strings				equ 3ah
       0000003B            C    79    kr_hex_byte_to_ascii			equ 3bh
       0000003C            C    80    kr_ascii_to_hex_word			equ 3ch
       0000003D            C    81    kr_get_string					equ 3dh
                           C    82    
       0000003E            C    83    kr_get_version					equ 3eh
       0000003F            C    84    kr_dont_store_registers			equ 3fh
       00000040            C    85    kr_get_font_info				equ 40h
       00000041            C    86    kr_read_rtc						equ 41h
       00000042            C    87    kr_write_rtc					equ 42h
                           C    88    
       00000043            C    89    kr_get_keymap_location			equ 43h
                           C    90    
       00000044            C    91    kr_get_os_high_mem				equ 44h
       00000044            C    92    kr_get_mem_base					equ 44h		
       00000044            C    93    kr_get_ram_base					equ 44h		;pr
                           C    94    
       00000045            C    95    kr_play_audio					equ 45h
       00000046            C    96    kr_disable_audio				equ 46h
       00000047            C    97    kr_get_joysticks				equ 47h
       00000048            C    98    kr_set_video_mode				equ 48h
       00000049            C    99    kr_set_cursor_image				equ 49h
       0000004A            C   100    kr_remove_cursor				equ 4ah
       0000004B            C   101    kr_char_to_font					equ 4bh
                           C   102    
       0000004C            C   103    kr_get_disk_sector_ptr			equ 4ch
       0000004D            C   104    kr_set_timeout					equ 4dh
       0000004E            C   105    kr_test_timeout					equ 4eh
       0000004F            C   106    kr_set_pointer					equ 4fh
       00000050            C   107    kr_allocate_ram					equ 50h
       00000051            C   108    kr_deallocate_ram				equ 51h
                           C   109    
       00000052            C   110    kr_get_mem_top					equ 52h
       00000052            C   111    kr_get_ram_top					equ 52h		;pr
                           C   112    
       00000053            C   113    kr_init_msec_counter			equ 53h
       00000054            C   114    kr_read_msec_counter			equ 54h
       00000055            C   115    kr_parse_path					equ 55h
                           C   116    
                           C   117    ;----------------------------------------------
                           B     9    
                           C     0    include "misc_system_equates.asm"
                           C     1    
                           C     2    ;-- System Equates ----------------------------
Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:   6


PC     Object              I  Line    Source ..\..\..\..\..\Includes\misc_system_equates.asm
                           C     3    
       00000A00            C     4    os_location			equ 0a00h
                           C     5    
       00000A14            C     6    prose_return 		equ os_location + 14h
       00000A18            C     7    prose_relativize_hl	equ os_location + 18h
       00000A1C            C     8    prose_relative_call	equ os_location + 1ch
                           C     9    
       00000A20            C    10    prose_kernal 		equ os_location + 20h
                           C    11    
                           C    12    ;----------------------------------------------
                           C    13    
                           C    14    ; Add to sprite locations to position a 0,0 spr
                           C    15    
       0000009A            C    16    x_display_offset	equ 09ah
       00000025            C    17    y_display_offset	equ 025h
                           C    18    
                           C    19    ;----------------------------------------------
                           B    11    
                           B    12    ;----------------------------------------------
                           B    13    
                           B    14    prose_call : MACRO kernal_routine_required
                           B    15    	
                           B    16    	ld a,kernal_routine_required
                           B    17    	call.lil prose_kernal
                           B    18    
                           B    19    ENDMACRO prose_call
                           B    20    	
                           B    21    ;----------------------------------------------
                           B    22    ; Standard PROSE executable header
                           B    23    ;----------------------------------------------
                           B    24    
                           B    25    
                           B    26    	IF ADL_mode = 0
                           B    27    		org load_location&0ffffh	; if Z80 mo
                           B    28    	ELSE
010000                     B    29    		org load_location			; otherwise
                           B    30    	ENDIF
                           B    31    	
                           B    32    		.assume ADL = 1				; All PROSE
                           B    33    
010000 18 0E               B    34    		jr skip_header				; $0 - Jump
010002 50524F              B    35    		db 'PRO'					; $2 - ASCI
010005 000001              B    36    mb_loc	dw24 load_location			; $5 - Desi
010008 000000              B    37    		dw24 0						; $8 - If >
01000B 3B00                B    38    		dw prose_version_req		; $B - If >
01000D 0A01                B    39    		dw amoeba_version_req		; $D - If >
01000F 01                  B    40    		db ADL_mode					; $F - Z80 
                           B    41    
010010                     B    42    skip_header
                           B    43    	
                           B    44    	IF ADL_mode = 0 
                           B    45    		
Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:   7


PC     Object              I  Line    Source ..\..\..\..\..\Includes\PROSE_header.asm
                           B    46    mbase_offset equ load_location & 0ff0000h
                           B    47    
                           B    48    		ld a,load_location/65536	; Additiona
                           B    49    		ld MB,a						; Set MBASE
                           B    50    		jp.sis go_z80_mode			; switches 
                           B    51    
                           B    52    go_z80_mode
                           B    53    
                           B    54    		.assume ADL = 0
                           B    55    
                           B    56    	ENDIF
                           B    57    	
                           B    58    ;----------------------------------------------
                           B    59    	
                           A    16    			
                           A    17    			
                           A    18    ;----------------------------------------------
                           A    19    
010010 E5                  A    20    			push hl
010011 3E04                A    21    			ld a,kr_get_volume_info		;store 
010013 5BCD200A 00         A    22    			call.lil prose_kernal
010018 32 4C 00 01         A    23    			ld (orig_volume),a
01001C 3E1A                A    24    			ld a,kr_get_dir_cluster
01001E 5BCD200A 00         A    25    			call.lil prose_kernal
010023 ED53 4D 00 01       A    26    			ld (orig_dir_cluster),de
010028 E1                  A    27     			pop hl
                           A    28    			
010029 CD 50 00 01         A    29    			call my_prog
                           A    30    			
01002D F5                  A    31    			push af						;restor
01002E 3A 4C 00 01         A    32    			ld a,(orig_volume)
010032 5F                  A    33    			ld e,a
010033 3E03                A    34    			ld a,kr_change_volume
010035 5BCD200A 00         A    35    			call.lil prose_kernal
01003A ED5B 4D 00 01       A    36    			ld de,(orig_dir_cluster)
01003F 3E1B                A    37    			ld a,kr_set_dir_cluster
010041 5BCD200A 00         A    38    			call.lil prose_kernal
010046 F1                  A    39    			pop af
010047 5BC3140A 00         A    40    			jp.lil prose_return
                           A    41    
                           A    42    
01004C 00                  A    43    orig_volume			db 0
01004D 000000              A    44    orig_dir_cluster	dw24 0
                           A    45    
                           A    46    ;----------------------------------------------
                           A    47    ; App starts here..
                           A    48    ;----------------------------------------------
                           A    49    
                           A    50    
       00000008            A    51    chans equ 8								; numbe
                           A    52    
010050 7E                  A    53    my_prog		ld a,(hl)					; exami
Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:   8


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\ez80p\Code\PROSEB~1\Phil\EXTERN~1\playwav\src\playwav.asm
010051 B7                  A    54    			or a			
010052 CA B0 03 01         A    55    			jp z,show_use
                           A    56    			
010056 1E00                A    57    			ld e,0
010058 3E55                A    58    			ld a,kr_parse_path
01005A 5BCD200A 00         A    59    			call.lil prose_kernal
01005F C0                  A    60    			ret nz
                           A    61    			
010060 11 AC 04 01         A    62    			ld de,filename				; copy 
010064 0610                A    63    			ld b,16
010066 7E                  A    64    fnclp		ld a,(hl)
010067 B7                  A    65    			or a
010068 28 09               A    66    			jr z,fncdone
01006A FE20                A    67    			cp ' '
01006C 28 05               A    68    			jr z,fncdone
01006E 12                  A    69    			ld (de),a
01006F 23                  A    70    			inc hl
010070 13                  A    71    			inc de
010071 10 F3               A    72    			djnz fnclp
010073 AF                  A    73    fncdone		xor a
010074 12                  A    74    			ld (de),a					; null 
                           A    75    
010075 21 A0 04 01         A    76    			ld hl,loading_txt
                           A    77    			prose_call kr_print_string
                           A    78    			
                           A    79    ;----------------------------------------------
                           A    80    
010080 3E81                A    81    			ld a,081h
010082 ED390A              A    82    			out0 (port_hw_enable),a		; ensur
                           A    83    
010085 CD 8C 03 01         A    84    			call silence_all_channels
                           A    85    	
010089 21 AC 04 01         A    86    			ld hl,filename				; does 
                           A    87    			prose_call kr_open_file
010094 C0                  A    88    			ret nz
                           A    89    				
010095 0E00                A    90    			ld c,0
010097 112C0000            A    91    			ld de,44
                           A    92    			prose_call kr_set_load_length
                           A    93    				
0100A2 21 DA 04 01         A    94    			ld hl,wav_header
                           A    95    			prose_call kr_read_file		; load 
0100AD C0                  A    96    			ret nz	
                           A    97    				
0100AE DD21 DA 04 01       A    98    			ld ix,wav_header			; check
0100B3 DD7E08              A    99    			ld a,(ix+8)					
0100B6 FE57                A   100    			cp 'W'
0100B8 C2 BD 03 01         A   101    			jp nz,notwav
0100BC DD7E09              A   102    			ld a,(ix+9)
0100BF FE41                A   103    			cp 'A'
0100C1 C2 BD 03 01         A   104    			jp nz,notwav
0100C5 DD7E16              A   105    			ld a,(ix+22)				; 1 = m
Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:   9


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\ez80p\Code\PROSEB~1\Phil\EXTERN~1\playwav\src\playwav.asm
0100C8 FE01                A   106    			cp 1
0100CA C2 C3 03 01         A   107    			jp nz,badwavtype
0100CE DD7E20              A   108    			ld a,(ix+32)				; 1 = 8
0100D1 FE01                A   109    			cp 1
0100D3 C2 C3 03 01         A   110    			jp nz,badwavtype
                           A   111    
0100D7 21000000            A   112    			ld hl,0						; conve
0100DB AF                  A   113    			xor a						; a:hl 
0100DC 11CCAB00            A   114    			ld de,43980					; c:de 
0100E0 0E00                A   115    			ld c,0
0100E2 0610                A   116    			ld b,16
0100E4 DDCB193E            A   117    mult_lp		srl (ix+25)					; 24:25
0100E8 DDCB181E            A   118    			rr (ix+24)
0100EC 30 02               A   119    			jr nc,mult_no_add
0100EE 19                  A   120    			add hl,de
0100EF 89                  A   121    			adc a,c
0100F0 EB                  A   122    mult_no_add	ex de,hl
0100F1 29                  A   123    			add hl,hl
0100F2 CB11                A   124    			rl c
0100F4 EB                  A   125    			ex de,hl
0100F5 10 ED               A   126    			djnz mult_lp
0100F7 22 D2 04 01         A   127    			ld (mult32_result),hl
0100FB 32 D5 04 01         A   128    			ld (mult32_result+3),a
0100FF 2A D4 04 01         A   129    			ld hl,(mult32_result+2)
010103 29                  A   130    			add hl,hl
010104 22 D7 04 01         A   131    			ld (frequency_constant),hl
                           A   132    			
                           A   133    				
010108 DD2728              A   134    			ld hl,(ix+40)
01010B DD7E2B              A   135    			ld a,(ix+43)				; a:hl 
01010E 22 CD 04 01         A   136    			ld (samp_len_lo),hl
010112 32 D0 04 01         A   137    			ld (samp_len_hi),a
010116 B7                  A   138    			or a
010117 C2 CE 01 01         A   139    			jp nz,long_samp				; is sa
01011B 11010002            A   140    			ld de,20001h
01011F AF                  A   141    			xor a
010120 ED52                A   142    			sbc hl,de
010122 D2 CE 01 01         A   143    			jp nc,long_samp
                           A   144    			
                           A   145    ;----------------------------------------------
                           A   146    
010126 21 AC 04 01         A   147    short_samp	ld hl,filename						                           A   148    			prose_call kr_open_file
010131 C0                  A   149    			ret nz
                           A   150    			
010132 0E00                A   151    			ld c,0
010134 112C0000            A   152    			ld de,44
                           A   153    			prose_call kr_set_file_pointer
                           A   154    			
01013F 210000C0            A   155    			ld hl,vram_b_addr					                           A   156    			prose_call kr_read_file				01014A C0                  A   157    			ret nz
Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:  10


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\ez80p\Code\PROSEB~1\Phil\EXTERN~1\playwav\src\playwav.asm
                           A   158    			
01014B 210000C0            A   159    			ld hl,vram_b_addr					01014F CD 81 03 01         A   160    			call convert_samples
010153 210000C1            A   161    			ld hl,vram_b_addr+10000h			010157 CD 81 03 01         A   162    			call convert_samples
                           A   163    
01015B 3EFF                A   164    			ld a,0ffh							01015D 328014FF            A   165    			ld (hw_audio_registers+80h),a		010161 DD210014 FF         A   166    			ld ix,hw_audio_registers			010166 0608                A   167    			ld b,chans
010168 110000C0            A   168    initchlp1	ld de,vram_b_addr
01016C DD1F00              A   169    			ld (ix+00h),de						01016F ED5B CD 04 01       A   170    			ld de,(samp_len_lo)
010174 DD1F04              A   171    			ld (ix+04h),de						010177 ED5B D7 04 01       A   172    			ld de,(frequency_constant)
01017C DD1F08              A   173    			ld (ix+08h),de						01017F DD360C40            A   174    			ld (ix+0ch),40h						010183 DD360E00            A   175    			ld (ix+0eh),0
010187 DD360F03            A   176    			ld (ix+0fh),011b					01018B ED3210              A   177    			lea ix,ix+16
01018E 10 D8               A   178    			djnz initchlp1
010190 AF                  A   179    			xor a
010191 328014FF            A   180    			ld (hw_audio_registers+80h),a		                           A   181    
010195 CD 63 03 01         A   182    			call wait_audio_swap				                           A   183    
010199 3EFF                A   184    			ld a,0ffh
01019B 328014FF            A   185    			ld (hw_audio_registers+80h),a		01019F DD210014 FF         A   186    			ld ix,hw_audio_registers			0101A4 0608                A   187    			ld b,chans
0101A6 210000C0            A   188    initchlp2	ld hl,vram_b_addr
0101AA ED5B CD 04 01       A   189    			ld de,(samp_len_lo)					0101AF 19                  A   190    			add hl,de
0101B0 2B                  A   191    			dec hl
0101B1 DD2F00              A   192    			ld (ix+00h),hl						0101B4 11010000            A   193    			ld de,1
0101B8 DD1F04              A   194    			ld (ix+04h),de						0101BB DD360E00            A   195    			ld (ix+0eh),0
0101BF DD360F00            A   196    			ld (ix+0fh),000b					0101C3 ED3210              A   197    			lea ix,ix+16
0101C6 10 DE               A   198    			djnz initchlp2
0101C8 AF                  A   199    			xor a
0101C9 328014FF            A   200    			ld (hw_audio_registers+80h),a		0101CD C9                  A   201    			ret
                           A   202    						
                           A   203    ;----------------------------------------------
                           A   204    
0101CE AF                  A   205    long_samp	xor a
0101CF 32 CC 04 01         A   206    			ld (buffer),a
                           A   207    				
0101D3 21 AC 04 01         A   208    			ld hl,filename						                           A   209    			prose_call kr_open_file
Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:  11


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\ez80p\Code\PROSEB~1\Phil\EXTERN~1\playwav\src\playwav.asm
0101DE C0                  A   210    			ret nz
                           A   211    			
0101DF 0E00                A   212    			ld c,0
0101E1 112C0000            A   213    			ld de,44
                           A   214    			prose_call kr_set_file_pointer
                           A   215    
0101EC 0E00                A   216    			ld c,0								0101EE 11000002            A   217    			ld de,20000h
                           A   218    			prose_call kr_set_load_length
                           A   219    			 
0101F9 210000C0            A   220    			ld hl,vram_b_addr					                           A   221    			prose_call kr_read_file				010204 C0                  A   222    			ret nz
010205 210000C0            A   223    			ld hl,vram_b_addr
010209 CD 81 03 01         A   224    			call convert_samples				01020D 210000C1            A   225    			ld hl,vram_b_addr+10000h
010211 CD 81 03 01         A   226    			call convert_samples				                           A   227    						
010215 2A CD 04 01         A   228    			ld hl,(samp_len_lo)					010219 3A D0 04 01         A   229    			ld a,(samp_len_hi)
01021D 0600                A   230    			ld b,0
01021F 11000002            A   231    			ld de,20000h
010223 AF                  A   232    			xor a
010224 ED52                A   233    			sbc hl,de
010226 98                  A   234    			sbc a,b
010227 22 CD 04 01         A   235    			ld (samp_len_lo),hl
01022B 32 D0 04 01         A   236    			ld (samp_len_hi),a
                           A   237    			
01022F 3EFF                A   238    			ld a,0ffh
010231 328014FF            A   239    			ld (hw_audio_registers+80h),a
010235 DD210014 FF         A   240    			ld ix,hw_audio_registers			01023A 0608                A   241    			ld b,chans
01023C 110000C0            A   242    initchlp3	ld de,vram_b_addr
010240 DD1F00              A   243    			ld (ix+00h),de						010243 11000001            A   244    			ld de,65536
010247 DD1F04              A   245    			ld (ix+04h),de						01024A ED5B D7 04 01       A   246    			ld de,(frequency_constant)
01024F DD1F08              A   247    			ld (ix+08h),de						010252 DD360C40            A   248    			ld (ix+0ch),40h						010256 DD360E00            A   249    			ld (ix+0eh),0
01025A DD360F03            A   250    			ld (ix+0fh),011b					01025E ED3210              A   251    			lea ix,ix+16
010261 10 D9               A   252    			djnz initchlp3
010263 AF                  A   253    			xor a
010264 328014FF            A   254    			ld (hw_audio_registers+80h),a		                           A   255    			
010268 CD 63 03 01         A   256    			call wait_audio_swap				                           A   257    			
01026C 3EFF                A   258    			ld a,0ffh
01026E 328014FF            A   259    			ld (hw_audio_registers+80h),a
010272 DD210014 FF         A   260    			ld ix,hw_audio_registers			010277 0608                A   261    			ld b,chans
Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:  12


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\ez80p\Code\PROSEB~1\Phil\EXTERN~1\playwav\src\playwav.asm
010279 110000C1            A   262    initchlp4	ld de,vram_b_addr+65536
01027D DD1F00              A   263    			ld (ix+00h),de						010280 11000001            A   264    			ld de,65536
010284 DD1F04              A   265    			ld (ix+04h),de						010287 DD360E00            A   266    			ld (ix+0eh),0
01028B DD360F02            A   267    			ld (ix+0fh),010b					01028F ED3210              A   268    			lea ix,ix+16
010292 10 E5               A   269    			djnz initchlp4
010294 AF                  A   270    			xor a
010295 328014FF            A   271    			ld (hw_audio_registers+80h),a		                           A   272    			
010299 CD 63 03 01         A   273    ls_loop		call wait_audio_swap				01029D C2 5D 03 01         A   274    			jp nz,quit
                           A   275    			
0102A1 0E00                A   276    			ld c,0								0102A3 11000001            A   277    			ld de,10000h
                           A   278    			prose_call kr_set_load_length
                           A   279    
0102AE 210000C0            A   280    			ld hl,vram_b_addr					0102B2 3A CC 04 01         A   281    			ld a,(buffer)
0102B6 B7                  A   282    			or a
0102B7 28 04               A   283    			jr z,load_buf0
0102B9 210000C1            A   284    			ld hl,vram_b_addr+10000h
                           A   285    			
0102BD E5                  A   286    load_buf0	push hl
                           A   287    			prose_call kr_read_file				0102C5 E1                  A   288    			pop hl
0102C6 F5                  A   289    			push af
0102C7 CD 81 03 01         A   290    			call convert_samples
0102CB F1                  A   291    			pop af
0102CC 20 26               A   292    			jr nz,last_load						                           A   293    			
0102CE 2A CD 04 01         A   294    			ld hl,(samp_len_lo)					0102D2 3A D0 04 01         A   295    			ld a,(samp_len_hi)
0102D6 0600                A   296    			ld b,0
0102D8 11000001            A   297    			ld de,10000h
0102DC AF                  A   298    			xor a
0102DD ED52                A   299    			sbc hl,de
0102DF 98                  A   300    			sbc a,b
0102E0 22 CD 04 01         A   301    			ld (samp_len_lo),hl
0102E4 32 D0 04 01         A   302    			ld (samp_len_hi),a
                           A   303    			
0102E8 3A CC 04 01         A   304    			ld a,(buffer)
0102EC EE01                A   305    			xor 1
0102EE 32 CC 04 01         A   306    			ld (buffer),a						0102F2 18 A5               A   307    			jr ls_loop
                           A   308    					
                           A   309    
0102F4 DD210014 FF         A   310    last_load	ld ix,hw_audio_registers			0102F9 0608                A   311    			ld b,chans
0102FB 3EFF                A   312    			ld a,0ffh
0102FD 328014FF            A   313    			ld (hw_audio_registers+80h),a		Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:  13


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\ez80p\Code\PROSEB~1\Phil\EXTERN~1\playwav\src\playwav.asm
010301 ED5B CD 04 01       A   314    initchlp5	ld de,(samp_len_lo)
010306 DD1F04              A   315    			ld (ix+04h),de						010309 DD360F02            A   316    			ld (ix+0fh),010b					01030D ED3210              A   317    			lea ix,ix+16
010310 10 EF               A   318    			djnz initchlp5
010312 AF                  A   319    			xor a
010313 328014FF            A   320    			ld (hw_audio_registers+80h),a		                           A   321    			
010317 CD 63 03 01         A   322    es_loop		call wait_audio_swap
01031B C2 5D 03 01         A   323    			jp nz,quit
                           A   324    							
01031F 210000C0            A   325    			ld hl,vram_b_addr					010323 3A CC 04 01         A   326    			ld a,(buffer)
010327 B7                  A   327    			or a
010328 28 04               A   328    			jr z,zero_buf0
01032A 210000C1            A   329    			ld hl,vram_b_addr+10000h
01032E 3600                A   330    zero_buf0	ld (hl),0h
                           A   331    
010330 3EFF                A   332    			ld a,0ffh
010332 328014FF            A   333    			ld (hw_audio_registers+80h),a
010336 DD210014 FF         A   334    			ld ix,hw_audio_registers			01033B 0608                A   335    			ld b,chans
01033D DD2F00              A   336    initchlp6	ld (ix+00h),hl						010340 11010000            A   337    			ld de,1
010344 DD1F04              A   338    			ld (ix+04h),de						010347 DD360E00            A   339    			ld (ix+0eh),0
01034B DD360F00            A   340    			ld (ix+0fh),000b					01034F ED3210              A   341    			lea ix,ix+16
010352 10 E9               A   342    			djnz initchlp6
010354 AF                  A   343    			xor a
010355 328014FF            A   344    			ld (hw_audio_registers+80h),a		                           A   345    
010359 CD 63 03 01         A   346    			call wait_audio_swap
                           A   347    			
01035D CD 8C 03 01         A   348    quit		call silence_all_channels
010361 AF                  A   349    			xor a
010362 C9                  A   350    			ret
                           A   351    
                           A   352    
                           A   353    ;----------------------------------------------
                           A   354    
010363                     A   355    wait_audio_swap
                           A   356    
010363 AF                  A   357    			xor a
010364 ED3908              A   358    			out0 (port_selector),a
                           A   359    			
010367 320E14FF            A   360    			ld (hw_audio_registers+0eh),a		                           A   361    
01036B                     A   362    was_lp		prose_call kr_get_key				010372 FE76                A   363    			cp 76h
010374 20 02               A   364    			jr nz,nwasquit
010376 B7                  A   365    			or a
Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:  14


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\ez80p\Code\PROSEB~1\Phil\EXTERN~1\playwav\src\playwav.asm
010377 C9                  A   366    			ret
                           A   367    			
010378 ED3801              A   368    nwasquit	in0 a,(port_hw_flags)				01037B CB77                A   369    			bit 6,a
01037D 28 EC               A   370    			jr z,was_lp
01037F AF                  A   371    			xor a
010380 C9                  A   372    			ret
                           A   373    			
                           A   374    
                           A   375    ;----------------------------------------------
                           A   376    
010381                     A   377    convert_samples
                           A   378    
                           A   379    ; set HL to start address of samples in VRAM_B
                           A   380    
010381 7E                  A   381    cslp			ld a,(hl)
010382 D680                A   382    				sub 80h
010384 77                  A   383    				ld (hl),a
010385 2C                  A   384    				inc l
010386 20 F9               A   385    				jr nz,cslp
010388 24                  A   386    				inc h
010389 20 F6               A   387    				jr nz,cslp
01038B C9                  A   388    				ret
                           A   389    
                           A   390    
                           A   391    ;----------------------------------------------
                           A   392    
01038C                     A   393    silence_all_channels
                           A   394    
01038C 3EFF                A   395    				ld a,0ffh
01038E 328014FF            A   396    				ld (hw_audio_registers+80h),a	                           A   397    			
010392 DD210014 FF         A   398    				ld ix,hw_audio_registers		010397 0608                A   399    				ld b,8
010399 11000000            A   400    				ld de,0
01039D DD360F00            A   401    novol_lp		ld (ix+0fh),0					0103A1 DD360C00            A   402    				ld (ix+0ch),0					0103A5 ED3210              A   403    				lea ix,ix+16
0103A8 10 F3               A   404    				djnz novol_lp
                           A   405    
0103AA AF                  A   406    				xor a
0103AB 328014FF            A   407    				ld (hw_audio_registers+80h),a	0103AF C9                  A   408    				ret
                           A   409    
                           A   410    ;----------------------------------------------
                           A   411    
0103B0 21 45 04 01         A   412    show_use		ld hl,use_txt
                           A   413    
0103B4                     A   414    msg_exit		prose_call kr_print_string
0103BB AF                  A   415    				xor a
0103BC C9                  A   416    				ret
                           A   417    
Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:  15


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\ez80p\Code\PROSEB~1\Phil\EXTERN~1\playwav\src\playwav.asm
0103BD 21 CF 03 01         A   418    notwav			ld hl,notwav_txt
0103C1 18 F1               A   419    				jr msg_exit
                           A   420    				
0103C3 21 F0 03 01         A   421    badwavtype		ld hl,badwav_txt
0103C7 18 EB               A   422    				jr msg_exit
                           A   423    
0103C9 21 1A 04 01         A   424    sampratebad		ld hl,samprate_txt
0103CD 18 E5               A   425    				jr msg_exit	
                           A   426    
                           A   427    ;----------------------------------------------
                           A   428    
0103CF 4572726F 72202D20   A   429    notwav_txt		db "Error - Not a .wav format f
0103D7 4E6F7420 61202E77 
0103DF 61762066 6F726D61 
0103E7 74206669 6C65210B 
0103EF 00 
                           A   430    
0103F0 4572726F 72202D20   A   431    badwav_txt		db "Error - Wav file is not a p
0103F8 57617620 66696C65 
010400 20697320 6E6F7420 
010408 6120706C 61796162 
010410 6C652074 79706521 
010418 0B00 
                           A   432    
01041A 4572726F 72202D20   A   433    samprate_txt	db "Error - Wav file sample rat
010422 57617620 66696C65 
01042A 2073616D 706C6520 
010432 72617465 20697320 
01043A 746F6F20 68696768 
010442 210B00 
                           A   434    
010445 0B555345 3A20504C   A   435    use_txt			db 11,"USE: PLAYWAV [filename]"
01044D 41595741 56205B66 
010455 696C656E 616D655D 
01045D 0B0B 
01045F 57617620 66696C65   A   436    				db "Wav file must be 8 bit, mon
010467 206D7573 74206265 
01046F 20382062 69742C20 
010477 6D6F6E6F 2C205043 
01047F 4D207769 74682073 
010487 616D706C 65207261 
01048F 7465203C 3D203438 
010497 38323820 4B487A0B 
01049F 00 
                           A   437    	
0104A0 4C6F6164 696E672E   A   438    loading_txt		db "Loading...",11,0
0104A8 2E2E0B00 
                           A   439    
0104AC 00 00 00 00 00 00   A   440    filename		blkb 32,0
0104B2 00 00 00 00 00 00 
0104B8 00 00 00 00 00 00 
0104BE 00 00 00 00 00 00 
Zilog eZ80 Macro Assembler Version 4.1 (10060805)28-Sep-11     16:32:44     page:  16


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\ez80p\Code\PROSEB~1\Phil\EXTERN~1\playwav\src\playwav.asm
0104C4 00 00 00 00 00 00 
0104CA 00 00 
                           A   441    
0104CC 00                  A   442    buffer			db 0
                           A   443    
0104CD 000000              A   444    samp_len_lo		dw24 0
0104D0 0000                A   445    samp_len_hi		dw 0
                           A   446    
0104D2 00000000 00         A   447    mult32_result		db 0,0,0,0,0			;5 
                           A   448    
0104D7 000000              A   449    frequency_constant	dw24 0 		
                           A   450    
0104DA 00 00 00 00 00 00   A   451    wav_header			blkb 44,0
0104E0 00 00 00 00 00 00 
0104E6 00 00 00 00 00 00 
0104EC 00 00 00 00 00 00 
0104F2 00 00 00 00 00 00 
0104F8 00 00 00 00 00 00 
0104FE 00 00 00 00 00 00 
010504 00 00 
                           A   452    
                           A   453    ;----------------------------------------------


Errors: 0
Warnings: 0
Lines Assembled: 810
