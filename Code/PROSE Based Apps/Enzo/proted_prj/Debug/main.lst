Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:   1


PC     Object              I  Line    Source 
                           A     1    ; Zilog eZ80 ANSI C Compiler Release 3.3
                           A     2    ; -nomodsect -optspeed -noreduceopt -peephole -
                           A     3    ; -localcse -const=ROM 
                           A     4    	FILE	"..\MAIN.C"
                           A     5    	.assume ADL=1
                           A     6    	SEGMENT BSS
012B6E                     A     7    _tebuflen:
012B6E                     A     8    	DS	3
012B71                     A     9    _tebuf:
012B71                     A    10    	DS	2058
01337B                     A    11    _scn_virt:
01337B                     A    12    	DS	4000
01431B                     A    13    _scn_phys:
01431B                     A    14    	DS	4000
0152BB                     A    15    _backbuffer:
0152BB                     A    16    	DS	320
0153FB                     A    17    _root:
0153FB                     A    18    	DS	9
015404                     A    19    _p_root:
015404                     A    20    	DS	3
015407                     A    21    _p_curr:
015407                     A    22    	DS	3
01540A                     A    23    _numlines:
01540A                     A    24    	DS	3
01540D                     A    25    _cur_line:
01540D                     A    26    	DS	3
015410                     A    27    _cur_char:
015410                     A    28    	DS	3
015413                     A    29    _cur_row:
015413                     A    30    	DS	3
015416                     A    31    _cur_col:
015416                     A    32    	DS	3
015419                     A    33    _linbuf:
015419                     A    34    	DS	90
015473                     A    35    _Ascii:
015473                     A    36    	DS	1
015474                     A    37    _Scancode:
015474                     A    38    	DS	1
015475                     A    39    _B:
015475                     A    40    	DS	1
015476                     A    41    _C:
015476                     A    42    	DS	1
015477                     A    43    _E:
015477                     A    44    	DS	1
015478                     A    45    _K_xHL:
015478                     A    46    	DS	3
01547B                     A    47    _K_xBC:
01547B                     A    48    	DS	3
01547E                     A    49    _filesize:
01547E                     A    50    	DS	3
                           A    51    	SEGMENT DATA
015490                     A    52    _BufferFile:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:   2


PC     Object              I  Line    Source C:\proted\Debug\main.src
015490 0000C0              A    53    	DW24	12582912
                           A    54    	SEGMENT BSS
015481                     A    55    _TxtPnt:
015481                     A    56    	DS	3
                           A    57    	SEGMENT STRSECT
01258B                     A    58    L__0:
01258B 6E6F6E61 6D652E74   A    59    	DB	"noname.txt"
012593 7874 
012595 00                  A    60    	DB	0
                           A    61    	SEGMENT DATA
015493                     A    62    _NonameFile:
015493 8B2501              A    63    	DW24	L__0
                           A    64    	SEGMENT BSS
015484                     A    65    _UseFile:
015484                     A    66    	DS	1
015485                     A    67    _convBuf:
015485                     A    68    	DS	5
                           A    69    ;    1	#include <stdio.h>
                           A    70    ;    2	#include <stdlib.h>
                           A    71    ;    3	#include <string.h>
                           A    72    ;    4	#include <stddef.h>
                           A    73    ;    5	
                           A    74    ;    6	#include "PROSE_Header.h"
                           A    75    ;    7	
                           A    76    ;    8	#define TEBUFMAX		2048			                           A    77    ;    9	#define MAXLNLEN		80				                           A    78    ;   10	#define SCNROWS			50				                           A    79    ;   11	#define SCNCOLS			80				                           A    80    ;   12	#define VERSION			"1.0"			                           A    81    ;   13	#define FUDGE			10
                           A    82    ;   14	#define FALSE			0
                           A    83    ;   15	#define TRUE			1
                           A    84    ;   16	#define SCNSIZE 		(SCNROWS * SCNC
                           A    85    ;   17	
                           A    86    ;   18	#define EOS 			'\0'
                           A    87    ;   19	#define EOL 			'\n'
                           A    88    ;   20	#define CH_TAB 			9
                           A    89    ;   21	
                           A    90    ;   22	int tebuflen;
                           A    91    ;   23	static char tebuf[TEBUFMAX + FUDGE];
                           A    92    ;   24	char scn_virt[SCNROWS][SCNCOLS];
                           A    93    ;   25	char scn_phys[SCNROWS][SCNCOLS];
                           A    94    ;   26	char backbuffer[4][SCNCOLS];
                           A    95    ;   27	
                           A    96    ;   28	typedef struct line_t_ line_t;
                           A    97    ;   29	#define p_line_t line_t *
                           A    98    ;   30	struct line_t_
                           A    99    ;   31	 {
                           A   100    ;   32	   p_line_t 	p_prev;					                           A   101    ;   33	   p_line_t 	p_next;					                           A   102    ;   34	   char   		*p_data; 				                           A   103    ;   35	 };
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:   3


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A   104    ;   36	 
                           A   105    ;   37	line_t root;							                           A   106    ;   38	p_line_t p_root;						                           A   107    ;   39	p_line_t p_curr;						                           A   108    ;   40	int numlines, cur_line, cur_char, cur_r
                           A   109    ;   41	char linbuf[MAXLNLEN+FUDGE]; 
                           A   110    ;   42	
                           A   111    ;   43	static unsigned char Ascii, Scancode, B
                           A   112    ;   44	unsigned int K_xHL, K_xBC, filesize;
                           A   113    ;   45	char *BufferFile = (char *)0x0C00000;	                           A   114    ;   46	static char *TxtPnt;
                           A   115    ;   47	static char *NonameFile = "noname.txt";
                           A   116    ;   48	char UseFile;
                           A   117    ;   49	
                           A   118    ;   50	void GetCh(void);
                           A   119    ;   51	unsigned char getch(void);
                           A   120    ;   52	void print(const char *Txt);
                           A   121    ;   53	void get_cursor_position(unsigned char 
                           A   122    ;   54	void plot_char(unsigned char x, unsigne
                           A   123    ;   55	void clreol(void);
                           A   124    ;   56	void gotoxy(unsigned char x, unsigned c
                           A   125    ;   57	int get_prose_version(void);
                           A   126    ;   58	
                           A   127    ;   59	void uitoa(unsigned int val, char *stri
                           A   128    ;   60	char convBuf[5];
                           A   129    	SEGMENT CODE
                           A   130    ;   61	
                           A   131    ;   62	void ShowMenu(void);
                           A   132    ;   63	void Enable_Back_Color(void);
                           A   133    ;   64	void Disable_Back_Color(void);
                           A   134    ;   65	void Show_Cursor(void);
                           A   135    ;   66	void Show_Cursor_Position(void);
                           A   136    ;   67	
                           A   137    ;   68	char FileExists(void);
                           A   138    ;   69	void load_file(void);
                           A   139    ;   70	void save_file(void);
                           A   140    ;   71	void reload_file(void);
                           A   141    ;   72	
                           A   142    ;   73	void msg_window(char *msg1, char *msg2)
                           A   143    ;   74	void close_msg_window(void);
                           A   144    ;   75	
                           A   145    ;   76	/*-------------------------------------
                           A   146    ;   77	
                           A   147    ;   78	void bomb(char *txt);
                           A   148    ;   79	void as(char b, char *txt);
                           A   149    ;   80	void *mymalloc(size_t n);
                           A   150    ;   81	char blankrow(char *p);
                           A   151    ;   82	void zap_trail(char *s);
                           A   152    ;   83	void purify(char *st);
                           A   153    ;   84	void te_flu(void);
                           A   154    ;   85	unsigned char te_gch(void);
                           A   155    ;   86	void te_chr(char ch);
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:   4


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A   156    ;   87	void te_str(char *s);
                           A   157    ;   88	void te_mov(unsigned char r, unsigned c
                           A   158    ;   89	void te_cln(unsigned char row);
                           A   159    ;   90	void te_clr(void);
                           A   160    ;   91	void te_ini(void);
                           A   161    ;   92	void te_fin(void);
                           A   162    ;   93	
                           A   163    ;   94	void sc_clr(void);
                           A   164    ;   95	void sc_crw(unsigned char row);
                           A   165    ;   96	void sc_chr(unsigned char row, unsigned
                           A   166    ;   97	void sc_str(unsigned char row, unsigned
                           A   167    ;   98	void sc_upd(void);
                           A   168    ;   99	void sc_fup(void);
                           A   169    ;  100	void sc_ini(void);
                           A   170    ;  101	void sc_fin(void);
                           A   171    ;  102	
                           A   172    ;  103	void tx_ini(void);
                           A   173    ;  104	void tx_set(p_line_t p_line, char *s);
                           A   174    ;  105	void tx_ins(p_line_t p_line, char *s);
                           A   175    ;  106	void tx_del(p_line_t p_line);
                           A   176    ;  107	void tx_get(p_line_t p_line);
                           A   177    ;  108	void tx_put(p_line_t p_line);
                           A   178    ;  109	
                           A   179    ;  110	void do_red(void);
                           A   180    ;  111	void do_cup(void);
                           A   181    ;  112	void do_cdw(void);
                           A   182    ;  113	void do_clf(void);
                           A   183    ;  114	void do_crt(void);
                           A   184    ;  115	void do_pdw(void);
                           A   185    ;  116	void do_pup(void);
                           A   186    ;  117	void do_ret(void);
                           A   187    ;  118	void do_enhanced_ret(void);
                           A   188    ;  119	void do_tab(void);
                           A   189    ;  120	void do_top(void);
                           A   190    ;  121	void do_bot(char paint);
                           A   191    ;  122	void do_chr(char ch);
                           A   192    ;  123	void do_dch(void);
                           A   193    ;  124	void do_iln(void);
                           A   194    ;  125	void do_dln(void);
                           A   195    ;  126	void do_del(void);
                           A   196    ;  127	void do_enhanced_del(void);
                           A   197    ;  128	void do_home(void);
                           A   198    ;  129	void do_endline(void);
                           A   199    ;  130	
                           A   200    ;  131	void paintall(void);
                           A   201    ;  132	void paintrow(void);
                           A   202    ;  133	
                           A   203    ;  134	void edit(void);
                           A   204    ;  135	
                           A   205    ;  136	/*-------------------------------------
                           A   206    ;  137	void main(void)
                           A   207    ;  138	{
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:   5


PC     Object              I  Line    Source C:\proted\Debug\main.src
010000                     A   208    _main:
                           A   209    ;  139		INIT_HARDWARE;
       0000009A            A   210    PB_DR		equ 09Ah
       0000009B            A   211    PB_DDR		equ 09Bh
       0000009C            A   212    PB_ALT1		equ 09Ch
       0000009D            A   213    PB_ALT2		equ 09Dh
       0000009E            A   214    PC_DR		equ 09Eh
       0000009F            A   215    PC_DDR		equ 09Fh
       000000A0            A   216    PC_ALT1		equ 0A0h
       000000A1            A   217    PC_ALT2		equ 0A1h
       000000A2            A   218    PD_DR		equ 0A2h
       000000A3            A   219    PD_DDR		equ 0A3h
       000000A4            A   220    PD_ALT1		equ 0A4h
       000000A5            A   221    PD_ALT2		equ 0A5h
       000000C0            A   222    UART0_RBR	equ 0C0h
       000000C0            A   223    UART0_THR	equ 0C0h
       000000C0            A   224    UART0_BRG_L	equ 0C0h
       000000C1            A   225    UART0_BRG_H	equ 0C1h
       000000C1            A   226    UART0_IER	equ 0C1h
       000000C2            A   227    UART0_FCTL	equ 0C2h
       000000C3            A   228    UART0_LCTL	equ 0C3h
       000000C4            A   229    UART0_MCTL	equ 0C4h
       000000C5            A   230    UART0_LSR	equ 0C5h
       000000C6            A   231    UART0_MSR	equ 0C6h
       000000A8            A   232    CS0_LBR		equ 0A8h
       000000A9            A   233    CS0_UBR		equ 0A9h
       000000AA            A   234    CS0_CTL		equ 0AAh
       000000AB            A   235    CS1_LBR		equ 0ABh
       000000AC            A   236    CS1_UBR		equ 0ACh
       000000AD            A   237    CS1_CTL		equ 0ADh
       000000AE            A   238    CS2_LBR		equ 0AEh
       000000AF            A   239    CS2_UBR		equ 0AFh
       000000B0            A   240    CS2_CTL		equ 0B0h
       000000B1            A   241    CS3_LBR		equ 0B1h
       000000B2            A   242    CS3_UBR		equ 0B2h
       000000B3            A   243    CS3_CTL		equ 0B3h
       00000080            A   244    TMR0_CTL		equ 080h
       00000081            A   245    TMR0_DR_L	equ 081h
       00000081            A   246    TMR0_RR_L	equ 081h
       00000082            A   247    TMR0_DR_H	equ 082h
       00000082            A   248    TMR0_RR_H	equ 082h
       00000092            A   249    TMR_ISS		equ 092h
       000000ED            A   250    RTC_CTRL		equ 0EDh
       000000EC            A   251    RTC_ACTRL	equ 0ECh
       000000E0            A   252    RTC_SEC		equ 0E0h
       000000E1            A   253    RTC_MIN		equ 0E1h
       000000E2            A   254    RTC_HRS		equ 0E2h
       000000E3            A   255    RTC_DOW		equ 0E3h
       000000E4            A   256    RTC_DOM		equ 0E4h
       000000E5            A   257    RTC_MON		equ 0E5h
       000000E6            A   258    RTC_YR		equ 0E6h
       000000E7            A   259    RTC_CEN		equ 0E7h
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:   6


PC     Object              I  Line    Source C:\proted\Debug\main.src
       00000000            A   260    port_pic_data		equ 000h
       00000001            A   261    port_pic_ctrl		equ 001h
       00000001            A   262    port_hw_flags		equ 001h
       00000002            A   263    port_sdc_ctrl		equ 002h
       00000002            A   264    port_keyboard_data	equ 002h
       00000003            A   265    port_sdc_data		equ 003h
       00000004            A   266    port_memory_paging	equ 004h
       00000005            A   267    port_irq_ctrl		equ 005h
       00000006            A   268    port_nmi_ack			equ 006h
       00000007            A   269    port_ps2_ctrl		equ 007h
       00000008            A   270    port_selector		equ 008h
       00000006            A   271    port_mouse_data		equ 006h
       00000009            A   272    port_clear_flags		equ 009h
       00000000            A   273    sdc_power			equ 0h
       00000001            A   274    sdc_cs				equ 1h
       00000002            A   275    sdc_speed			equ 2h
       00000004            A   276    sdc_serializer_busy	equ 4h
       00000005            A   277    vrt					equ 5h
       00000000            A   278    sysram_addr			equ 0000000h
       00800000            A   279    vram_a_addr			equ 0800000h
       00C00000            A   280    vram_b_addr			equ 0C00000h
       00FF0000            A   281    hw_palette			equ 0ff0000h
       00FF0800            A   282    hw_sprite_registers	equ 0ff0800h
       00FF1000            A   283    hw_video_parameters	equ 0ff1000h
       00FF1400            A   284    hw_audio_registers	equ 0ff1400h
       00FF1800            A   285    hw_video_settings	equ 0ff1800h
       00FF1000            A   286    tilemap_parameters	equ hw_video_parameters + 0
       00FF1020            A   287    bitmap_parameters	equ hw_video_parameters + 2
       00FF1800            A   288    video_control		equ hw_video_settings + 00h
       00FF1801            A   289    sprite_control		equ hw_video_settings + 01h
       00FF1802            A   290    bgnd_palette_select	equ hw_video_settings + 02h
       00FF1803            A   291    sprite_palette_select	equ hw_video_settings +
       00FF1804            A   292    right_border_position	equ hw_video_settings +
       00000A00            A   293    os_start			equ 0A00h
       00000A14            A   294    prose_return		equ os_start + 14h
       00000A20            A   295    prose_kernal		equ os_start + 20h
                           A   296    ;  140		INIT_KJT;
       00000000            A   297    kr_mount_volumes			equ 00h
       00000001            A   298    kr_get_device_info		equ 01h
       00000002            A   299    kr_check_volume_format	equ 02h
       00000003            A   300    kr_change_volume			equ 03h
       00000004            A   301    kr_get_volume_info		equ 04h
       00000005            A   302    kr_format_device			equ 05h
       00000006            A   303    kr_make_dir				equ 06h
       00000007            A   304    kr_change_dir			equ 07h
       00000008            A   305    kr_parent_dir			equ 08h
       00000009            A   306    kr_root_dir				equ 09h
       0000000A            A   307    kr_delete_dir			equ 0Ah
       0000000B            A   308    kr_find_file				equ 0Bh
       0000000C            A   309    kr_set_file_pointer		equ 0Ch
       0000000D            A   310    kr_set_load_length		equ 0Dh
       0000000E            A   311    kr_read_file				equ 0Eh
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:   7


PC     Object              I  Line    Source C:\proted\Debug\main.src
       0000000F            A   312    kr_erase_file			equ 0Fh
       00000010            A   313    kr_rename_file			equ 10h
       00000011            A   314    kr_create_file			equ 11h
       00000012            A   315    kr_write_file			equ 12h
       00000013            A   316    kr_get_total_sectors		equ 13h
       00000014            A   317    kr_dir_list_first_entry	equ 14h
       00000015            A   318    kr_dir_list_get_entry	equ 15h
       00000016            A   319    kr_dir_list_next_entry	equ 16h
       00000017            A   320    kr_read_sector			equ 17h
       00000018            A   321    kr_write_sector			equ 18h
       00000019            A   322    kr_file_sector_list		equ 19h
       0000001A            A   323    kr_get_dir_cluster		equ 1Ah
       0000001B            A   324    kr_set_dir_cluster		equ 1Bh
       0000001C            A   325    kr_get_dir_name			equ 1Ch
       0000001D            A   326    kr_wait_key				equ 1Dh
       0000001E            A   327    kr_get_key				equ 1Eh
       0000001F            A   328    kr_get_key_mod_flags		equ 1Fh
       00000020            A   329    kr_serial_receive_header	equ 20h
       00000021            A   330    kr_serial_receive_file	equ 21h
       00000022            A   331    kr_serial_send_file		equ 22h
       00000023            A   332    kr_serial_tx_byte		equ 23h
       00000024            A   333    kr_serial_rx_byte		equ 24h
       00000025            A   334    kr_print_string			equ 25h
       00000026            A   335    kr_clear_screen			equ 26h
       00000027            A   336    kr_wait_vrt				equ 27h
       00000028            A   337    kr_set_cursor_position	equ 28h
       00000029            A   338    kr_plot_char				equ 29h
       0000002A            A   339    kr_set_pen				equ 2Ah
       0000002B            A   340    kr_background_colours	equ 2Bh
       0000002C            A   341    kr_draw_cursor			equ 2Ch
       0000002D            A   342    kr_get_pen				equ 2Dh
       0000002E            A   343    kr_scroll_up				equ 2Eh
       0000002F            A   344    kr_os_display			equ 2Fh
       00000030            A   345    kr_get_display_size		equ 30h
       00000031            A   346    kr_get_charmap_addr_xy	equ 31h
       00000032            A   347    kr_get_cursor_position	equ 32h
       00000033            A   348    kr_set_envar				equ 33h
       00000034            A   349    kr_get_envar				equ 34h
       00000035            A   350    kr_delete_envar			equ 35h
       00000036            A   351    kr_set_mouse_window		equ 36h
       00000037            A   352    kr_get_mouse_position	equ 37h
       00000038            A   353    kr_get_mouse_motion		equ 38h
       00000039            A   354    kr_time_delay			equ 39h
       0000003A            A   355    kr_compare_strings		equ 3Ah
       0000003B            A   356    kr_hex_byte_to_ascii		equ 3Bh
       0000003C            A   357    kr_ascii_to_hex_word		equ 3Ch
       0000003D            A   358    kr_get_string			equ 3Dh
       0000003E            A   359    kr_get_version			equ 3Eh
       0000003F            A   360    kr_dont_store_registers	equ 3Fh
       00000040            A   361    kr_get_font_info			equ 40h
       00000041            A   362    kr_read_rtc				equ 41h
       00000042            A   363    kr_write_rtc				equ 42h
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:   8


PC     Object              I  Line    Source C:\proted\Debug\main.src
       00000043            A   364    kr_get_keymap_location	equ 43h
                           A   365    ;  141		
                           A   366    ;  142		CREATE_HEADER;
010000 18 0E               A   367    jr skip_header
010002 50524F              A   368    db 'PRO'
010005 000001              A   369    mb_loc dw24 10000h
010008 000000              A   370    dw24 0
01000B 0000                A   371    dw 0
01000D 0000                A   372    dw 0
01000F 01                  A   373    db 1
010010                     A   374    skip_header
                           A   375    ;  143		
                           A   376    ;  144		UseFile = 0;
010010 AF                  A   377    	XOR	A,A
010011 32 84 54 01         A   378    	LD	(_UseFile),A
                           A   379    ;  145		
                           A   380    ;  146		asm ("ld a, (hl)");
010015 7E                  A   381    ld a, (hl)
                           A   382    ;  147		asm ("or a");
010016 B7                  A   383    or a
                           A   384    ;  148		asm ("jr z, no_param");
010017 28 0A               A   385    jr z, no_param
                           A   386    ;  149		asm ("ld (_K_xHL), hl");	//If pa
010019 22 78 54 01         A   387    ld (_K_xHL), hl
                           A   388    ;  150		
                           A   389    ;  151		UseFile = 1;
01001D 3E01                A   390    	LD	A,1
01001F 32 84 54 01         A   391    	LD	(_UseFile),A
                           A   392    ;  152		
                           A   393    ;  153		asm ("no_param:");
010023                     A   394    no_param:
                           A   395    ;  154		
                           A   396    ;  155		if (get_prose_version() < 0x2F)
010023 CD 45 03 01         A   397    	CALL	_get_prose_version
010027 012F0000            A   398    	LD	BC,47
01002B B7                  A   399    	OR	A,A
01002C ED42                A   400    	SBC	HL,BC
01002E F2 38 00 01         A   401    	JP	P,L__12
010032 EA 50 00 01         A   402    	JP	PE,L_1
010036 18 04               A   403    	JR	L__13
010038                     A   404    L__12:
010038 E2 50 00 01         A   405    	JP	PO,L_1
01003C                     A   406    L__13:
                           A   407    ;  156		{
                           A   408    ;  157			print("Proted require PROSE ver
01003C 01 96 25 01         A   409    	LD	BC,L__2
010040 C5                  A   410    	PUSH	BC
010041 CD 50 02 01         A   411    	CALL	_print
010045 C1                  A   412    	POP	BC
                           A   413    ;  158			
                           A   414    ;  159			QUIT_TO_PROSE;
010046 AF                  A   415    xor a
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:   9


PC     Object              I  Line    Source C:\proted\Debug\main.src
010047 5BC3140A 00         A   416    jp.lil prose_return
                           A   417    ;  160			
                           A   418    ;  161			return;
01004C C3 03 01 01         A   419    	JR	L_5
                           A   420    ;  162		}
010050                     A   421    L_1:
                           A   422    ;  163		
                           A   423    ;  164		asm ("push ix");
010050 DDE5                A   424    push ix
                           A   425    ;  165		asm ("ld a, kr_clear_screen");
010052 3E26                A   426    ld a, kr_clear_screen
                           A   427    ;  166		asm ("call.lil prose_kernal");
010054 5BCD200A 00         A   428    call.lil prose_kernal
                           A   429    ;  167		asm ("pop ix");
010059 DDE1                A   430    pop ix
                           A   431    ;  168		
                           A   432    ;  169		memset(BufferFile, 0, 1024 * 512);	01005B 01000008            A   433    	LD	BC,524288
01005F C5                  A   434    	PUSH	BC
010060 01000000            A   435    	LD	BC,0
010064 C5                  A   436    	PUSH	BC
010065 ED4B 90 54 01       A   437    	LD	BC,(_BufferFile)
01006A C5                  A   438    	PUSH	BC
01006B CD 3C 25 01         A   439    	CALL	_memset
01006F C1                  A   440    	POP	BC
010070 C1                  A   441    	POP	BC
010071 C1                  A   442    	POP	BC
                           A   443    ;  170		
                           A   444    ;  171		ShowMenu();
010072 CD 40 18 01         A   445    	CALL	_ShowMenu
                           A   446    ;  172		
                           A   447    ;  173		te_ini();
010076 CD 4C 07 01         A   448    	CALL	_te_ini
                           A   449    ;  174		sc_ini();
01007A CD BD 09 01         A   450    	CALL	_sc_ini
                           A   451    ;  175		tx_ini();
01007E CD CF 09 01         A   452    	CALL	_tx_ini
                           A   453    ;  176		
                           A   454    ;  177		if (UseFile == 1)
010082 3A 84 54 01         A   455    	LD	A,(_UseFile)
010086 FE01                A   456    	CP	A,1
010088 20 16               A   457    	JR	NZ,L_4
                           A   458    ;  178			if (FileExists() == 1)
01008A CD 98 1B 01         A   459    	CALL	_FileExists
01008E 47                  A   460    	LD	B,A
01008F 17ED62              A   461    	SEXT	HL
010092 68                  A   462    	LD	L,B
010093 B7                  A   463    	OR	A,A
010094 01010000            A   464    	LD	BC,1
010098 ED42                A   465    	SBC	HL,BC
01009A 20 04               A   466    	JR	NZ,L_4
                           A   467    ;  179				load_file();		
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  10


PC     Object              I  Line    Source C:\proted\Debug\main.src
01009C CD C1 1B 01         A   468    	CALL	_load_file
0100A0                     A   469    L_4:
                           A   470    ;  180		
                           A   471    ;  181		edit();
0100A0 CD CF 18 01         A   472    	CALL	_edit
                           A   473    ;  182		
                           A   474    ;  183		sc_fin();
0100A4 CD C6 09 01         A   475    	CALL	_sc_fin
                           A   476    ;  184		te_fin();
0100A8 CD 56 07 01         A   477    	CALL	_te_fin
                           A   478    ;  185		
                           A   479    ;  186		asm ("proted_exit:");
0100AC                     A   480    proted_exit:
                           A   481    ;  187		asm ("push ix");
0100AC DDE5                A   482    push ix
                           A   483    ;  188		asm ("ld a, kr_clear_screen");
0100AE 3E26                A   484    ld a, kr_clear_screen
                           A   485    ;  189		asm ("call.lil prose_kernal");
0100B0 5BCD200A 00         A   486    call.lil prose_kernal
                           A   487    ;  190		asm ("pop ix");
0100B5 DDE1                A   488    pop ix
                           A   489    ;  191		
                           A   490    ;  192		print("\n\r");
0100B7 01 BE 25 01         A   491    	LD	BC,L__5
0100BB C5                  A   492    	PUSH	BC
0100BC CD 50 02 01         A   493    	CALL	_print
0100C0 C1                  A   494    	POP	BC
                           A   495    ;  193		print("PROTED ver ");
0100C1 01 C1 25 01         A   496    	LD	BC,L__6
0100C5 C5                  A   497    	PUSH	BC
0100C6 CD 50 02 01         A   498    	CALL	_print
0100CA C1                  A   499    	POP	BC
                           A   500    ;  194		print(VERSION);
0100CB 01 CD 25 01         A   501    	LD	BC,L__7
0100CF C5                  A   502    	PUSH	BC
0100D0 CD 50 02 01         A   503    	CALL	_print
0100D4 C1                  A   504    	POP	BC
                           A   505    ;  195		print(" rel.: ");
0100D5 01 D1 25 01         A   506    	LD	BC,L__8
0100D9 C5                  A   507    	PUSH	BC
0100DA CD 50 02 01         A   508    	CALL	_print
0100DE C1                  A   509    	POP	BC
                           A   510    ;  196		print(__DATE__);
0100DF 01 D9 25 01         A   511    	LD	BC,L__9
0100E3 C5                  A   512    	PUSH	BC
0100E4 CD 50 02 01         A   513    	CALL	_print
0100E8 C1                  A   514    	POP	BC
                           A   515    ;  197		print("\n\r");
0100E9 01 E5 25 01         A   516    	LD	BC,L__10
0100ED C5                  A   517    	PUSH	BC
0100EE CD 50 02 01         A   518    	CALL	_print
0100F2 C1                  A   519    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  11


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A   520    ;  198		print("Created by Calogiuri Enzo An
0100F3 01 E8 25 01         A   521    	LD	BC,L__11
0100F7 C5                  A   522    	PUSH	BC
0100F8 CD 50 02 01         A   523    	CALL	_print
0100FC C1                  A   524    	POP	BC
                           A   525    ;  199		
                           A   526    ;  200		QUIT_TO_PROSE;
0100FD AF                  A   527    xor a
0100FE 5BC3140A 00         A   528    jp.lil prose_return
                           A   529    ;  201	}
010103                     A   530    L_5:
010103 C9                  A   531    	RET	
                           A   532    
                           A   533    
                           A   534    ;**************************** _main ***********
                           A   535    ;Name                         Addr/Register   S
                           A   536    ;_te_fin                             IMPORT  --
                           A   537    ;_sc_fin                             IMPORT  --
                           A   538    ;_edit                               IMPORT  --
                           A   539    ;_load_file                          IMPORT  --
                           A   540    ;_FileExists                         IMPORT  --
                           A   541    ;_tx_ini                             IMPORT  --
                           A   542    ;_sc_ini                             IMPORT  --
                           A   543    ;_te_ini                             IMPORT  --
                           A   544    ;_ShowMenu                           IMPORT  --
                           A   545    ;_BufferFile                         STATIC    
                           A   546    ;_memset                             IMPORT  --
                           A   547    ;_print                              IMPORT  --
                           A   548    ;_get_prose_version                  IMPORT  --
                           A   549    ;_UseFile                            STATIC    
                           A   550    
                           A   551    
                           A   552    ; Stack Frame Size: 6 (bytes)
                           A   553    ;       Spill Code: 0 (instruction)
                           A   554    
                           A   555    
                           A   556    	SEGMENT STRSECT
012596                     A   557    L__2:
012596 50726F74 65642072   A   558    	DB	"Proted require PROSE ver 2F or later!"
01259E 65717569 72652050 
0125A6 524F5345 20766572 
0125AE 20324620 6F72206C 
0125B6 61746572 21 
0125BB 0A0D00              A   559    	DB	10,13,0
0125BE                     A   560    L__5:
0125BE 0A0D00              A   561    	DB	10,13,0
0125C1                     A   562    L__6:
0125C1 50524F54 45442076   A   563    	DB	"PROTED ver "
0125C9 657220 
0125CC 00                  A   564    	DB	0
0125CD                     A   565    L__7:
0125CD 312E30              A   566    	DB	"1.0"
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  12


PC     Object              I  Line    Source C:\proted\Debug\main.src
0125D0 00                  A   567    	DB	0
0125D1                     A   568    L__8:
0125D1 2072656C 2E3A20     A   569    	DB	" rel.: "
0125D8 00                  A   570    	DB	0
0125D9                     A   571    L__9:
0125D9 4A756C20 32302032   A   572    	DB	"Jul 20 2011"
0125E1 303131 
0125E4 00                  A   573    	DB	0
0125E5                     A   574    L__10:
0125E5 0A0D00              A   575    	DB	10,13,0
0125E8                     A   576    L__11:
0125E8 43726561 74656420   A   577    	DB	"Created by Calogiuri Enzo Antonio for 
0125F0 62792043 616C6F67 
0125F8 69757269 20456E7A 
012600 6F20416E 746F6E69 
012608 6F20666F 7220655A 
012610 38305020 66616E73 
012618 203A2D29 
01261C 0A0D00              A   578    	DB	10,13,0
                           A   579    	SEGMENT CODE
                           A   580    ;  202	
                           A   581    ;  203	/* Get ascii and scancode value of key 
                           A   582    ;  204	void GetCh(void)
                           A   583    ;  205	{
010104                     A   584    _GetCh:
                           A   585    ;  206		Ascii = Scancode = 0;
010104 AF                  A   586    	XOR	A,A
010105 32 74 54 01         A   587    	LD	(_Scancode),A
010109 AF                  A   588    	XOR	A,A
01010A 32 73 54 01         A   589    	LD	(_Ascii),A
                           A   590    ;  207		
                           A   591    ;  208		asm ("push ix");
01010E DDE5                A   592    push ix
                           A   593    ;  209		asm ("ld a, kr_get_key");
010110 3E1E                A   594    ld a, kr_get_key
                           A   595    ;  210		asm ("call.lil prose_kernal");
010112 5BCD200A 00         A   596    call.lil prose_kernal
                           A   597    ;  211		asm ("jr nz, NoKeyInB");
010117 20 09               A   598    jr nz, NoKeyInB
                           A   599    ;  212		asm ("ld (_Scancode), a");
010119 32 74 54 01         A   600    ld (_Scancode), a
                           A   601    ;  213		asm ("ld a, b");
01011D 78                  A   602    ld a, b
                           A   603    ;  214		asm ("ld (_Ascii), a");
01011E 32 73 54 01         A   604    ld (_Ascii), a
                           A   605    ;  215		asm ("NoKeyInB:");
010122                     A   606    NoKeyInB:
                           A   607    ;  216		asm ("pop ix");
010122 DDE1                A   608    pop ix
                           A   609    ;  217	}
010124 C9                  A   610    	RET	
                           A   611    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  13


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A   612    
                           A   613    ;**************************** _GetCh **********
                           A   614    ;Name                         Addr/Register   S
                           A   615    ;_Ascii                              STATIC    
                           A   616    ;_Scancode                           STATIC    
                           A   617    
                           A   618    
                           A   619    ; Stack Frame Size: 6 (bytes)
                           A   620    ;       Spill Code: 0 (instruction)
                           A   621    
                           A   622    
                           A   623    ;  218	
                           A   624    ;  219	/* Manage the input from keyboard */
                           A   625    ;  220	unsigned char getch(void)
                           A   626    ;  221	{
010125                     A   627    _getch:
                           A   628    ;  222		while (1)
010125                     A   629    L_26:
                           A   630    ;  223		{	
                           A   631    ;  224			GetCh();	
010125 CD 04 01 01         A   632    	CALL	_GetCh
                           A   633    ;  225			
                           A   634    ;  226			switch (Scancode)
010129 3A 74 54 01         A   635    	LD	A,(_Scancode)
01012D B7ED62              A   636    	UEXT	HL
010130 6F                  A   637    	LD	L,A
010131 E5C1                A   638    	LD	BC,HL
010133                     A   639    L__18:
010133 11690000            A   640    	LD	DE,105
010137 B7                  A   641    	OR	A,A
010138 ED52                A   642    	SBC	HL,DE
01013A 38 24               A   643    	JR	C,L__19
01013C 216C0000            A   644    	LD	HL,108
010140 B7                  A   645    	OR	A,A
010141 ED42                A   646    	SBC	HL,BC
010143 38 69               A   647    	JR	C,L__21
010145 C5E1                A   648    	LD	HL,BC
010147 29                  A   649    	ADD	HL,HL
010148 29                  A   650    	ADD	HL,HL
010149 B7                  A   651    	OR	A,A
01014A ED42                A   652    	SBC	HL,BC
01014C 11 19 00 01         A   653    	LD	DE,L__16-315
010150 19                  A   654    	ADD	HL,DE
010151 ED27                A   655    	LD	HL,(HL)
010153 E9                  A   656    	JP	(HL)
010154                     A   657    L__16:
010154 3C0201              A   658    	DW24	L_21	
                           A   659    
010157 420201              A   660    	DW24	L_24	
                           A   661    
01015A 3C0201              A   662    	DW24	L_17	
                           A   663    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  14


PC     Object              I  Line    Source C:\proted\Debug\main.src
01015D 3C0201              A   664    	DW24	L_20	
                           A   665    
010160                     A   666    L__19:
010160 115A0000            A   667    	LD	DE,90
010164 C5E1                A   668    	LD	HL,BC
010166 B7                  A   669    	OR	A,A
010167 ED52                A   670    	SBC	HL,DE
010169 CA 27 02 01         A   671    	JR	Z,L_12
01016D 215A0000            A   672    	LD	HL,90
010171 B7                  A   673    	OR	A,A
010172 ED42                A   674    	SBC	HL,BC
010174 38 29               A   675    	JR	C,L__24
010176 11120000            A   676    	LD	DE,18
01017A C5E1                A   677    	LD	HL,BC
01017C B7                  A   678    	OR	A,A
01017D ED52                A   679    	SBC	HL,DE
01017F CA 33 02 01         A   680    	JR	Z,L_14
010183 21120000            A   681    	LD	HL,18
010187 B7                  A   682    	OR	A,A
010188 ED42                A   683    	SBC	HL,BC
01018A DA 42 02 01         A   684    	JR	C,L_24
01018E 110D0000            A   685    	LD	DE,13
010192 C5E1                A   686    	LD	HL,BC
010194 B7                  A   687    	OR	A,A
010195 ED52                A   688    	SBC	HL,DE
010197 CA 1F 02 01         A   689    	JR	Z,L_11
01019B C3 42 02 01         A   690    	JR	L_24
01019F                     A   691    L__24:
01019F 11660000            A   692    	LD	DE,102
0101A3 C5E1                A   693    	LD	HL,BC
0101A5 B7                  A   694    	OR	A,A
0101A6 ED52                A   695    	SBC	HL,DE
0101A8 28 6D               A   696    	JR	Z,L_10
0101AA C3 42 02 01         A   697    	JR	L_24
0101AE                     A   698    L__21:
0101AE 117A0000            A   699    	LD	DE,122
0101B2 C5E1                A   700    	LD	HL,BC
0101B4 B7                  A   701    	OR	A,A
0101B5 ED52                A   702    	SBC	HL,DE
0101B7 28 56               A   703    	JR	Z,L_9
0101B9 217A0000            A   704    	LD	HL,122
0101BD B7                  A   705    	OR	A,A
0101BE ED42                A   706    	SBC	HL,BC
0101C0 38 32               A   707    	JR	C,L__29
0101C2 11710000            A   708    	LD	DE,113
0101C6 C5E1                A   709    	LD	HL,BC
0101C8 B7                  A   710    	OR	A,A
0101C9 ED52                A   711    	SBC	HL,DE
0101CB 38 75               A   712    	JR	C,L_24
0101CD 21750000            A   713    	LD	HL,117
0101D1 B7                  A   714    	OR	A,A
0101D2 ED42                A   715    	SBC	HL,BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  15


PC     Object              I  Line    Source C:\proted\Debug\main.src
0101D4 38 6C               A   716    	JR	C,L_24
0101D6 C5E1                A   717    	LD	HL,BC
0101D8 29                  A   718    	ADD	HL,HL
0101D9 29                  A   719    	ADD	HL,HL
0101DA B7                  A   720    	OR	A,A
0101DB ED42                A   721    	SBC	HL,BC
0101DD 11 92 00 01         A   722    	LD	DE,L__17-339
0101E1 19                  A   723    	ADD	HL,DE
0101E2 ED27                A   724    	LD	HL,(HL)
0101E4 E9                  A   725    	JP	(HL)
0101E5                     A   726    L__17:
0101E5 070201              A   727    	DW24	L_8	
                           A   728    
0101E8 3C0201              A   729    	DW24	L_19	
                           A   730    
0101EB 420201              A   731    	DW24	L_24	
                           A   732    
0101EE 3C0201              A   733    	DW24	L_22	
                           A   734    
0101F1 3C0201              A   735    	DW24	L_18	
                           A   736    
0101F4                     A   737    L__29:
0101F4 117D0000            A   738    	LD	DE,125
0101F8 C5E1                A   739    	LD	HL,BC
0101FA B7                  A   740    	OR	A,A
0101FB ED52                A   741    	SBC	HL,DE
0101FD 20 43               A   742    	JR	NZ,L_24
                           A   743    ;  227			{
                           A   744    ;  228				case 0x7D	: Ascii = 3; br
0101FF 3E03                A   745    	LD	A,3
010201 32 73 54 01         A   746    	LD	(_Ascii),A
010205 18 3B               A   747    	JR	L_24
                           A   748    ;  229				
                           A   749    ;  230				case 0x71	: Ascii = 4; br
010207                     A   750    L_8:
010207 3E04                A   751    	LD	A,4
010209 32 73 54 01         A   752    	LD	(_Ascii),A
01020D 18 33               A   753    	JR	L_24
                           A   754    ;  231	
                           A   755    ;  232				case 0x7A	: Ascii = 6; br
01020F                     A   756    L_9:
01020F 3E06                A   757    	LD	A,6
010211 32 73 54 01         A   758    	LD	(_Ascii),A
010215 18 2B               A   759    	JR	L_24
                           A   760    ;  233				
                           A   761    ;  234				case 102	: Ascii = 8; br
010217                     A   762    L_10:
010217 3E08                A   763    	LD	A,8
010219 32 73 54 01         A   764    	LD	(_Ascii),A
01021D 18 23               A   765    	JR	L_24
                           A   766    ;  235				
                           A   767    ;  236				case 0xD	: Ascii = 9; br
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  16


PC     Object              I  Line    Source C:\proted\Debug\main.src
01021F                     A   768    L_11:
01021F 3E09                A   769    	LD	A,9
010221 32 73 54 01         A   770    	LD	(_Ascii),A
010225 18 1B               A   771    	JR	L_24
                           A   772    ;  237				
                           A   773    ;  238				case 90		: Ascii = 13; b
010227                     A   774    L_12:
010227 3E0D                A   775    	LD	A,13
010229 32 73 54 01         A   776    	LD	(_Ascii),A
01022D 18 13               A   777    	JR	L_24
                           A   778    ;  239				
                           A   779    ;  240				case 0x12	: while (Ascii 
01022F                     A   780    L_15:
                           A   781    ;  241								GetCh();
01022F CD 04 01 01         A   782    	CALL	_GetCh
010233                     A   783    L_14:
010233 3A 73 54 01         A   784    	LD	A,(_Ascii)
010237 B7                  A   785    	OR	A,A
010238 28 F5               A   786    	JR	Z,L_15
                           A   787    ;  242								
                           A   788    ;  243							  break;
01023A 18 06               A   789    	JR	L_24
                           A   790    ;  244				
                           A   791    ;  245				case 0x6B	:
01023C                     A   792    L_17:
                           A   793    ;  246				case 0x75	:
01023C                     A   794    L_18:
                           A   795    ;  247				case 0x72	:
01023C                     A   796    L_19:
                           A   797    ;  248				case 0x6C	:
01023C                     A   798    L_20:
                           A   799    ;  249				case 0x69	:
01023C                     A   800    L_21:
                           A   801    ;  250				case 0x74	: Ascii = 1; br
01023C                     A   802    L_22:
01023C 3E01                A   803    	LD	A,1
01023E 32 73 54 01         A   804    	LD	(_Ascii),A
                           A   805    ;  251			}
010242                     A   806    L_24:
                           A   807    ;  252			
                           A   808    ;  253			if (Ascii != 0)
010242 3A 73 54 01         A   809    	LD	A,(_Ascii)
010246 B7                  A   810    	OR	A,A
010247 CA 25 01 01         A   811    	JR	Z,L_26
                           A   812    ;  254				break;		
                           A   813    ;  255		}	
                           A   814    ;  256			
                           A   815    ;  257		return Ascii;
01024B 3A 73 54 01         A   816    	LD	A,(_Ascii)
                           A   817    ;  258	}
01024F C9                  A   818    	RET	
                           A   819    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  17


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A   820    
                           A   821    ;**************************** _getch **********
                           A   822    ;Name                         Addr/Register   S
                           A   823    ;_Ascii                              STATIC    
                           A   824    ;_Scancode                           STATIC    
                           A   825    ;_GetCh                              IMPORT  --
                           A   826    
                           A   827    
                           A   828    ; Stack Frame Size: 6 (bytes)
                           A   829    ;       Spill Code: 0 (instruction)
                           A   830    
                           A   831    
                           A   832    ;  259	
                           A   833    ;  260	/* Print on screen a text at current x,
                           A   834    ;  261	void print(const char *Txt)
                           A   835    ;  262	{
010250                     A   836    _print:
010250 CD 71 24 01         A   837    	CALL	__frameset0
                           A   838    ;  263		TxtPnt = Txt;
010254 DD0706              A   839    	LD	BC,(IX+6)
010257 ED43 81 54 01       A   840    	LD	(_TxtPnt),BC
                           A   841    ;  264		
                           A   842    ;  265		asm ("push ix");
01025C DDE5                A   843    push ix
                           A   844    ;  266		asm ("ld hl, (_TxtPnt)");
01025E 2A 81 54 01         A   845    ld hl, (_TxtPnt)
                           A   846    ;  267		asm ("ld a, kr_print_string");
010262 3E25                A   847    ld a, kr_print_string
                           A   848    ;  268		asm ("call.lil prose_kernal");
010264 5BCD200A 00         A   849    call.lil prose_kernal
                           A   850    ;  269		asm ("pop ix");
010269 DDE1                A   851    pop ix
                           A   852    ;  270	}
01026B DDF9                A   853    	LD	SP,IX
01026D DDE1                A   854    	POP	IX
01026F C9                  A   855    	RET	
                           A   856    
                           A   857    
                           A   858    ;**************************** _print **********
                           A   859    ;Name                         Addr/Register   S
                           A   860    ;_TxtPnt                             STATIC    
                           A   861    ;Txt                                   IX+6    
                           A   862    
                           A   863    
                           A   864    ; Stack Frame Size: 9 (bytes)
                           A   865    ;       Spill Code: 0 (instruction)
                           A   866    
                           A   867    
                           A   868    ;  271	
                           A   869    ;  272	/* Get the x and the y of screen cursor
                           A   870    ;  273	void get_cursor_position(unsigned char 
                           A   871    ;  274	{
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  18


PC     Object              I  Line    Source C:\proted\Debug\main.src
010270                     A   872    _get_cursor_position:
010270 CD 71 24 01         A   873    	CALL	__frameset0
                           A   874    ;  275		asm ("push ix");
010274 DDE5                A   875    push ix
                           A   876    ;  276		asm ("ld a, kr_get_cursor_position"
010276 3E32                A   877    ld a, kr_get_cursor_position
                           A   878    ;  277		asm ("call.lil prose_kernal");
010278 5BCD200A 00         A   879    call.lil prose_kernal
                           A   880    ;  278		asm ("ld a, b");
01027D 78                  A   881    ld a, b
                           A   882    ;  279		asm ("ld (_B), a");
01027E 32 75 54 01         A   883    ld (_B), a
                           A   884    ;  280		asm ("ld a, c");
010282 79                  A   885    ld a, c
                           A   886    ;  281		asm ("ld (_C), a");
010283 32 76 54 01         A   887    ld (_C), a
                           A   888    ;  282		asm ("pop ix");
010287 DDE1                A   889    pop ix
                           A   890    ;  283		
                           A   891    ;  284		*X = B;
010289 DD2706              A   892    	LD	HL,(IX+6)
01028C 3A 75 54 01         A   893    	LD	A,(_B)
010290 77                  A   894    	LD	(HL),A
                           A   895    ;  285		*Y = C;
010291 DD2709              A   896    	LD	HL,(IX+9)
010294 3A 76 54 01         A   897    	LD	A,(_C)
010298 77                  A   898    	LD	(HL),A
                           A   899    ;  286	}
010299 DDF9                A   900    	LD	SP,IX
01029B DDE1                A   901    	POP	IX
01029D C9                  A   902    	RET	
                           A   903    
                           A   904    
                           A   905    ;**************************** _get_cursor_posit
                           A   906    ;Name                         Addr/Register   S
                           A   907    ;_C                                  STATIC    
                           A   908    ;_B                                  STATIC    
                           A   909    ;Y                                     IX+9    
                           A   910    ;X                                     IX+6    
                           A   911    
                           A   912    
                           A   913    ; Stack Frame Size: 12 (bytes)
                           A   914    ;       Spill Code: 0 (instruction)
                           A   915    
                           A   916    
                           A   917    ;  287	
                           A   918    ;  288	/* Draw a character at X, Y coordinates
                           A   919    ;  289	void plot_char(unsigned char x, unsigne
                           A   920    ;  290	{
01029E                     A   921    _plot_char:
01029E CD 71 24 01         A   922    	CALL	__frameset0
                           A   923    ;  291		B = x;
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  19


PC     Object              I  Line    Source C:\proted\Debug\main.src
0102A2 DD7E06              A   924    	LD	A,(IX+6)
0102A5 32 75 54 01         A   925    	LD	(_B),A
                           A   926    ;  292		C = y;
0102A9 DD7E09              A   927    	LD	A,(IX+9)
0102AC 32 76 54 01         A   928    	LD	(_C),A
                           A   929    ;  293		E = Ch;
0102B0 DD7E0C              A   930    	LD	A,(IX+12)
0102B3 32 77 54 01         A   931    	LD	(_E),A
                           A   932    ;  294		
                           A   933    ;  295		asm ("push ix");
0102B7 DDE5                A   934    push ix
                           A   935    ;  296		asm ("ld hl, _B");
0102B9 21 75 54 01         A   936    ld hl, _B
                           A   937    ;  297		asm ("ld B, (hl)");
0102BD 46                  A   938    ld B, (hl)
                           A   939    ;  298		asm ("ld hl, _C");
0102BE 21 76 54 01         A   940    ld hl, _C
                           A   941    ;  299		asm ("ld C, (hl)");
0102C2 4E                  A   942    ld C, (hl)
                           A   943    ;  300		asm ("ld hl, _E");
0102C3 21 77 54 01         A   944    ld hl, _E
                           A   945    ;  301		asm ("ld E, (hl)");
0102C7 5E                  A   946    ld E, (hl)
                           A   947    ;  302		asm ("ld a, kr_plot_char");
0102C8 3E29                A   948    ld a, kr_plot_char
                           A   949    ;  303		asm ("call.lil prose_kernal");
0102CA 5BCD200A 00         A   950    call.lil prose_kernal
                           A   951    ;  304		asm ("pop ix");
0102CF DDE1                A   952    pop ix
                           A   953    ;  305	}
0102D1 DDF9                A   954    	LD	SP,IX
0102D3 DDE1                A   955    	POP	IX
0102D5 C9                  A   956    	RET	
                           A   957    
                           A   958    
                           A   959    ;**************************** _plot_char ******
                           A   960    ;Name                         Addr/Register   S
                           A   961    ;_E                                  STATIC    
                           A   962    ;_C                                  STATIC    
                           A   963    ;_B                                  STATIC    
                           A   964    ;Ch                                   IX+12    
                           A   965    ;y                                     IX+9    
                           A   966    ;x                                     IX+6    
                           A   967    
                           A   968    
                           A   969    ; Stack Frame Size: 15 (bytes)
                           A   970    ;       Spill Code: 0 (instruction)
                           A   971    
                           A   972    
                           A   973    ;  306	
                           A   974    ;  307	/* Clear the row on screen from current
                           A   975    ;  308	void clreol(void)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  20


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A   976    ;  309	{
0102D6                     A   977    _clreol:
0102D6 21FDFFFF            A   978    	LD	HL,-3
0102DA CD 7E 24 01         A   979    	CALL	__frameset
                           A   980    ;  310		unsigned char x, y;
                           A   981    ;  311		register char i;
                           A   982    ;  312		
                           A   983    ;  313		get_cursor_position(&x, &y);
0102DE ED65FE              A   984    	PEA	IX+-2
0102E1 ED65FD              A   985    	PEA	IX+-3
0102E4 CD 70 02 01         A   986    	CALL	_get_cursor_position
0102E8 C1                  A   987    	POP	BC
0102E9 C1                  A   988    	POP	BC
0102EA DD7EFD              A   989    	LD	A,(IX+-3)
0102ED DD77FF              A   990    	LD	(IX+-1),A
                           A   991    ;  314		
                           A   992    ;  315		for (i = x; i < 80; i++)
0102F0 18 19               A   993    	JR	L_35
0102F2                     A   994    L_33:
                           A   995    ;  316			plot_char(i, y, ' ');		
0102F2 01200000            A   996    	LD	BC,32
0102F6 C5                  A   997    	PUSH	BC
0102F7 DD4EFE              A   998    	LD	C,(IX+-2)
0102FA 0600                A   999    	LD	B,0
0102FC C5                  A  1000    	PUSH	BC
0102FD DD4EFF              A  1001    	LD	C,(IX+-1)
010300 C5                  A  1002    	PUSH	BC
010301 CD 9E 02 01         A  1003    	CALL	_plot_char
010305 C1                  A  1004    	POP	BC
010306 C1                  A  1005    	POP	BC
010307 C1                  A  1006    	POP	BC
010308 DD34FF              A  1007    	INC	(IX+-1)
01030B                     A  1008    L_35:
01030B DD7EFF              A  1009    	LD	A,(IX+-1)
01030E FE50                A  1010    	CP	A,80
010310 FA F2 02 01         A  1011    	JP	M,L_33
                           A  1012    ;  317	}
010314 DDF9                A  1013    	LD	SP,IX
010316 DDE1                A  1014    	POP	IX
010318 C9                  A  1015    	RET	
                           A  1016    
                           A  1017    
                           A  1018    ;**************************** _clreol *********
                           A  1019    ;Name                         Addr/Register   S
                           A  1020    ;_plot_char                          IMPORT  --
                           A  1021    ;_get_cursor_position                IMPORT  --
                           A  1022    ;x                                     IX-3    
                           A  1023    ;y                                     IX-2    
                           A  1024    ;i                                     IX-1    
                           A  1025    
                           A  1026    
                           A  1027    ; Stack Frame Size: 9 (bytes)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  21


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1028    ;       Spill Code: 0 (instruction)
                           A  1029    
                           A  1030    
                           A  1031    ;  318	
                           A  1032    ;  319	/* Move screen cursor at x,y position *
                           A  1033    ;  320	void gotoxy(unsigned char x, unsigned c
                           A  1034    ;  321	{
010319                     A  1035    _gotoxy:
010319 CD 71 24 01         A  1036    	CALL	__frameset0
                           A  1037    ;  322		B = x;
01031D DD7E06              A  1038    	LD	A,(IX+6)
010320 32 75 54 01         A  1039    	LD	(_B),A
                           A  1040    ;  323		C = y;
010324 DD7E09              A  1041    	LD	A,(IX+9)
010327 32 76 54 01         A  1042    	LD	(_C),A
                           A  1043    ;  324		
                           A  1044    ;  325		asm ("push ix");
01032B DDE5                A  1045    push ix
                           A  1046    ;  326		asm ("ld hl, _B");
01032D 21 75 54 01         A  1047    ld hl, _B
                           A  1048    ;  327		asm ("ld B, (hl)");
010331 46                  A  1049    ld B, (hl)
                           A  1050    ;  328		asm ("ld hl, _C");
010332 21 76 54 01         A  1051    ld hl, _C
                           A  1052    ;  329		asm ("ld C, (hl)");
010336 4E                  A  1053    ld C, (hl)
                           A  1054    ;  330		asm ("ld a, kr_set_cursor_position"
010337 3E28                A  1055    ld a, kr_set_cursor_position
                           A  1056    ;  331		asm ("call.lil prose_kernal");
010339 5BCD200A 00         A  1057    call.lil prose_kernal
                           A  1058    ;  332		asm ("pop ix");
01033E DDE1                A  1059    pop ix
                           A  1060    ;  333	}
010340 DDF9                A  1061    	LD	SP,IX
010342 DDE1                A  1062    	POP	IX
010344 C9                  A  1063    	RET	
                           A  1064    
                           A  1065    
                           A  1066    ;**************************** _gotoxy *********
                           A  1067    ;Name                         Addr/Register   S
                           A  1068    ;_C                                  STATIC    
                           A  1069    ;_B                                  STATIC    
                           A  1070    ;y                                     IX+9    
                           A  1071    ;x                                     IX+6    
                           A  1072    
                           A  1073    
                           A  1074    ; Stack Frame Size: 12 (bytes)
                           A  1075    ;       Spill Code: 0 (instruction)
                           A  1076    
                           A  1077    
                           A  1078    ;  334	
                           A  1079    ;  335	/* Return only PROSE version */
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  22


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1080    ;  336	int get_prose_version(void)
                           A  1081    ;  337	{
010345                     A  1082    _get_prose_version:
                           A  1083    ;  338		asm ("push ix");
010345 DDE5                A  1084    push ix
                           A  1085    ;  339		asm ("push de");
010347 D5                  A  1086    push de
                           A  1087    ;  340		asm ("push hl");
010348 E5                  A  1088    push hl
                           A  1089    ;  341		asm ("ld a, kr_get_version");
010349 3E3E                A  1090    ld a, kr_get_version
                           A  1091    ;  342		asm ("call.lil prose_kernal");
01034B 5BCD200A 00         A  1092    call.lil prose_kernal
                           A  1093    ;  343		asm ("ld (_K_xBC), hl");
010350 22 7B 54 01         A  1094    ld (_K_xBC), hl
                           A  1095    ;  344		asm ("pop hl");
010354 E1                  A  1096    pop hl
                           A  1097    ;  345		asm ("pop de");
010355 D1                  A  1098    pop de
                           A  1099    ;  346		asm ("pop ix");
010356 DDE1                A  1100    pop ix
                           A  1101    ;  347		
                           A  1102    ;  348		return K_xBC;
010358 2A 7B 54 01         A  1103    	LD	HL,(_K_xBC)
                           A  1104    ;  349	}
01035C C9                  A  1105    	RET	
                           A  1106    
                           A  1107    
                           A  1108    ;**************************** _get_prose_versio
                           A  1109    ;Name                         Addr/Register   S
                           A  1110    ;_K_xBC                              STATIC    
                           A  1111    
                           A  1112    
                           A  1113    ; Stack Frame Size: 6 (bytes)
                           A  1114    ;       Spill Code: 0 (instruction)
                           A  1115    
                           A  1116    
                           A  1117    ;  350	
                           A  1118    ;  351	/*-------------------------------------
                           A  1119    ;  352	
                           A  1120    ;  353	/* Writes out its argument string and t
                           A  1121    ;  354	void bomb(char *txt)
                           A  1122    ;  355	{
01035D                     A  1123    _bomb:
01035D CD 71 24 01         A  1124    	CALL	__frameset0
                           A  1125    ;  356		msg_window("Proted assertion failur
010361 DD0706              A  1126    	LD	BC,(IX+6)
010364 C5                  A  1127    	PUSH	BC
010365 01 1F 26 01         A  1128    	LD	BC,L__43
010369 C5                  A  1129    	PUSH	BC
01036A CD 97 1F 01         A  1130    	CALL	_msg_window
01036E C1                  A  1131    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  23


PC     Object              I  Line    Source C:\proted\Debug\main.src
01036F C1                  A  1132    	POP	BC
                           A  1133    ;  357		
                           A  1134    ;  358		while (1)
010370                     A  1135    L_41:
                           A  1136    ;  359		{
                           A  1137    ;  360			getch();
010370 CD 25 01 01         A  1138    	CALL	_getch
                           A  1139    ;  361			
                           A  1140    ;  362			if (Ascii == 13)
010374 3A 73 54 01         A  1141    	LD	A,(_Ascii)
010378 FE0D                A  1142    	CP	A,13
01037A 20 F4               A  1143    	JR	NZ,L_41
                           A  1144    ;  363				break;
                           A  1145    ;  364		}
                           A  1146    ;  365	
                           A  1147    ;  366		asm ("ld a, 0ffh");
01037C 3EFF                A  1148    ld a, 0ffh
                           A  1149    ;  367		asm ("jp.lil prose_return");
01037E 5BC3140A 00         A  1150    jp.lil prose_return
                           A  1151    ;  368	}
010383 DDF9                A  1152    	LD	SP,IX
010385 DDE1                A  1153    	POP	IX
010387 C9                  A  1154    	RET	
                           A  1155    
                           A  1156    
                           A  1157    ;**************************** _bomb ***********
                           A  1158    ;Name                         Addr/Register   S
                           A  1159    ;_Ascii                              STATIC    
                           A  1160    ;_getch                              IMPORT  --
                           A  1161    ;_msg_window                         IMPORT  --
                           A  1162    ;txt                                   IX+6    
                           A  1163    
                           A  1164    
                           A  1165    ; Stack Frame Size: 9 (bytes)
                           A  1166    ;       Spill Code: 0 (instruction)
                           A  1167    
                           A  1168    
                           A  1169    	SEGMENT STRSECT
01261F                     A  1170    L__43:
01261F 50726F74 65642061   A  1171    	DB	"Proted assertion failure. Press RETURN
012627 73736572 74696F6E 
01262F 20666169 6C757265 
012637 2E205072 65737320 
01263F 52455455 524E2074 
012647 6F206162 6F727421 
01264F 00                  A  1172    	DB	0
                           A  1173    	SEGMENT CODE
                           A  1174    ;  369	
                           A  1175    ;  370	/* Bombs with an assertion failure if i
                           A  1176    ;  371	void as(char b, char *txt)
                           A  1177    ;  372	{
010388                     A  1178    _as:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  24


PC     Object              I  Line    Source C:\proted\Debug\main.src
010388 CD 71 24 01         A  1179    	CALL	__frameset0
                           A  1180    ;  373		if (!b)
01038C DD7E06              A  1181    	LD	A,(IX+6)
01038F B7                  A  1182    	OR	A,A
010390 20 09               A  1183    	JR	NZ,L_45
                           A  1184    ;  374			bomb(txt);
010392 DD0709              A  1185    	LD	BC,(IX+9)
010395 C5                  A  1186    	PUSH	BC
010396 CD 5D 03 01         A  1187    	CALL	_bomb
01039A C1                  A  1188    	POP	BC
                           A  1189    ;  375	}
01039B                     A  1190    L_45:
01039B DDF9                A  1191    	LD	SP,IX
01039D DDE1                A  1192    	POP	IX
01039F C9                  A  1193    	RET	
                           A  1194    
                           A  1195    
                           A  1196    ;**************************** _as *************
                           A  1197    ;Name                         Addr/Register   S
                           A  1198    ;_bomb                               IMPORT  --
                           A  1199    ;txt                                   IX+9    
                           A  1200    ;b                                     IX+6    
                           A  1201    
                           A  1202    
                           A  1203    ; Stack Frame Size: 12 (bytes)
                           A  1204    ;       Spill Code: 0 (instruction)
                           A  1205    
                           A  1206    
                           A  1207    ;  376	
                           A  1208    ;  377	/* Convert an unsigned int into string 
                           A  1209    ;  378	void uitoa(unsigned int val, char *stri
                           A  1210    ;  379	{
0103A0                     A  1211    _uitoa:
0103A0 21FAFFFF            A  1212    	LD	HL,-6
0103A4 CD 7E 24 01         A  1213    	CALL	__frameset
                           A  1214    ;  380		char index = 0, i = 0;
0103A8 DD36FF00            A  1215    	LD	(IX+-1),0
0103AC DD36FE00            A  1216    	LD	(IX+-2),0
                           A  1217    ;  381		
                           A  1218    ;  382		do {
0103B0                     A  1219    L_48:
                           A  1220    ;  383			string[index] = '0' + (val % 10
0103B0 DD7EFF              A  1221    	LD	A,(IX+-1)
0103B3 17ED62              A  1222    	SEXT	HL
0103B6 DD6EFF              A  1223    	LD	L,(IX+-1)
0103B9 DD0709              A  1224    	LD	BC,(IX+9)
0103BC 09                  A  1225    	ADD	HL,BC
0103BD DD2FFB              A  1226    	LD	(IX+-5),HL
0103C0 DD2706              A  1227    	LD	HL,(IX+6)
0103C3 010A0000            A  1228    	LD	BC,10
0103C7 CD 32 24 01         A  1229    	CALL	__iremu
0103CB 7D                  A  1230    	LD	A,L
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  25


PC     Object              I  Line    Source C:\proted\Debug\main.src
0103CC C630                A  1231    	ADD	A,48
0103CE DD27FB              A  1232    	LD	HL,(IX+-5)
0103D1 77                  A  1233    	LD	(HL),A
                           A  1234    ;  384			
                           A  1235    ;  385			if (string[index] > '9')
0103D2 DD27FB              A  1236    	LD	HL,(IX+-5)
0103D5 7E                  A  1237    	LD	A,(HL)
0103D6 47                  A  1238    	LD	B,A
0103D7 17ED62              A  1239    	SEXT	HL
0103DA 68                  A  1240    	LD	L,B
0103DB E5C1                A  1241    	LD	BC,HL
0103DD 21390000            A  1242    	LD	HL,57
0103E1 B7                  A  1243    	OR	A,A
0103E2 ED42                A  1244    	SBC	HL,BC
0103E4 F2 F2 03 01         A  1245    	JP	P,L_47
                           A  1246    ;  386				string[index] += 'A' - '9' 
0103E8 DD27FB              A  1247    	LD	HL,(IX+-5)
0103EB 7E                  A  1248    	LD	A,(HL)
0103EC C607                A  1249    	ADD	A,7
0103EE DD27FB              A  1250    	LD	HL,(IX+-5)
0103F1 77                  A  1251    	LD	(HL),A
0103F2                     A  1252    L_47:
                           A  1253    ;  387			
                           A  1254    ;  388			val /= 10;
0103F2 010A0000            A  1255    	LD	BC,10
0103F6 DD2706              A  1256    	LD	HL,(IX+6)
0103F9 CD 50 24 01         A  1257    	CALL	__idivu
0103FD DD2F06              A  1258    	LD	(IX+6),HL
                           A  1259    ;  389			++index;
010400 DD34FF              A  1260    	INC	(IX+-1)
                           A  1261    ;  390	  } while (val != 0);
010403 DD2706              A  1262    	LD	HL,(IX+6)
010406 B7                  A  1263    	OR	A,A
010407 01000000            A  1264    	LD	BC,0
01040B ED42                A  1265    	SBC	HL,BC
01040D 20 A1               A  1266    	JR	NZ,L_48
                           A  1267    ;  391	  
                           A  1268    ;  392	  string[index--] = '\0'; 
01040F DD7EFF              A  1269    	LD	A,(IX+-1)
010412 17ED62              A  1270    	SEXT	HL
010415 DD6EFF              A  1271    	LD	L,(IX+-1)
010418 DD0709              A  1272    	LD	BC,(IX+9)
01041B 09                  A  1273    	ADD	HL,BC
01041C 3600                A  1274    	LD	(HL),0
01041E DD35FF              A  1275    	DEC	(IX+-1)
                           A  1276    ;  393	  
                           A  1277    ;  394	  while (index > i)
010421 18 49               A  1278    	JR	L_52
010423                     A  1279    L_53:
                           A  1280    ;  395	  {
                           A  1281    ;  396	    char tmp = string[i];
010423 DD7EFE              A  1282    	LD	A,(IX+-2)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  26


PC     Object              I  Line    Source C:\proted\Debug\main.src
010426 17ED62              A  1283    	SEXT	HL
010429 DD6EFE              A  1284    	LD	L,(IX+-2)
01042C DD0709              A  1285    	LD	BC,(IX+9)
01042F 09                  A  1286    	ADD	HL,BC
010430 7E                  A  1287    	LD	A,(HL)
010431 DD77FA              A  1288    	LD	(IX+-6),A
                           A  1289    ;  397		  
                           A  1290    ;  398	    string[i] = string[index];
010434 DD7EFF              A  1291    	LD	A,(IX+-1)
010437 17ED62              A  1292    	SEXT	HL
01043A DD6EFF              A  1293    	LD	L,(IX+-1)
01043D DD7EFE              A  1294    	LD	A,(IX+-2)
010440 DD0709              A  1295    	LD	BC,(IX+9)
010443 09                  A  1296    	ADD	HL,BC
010444 E5FDE1              A  1297    	LD	IY,HL
010447 17ED62              A  1298    	SEXT	HL
01044A DD6EFE              A  1299    	LD	L,(IX+-2)
01044D FD7E00              A  1300    	LD	A,(IY)
010450 DD0709              A  1301    	LD	BC,(IX+9)
010453 09                  A  1302    	ADD	HL,BC
010454 77                  A  1303    	LD	(HL),A
                           A  1304    ;  399	    string[index] = tmp;
010455 DD7EFF              A  1305    	LD	A,(IX+-1)
010458 17ED62              A  1306    	SEXT	HL
01045B DD6EFF              A  1307    	LD	L,(IX+-1)
01045E DD7EFA              A  1308    	LD	A,(IX+-6)
010461 DD0709              A  1309    	LD	BC,(IX+9)
010464 09                  A  1310    	ADD	HL,BC
010465 77                  A  1311    	LD	(HL),A
                           A  1312    ;  400	    ++i;
010466 DD34FE              A  1313    	INC	(IX+-2)
                           A  1314    ;  401	    --index;
010469 DD35FF              A  1315    	DEC	(IX+-1)
                           A  1316    ;  402	  }
01046C                     A  1317    L_52:
01046C DD7EFE              A  1318    	LD	A,(IX+-2)
01046F DDBEFF              A  1319    	CP	A,(IX+-1)
010472 FA 7C 04 01         A  1320    	JP	M,L__51
010476 EA 23 04 01         A  1321    	JP	PE,L_53
01047A 18 04               A  1322    	JR	L__52
01047C                     A  1323    L__51:
01047C E2 23 04 01         A  1324    	JP	PO,L_53
010480                     A  1325    L__52:
                           A  1326    ;  403	}
010480 DDF9                A  1327    	LD	SP,IX
010482 DDE1                A  1328    	POP	IX
010484 C9                  A  1329    	RET	
                           A  1330    
                           A  1331    
                           A  1332    ;**************************** _uitoa **********
                           A  1333    ;Name                         Addr/Register   S
                           A  1334    ;tmp                                   IX-6    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  27


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1335    ;G_0                                   IX-5    
                           A  1336    ;i                                     IX-2    
                           A  1337    ;index                                 IX-1    
                           A  1338    ;string                                IX+9    
                           A  1339    ;val                                   IX+6    
                           A  1340    
                           A  1341    
                           A  1342    ; Stack Frame Size: 18 (bytes)
                           A  1343    ;       Spill Code: 0 (instruction)
                           A  1344    
                           A  1345    
                           A  1346    ;  404	
                           A  1347    ;  405	/* The same as malloc except it bombs i
                           A  1348    ;  406	void *mymalloc(size_t n)
                           A  1349    ;  407	{
010485                     A  1350    _mymalloc:
010485 21FDFFFF            A  1351    	LD	HL,-3
010489 CD 7E 24 01         A  1352    	CALL	__frameset
                           A  1353    ;  408		void *p;
                           A  1354    ;  409		
                           A  1355    ;  410		if (n == 0)
01048D 01000000            A  1356    	LD	BC,0
010491 DD2706              A  1357    	LD	HL,(IX+6)
010494 B7                  A  1358    	OR	A,A
010495 ED42                A  1359    	SBC	HL,BC
010497 20 07               A  1360    	JR	NZ,L_57
                           A  1361    ;  411			n++;
010499 DD0706              A  1362    	LD	BC,(IX+6)
01049C 03                  A  1363    	INC	BC
01049D DD0F06              A  1364    	LD	(IX+6),BC
0104A0                     A  1365    L_57:
                           A  1366    ;  412		
                           A  1367    ;  413		p = malloc(n);
0104A0 DD0706              A  1368    	LD	BC,(IX+6)
0104A3 C5                  A  1369    	PUSH	BC
0104A4 CD 64 23 01         A  1370    	CALL	_malloc
0104A8 C1                  A  1371    	POP	BC
0104A9 DD2FFD              A  1372    	LD	(IX+-3),HL
                           A  1373    ;  414		
                           A  1374    ;  415		as(p != NULL, "out of memory!");
0104AC 01 50 26 01         A  1375    	LD	BC,L__55
0104B0 C5                  A  1376    	PUSH	BC
0104B1 DD27FD              A  1377    	LD	HL,(IX+-3)
0104B4 01000000            A  1378    	LD	BC,0
0104B8 B7                  A  1379    	OR	A,A
0104B9 ED42                A  1380    	SBC	HL,BC
0104BB 28 04               A  1381    	JR	Z,L__57
0104BD 3E01                A  1382    	LD	A,1
0104BF 18 01               A  1383    	JR	L__58
0104C1                     A  1384    L__57:
0104C1 AF                  A  1385    	XOR	A,A
0104C2                     A  1386    L__58:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  28


PC     Object              I  Line    Source C:\proted\Debug\main.src
0104C2 4F                  A  1387    	LD	C,A
0104C3 0600                A  1388    	LD	B,0
0104C5 C5                  A  1389    	PUSH	BC
0104C6 CD 88 03 01         A  1390    	CALL	_as
0104CA C1                  A  1391    	POP	BC
0104CB C1                  A  1392    	POP	BC
                           A  1393    ;  416		
                           A  1394    ;  417		return p;
0104CC DD27FD              A  1395    	LD	HL,(IX+-3)
                           A  1396    ;  418	}
0104CF DDF9                A  1397    	LD	SP,IX
0104D1 DDE1                A  1398    	POP	IX
0104D3 C9                  A  1399    	RET	
                           A  1400    
                           A  1401    
                           A  1402    ;**************************** _mymalloc *******
                           A  1403    ;Name                         Addr/Register   S
                           A  1404    ;_as                                 IMPORT  --
                           A  1405    ;_malloc                             IMPORT  --
                           A  1406    ;p                                     IX-3    
                           A  1407    ;n                                     IX+6    
                           A  1408    
                           A  1409    
                           A  1410    ; Stack Frame Size: 12 (bytes)
                           A  1411    ;       Spill Code: 0 (instruction)
                           A  1412    
                           A  1413    
                           A  1414    	SEGMENT STRSECT
012650                     A  1415    L__55:
012650 6F757420 6F66206D   A  1416    	DB	"out of memory!"
012658 656D6F72 7921 
01265E 00                  A  1417    	DB	0
                           A  1418    	SEGMENT CODE
                           A  1419    ;  419	
                           A  1420    ;  420	/* Returns TRUE if p[0..SCNCOLS - 1] ar
                           A  1421    ;  421	char blankrow(char *p)
                           A  1422    ;  422	{
0104D4                     A  1423    _blankrow:
0104D4 21FFFFFF            A  1424    	LD	HL,-1
0104D8 CD 7E 24 01         A  1425    	CALL	__frameset
0104DC DD36FF00            A  1426    	LD	(IX+-1),0
                           A  1427    ;  423		register unsigned char i;
                           A  1428    ;  424		
                           A  1429    ;  425		for (i = 0; i < SCNCOLS; i++)
0104E0 18 20               A  1430    	JR	L_63
0104E2                     A  1431    L_61:
                           A  1432    ;  426			if (p[i] != ' ')
0104E2 DD7EFF              A  1433    	LD	A,(IX+-1)
0104E5 B7ED62              A  1434    	UEXT	HL
0104E8 6F                  A  1435    	LD	L,A
0104E9 DD0706              A  1436    	LD	BC,(IX+6)
0104EC 09                  A  1437    	ADD	HL,BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  29


PC     Object              I  Line    Source C:\proted\Debug\main.src
0104ED 7E                  A  1438    	LD	A,(HL)
0104EE 47                  A  1439    	LD	B,A
0104EF 17ED62              A  1440    	SEXT	HL
0104F2 68                  A  1441    	LD	L,B
0104F3 B7                  A  1442    	OR	A,A
0104F4 01200000            A  1443    	LD	BC,32
0104F8 ED42                A  1444    	SBC	HL,BC
0104FA 28 03               A  1445    	JR	Z,L_62
                           A  1446    ;  427				return FALSE;
0104FC AF                  A  1447    	XOR	A,A
0104FD 18 0C               A  1448    	JR	L_65
0104FF                     A  1449    L_62:
0104FF DD34FF              A  1450    	INC	(IX+-1)
010502                     A  1451    L_63:
010502 DD7EFF              A  1452    	LD	A,(IX+-1)
010505 FE50                A  1453    	CP	A,80
010507 38 D9               A  1454    	JR	C,L_61
                           A  1455    ;  428			
                           A  1456    ;  429		return TRUE;
010509 3E01                A  1457    	LD	A,1
                           A  1458    ;  430	}
01050B                     A  1459    L_65:
01050B DDF9                A  1460    	LD	SP,IX
01050D DDE1                A  1461    	POP	IX
01050F C9                  A  1462    	RET	
                           A  1463    
                           A  1464    
                           A  1465    ;**************************** _blankrow *******
                           A  1466    ;Name                         Addr/Register   S
                           A  1467    ;i                                     IX-1    
                           A  1468    ;p                                     IX+6    
                           A  1469    
                           A  1470    
                           A  1471    ; Stack Frame Size: 10 (bytes)
                           A  1472    ;       Spill Code: 0 (instruction)
                           A  1473    
                           A  1474    
                           A  1475    ;  431	
                           A  1476    ;  432	/* Deletes trailing blanks from its arg
                           A  1477    ;  433	void zap_trail(char *s)
                           A  1478    ;  434	{
010510                     A  1479    _zap_trail:
010510 21FDFFFF            A  1480    	LD	HL,-3
010514 CD 7E 24 01         A  1481    	CALL	__frameset
                           A  1482    ;  435		char *p = s;
010518 DD0706              A  1483    	LD	BC,(IX+6)
01051B DD0FFD              A  1484    	LD	(IX+-3),BC
                           A  1485    ;  436		
                           A  1486    ;  437		while (*s != EOS)
01051E 18 20               A  1487    	JR	L_69
010520                     A  1488    L_70:
                           A  1489    ;  438		{
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  30


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1490    ;  439			if (*s != ' ')
010520 DD2706              A  1491    	LD	HL,(IX+6)
010523 7E                  A  1492    	LD	A,(HL)
010524 47                  A  1493    	LD	B,A
010525 17ED62              A  1494    	SEXT	HL
010528 68                  A  1495    	LD	L,B
010529 B7                  A  1496    	OR	A,A
01052A 01200000            A  1497    	LD	BC,32
01052E ED42                A  1498    	SBC	HL,BC
010530 28 07               A  1499    	JR	Z,L_68
                           A  1500    ;  440				p = s + 1;
010532 DD0706              A  1501    	LD	BC,(IX+6)
010535 03                  A  1502    	INC	BC
010536 DD0FFD              A  1503    	LD	(IX+-3),BC
010539                     A  1504    L_68:
                           A  1505    ;  441			
                           A  1506    ;  442			s++;
010539 DD0706              A  1507    	LD	BC,(IX+6)
01053C 03                  A  1508    	INC	BC
01053D DD0F06              A  1509    	LD	(IX+6),BC
                           A  1510    ;  443		}
010540                     A  1511    L_69:
010540 DD2706              A  1512    	LD	HL,(IX+6)
010543 7E                  A  1513    	LD	A,(HL)
010544 B7                  A  1514    	OR	A,A
010545 20 D9               A  1515    	JR	NZ,L_70
                           A  1516    ;  444		
                           A  1517    ;  445		*p = EOS;
010547 DD27FD              A  1518    	LD	HL,(IX+-3)
01054A 3600                A  1519    	LD	(HL),0
                           A  1520    ;  446	}
01054C DDF9                A  1521    	LD	SP,IX
01054E DDE1                A  1522    	POP	IX
010550 C9                  A  1523    	RET	
                           A  1524    
                           A  1525    
                           A  1526    ;**************************** _zap_trail ******
                           A  1527    ;Name                         Addr/Register   S
                           A  1528    ;p                                     IX-3    
                           A  1529    ;s                                     IX+6    
                           A  1530    
                           A  1531    
                           A  1532    ; Stack Frame Size: 12 (bytes)
                           A  1533    ;       Spill Code: 0 (instruction)
                           A  1534    
                           A  1535    
                           A  1536    ;  447	
                           A  1537    ;  448	/* Deletes all non-printables from the 
                           A  1538    ;  449	/* Replaces each TAB by a space.       
                           A  1539    ;  450	void purify(char *st)
                           A  1540    ;  451	{
010551                     A  1541    _purify:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  31


PC     Object              I  Line    Source C:\proted\Debug\main.src
010551 21F4FFFF            A  1542    	LD	HL,-12
010555 CD 7E 24 01         A  1543    	CALL	__frameset
                           A  1544    ;  452		char *s = st;
010559 DD0706              A  1545    	LD	BC,(IX+6)
01055C DD0FFD              A  1546    	LD	(IX+-3),BC
                           A  1547    ;  453		char *d = st;
01055F DD0706              A  1548    	LD	BC,(IX+6)
010562 DD0FFA              A  1549    	LD	(IX+-6),BC
                           A  1550    ;  454		
                           A  1551    ;  455		while (*s)
010565 18 73               A  1552    	JR	L_81
010567                     A  1553    L_82:
                           A  1554    ;  456		{
                           A  1555    ;  457			if ((' ' <= *s) && (*s <= '~'))
010567 DD27FD              A  1556    	LD	HL,(IX+-3)
01056A 7E                  A  1557    	LD	A,(HL)
01056B 47                  A  1558    	LD	B,A
01056C 17ED62              A  1559    	SEXT	HL
01056F 68                  A  1560    	LD	L,B
010570 B7                  A  1561    	OR	A,A
010571 01200000            A  1562    	LD	BC,32
010575 ED42                A  1563    	SBC	HL,BC
010577 FA B0 05 01         A  1564    	JP	M,L_78
01057B DD27FD              A  1565    	LD	HL,(IX+-3)
01057E 7E                  A  1566    	LD	A,(HL)
01057F 47                  A  1567    	LD	B,A
010580 17ED62              A  1568    	SEXT	HL
010583 68                  A  1569    	LD	L,B
010584 E5C1                A  1570    	LD	BC,HL
010586 217E0000            A  1571    	LD	HL,126
01058A B7                  A  1572    	OR	A,A
01058B ED42                A  1573    	SBC	HL,BC
01058D FA 97 05 01         A  1574    	JP	M,L__70
010591 EA B0 05 01         A  1575    	JP	PE,L_78
010595 18 04               A  1576    	JR	L__71
010597                     A  1577    L__70:
010597 E2 B0 05 01         A  1578    	JP	PO,L_78
01059B                     A  1579    L__71:
                           A  1580    ;  458				*d++ = *s;
01059B DD07FA              A  1581    	LD	BC,(IX+-6)
01059E DD0FF7              A  1582    	LD	(IX+-9),BC
0105A1 DD27FD              A  1583    	LD	HL,(IX+-3)
0105A4 7E                  A  1584    	LD	A,(HL)
0105A5 DD27F7              A  1585    	LD	HL,(IX+-9)
0105A8 77                  A  1586    	LD	(HL),A
0105A9 DD07FA              A  1587    	LD	BC,(IX+-6)
0105AC 03                  A  1588    	INC	BC
0105AD DD0FFA              A  1589    	LD	(IX+-6),BC
0105B0                     A  1590    L_78:
                           A  1591    ;  459			
                           A  1592    ;  460			if (*s == CH_TAB)		
0105B0 DD27FD              A  1593    	LD	HL,(IX+-3)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  32


PC     Object              I  Line    Source C:\proted\Debug\main.src
0105B3 7E                  A  1594    	LD	A,(HL)
0105B4 47                  A  1595    	LD	B,A
0105B5 17ED62              A  1596    	SEXT	HL
0105B8 68                  A  1597    	LD	L,B
0105B9 B7                  A  1598    	OR	A,A
0105BA 01090000            A  1599    	LD	BC,9
0105BE ED42                A  1600    	SBC	HL,BC
0105C0 20 11               A  1601    	JR	NZ,L_80
                           A  1602    ;  461				*d++ = ' ';
0105C2 DD07FA              A  1603    	LD	BC,(IX+-6)
0105C5 DD0FF4              A  1604    	LD	(IX+-12),BC
0105C8 C5E1                A  1605    	LD	HL,BC
0105CA 3620                A  1606    	LD	(HL),32
0105CC DD07FA              A  1607    	LD	BC,(IX+-6)
0105CF 03                  A  1608    	INC	BC
0105D0 DD0FFA              A  1609    	LD	(IX+-6),BC
0105D3                     A  1610    L_80:
                           A  1611    ;  462			
                           A  1612    ;  463			s++;
0105D3 DD07FD              A  1613    	LD	BC,(IX+-3)
0105D6 03                  A  1614    	INC	BC
0105D7 DD0FFD              A  1615    	LD	(IX+-3),BC
                           A  1616    ;  464		}
0105DA                     A  1617    L_81:
0105DA DD27FD              A  1618    	LD	HL,(IX+-3)
0105DD 7E                  A  1619    	LD	A,(HL)
0105DE B7                  A  1620    	OR	A,A
0105DF 20 86               A  1621    	JR	NZ,L_82
                           A  1622    ;  465		
                           A  1623    ;  466		*d = EOS;
0105E1 DD27FA              A  1624    	LD	HL,(IX+-6)
0105E4 3600                A  1625    	LD	(HL),0
                           A  1626    ;  467	}
0105E6 DDF9                A  1627    	LD	SP,IX
0105E8 DDE1                A  1628    	POP	IX
0105EA C9                  A  1629    	RET	
                           A  1630    
                           A  1631    
                           A  1632    ;**************************** _purify *********
                           A  1633    ;Name                         Addr/Register   S
                           A  1634    ;d                                     IX-6    
                           A  1635    ;s                                     IX-3    
                           A  1636    ;st                                    IX+6    
                           A  1637    
                           A  1638    
                           A  1639    ; Stack Frame Size: 21 (bytes)
                           A  1640    ;       Spill Code: 0 (instruction)
                           A  1641    
                           A  1642    
                           A  1643    ;  468	
                           A  1644    ;  469	/* Flushes the terminal's output buffer
                           A  1645    ;  470	void te_flu(void)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  33


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1646    ;  471	{
0105EB                     A  1647    _te_flu:
                           A  1648    ;  472		if (tebuflen == 0)
0105EB 01000000            A  1649    	LD	BC,0
0105EF 2A 6E 2B 01         A  1650    	LD	HL,(_tebuflen)
0105F3 B7                  A  1651    	OR	A,A
0105F4 ED42                A  1652    	SBC	HL,BC
0105F6 28 1A               A  1653    	JR	Z,L_87
                           A  1654    ;  473			return;
                           A  1655    ;  474		
                           A  1656    ;  475		tebuf[tebuflen] = EOS;
                           A  1657    ;  476		
                           A  1658    ;  477		print(tebuf);
0105F8 01 71 2B 01         A  1659    	LD	BC,_tebuf
0105FC C5                  A  1660    	PUSH	BC
0105FD 2A 6E 2B 01         A  1661    	LD	HL,(_tebuflen)
010601 09                  A  1662    	ADD	HL,BC
010602 3600                A  1663    	LD	(HL),0
010604 CD 50 02 01         A  1664    	CALL	_print
010608 C1                  A  1665    	POP	BC
                           A  1666    ;  478		
                           A  1667    ;  479		tebuflen = 0;
010609 01000000            A  1668    	LD	BC,0
01060D ED43 6E 2B 01       A  1669    	LD	(_tebuflen),BC
                           A  1670    ;  480	}
010612                     A  1671    L_87:
010612 C9                  A  1672    	RET	
                           A  1673    
                           A  1674    
                           A  1675    ;**************************** _te_flu *********
                           A  1676    ;Name                         Addr/Register   S
                           A  1677    ;_print                              IMPORT  --
                           A  1678    ;_tebuf                              STATIC   2
                           A  1679    ;_tebuflen                           STATIC    
                           A  1680    
                           A  1681    
                           A  1682    ; Stack Frame Size: 6 (bytes)
                           A  1683    ;       Spill Code: 0 (instruction)
                           A  1684    
                           A  1685    
                           A  1686    ;  481	
                           A  1687    ;  482	/* Get a character from the console. */
                           A  1688    ;  483	unsigned char te_gch(void)
                           A  1689    ;  484	{
010613                     A  1690    _te_gch:
                           A  1691    ;  485		te_flu();
010613 CD EB 05 01         A  1692    	CALL	_te_flu
                           A  1693    ;  486		
                           A  1694    ;  487		return getch();
010617 CD 25 01 01         A  1695    	CALL	_getch
                           A  1696    ;  488	}
01061B C9                  A  1697    	RET	
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  34


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1698    
                           A  1699    
                           A  1700    ;**************************** _te_gch *********
                           A  1701    ;Name                         Addr/Register   S
                           A  1702    ;_getch                              IMPORT  --
                           A  1703    ;_te_flu                             IMPORT  --
                           A  1704    
                           A  1705    
                           A  1706    ; Stack Frame Size: 6 (bytes)
                           A  1707    ;       Spill Code: 0 (instruction)
                           A  1708    
                           A  1709    
                           A  1710    ;  489	
                           A  1711    ;  490	/* Writes its argument character to the
                           A  1712    ;  491	void te_chr(char ch)
                           A  1713    ;  492	{
01061C                     A  1714    _te_chr:
01061C CD 71 24 01         A  1715    	CALL	__frameset0
                           A  1716    ;  493		tebuf[tebuflen++] = (char) ch;
010620 01 71 2B 01         A  1717    	LD	BC,_tebuf
010624 2A 6E 2B 01         A  1718    	LD	HL,(_tebuflen)
010628 09                  A  1719    	ADD	HL,BC
010629 DD7E06              A  1720    	LD	A,(IX+6)
01062C 77                  A  1721    	LD	(HL),A
01062D ED4B 6E 2B 01       A  1722    	LD	BC,(_tebuflen)
010632 03                  A  1723    	INC	BC
010633 ED43 6E 2B 01       A  1724    	LD	(_tebuflen),BC
                           A  1725    ;  494		
                           A  1726    ;  495		if (tebuflen == TEBUFMAX)
010638 2A 6E 2B 01         A  1727    	LD	HL,(_tebuflen)
01063C B7                  A  1728    	OR	A,A
01063D 01000800            A  1729    	LD	BC,2048
010641 ED42                A  1730    	SBC	HL,BC
010643 20 04               A  1731    	JR	NZ,L_91
                           A  1732    ;  496			te_flu();
010645 CD EB 05 01         A  1733    	CALL	_te_flu
                           A  1734    ;  497	}
010649                     A  1735    L_91:
010649 DDF9                A  1736    	LD	SP,IX
01064B DDE1                A  1737    	POP	IX
01064D C9                  A  1738    	RET	
                           A  1739    
                           A  1740    
                           A  1741    ;**************************** _te_chr *********
                           A  1742    ;Name                         Addr/Register   S
                           A  1743    ;_te_flu                             IMPORT  --
                           A  1744    ;_tebuflen                           STATIC    
                           A  1745    ;_tebuf                              STATIC   2
                           A  1746    ;ch                                    IX+6    
                           A  1747    
                           A  1748    
                           A  1749    ; Stack Frame Size: 9 (bytes)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  35


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1750    ;       Spill Code: 0 (instruction)
                           A  1751    
                           A  1752    
                           A  1753    ;  498	
                           A  1754    ;  499	/* Writes its argument string to the te
                           A  1755    ;  500	void te_str(char *s)
                           A  1756    ;  501	{
01064E                     A  1757    _te_str:
01064E 21FDFFFF            A  1758    	LD	HL,-3
010652 CD 7E 24 01         A  1759    	CALL	__frameset
                           A  1760    ;  502		while (*s)
010656 18 19               A  1761    	JR	L_93
010658                     A  1762    L_94:
                           A  1763    ;  503			te_chr((unsigned char)(*s++));
010658 DD0706              A  1764    	LD	BC,(IX+6)
01065B DD0FFD              A  1765    	LD	(IX+-3),BC
01065E DD0706              A  1766    	LD	BC,(IX+6)
010661 03                  A  1767    	INC	BC
010662 DD0F06              A  1768    	LD	(IX+6),BC
010665 DD27FD              A  1769    	LD	HL,(IX+-3)
010668 4E                  A  1770    	LD	C,(HL)
010669 0600                A  1771    	LD	B,0
01066B C5                  A  1772    	PUSH	BC
01066C CD 1C 06 01         A  1773    	CALL	_te_chr
010670 C1                  A  1774    	POP	BC
010671                     A  1775    L_93:
010671 DD2706              A  1776    	LD	HL,(IX+6)
010674 7E                  A  1777    	LD	A,(HL)
010675 B7                  A  1778    	OR	A,A
010676 20 E0               A  1779    	JR	NZ,L_94
                           A  1780    ;  504	}
010678 DDF9                A  1781    	LD	SP,IX
01067A DDE1                A  1782    	POP	IX
01067C C9                  A  1783    	RET	
                           A  1784    
                           A  1785    
                           A  1786    ;**************************** _te_str *********
                           A  1787    ;Name                         Addr/Register   S
                           A  1788    ;_te_chr                             IMPORT  --
                           A  1789    ;s                                     IX+6    
                           A  1790    
                           A  1791    
                           A  1792    ; Stack Frame Size: 12 (bytes)
                           A  1793    ;       Spill Code: 0 (instruction)
                           A  1794    
                           A  1795    
                           A  1796    ;  505	
                           A  1797    ;  506	/* Moves the cursor to the specified ro
                           A  1798    ;  507	void te_mov(unsigned char r, unsigned c
                           A  1799    ;  508	{
01067D                     A  1800    _te_mov:
01067D 21FAFFFF            A  1801    	LD	HL,-6
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  36


PC     Object              I  Line    Source C:\proted\Debug\main.src
010681 CD 7E 24 01         A  1802    	CALL	__frameset
                           A  1803    ;  509		as((0 <= r) && (r <= SCNROWS), "te_
010685 DD7E06              A  1804    	LD	A,(IX+6)
010688 B7                  A  1805    	OR	A,A
010689 38 10               A  1806    	JR	C,L_98
01068B 3E32                A  1807    	LD	A,50
01068D DDBE06              A  1808    	CP	A,(IX+6)
010690 38 09               A  1809    	JR	C,L_98
010692 01010000            A  1810    	LD	BC,1
010696 DD0FFD              A  1811    	LD	(IX+-3),BC
010699 18 07               A  1812    	JR	L_99
01069B                     A  1813    L_98:
01069B 01000000            A  1814    	LD	BC,0
01069F DD0FFD              A  1815    	LD	(IX+-3),BC
0106A2                     A  1816    L_99:
0106A2 01 5F 26 01         A  1817    	LD	BC,L__82
0106A6 C5                  A  1818    	PUSH	BC
0106A7 DD4EFD              A  1819    	LD	C,(IX+-3)
0106AA 0600                A  1820    	LD	B,0
0106AC C5                  A  1821    	PUSH	BC
0106AD CD 88 03 01         A  1822    	CALL	_as
0106B1 C1                  A  1823    	POP	BC
0106B2 C1                  A  1824    	POP	BC
                           A  1825    ;  510		
                           A  1826    ;  511		as((0 <= c) && (c <= SCNCOLS), "te_
0106B3 DD7E09              A  1827    	LD	A,(IX+9)
0106B6 B7                  A  1828    	OR	A,A
0106B7 38 10               A  1829    	JR	C,L_103
0106B9 3E50                A  1830    	LD	A,80
0106BB DDBE09              A  1831    	CP	A,(IX+9)
0106BE 38 09               A  1832    	JR	C,L_103
0106C0 01010000            A  1833    	LD	BC,1
0106C4 DD0FFA              A  1834    	LD	(IX+-6),BC
0106C7 18 07               A  1835    	JR	L_104
0106C9                     A  1836    L_103:
0106C9 01000000            A  1837    	LD	BC,0
0106CD DD0FFA              A  1838    	LD	(IX+-6),BC
0106D0                     A  1839    L_104:
0106D0 01 70 26 01         A  1840    	LD	BC,L__85
0106D4 C5                  A  1841    	PUSH	BC
0106D5 DD4EFA              A  1842    	LD	C,(IX+-6)
0106D8 0600                A  1843    	LD	B,0
0106DA C5                  A  1844    	PUSH	BC
0106DB CD 88 03 01         A  1845    	CALL	_as
0106DF C1                  A  1846    	POP	BC
0106E0 C1                  A  1847    	POP	BC
                           A  1848    ;  512		
                           A  1849    ;  513		te_flu();
0106E1 CD EB 05 01         A  1850    	CALL	_te_flu
                           A  1851    ;  514		
                           A  1852    ;  515		gotoxy(c, r);
0106E5 DD4E06              A  1853    	LD	C,(IX+6)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  37


PC     Object              I  Line    Source C:\proted\Debug\main.src
0106E8 0600                A  1854    	LD	B,0
0106EA C5                  A  1855    	PUSH	BC
0106EB DD4E09              A  1856    	LD	C,(IX+9)
0106EE C5                  A  1857    	PUSH	BC
0106EF CD 19 03 01         A  1858    	CALL	_gotoxy
0106F3 C1                  A  1859    	POP	BC
0106F4 C1                  A  1860    	POP	BC
                           A  1861    ;  516	}
0106F5 DDF9                A  1862    	LD	SP,IX
0106F7 DDE1                A  1863    	POP	IX
0106F9 C9                  A  1864    	RET	
                           A  1865    
                           A  1866    
                           A  1867    ;**************************** _te_mov *********
                           A  1868    ;Name                         Addr/Register   S
                           A  1869    ;_gotoxy                             IMPORT  --
                           A  1870    ;_te_flu                             IMPORT  --
                           A  1871    ;_as                                 IMPORT  --
                           A  1872    ;temp105                               IX-6    
                           A  1873    ;temp100                               IX-3    
                           A  1874    ;c                                     IX+9    
                           A  1875    ;r                                     IX+6    
                           A  1876    
                           A  1877    
                           A  1878    ; Stack Frame Size: 18 (bytes)
                           A  1879    ;       Spill Code: 0 (instruction)
                           A  1880    
                           A  1881    
                           A  1882    	SEGMENT STRSECT
01265F                     A  1883    L__82:
01265F 74655F6D 6F763A20   A  1884    	DB	"te_mov: Bad row."
012667 42616420 726F772E 
01266F 00                  A  1885    	DB	0
012670                     A  1886    L__85:
012670 74655F6D 6F763A20   A  1887    	DB	"te_mov: Bad col."
012678 42616420 636F6C2E 
012680 00                  A  1888    	DB	0
                           A  1889    	SEGMENT CODE
                           A  1890    ;  517	
                           A  1891    ;  518	/* Sets the specified row of the termin
                           A  1892    ;  519	/* Leaves the cursor at the start of th
                           A  1893    ;  520	void te_cln(unsigned char row)
                           A  1894    ;  521	{
0106FA                     A  1895    _te_cln:
0106FA CD 71 24 01         A  1896    	CALL	__frameset0
                           A  1897    ;  522		te_mov(row, 0);
0106FE 01000000            A  1898    	LD	BC,0
010702 C5                  A  1899    	PUSH	BC
010703 DD4E06              A  1900    	LD	C,(IX+6)
010706 0600                A  1901    	LD	B,0
010708 C5                  A  1902    	PUSH	BC
010709 CD 7D 06 01         A  1903    	CALL	_te_mov
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  38


PC     Object              I  Line    Source C:\proted\Debug\main.src
01070D C1                  A  1904    	POP	BC
01070E C1                  A  1905    	POP	BC
                           A  1906    ;  523		
                           A  1907    ;  524		clreol();
01070F CD D6 02 01         A  1908    	CALL	_clreol
                           A  1909    ;  525	}
010713 DDF9                A  1910    	LD	SP,IX
010715 DDE1                A  1911    	POP	IX
010717 C9                  A  1912    	RET	
                           A  1913    
                           A  1914    
                           A  1915    ;**************************** _te_cln *********
                           A  1916    ;Name                         Addr/Register   S
                           A  1917    ;_clreol                             IMPORT  --
                           A  1918    ;_te_mov                             IMPORT  --
                           A  1919    ;row                                   IX+6    
                           A  1920    
                           A  1921    
                           A  1922    ; Stack Frame Size: 9 (bytes)
                           A  1923    ;       Spill Code: 0 (instruction)
                           A  1924    
                           A  1925    
                           A  1926    ;  526	
                           A  1927    ;  527	/* Homes the cursor and clears the scre
                           A  1928    ;  528	void te_clr(void)
                           A  1929    ;  529	{
010718                     A  1930    _te_clr:
010718 21FFFFFF            A  1931    	LD	HL,-1
01071C CD 7E 24 01         A  1932    	CALL	__frameset
010720 DD36FF00            A  1933    	LD	(IX+-1),0
                           A  1934    ;  530		register unsigned char r;
                           A  1935    ;  531		
                           A  1936    ;  532		for (r = 0; r < SCNROWS; r++)
010724 18 0E               A  1937    	JR	L_111
010726                     A  1938    L_109:
                           A  1939    ;  533			te_cln(r);
010726 DD4EFF              A  1940    	LD	C,(IX+-1)
010729 0600                A  1941    	LD	B,0
01072B C5                  A  1942    	PUSH	BC
01072C CD FA 06 01         A  1943    	CALL	_te_cln
010730 C1                  A  1944    	POP	BC
010731 DD34FF              A  1945    	INC	(IX+-1)
010734                     A  1946    L_111:
010734 DD7EFF              A  1947    	LD	A,(IX+-1)
010737 FE32                A  1948    	CP	A,50
010739 38 EB               A  1949    	JR	C,L_109
                           A  1950    ;  534		
                           A  1951    ;  535		te_mov(0, 0);
01073B 01000000            A  1952    	LD	BC,0
01073F C5                  A  1953    	PUSH	BC
010740 C5                  A  1954    	PUSH	BC
010741 CD 7D 06 01         A  1955    	CALL	_te_mov
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  39


PC     Object              I  Line    Source C:\proted\Debug\main.src
010745 C1                  A  1956    	POP	BC
010746 C1                  A  1957    	POP	BC
                           A  1958    ;  536	}
010747 DDF9                A  1959    	LD	SP,IX
010749 DDE1                A  1960    	POP	IX
01074B C9                  A  1961    	RET	
                           A  1962    
                           A  1963    
                           A  1964    ;**************************** _te_clr *********
                           A  1965    ;Name                         Addr/Register   S
                           A  1966    ;_te_mov                             IMPORT  --
                           A  1967    ;_te_cln                             IMPORT  --
                           A  1968    ;r                                     IX-1    
                           A  1969    
                           A  1970    
                           A  1971    ; Stack Frame Size: 7 (bytes)
                           A  1972    ;       Spill Code: 0 (instruction)
                           A  1973    
                           A  1974    
                           A  1975    ;  537	
                           A  1976    ;  538	/* Initializes the terminal package. */
                           A  1977    ;  539	void te_ini(void)
                           A  1978    ;  540	{
01074C                     A  1979    _te_ini:
                           A  1980    ;  541		tebuflen = 0;
01074C 01000000            A  1981    	LD	BC,0
010750 ED43 6E 2B 01       A  1982    	LD	(_tebuflen),BC
                           A  1983    ;  542	}
010755 C9                  A  1984    	RET	
                           A  1985    
                           A  1986    
                           A  1987    ;**************************** _te_ini *********
                           A  1988    ;Name                         Addr/Register   S
                           A  1989    ;_tebuflen                           STATIC    
                           A  1990    
                           A  1991    
                           A  1992    ; Stack Frame Size: 6 (bytes)
                           A  1993    ;       Spill Code: 0 (instruction)
                           A  1994    
                           A  1995    
                           A  1996    ;  543	
                           A  1997    ;  544	/* Finalize the terminal package. */
                           A  1998    ;  545	void te_fin(void)
                           A  1999    ;  546	{
010756                     A  2000    _te_fin:
                           A  2001    ;  547		te_flu();
010756 CD EB 05 01         A  2002    	CALL	_te_flu
                           A  2003    ;  548	}
01075A C9                  A  2004    	RET	
                           A  2005    
                           A  2006    
                           A  2007    ;**************************** _te_fin *********
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  40


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  2008    ;Name                         Addr/Register   S
                           A  2009    ;_te_flu                             IMPORT  --
                           A  2010    
                           A  2011    
                           A  2012    ; Stack Frame Size: 6 (bytes)
                           A  2013    ;       Spill Code: 0 (instruction)
                           A  2014    
                           A  2015    
                           A  2016    ;  549	
                           A  2017    ;  550	/* Clear the virtual screen. */
                           A  2018    ;  551	void sc_clr(void)
                           A  2019    ;  552	{
01075B                     A  2020    _sc_clr:
                           A  2021    ;  553		memset(&scn_virt[0][0], ' ', SCNSIZ
01075B 01A00F00            A  2022    	LD	BC,4000
01075F C5                  A  2023    	PUSH	BC
010760 01200000            A  2024    	LD	BC,32
010764 C5                  A  2025    	PUSH	BC
010765 01 7B 33 01         A  2026    	LD	BC,_scn_virt
010769 C5                  A  2027    	PUSH	BC
01076A CD 3C 25 01         A  2028    	CALL	_memset
01076E C1                  A  2029    	POP	BC
01076F C1                  A  2030    	POP	BC
010770 C1                  A  2031    	POP	BC
                           A  2032    ;  554	}
010771 C9                  A  2033    	RET	
                           A  2034    
                           A  2035    
                           A  2036    ;**************************** _sc_clr *********
                           A  2037    ;Name                         Addr/Register   S
                           A  2038    ;_scn_virt                           STATIC   4
                           A  2039    ;_memset                             IMPORT  --
                           A  2040    
                           A  2041    
                           A  2042    ; Stack Frame Size: 6 (bytes)
                           A  2043    ;       Spill Code: 0 (instruction)
                           A  2044    
                           A  2045    
                           A  2046    ;  555	
                           A  2047    ;  556	/* Clear the specified row of the virtu
                           A  2048    ;  557	void sc_crw(unsigned char row)
                           A  2049    ;  558	{
010772                     A  2050    _sc_crw:
010772 21FDFFFF            A  2051    	LD	HL,-3
010776 CD 7E 24 01         A  2052    	CALL	__frameset
                           A  2053    ;  559		as((0 <= row) && (row <= SCNROWS), 
01077A DD7E06              A  2054    	LD	A,(IX+6)
01077D B7                  A  2055    	OR	A,A
01077E 38 10               A  2056    	JR	C,L_119
010780 3E32                A  2057    	LD	A,50
010782 DDBE06              A  2058    	CP	A,(IX+6)
010785 38 09               A  2059    	JR	C,L_119
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  41


PC     Object              I  Line    Source C:\proted\Debug\main.src
010787 01010000            A  2060    	LD	BC,1
01078B DD0FFD              A  2061    	LD	(IX+-3),BC
01078E 18 07               A  2062    	JR	L_120
010790                     A  2063    L_119:
010790 01000000            A  2064    	LD	BC,0
010794 DD0FFD              A  2065    	LD	(IX+-3),BC
010797                     A  2066    L_120:
010797 01 81 26 01         A  2067    	LD	BC,L__95
01079B C5                  A  2068    	PUSH	BC
01079C DD4EFD              A  2069    	LD	C,(IX+-3)
01079F 0600                A  2070    	LD	B,0
0107A1 C5                  A  2071    	PUSH	BC
0107A2 CD 88 03 01         A  2072    	CALL	_as
0107A6 C1                  A  2073    	POP	BC
0107A7 C1                  A  2074    	POP	BC
                           A  2075    ;  560		
                           A  2076    ;  561		memset(&scn_virt[row][0], ' ', SCNC
0107A8 01500000            A  2077    	LD	BC,80
0107AC C5                  A  2078    	PUSH	BC
0107AD 01200000            A  2079    	LD	BC,32
0107B1 C5                  A  2080    	PUSH	BC
0107B2 DD7E06              A  2081    	LD	A,(IX+6)
0107B5 B7ED62              A  2082    	UEXT	HL
0107B8 6F                  A  2083    	LD	L,A
0107B9 E5C1                A  2084    	LD	BC,HL
0107BB C5E1                A  2085    	LD	HL,BC
0107BD 29                  A  2086    	ADD	HL,HL
0107BE 29                  A  2087    	ADD	HL,HL
0107BF 09                  A  2088    	ADD	HL,BC
0107C0 29                  A  2089    	ADD	HL,HL
0107C1 29                  A  2090    	ADD	HL,HL
0107C2 29                  A  2091    	ADD	HL,HL
0107C3 29                  A  2092    	ADD	HL,HL
0107C4 01 7B 33 01         A  2093    	LD	BC,_scn_virt
0107C8 09                  A  2094    	ADD	HL,BC
0107C9 E5                  A  2095    	PUSH	HL
0107CA CD 3C 25 01         A  2096    	CALL	_memset
0107CE C1                  A  2097    	POP	BC
0107CF C1                  A  2098    	POP	BC
0107D0 C1                  A  2099    	POP	BC
                           A  2100    ;  562	}
0107D1 DDF9                A  2101    	LD	SP,IX
0107D3 DDE1                A  2102    	POP	IX
0107D5 C9                  A  2103    	RET	
                           A  2104    
                           A  2105    
                           A  2106    ;**************************** _sc_crw *********
                           A  2107    ;Name                         Addr/Register   S
                           A  2108    ;_scn_virt                           STATIC   4
                           A  2109    ;_memset                             IMPORT  --
                           A  2110    ;_as                                 IMPORT  --
                           A  2111    ;temp121                               IX-3    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  42


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  2112    ;row                                   IX+6    
                           A  2113    
                           A  2114    
                           A  2115    ; Stack Frame Size: 12 (bytes)
                           A  2116    ;       Spill Code: 0 (instruction)
                           A  2117    
                           A  2118    
                           A  2119    	SEGMENT STRSECT
012681                     A  2120    L__95:
012681 73635F63 72773A20   A  2121    	DB	"sc_crw: Bad row number."
012689 42616420 726F7720 
012691 6E756D62 65722E 
012698 00                  A  2122    	DB	0
                           A  2123    	SEGMENT CODE
                           A  2124    ;  563	
                           A  2125    ;  564	/* Places the specified character at th
                           A  2126    ;  565	/* screen. If the row and column are of
                           A  2127    ;  566	void sc_chr(unsigned char row, unsigned
                           A  2128    ;  567	{
0107D6                     A  2129    _sc_chr:
0107D6 CD 71 24 01         A  2130    	CALL	__frameset0
                           A  2131    ;  568		if (((0 <= row) && (row < SCNROWS))
0107DA DD7E06              A  2132    	LD	A,(IX+6)
0107DD B7                  A  2133    	OR	A,A
0107DE 38 39               A  2134    	JR	C,L_127
0107E0 DD7E06              A  2135    	LD	A,(IX+6)
0107E3 FE32                A  2136    	CP	A,50
0107E5 30 32               A  2137    	JR	NC,L_127
0107E7 DD7E09              A  2138    	LD	A,(IX+9)
0107EA B7                  A  2139    	OR	A,A
0107EB 38 2C               A  2140    	JR	C,L_127
0107ED DD7E09              A  2141    	LD	A,(IX+9)
0107F0 FE50                A  2142    	CP	A,80
0107F2 30 25               A  2143    	JR	NC,L_127
                           A  2144    ;  569			scn_virt[row - 0][col - 0] = (c
0107F4 DD7E06              A  2145    	LD	A,(IX+6)
0107F7 B7ED62              A  2146    	UEXT	HL
0107FA 6F                  A  2147    	LD	L,A
0107FB E5C1                A  2148    	LD	BC,HL
0107FD C5E1                A  2149    	LD	HL,BC
0107FF DD7E09              A  2150    	LD	A,(IX+9)
010802 29                  A  2151    	ADD	HL,HL
010803 29                  A  2152    	ADD	HL,HL
010804 09                  A  2153    	ADD	HL,BC
010805 29                  A  2154    	ADD	HL,HL
010806 29                  A  2155    	ADD	HL,HL
010807 29                  A  2156    	ADD	HL,HL
010808 29                  A  2157    	ADD	HL,HL
010809 01 7B 33 01         A  2158    	LD	BC,_scn_virt
01080D 09                  A  2159    	ADD	HL,BC
01080E E5C1                A  2160    	LD	BC,HL
010810 B7ED62              A  2161    	UEXT	HL
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  43


PC     Object              I  Line    Source C:\proted\Debug\main.src
010813 6F                  A  2162    	LD	L,A
010814 DD7E0C              A  2163    	LD	A,(IX+12)
010817 09                  A  2164    	ADD	HL,BC
010818 77                  A  2165    	LD	(HL),A
                           A  2166    ;  570	}
010819                     A  2167    L_127:
010819 DDF9                A  2168    	LD	SP,IX
01081B DDE1                A  2169    	POP	IX
01081D C9                  A  2170    	RET	
                           A  2171    
                           A  2172    
                           A  2173    ;**************************** _sc_chr *********
                           A  2174    ;Name                         Addr/Register   S
                           A  2175    ;_scn_virt                           STATIC   4
                           A  2176    ;ch                                   IX+12    
                           A  2177    ;col                                   IX+9    
                           A  2178    ;row                                   IX+6    
                           A  2179    
                           A  2180    
                           A  2181    ; Stack Frame Size: 15 (bytes)
                           A  2182    ;       Spill Code: 0 (instruction)
                           A  2183    
                           A  2184    
                           A  2185    ;  571	
                           A  2186    ;  572	/* Writes the specified string on the v
                           A  2187    ;  573	/* The function ignores any part of the
                           A  2188    ;  574	void sc_str(unsigned char row, unsigned
                           A  2189    ;  575	{
01081E                     A  2190    _sc_str:
01081E 21F9FFFF            A  2191    	LD	HL,-7
010822 CD 7E 24 01         A  2192    	CALL	__frameset
                           A  2193    ;  576		unsigned char c = col;
010826 DD7E09              A  2194    	LD	A,(IX+9)
010829 DD77FF              A  2195    	LD	(IX+-1),A
                           A  2196    ;  577		char *t = s;
01082C DD070C              A  2197    	LD	BC,(IX+12)
01082F DD0FFC              A  2198    	LD	(IX+-4),BC
                           A  2199    ;  578		
                           A  2200    ;  579		while (*t)
010832 18 27               A  2201    	JR	L_130
010834                     A  2202    L_131:
                           A  2203    ;  580			sc_chr(row, c++, (unsigned char
010834 DD7EFF              A  2204    	LD	A,(IX+-1)
010837 DD07FC              A  2205    	LD	BC,(IX+-4)
01083A DD0FF9              A  2206    	LD	(IX+-7),BC
01083D DD34FF              A  2207    	INC	(IX+-1)
010840 DD07FC              A  2208    	LD	BC,(IX+-4)
010843 03                  A  2209    	INC	BC
010844 DD0FFC              A  2210    	LD	(IX+-4),BC
010847 DD27F9              A  2211    	LD	HL,(IX+-7)
01084A 4E                  A  2212    	LD	C,(HL)
01084B 0600                A  2213    	LD	B,0
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  44


PC     Object              I  Line    Source C:\proted\Debug\main.src
01084D C5                  A  2214    	PUSH	BC
01084E 4F                  A  2215    	LD	C,A
01084F C5                  A  2216    	PUSH	BC
010850 DD4E06              A  2217    	LD	C,(IX+6)
010853 C5                  A  2218    	PUSH	BC
010854 CD D6 07 01         A  2219    	CALL	_sc_chr
010858 C1                  A  2220    	POP	BC
010859 C1                  A  2221    	POP	BC
01085A C1                  A  2222    	POP	BC
01085B                     A  2223    L_130:
01085B DD27FC              A  2224    	LD	HL,(IX+-4)
01085E 7E                  A  2225    	LD	A,(HL)
01085F B7                  A  2226    	OR	A,A
010860 20 D2               A  2227    	JR	NZ,L_131
                           A  2228    ;  581	}
010862 DDF9                A  2229    	LD	SP,IX
010864 DDE1                A  2230    	POP	IX
010866 C9                  A  2231    	RET	
                           A  2232    
                           A  2233    
                           A  2234    ;**************************** _sc_str *********
                           A  2235    ;Name                         Addr/Register   S
                           A  2236    ;_sc_chr                             IMPORT  --
                           A  2237    ;t                                     IX-4    
                           A  2238    ;c                                     IX-1    
                           A  2239    ;s                                    IX+12    
                           A  2240    ;col                                   IX+9    
                           A  2241    ;row                                   IX+6    
                           A  2242    
                           A  2243    
                           A  2244    ; Stack Frame Size: 22 (bytes)
                           A  2245    ;       Spill Code: 0 (instruction)
                           A  2246    
                           A  2247    
                           A  2248    ;  582	
                           A  2249    ;  583	/* Updates the physical screen from the
                           A  2250    ;  584	/* - Identifying the differences betwee
                           A  2251    ;  585	/* - Sending characters to the terminal
                           A  2252    ;  586	/* - Setting the physical screen to the
                           A  2253    ;  587	void sc_upd(void)
                           A  2254    ;  588	{
010867                     A  2255    _sc_upd:
010867 21F3FFFF            A  2256    	LD	HL,-13
01086B CD 7E 24 01         A  2257    	CALL	__frameset
01086F DD36FC00            A  2258    	LD	(IX+-4),0
                           A  2259    ;  589		register unsigned char r, c;
                           A  2260    ;  590		
                           A  2261    ;  591		for (r = 0; r < SCNROWS; r++)
010873 C3 90 09 01         A  2262    	JR	L_150
010877                     A  2263    L_148:
                           A  2264    ;  592		{
                           A  2265    ;  593			if (memcmp(&scn_virt[r - 0][0],
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  45


PC     Object              I  Line    Source C:\proted\Debug\main.src
010877 DD7EFC              A  2266    	LD	A,(IX+-4)
01087A B7ED62              A  2267    	UEXT	HL
01087D 6F                  A  2268    	LD	L,A
01087E E5C1                A  2269    	LD	BC,HL
010880 C5E1                A  2270    	LD	HL,BC
010882 29                  A  2271    	ADD	HL,HL
010883 29                  A  2272    	ADD	HL,HL
010884 09                  A  2273    	ADD	HL,BC
010885 29                  A  2274    	ADD	HL,HL
010886 29                  A  2275    	ADD	HL,HL
010887 29                  A  2276    	ADD	HL,HL
010888 29                  A  2277    	ADD	HL,HL
010889 DD2FFD              A  2278    	LD	(IX+-3),HL
01088C 01500000            A  2279    	LD	BC,80
010890 C5                  A  2280    	PUSH	BC
010891 DD27FD              A  2281    	LD	HL,(IX+-3)
010894 01 1B 43 01         A  2282    	LD	BC,_scn_phys
010898 09                  A  2283    	ADD	HL,BC
010899 E5                  A  2284    	PUSH	HL
01089A DD27FD              A  2285    	LD	HL,(IX+-3)
01089D 01 7B 33 01         A  2286    	LD	BC,_scn_virt
0108A1 09                  A  2287    	ADD	HL,BC
0108A2 E5                  A  2288    	PUSH	HL
0108A3 CD 8E 24 01         A  2289    	CALL	_memcmp
0108A7 C1                  A  2290    	POP	BC
0108A8 C1                  A  2291    	POP	BC
0108A9 C1                  A  2292    	POP	BC
0108AA 01000000            A  2293    	LD	BC,0
0108AE B7                  A  2294    	OR	A,A
0108AF ED42                A  2295    	SBC	HL,BC
0108B1 CA 8D 09 01         A  2296    	JR	Z,L_149
                           A  2297    ;  594				continue;
                           A  2298    ;  595			
                           A  2299    ;  596			if ((blankrow(&scn_virt[r - 0][
0108B5 DD07FD              A  2300    	LD	BC,(IX+-3)
0108B8 DD0FF3              A  2301    	LD	(IX+-13),BC
0108BB DD07FD              A  2302    	LD	BC,(IX+-3)
0108BE DD0FF8              A  2303    	LD	(IX+-8),BC
0108C1 DD27FD              A  2304    	LD	HL,(IX+-3)
0108C4 01 7B 33 01         A  2305    	LD	BC,_scn_virt
0108C8 09                  A  2306    	ADD	HL,BC
0108C9 E5                  A  2307    	PUSH	HL
0108CA CD D4 04 01         A  2308    	CALL	_blankrow
0108CE C1                  A  2309    	POP	BC
0108CF B7                  A  2310    	OR	A,A
0108D0 28 2A               A  2311    	JR	Z,L_145
0108D2 DD07FD              A  2312    	LD	BC,(IX+-3)
0108D5 DD0FF3              A  2313    	LD	(IX+-13),BC
0108D8 DD07FD              A  2314    	LD	BC,(IX+-3)
0108DB DD0FF8              A  2315    	LD	(IX+-8),BC
0108DE DD27FD              A  2316    	LD	HL,(IX+-3)
0108E1 01 1B 43 01         A  2317    	LD	BC,_scn_phys
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  46


PC     Object              I  Line    Source C:\proted\Debug\main.src
0108E5 09                  A  2318    	ADD	HL,BC
0108E6 E5                  A  2319    	PUSH	HL
0108E7 CD D4 04 01         A  2320    	CALL	_blankrow
0108EB C1                  A  2321    	POP	BC
0108EC B7                  A  2322    	OR	A,A
0108ED 20 0D               A  2323    	JR	NZ,L_145
                           A  2324    ;  597				te_cln(r);
0108EF DD4EFC              A  2325    	LD	C,(IX+-4)
0108F2 0600                A  2326    	LD	B,0
0108F4 C5                  A  2327    	PUSH	BC
0108F5 CD FA 06 01         A  2328    	CALL	_te_cln
0108F9 C1                  A  2329    	POP	BC
                           A  2330    ;  598			else
0108FA 18 72               A  2331    	JR	L_147
0108FC                     A  2332    L_145:
                           A  2333    ;  599			{
                           A  2334    ;  600				char there = FALSE;
0108FC DD36F700            A  2335    	LD	(IX+-9),0
010900 DD36FB00            A  2336    	LD	(IX+-5),0
                           A  2337    ;  601				
                           A  2338    ;  602				for (c = 0; c < SCNCOLS; c+
010904 18 61               A  2339    	JR	L_143
010906                     A  2340    L_141:
                           A  2341    ;  603				{
                           A  2342    ;  604					char ch = scn_virt[r - 
010906 DD07F3              A  2343    	LD	BC,(IX+-13)
010909 DD0FF8              A  2344    	LD	(IX+-8),BC
01090C C5E1                A  2345    	LD	HL,BC
01090E 01 7B 33 01         A  2346    	LD	BC,_scn_virt
010912 09                  A  2347    	ADD	HL,BC
010913 E5C1                A  2348    	LD	BC,HL
010915 DD7EFB              A  2349    	LD	A,(IX+-5)
010918 B7ED62              A  2350    	UEXT	HL
01091B 6F                  A  2351    	LD	L,A
01091C 09                  A  2352    	ADD	HL,BC
01091D 7E                  A  2353    	LD	A,(HL)
01091E DD77F6              A  2354    	LD	(IX+-10),A
                           A  2355    ;  605					
                           A  2356    ;  606					if (ch != scn_phys[r - 
010921 DD27F8              A  2357    	LD	HL,(IX+-8)
010924 01 1B 43 01         A  2358    	LD	BC,_scn_phys
010928 09                  A  2359    	ADD	HL,BC
010929 E5C1                A  2360    	LD	BC,HL
01092B DD7EFB              A  2361    	LD	A,(IX+-5)
01092E B7ED62              A  2362    	UEXT	HL
010931 6F                  A  2363    	LD	L,A
010932 09                  A  2364    	ADD	HL,BC
010933 7E                  A  2365    	LD	A,(HL)
010934 DDBEF6              A  2366    	CP	A,(IX+-10)
010937 28 27               A  2367    	JR	Z,L_140
                           A  2368    ;  607					{
                           A  2369    ;  608						if (!there)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  47


PC     Object              I  Line    Source C:\proted\Debug\main.src
010939 DD7EF7              A  2370    	LD	A,(IX+-9)
01093C B7                  A  2371    	OR	A,A
01093D 20 10               A  2372    	JR	NZ,L_138
                           A  2373    ;  609							te_mov(r, c);
01093F DD4EFB              A  2374    	LD	C,(IX+-5)
010942 0600                A  2375    	LD	B,0
010944 C5                  A  2376    	PUSH	BC
010945 DD4EFC              A  2377    	LD	C,(IX+-4)
010948 C5                  A  2378    	PUSH	BC
010949 CD 7D 06 01         A  2379    	CALL	_te_mov
01094D C1                  A  2380    	POP	BC
01094E C1                  A  2381    	POP	BC
01094F                     A  2382    L_138:
                           A  2383    ;  610						
                           A  2384    ;  611						te_chr((unsigned ch
01094F DD4EF6              A  2385    	LD	C,(IX+-10)
010952 0600                A  2386    	LD	B,0
010954 C5                  A  2387    	PUSH	BC
010955 CD 1C 06 01         A  2388    	CALL	_te_chr
010959 C1                  A  2389    	POP	BC
                           A  2390    ;  612						
                           A  2391    ;  613						there = TRUE;
01095A DD36F701            A  2392    	LD	(IX+-9),1
                           A  2393    ;  614					}
                           A  2394    ;  615					else
01095E 18 04               A  2395    	JR	L_142
010960                     A  2396    L_140:
                           A  2397    ;  616						there = FALSE;
010960 DD36F700            A  2398    	LD	(IX+-9),0
                           A  2399    ;  617				}
010964                     A  2400    L_142:
010964 DD34FB              A  2401    	INC	(IX+-5)
010967                     A  2402    L_143:
010967 DD7EFB              A  2403    	LD	A,(IX+-5)
01096A FE50                A  2404    	CP	A,80
01096C 38 98               A  2405    	JR	C,L_141
                           A  2406    ;  618			}
01096E                     A  2407    L_147:
                           A  2408    ;  619			
                           A  2409    ;  620			memmove(&scn_phys[r - 0][0], &s
01096E DD07F8              A  2410    	LD	BC,(IX+-8)
010971 C5E1                A  2411    	LD	HL,BC
010973 11500000            A  2412    	LD	DE,80
010977 D5                  A  2413    	PUSH	DE
010978 11 7B 33 01         A  2414    	LD	DE,_scn_virt
01097C 19                  A  2415    	ADD	HL,DE
01097D E5                  A  2416    	PUSH	HL
01097E C5E1                A  2417    	LD	HL,BC
010980 01 1B 43 01         A  2418    	LD	BC,_scn_phys
010984 09                  A  2419    	ADD	HL,BC
010985 E5                  A  2420    	PUSH	HL
010986 CD 5D 25 01         A  2421    	CALL	_memmove
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  48


PC     Object              I  Line    Source C:\proted\Debug\main.src
01098A C1                  A  2422    	POP	BC
01098B C1                  A  2423    	POP	BC
01098C C1                  A  2424    	POP	BC
                           A  2425    ;  621		}	
01098D                     A  2426    L_149:
01098D DD34FC              A  2427    	INC	(IX+-4)
010990                     A  2428    L_150:
010990 DD7EFC              A  2429    	LD	A,(IX+-4)
010993 FE32                A  2430    	CP	A,50
010995 DA 77 08 01         A  2431    	JR	C,L_148
                           A  2432    ;  622		
                           A  2433    ;  623		te_flu();	
010999 CD EB 05 01         A  2434    	CALL	_te_flu
                           A  2435    ;  624	}
01099D DDF9                A  2436    	LD	SP,IX
01099F DDE1                A  2437    	POP	IX
0109A1 C9                  A  2438    	RET	
                           A  2439    
                           A  2440    
                           A  2441    ;**************************** _sc_upd *********
                           A  2442    ;Name                         Addr/Register   S
                           A  2443    ;_te_flu                             IMPORT  --
                           A  2444    ;_memmove                            IMPORT  --
                           A  2445    ;_te_chr                             IMPORT  --
                           A  2446    ;_te_mov                             IMPORT  --
                           A  2447    ;_te_cln                             IMPORT  --
                           A  2448    ;_blankrow                           IMPORT  --
                           A  2449    ;_scn_virt                           STATIC   4
                           A  2450    ;_scn_phys                           STATIC   4
                           A  2451    ;_memcmp                             IMPORT  --
                           A  2452    ;G_3                                  IX-13    
                           A  2453    ;ch                                   IX-10    
                           A  2454    ;there                                 IX-9    
                           A  2455    ;G_4                                   IX-8    
                           A  2456    ;c                                     IX-5    
                           A  2457    ;r                                     IX-4    
                           A  2458    ;G_1                                   IX-3    
                           A  2459    
                           A  2460    
                           A  2461    ; Stack Frame Size: 19 (bytes)
                           A  2462    ;       Spill Code: 0 (instruction)
                           A  2463    
                           A  2464    
                           A  2465    ;  625	
                           A  2466    ;  626	/* Forced update. Forces the terminals 
                           A  2467    ;  627	/* the virtual screen.                 
                           A  2468    ;  628	void sc_fup(void)
                           A  2469    ;  629	{
0109A2                     A  2470    _sc_fup:
                           A  2471    ;  630		memset(&scn_phys[0][0], 0, SCNSIZE)
0109A2 01A00F00            A  2472    	LD	BC,4000
0109A6 C5                  A  2473    	PUSH	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  49


PC     Object              I  Line    Source C:\proted\Debug\main.src
0109A7 01000000            A  2474    	LD	BC,0
0109AB C5                  A  2475    	PUSH	BC
0109AC 01 1B 43 01         A  2476    	LD	BC,_scn_phys
0109B0 C5                  A  2477    	PUSH	BC
0109B1 CD 3C 25 01         A  2478    	CALL	_memset
0109B5 C1                  A  2479    	POP	BC
0109B6 C1                  A  2480    	POP	BC
0109B7 C1                  A  2481    	POP	BC
                           A  2482    ;  631		
                           A  2483    ;  632		sc_upd();
0109B8 CD 67 08 01         A  2484    	CALL	_sc_upd
                           A  2485    ;  633	}
0109BC C9                  A  2486    	RET	
                           A  2487    
                           A  2488    
                           A  2489    ;**************************** _sc_fup *********
                           A  2490    ;Name                         Addr/Register   S
                           A  2491    ;_sc_upd                             IMPORT  --
                           A  2492    ;_scn_phys                           STATIC   4
                           A  2493    ;_memset                             IMPORT  --
                           A  2494    
                           A  2495    
                           A  2496    ; Stack Frame Size: 6 (bytes)
                           A  2497    ;       Spill Code: 0 (instruction)
                           A  2498    
                           A  2499    
                           A  2500    ;  634	
                           A  2501    ;  635	/* Initializes the screen package, clea
                           A  2502    ;  636	void sc_ini(void)
                           A  2503    ;  637	{
0109BD                     A  2504    _sc_ini:
                           A  2505    ;  638		sc_clr();
0109BD CD 5B 07 01         A  2506    	CALL	_sc_clr
                           A  2507    ;  639		
                           A  2508    ;  640		sc_fup();
0109C1 CD A2 09 01         A  2509    	CALL	_sc_fup
                           A  2510    ;  641	}
0109C5 C9                  A  2511    	RET	
                           A  2512    
                           A  2513    
                           A  2514    ;**************************** _sc_ini *********
                           A  2515    ;Name                         Addr/Register   S
                           A  2516    ;_sc_fup                             IMPORT  --
                           A  2517    ;_sc_clr                             IMPORT  --
                           A  2518    
                           A  2519    
                           A  2520    ; Stack Frame Size: 6 (bytes)
                           A  2521    ;       Spill Code: 0 (instruction)
                           A  2522    
                           A  2523    
                           A  2524    ;  642	
                           A  2525    ;  643	/* Finalizes the screen package, cleari
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  50


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  2526    ;  644	void sc_fin(void)
                           A  2527    ;  645	{
0109C6                     A  2528    _sc_fin:
                           A  2529    ;  646		sc_clr();
0109C6 CD 5B 07 01         A  2530    	CALL	_sc_clr
                           A  2531    ;  647		
                           A  2532    ;  648		sc_fup();
0109CA CD A2 09 01         A  2533    	CALL	_sc_fup
                           A  2534    ;  649	}
0109CE C9                  A  2535    	RET	
                           A  2536    
                           A  2537    
                           A  2538    ;**************************** _sc_fin *********
                           A  2539    ;Name                         Addr/Register   S
                           A  2540    ;_sc_fup                             IMPORT  --
                           A  2541    ;_sc_clr                             IMPORT  --
                           A  2542    
                           A  2543    
                           A  2544    ; Stack Frame Size: 6 (bytes)
                           A  2545    ;       Spill Code: 0 (instruction)
                           A  2546    
                           A  2547    
                           A  2548    ;  650	
                           A  2549    ;  651	/* Initialize the text data structure t
                           A  2550    ;  652	void tx_ini(void)
                           A  2551    ;  653	{
0109CF                     A  2552    _tx_ini:
                           A  2553    ;  654		p_root = &root;
0109CF 01 FB 53 01         A  2554    	LD	BC,_root
0109D3 ED43 04 54 01       A  2555    	LD	(_p_root),BC
                           A  2556    ;  655		p_root->p_next = p_root;
0109D8 ED43 FE 53 01       A  2557    	LD	(_root+3),BC
                           A  2558    ;  656		p_root->p_prev = p_root;
0109DD ED43 FB 53 01       A  2559    	LD	(_root),BC
                           A  2560    ;  657		p_root->p_data = NULL;
0109E2 01000000            A  2561    	LD	BC,0
0109E6 ED43 01 54 01       A  2562    	LD	(_root+6),BC
                           A  2563    ;  658		
                           A  2564    ;  659		numlines = 0;
0109EB ED43 0A 54 01       A  2565    	LD	(_numlines),BC
                           A  2566    ;  660	}
0109F0 C9                  A  2567    	RET	
                           A  2568    
                           A  2569    
                           A  2570    ;**************************** _tx_ini *********
                           A  2571    ;Name                         Addr/Register   S
                           A  2572    ;_numlines                           STATIC    
                           A  2573    ;_p_root                             STATIC    
                           A  2574    ;_root                               STATIC    
                           A  2575    
                           A  2576    
                           A  2577    ; Stack Frame Size: 6 (bytes)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  51


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  2578    ;       Spill Code: 0 (instruction)
                           A  2579    
                           A  2580    
                           A  2581    ;  661	
                           A  2582    ;  662	/* Sets the specified line to the speci
                           A  2583    ;  663	/* Deletes trailing spaces from the arg
                           A  2584    ;  664	void tx_set(p_line_t p_line, char *s)
                           A  2585    ;  665	{
0109F1                     A  2586    _tx_set:
0109F1 21FDFFFF            A  2587    	LD	HL,-3
0109F5 CD 7E 24 01         A  2588    	CALL	__frameset
                           A  2589    ;  666		size_t len;
                           A  2590    ;  667		
                           A  2591    ;  668		zap_trail(s);
0109F9 DD0709              A  2592    	LD	BC,(IX+9)
0109FC C5                  A  2593    	PUSH	BC
0109FD CD 10 05 01         A  2594    	CALL	_zap_trail
010A01 C1                  A  2595    	POP	BC
                           A  2596    ;  669		
                           A  2597    ;  670		len = strlen(s);
010A02 DD0709              A  2598    	LD	BC,(IX+9)
010A05 C5                  A  2599    	PUSH	BC
010A06 CD 3B 24 01         A  2600    	CALL	_strlen
010A0A C1                  A  2601    	POP	BC
010A0B DD2FFD              A  2602    	LD	(IX+-3),HL
                           A  2603    ;  671		
                           A  2604    ;  672		as(len <= MAXLNLEN, "tx_set: Line t
010A0E 01 99 26 01         A  2605    	LD	BC,L__116
010A12 C5                  A  2606    	PUSH	BC
010A13 DD07FD              A  2607    	LD	BC,(IX+-3)
010A16 21500000            A  2608    	LD	HL,80
010A1A B7                  A  2609    	OR	A,A
010A1B ED42                A  2610    	SBC	HL,BC
010A1D 38 04               A  2611    	JR	C,L__118
010A1F 3E01                A  2612    	LD	A,1
010A21 18 01               A  2613    	JR	L__119
010A23                     A  2614    L__118:
010A23 AF                  A  2615    	XOR	A,A
010A24                     A  2616    L__119:
010A24 4F                  A  2617    	LD	C,A
010A25 0600                A  2618    	LD	B,0
010A27 C5                  A  2619    	PUSH	BC
010A28 CD 88 03 01         A  2620    	CALL	_as
010A2C C1                  A  2621    	POP	BC
010A2D C1                  A  2622    	POP	BC
                           A  2623    ;  673		as(p_line != p_root, "tx_set: Attem
010A2E 01 B0 26 01         A  2624    	LD	BC,L__120
010A32 C5                  A  2625    	PUSH	BC
010A33 DD0706              A  2626    	LD	BC,(IX+6)
010A36 2A 04 54 01         A  2627    	LD	HL,(_p_root)
010A3A B7                  A  2628    	OR	A,A
010A3B ED42                A  2629    	SBC	HL,BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  52


PC     Object              I  Line    Source C:\proted\Debug\main.src
010A3D 28 04               A  2630    	JR	Z,L__122
010A3F 3E01                A  2631    	LD	A,1
010A41 18 01               A  2632    	JR	L__123
010A43                     A  2633    L__122:
010A43 AF                  A  2634    	XOR	A,A
010A44                     A  2635    L__123:
010A44 4F                  A  2636    	LD	C,A
010A45 0600                A  2637    	LD	B,0
010A47 C5                  A  2638    	PUSH	BC
010A48 CD 88 03 01         A  2639    	CALL	_as
010A4C C1                  A  2640    	POP	BC
010A4D C1                  A  2641    	POP	BC
                           A  2642    ;  674		as(p_line->p_data != NULL, "tx_set:
010A4E 01 D6 26 01         A  2643    	LD	BC,L__124
010A52 C5                  A  2644    	PUSH	BC
010A53 DD3106              A  2645    	LD	IY,(IX+6)
010A56 FD2706              A  2646    	LD	HL,(IY+6)
010A59 01000000            A  2647    	LD	BC,0
010A5D B7                  A  2648    	OR	A,A
010A5E ED42                A  2649    	SBC	HL,BC
010A60 28 04               A  2650    	JR	Z,L__126
010A62 3E01                A  2651    	LD	A,1
010A64 18 01               A  2652    	JR	L__127
010A66                     A  2653    L__126:
010A66 AF                  A  2654    	XOR	A,A
010A67                     A  2655    L__127:
010A67 4F                  A  2656    	LD	C,A
010A68 0600                A  2657    	LD	B,0
010A6A C5                  A  2658    	PUSH	BC
010A6B CD 88 03 01         A  2659    	CALL	_as
010A6F C1                  A  2660    	POP	BC
010A70 C1                  A  2661    	POP	BC
                           A  2662    ;  675		
                           A  2663    ;  676		free(p_line->p_data);
010A71 DD3106              A  2664    	LD	IY,(IX+6)
010A74 FD0706              A  2665    	LD	BC,(IY+6)
010A77 C5                  A  2666    	PUSH	BC
010A78 CD 40 22 01         A  2667    	CALL	_free
010A7C C1                  A  2668    	POP	BC
                           A  2669    ;  677		
                           A  2670    ;  678		p_line->p_data = mymalloc(len + 1);
010A7D DD07FD              A  2671    	LD	BC,(IX+-3)
010A80 03                  A  2672    	INC	BC
010A81 C5                  A  2673    	PUSH	BC
010A82 CD 85 04 01         A  2674    	CALL	_mymalloc
010A86 C1                  A  2675    	POP	BC
010A87 DD3106              A  2676    	LD	IY,(IX+6)
010A8A FD2F06              A  2677    	LD	(IY+6),HL
                           A  2678    ;  679		
                           A  2679    ;  680		strcpy(p_line->p_data, s);
010A8D DD0709              A  2680    	LD	BC,(IX+9)
010A90 C5                  A  2681    	PUSH	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  53


PC     Object              I  Line    Source C:\proted\Debug\main.src
010A91 FD0706              A  2682    	LD	BC,(IY+6)
010A94 C5                  A  2683    	PUSH	BC
010A95 CD 22 25 01         A  2684    	CALL	_strcpy
010A99 C1                  A  2685    	POP	BC
010A9A C1                  A  2686    	POP	BC
                           A  2687    ;  681	}
010A9B DDF9                A  2688    	LD	SP,IX
010A9D DDE1                A  2689    	POP	IX
010A9F C9                  A  2690    	RET	
                           A  2691    
                           A  2692    
                           A  2693    ;**************************** _tx_set *********
                           A  2694    ;Name                         Addr/Register   S
                           A  2695    ;_strcpy                             IMPORT  --
                           A  2696    ;_mymalloc                           IMPORT  --
                           A  2697    ;_free                               IMPORT  --
                           A  2698    ;_p_root                             STATIC    
                           A  2699    ;_as                                 IMPORT  --
                           A  2700    ;_strlen                             IMPORT  --
                           A  2701    ;_zap_trail                          IMPORT  --
                           A  2702    ;len                                   IX-3    
                           A  2703    ;s                                     IX+9    
                           A  2704    ;p_line                                IX+6    
                           A  2705    
                           A  2706    
                           A  2707    ; Stack Frame Size: 15 (bytes)
                           A  2708    ;       Spill Code: 0 (instruction)
                           A  2709    
                           A  2710    
                           A  2711    	SEGMENT STRSECT
012699                     A  2712    L__116:
012699 74785F73 65743A20   A  2713    	DB	"tx_set: Line too long."
0126A1 4C696E65 20746F6F 
0126A9 206C6F6E 672E 
0126AF 00                  A  2714    	DB	0
0126B0                     A  2715    L__120:
0126B0 74785F73 65743A20   A  2716    	DB	"tx_set: Attempt to set the root line."
0126B8 41747465 6D707420 
0126C0 746F2073 65742074 
0126C8 68652072 6F6F7420 
0126D0 6C696E65 2E 
0126D5 00                  A  2717    	DB	0
0126D6                     A  2718    L__124:
0126D6 74785F73 65743A20   A  2719    	DB	"tx_set: p_data=NULL."
0126DE 705F6461 74613D4E 
0126E6 554C4C2E 
0126EA 00                  A  2720    	DB	0
                           A  2721    	SEGMENT CODE
                           A  2722    ;  682	
                           A  2723    ;  683	/* Insert a line containing the specifi
                           A  2724    ;  684	/* just before the specified line.     
                           A  2725    ;  685	void tx_ins(p_line_t p_line, char *s)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  54


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  2726    ;  686	{
010AA0                     A  2727    _tx_ins:
010AA0 21FDFFFF            A  2728    	LD	HL,-3
010AA4 CD 7E 24 01         A  2729    	CALL	__frameset
                           A  2730    ;  687		p_line_t p_new = mymalloc(sizeof(li
010AA8 01090000            A  2731    	LD	BC,9
010AAC C5                  A  2732    	PUSH	BC
010AAD CD 85 04 01         A  2733    	CALL	_mymalloc
010AB1 C1                  A  2734    	POP	BC
010AB2 DD2FFD              A  2735    	LD	(IX+-3),HL
                           A  2736    ;  688		
                           A  2737    ;  689		p_new->p_prev = p_line->p_prev;
010AB5 DD3106              A  2738    	LD	IY,(IX+6)
010AB8 FD0700              A  2739    	LD	BC,(IY+0)
010ABB DD31FD              A  2740    	LD	IY,(IX+-3)
010ABE FD0F00              A  2741    	LD	(IY+0),BC
                           A  2742    ;  690		p_new->p_next = p_line;
010AC1 DD0706              A  2743    	LD	BC,(IX+6)
010AC4 FD0F03              A  2744    	LD	(IY+3),BC
                           A  2745    ;  691		
                           A  2746    ;  692		p_line->p_prev = p_new;
010AC7 DD07FD              A  2747    	LD	BC,(IX+-3)
010ACA DD3106              A  2748    	LD	IY,(IX+6)
010ACD FD0F00              A  2749    	LD	(IY+0),BC
                           A  2750    ;  693		p_new->p_prev->p_next = p_new;
010AD0 DD31FD              A  2751    	LD	IY,(IX+-3)
010AD3 FD3700              A  2752    	LD	IY,(IY+0)
010AD6 DD07FD              A  2753    	LD	BC,(IX+-3)
                           A  2754    ;  694		
                           A  2755    ;  695		p_new->p_data = mymalloc(0);
010AD9 11000000            A  2756    	LD	DE,0
010ADD D5                  A  2757    	PUSH	DE
010ADE FD0F03              A  2758    	LD	(IY+3),BC
010AE1 CD 85 04 01         A  2759    	CALL	_mymalloc
010AE5 C1                  A  2760    	POP	BC
010AE6 DD31FD              A  2761    	LD	IY,(IX+-3)
010AE9 FD2F06              A  2762    	LD	(IY+6),HL
                           A  2763    ;  696		
                           A  2764    ;  697		tx_set(p_new, s);
010AEC DD0709              A  2765    	LD	BC,(IX+9)
010AEF C5                  A  2766    	PUSH	BC
010AF0 DD07FD              A  2767    	LD	BC,(IX+-3)
010AF3 C5                  A  2768    	PUSH	BC
010AF4 CD F1 09 01         A  2769    	CALL	_tx_set
010AF8 C1                  A  2770    	POP	BC
010AF9 C1                  A  2771    	POP	BC
                           A  2772    ;  698		
                           A  2773    ;  699		numlines++;
010AFA ED4B 0A 54 01       A  2774    	LD	BC,(_numlines)
010AFF 03                  A  2775    	INC	BC
010B00 ED43 0A 54 01       A  2776    	LD	(_numlines),BC
                           A  2777    ;  700	}
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  55


PC     Object              I  Line    Source C:\proted\Debug\main.src
010B05 DDF9                A  2778    	LD	SP,IX
010B07 DDE1                A  2779    	POP	IX
010B09 C9                  A  2780    	RET	
                           A  2781    
                           A  2782    
                           A  2783    ;**************************** _tx_ins *********
                           A  2784    ;Name                         Addr/Register   S
                           A  2785    ;_numlines                           STATIC    
                           A  2786    ;_tx_set                             IMPORT  --
                           A  2787    ;_mymalloc                           IMPORT  --
                           A  2788    ;p_new                                 IX-3    
                           A  2789    ;s                                     IX+9    
                           A  2790    ;p_line                                IX+6    
                           A  2791    
                           A  2792    
                           A  2793    ; Stack Frame Size: 15 (bytes)
                           A  2794    ;       Spill Code: 0 (instruction)
                           A  2795    
                           A  2796    
                           A  2797    ;  701	
                           A  2798    ;  702	/* Deletes the specified line. */
                           A  2799    ;  703	void tx_del(p_line_t p_line)
                           A  2800    ;  704	{
010B0A                     A  2801    _tx_del:
010B0A 21FDFFFF            A  2802    	LD	HL,-3
010B0E CD 7E 24 01         A  2803    	CALL	__frameset
                           A  2804    ;  705		as(p_line != NULL, "tx_del: NULL.")
010B12 01 EB 26 01         A  2805    	LD	BC,L__130
010B16 C5                  A  2806    	PUSH	BC
010B17 DD2706              A  2807    	LD	HL,(IX+6)
010B1A 01000000            A  2808    	LD	BC,0
010B1E B7                  A  2809    	OR	A,A
010B1F ED42                A  2810    	SBC	HL,BC
010B21 28 04               A  2811    	JR	Z,L__132
010B23 3E01                A  2812    	LD	A,1
010B25 18 01               A  2813    	JR	L__133
010B27                     A  2814    L__132:
010B27 AF                  A  2815    	XOR	A,A
010B28                     A  2816    L__133:
010B28 4F                  A  2817    	LD	C,A
010B29 0600                A  2818    	LD	B,0
010B2B C5                  A  2819    	PUSH	BC
010B2C CD 88 03 01         A  2820    	CALL	_as
010B30 C1                  A  2821    	POP	BC
010B31 C1                  A  2822    	POP	BC
                           A  2823    ;  706		as(p_line != p_root, "tx_del: Attem
010B32 01 F9 26 01         A  2824    	LD	BC,L__134
010B36 C5                  A  2825    	PUSH	BC
010B37 DD0706              A  2826    	LD	BC,(IX+6)
010B3A 2A 04 54 01         A  2827    	LD	HL,(_p_root)
010B3E B7                  A  2828    	OR	A,A
010B3F ED42                A  2829    	SBC	HL,BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  56


PC     Object              I  Line    Source C:\proted\Debug\main.src
010B41 28 04               A  2830    	JR	Z,L__136
010B43 3E01                A  2831    	LD	A,1
010B45 18 01               A  2832    	JR	L__137
010B47                     A  2833    L__136:
010B47 AF                  A  2834    	XOR	A,A
010B48                     A  2835    L__137:
010B48 4F                  A  2836    	LD	C,A
010B49 0600                A  2837    	LD	B,0
010B4B C5                  A  2838    	PUSH	BC
010B4C CD 88 03 01         A  2839    	CALL	_as
010B50 C1                  A  2840    	POP	BC
010B51 C1                  A  2841    	POP	BC
                           A  2842    ;  707		
                           A  2843    ;  708		p_line->p_prev->p_next = p_line->p_
010B52 DD3106              A  2844    	LD	IY,(IX+6)
010B55 FD0700              A  2845    	LD	BC,(IY+0)
010B58 DD0FFD              A  2846    	LD	(IX+-3),BC
010B5B FD0703              A  2847    	LD	BC,(IY+3)
010B5E DD31FD              A  2848    	LD	IY,(IX+-3)
010B61 FD0F03              A  2849    	LD	(IY+3),BC
                           A  2850    ;  709		p_line->p_next->p_prev = p_line->p_
010B64 DD3106              A  2851    	LD	IY,(IX+6)
010B67 FD3703              A  2852    	LD	IY,(IY+3)
010B6A DD07FD              A  2853    	LD	BC,(IX+-3)
010B6D FD0F00              A  2854    	LD	(IY+0),BC
                           A  2855    ;  710		
                           A  2856    ;  711		free(p_line->p_data);
010B70 DD3106              A  2857    	LD	IY,(IX+6)
010B73 FD0706              A  2858    	LD	BC,(IY+6)
010B76 C5                  A  2859    	PUSH	BC
010B77 CD 40 22 01         A  2860    	CALL	_free
010B7B C1                  A  2861    	POP	BC
                           A  2862    ;  712		free(p_line);
010B7C DD0706              A  2863    	LD	BC,(IX+6)
010B7F C5                  A  2864    	PUSH	BC
010B80 CD 40 22 01         A  2865    	CALL	_free
010B84 C1                  A  2866    	POP	BC
                           A  2867    ;  713		
                           A  2868    ;  714		numlines--;
010B85 ED4B 0A 54 01       A  2869    	LD	BC,(_numlines)
010B8A 0B                  A  2870    	DEC	BC
010B8B ED43 0A 54 01       A  2871    	LD	(_numlines),BC
                           A  2872    ;  715	}
010B90 DDF9                A  2873    	LD	SP,IX
010B92 DDE1                A  2874    	POP	IX
010B94 C9                  A  2875    	RET	
                           A  2876    
                           A  2877    
                           A  2878    ;**************************** _tx_del *********
                           A  2879    ;Name                         Addr/Register   S
                           A  2880    ;_numlines                           STATIC    
                           A  2881    ;_free                               IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  57


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  2882    ;_p_root                             STATIC    
                           A  2883    ;_as                                 IMPORT  --
                           A  2884    ;p_line                                IX+6    
                           A  2885    
                           A  2886    
                           A  2887    ; Stack Frame Size: 12 (bytes)
                           A  2888    ;       Spill Code: 0 (instruction)
                           A  2889    
                           A  2890    
                           A  2891    	SEGMENT STRSECT
0126EB                     A  2892    L__130:
0126EB 74785F64 656C3A20   A  2893    	DB	"tx_del: NULL."
0126F3 4E554C4C 2E 
0126F8 00                  A  2894    	DB	0
0126F9                     A  2895    L__134:
0126F9 74785F64 656C3A20   A  2896    	DB	"tx_del: Attempt to delete the root lin
012701 41747465 6D707420 
012709 746F2064 656C6574 
012711 65207468 6520726F 
012719 6F74206C 696E652E 
012721 00                  A  2897    	DB	0
                           A  2898    	SEGMENT CODE
                           A  2899    ;  716	
                           A  2900    ;  717	/* Writes the contents of the line to t
                           A  2901    ;  718	/* padded array of MAXLNLEN characters.
                           A  2902    ;  719	void tx_get(p_line_t p_line)
                           A  2903    ;  720	{
010B95                     A  2904    _tx_get:
010B95 21FDFFFF            A  2905    	LD	HL,-3
010B99 CD 7E 24 01         A  2906    	CALL	__frameset
                           A  2907    ;  721		size_t len = strlen(p_line->p_data)
010B9D DD3106              A  2908    	LD	IY,(IX+6)
010BA0 FD0706              A  2909    	LD	BC,(IY+6)
010BA3 C5                  A  2910    	PUSH	BC
010BA4 CD 3B 24 01         A  2911    	CALL	_strlen
010BA8 C1                  A  2912    	POP	BC
010BA9 DD2FFD              A  2913    	LD	(IX+-3),HL
                           A  2914    ;  722		
                           A  2915    ;  723		memset((void *)linbuf, ' ', MAXLNLE
010BAC 01500000            A  2916    	LD	BC,80
010BB0 C5                  A  2917    	PUSH	BC
010BB1 01200000            A  2918    	LD	BC,32
010BB5 C5                  A  2919    	PUSH	BC
010BB6 01 19 54 01         A  2920    	LD	BC,_linbuf
010BBA C5                  A  2921    	PUSH	BC
010BBB CD 3C 25 01         A  2922    	CALL	_memset
010BBF C1                  A  2923    	POP	BC
010BC0 C1                  A  2924    	POP	BC
010BC1 C1                  A  2925    	POP	BC
                           A  2926    ;  724		
                           A  2927    ;  725		memmove((void *)linbuf, p_line->p_d
010BC2 DD07FD              A  2928    	LD	BC,(IX+-3)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  58


PC     Object              I  Line    Source C:\proted\Debug\main.src
010BC5 C5                  A  2929    	PUSH	BC
010BC6 DD3106              A  2930    	LD	IY,(IX+6)
010BC9 FD0706              A  2931    	LD	BC,(IY+6)
010BCC C5                  A  2932    	PUSH	BC
010BCD 01 19 54 01         A  2933    	LD	BC,_linbuf
010BD1 C5                  A  2934    	PUSH	BC
010BD2 CD 5D 25 01         A  2935    	CALL	_memmove
010BD6 C1                  A  2936    	POP	BC
010BD7 C1                  A  2937    	POP	BC
010BD8 C1                  A  2938    	POP	BC
                           A  2939    ;  726	}
010BD9 DDF9                A  2940    	LD	SP,IX
010BDB DDE1                A  2941    	POP	IX
010BDD C9                  A  2942    	RET	
                           A  2943    
                           A  2944    
                           A  2945    ;**************************** _tx_get *********
                           A  2946    ;Name                         Addr/Register   S
                           A  2947    ;_memmove                            IMPORT  --
                           A  2948    ;_linbuf                             STATIC    
                           A  2949    ;_memset                             IMPORT  --
                           A  2950    ;_strlen                             IMPORT  --
                           A  2951    ;len                                   IX-3    
                           A  2952    ;p_line                                IX+6    
                           A  2953    
                           A  2954    
                           A  2955    ; Stack Frame Size: 12 (bytes)
                           A  2956    ;       Spill Code: 0 (instruction)
                           A  2957    
                           A  2958    
                           A  2959    ;  727	
                           A  2960    ;  728	/* Sets the value of the specified line
                           A  2961    ;  729	void tx_put(p_line_t p_line)
                           A  2962    ;  730	{
010BDE                     A  2963    _tx_put:
010BDE CD 71 24 01         A  2964    	CALL	__frameset0
                           A  2965    ;  731		linbuf[MAXLNLEN] = EOS;
010BE2 21 69 54 01         A  2966    	LD	HL,_linbuf+80
                           A  2967    ;  732		
                           A  2968    ;  733		tx_set(p_line, linbuf);
010BE6 01 19 54 01         A  2969    	LD	BC,_linbuf
010BEA C5                  A  2970    	PUSH	BC
010BEB 3600                A  2971    	LD	(HL),0
010BED DD0706              A  2972    	LD	BC,(IX+6)
010BF0 C5                  A  2973    	PUSH	BC
010BF1 CD F1 09 01         A  2974    	CALL	_tx_set
010BF5 C1                  A  2975    	POP	BC
010BF6 C1                  A  2976    	POP	BC
                           A  2977    ;  734	}
010BF7 DDF9                A  2978    	LD	SP,IX
010BF9 DDE1                A  2979    	POP	IX
010BFB C9                  A  2980    	RET	
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  59


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  2981    
                           A  2982    
                           A  2983    ;**************************** _tx_put *********
                           A  2984    ;Name                         Addr/Register   S
                           A  2985    ;_tx_set                             IMPORT  --
                           A  2986    ;_linbuf                             STATIC    
                           A  2987    ;p_line                                IX+6    
                           A  2988    
                           A  2989    
                           A  2990    ; Stack Frame Size: 9 (bytes)
                           A  2991    ;       Spill Code: 0 (instruction)
                           A  2992    
                           A  2993    
                           A  2994    ;  735	
                           A  2995    ;  736	/* Redraw the screen. */
                           A  2996    ;  737	void do_red(void)
                           A  2997    ;  738	{
010BFC                     A  2998    _do_red:
                           A  2999    ;  739		sc_fup();
010BFC CD A2 09 01         A  3000    	CALL	_sc_fup
                           A  3001    ;  740	}
010C00 C9                  A  3002    	RET	
                           A  3003    
                           A  3004    
                           A  3005    ;**************************** _do_red *********
                           A  3006    ;Name                         Addr/Register   S
                           A  3007    ;_sc_fup                             IMPORT  --
                           A  3008    
                           A  3009    
                           A  3010    ; Stack Frame Size: 6 (bytes)
                           A  3011    ;       Spill Code: 0 (instruction)
                           A  3012    
                           A  3013    
                           A  3014    ;  741	
                           A  3015    ;  742	/* Cursor up. */
                           A  3016    ;  743	void do_cup(void)
                           A  3017    ;  744	{
010C01                     A  3018    _do_cup:
010C01 21FFFFFF            A  3019    	LD	HL,-1
010C05 CD 7E 24 01         A  3020    	CALL	__frameset
                           A  3021    ;  745		char ch;
                           A  3022    ;  746		
                           A  3023    ;  747		if (cur_line == 1)
010C09 01010000            A  3024    	LD	BC,1
010C0D 2A 0D 54 01         A  3025    	LD	HL,(_cur_line)
010C11 B7                  A  3026    	OR	A,A
010C12 ED42                A  3027    	SBC	HL,BC
010C14 20 06               A  3028    	JR	NZ,L_167
                           A  3029    ;  748		{
                           A  3030    ;  749			Show_Cursor();
010C16 CD 34 18 01         A  3031    	CALL	_Show_Cursor
                           A  3032    ;  750			
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  60


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3033    ;  751			return;
010C1A 18 6F               A  3034    	JR	L_171
                           A  3035    ;  752		}
010C1C                     A  3036    L_167:
                           A  3037    ;  753		
                           A  3038    ;  754		cur_line--;
010C1C ED4B 0D 54 01       A  3039    	LD	BC,(_cur_line)
010C21 0B                  A  3040    	DEC	BC
010C22 ED43 0D 54 01       A  3041    	LD	(_cur_line),BC
                           A  3042    ;  755		
                           A  3043    ;  756		p_curr = p_curr->p_prev;
010C27 FD2A 07 54 01       A  3044    	LD	IY,(_p_curr)
010C2C FD0700              A  3045    	LD	BC,(IY+0)
010C2F ED43 07 54 01       A  3046    	LD	(_p_curr),BC
                           A  3047    ;  757		
                           A  3048    ;  758		if (cur_row == 0)
010C34 2A 13 54 01         A  3049    	LD	HL,(_cur_row)
010C38 B7                  A  3050    	OR	A,A
010C39 01000000            A  3051    	LD	BC,0
010C3D ED42                A  3052    	SBC	HL,BC
010C3F 20 06               A  3053    	JR	NZ,L_170
                           A  3054    ;  759			paintall();
010C41 CD 6F 16 01         A  3055    	CALL	_paintall
                           A  3056    ;  760		else
010C45 18 44               A  3057    	JR	L_171
010C47                     A  3058    L_170:
                           A  3059    ;  761		{
                           A  3060    ;  762			ch = scn_phys[cur_row][cur_col]
010C47 2A 13 54 01         A  3061    	LD	HL,(_cur_row)
010C4B 29                  A  3062    	ADD	HL,HL
010C4C 29                  A  3063    	ADD	HL,HL
010C4D ED4B 13 54 01       A  3064    	LD	BC,(_cur_row)
010C52 09                  A  3065    	ADD	HL,BC
010C53 29                  A  3066    	ADD	HL,HL
010C54 29                  A  3067    	ADD	HL,HL
010C55 29                  A  3068    	ADD	HL,HL
010C56 29                  A  3069    	ADD	HL,HL
010C57 01 1B 43 01         A  3070    	LD	BC,_scn_phys
010C5B 09                  A  3071    	ADD	HL,BC
010C5C ED4B 16 54 01       A  3072    	LD	BC,(_cur_col)
010C61 09                  A  3073    	ADD	HL,BC
010C62 7E                  A  3074    	LD	A,(HL)
010C63 DD77FF              A  3075    	LD	(IX+-1),A
                           A  3076    ;  763			
                           A  3077    ;  764			cur_row--;
010C66 ED4B 13 54 01       A  3078    	LD	BC,(_cur_row)
010C6B 0B                  A  3079    	DEC	BC
010C6C ED43 13 54 01       A  3080    	LD	(_cur_row),BC
                           A  3081    ;  765			
                           A  3082    ;  766			plot_char(cur_col, cur_row + 1,
010C71 DD4EFF              A  3083    	LD	C,(IX+-1)
010C74 0600                A  3084    	LD	B,0
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  61


PC     Object              I  Line    Source C:\proted\Debug\main.src
010C76 C5                  A  3085    	PUSH	BC
010C77 3A 13 54 01         A  3086    	LD	A,(_cur_row)
010C7B 3C                  A  3087    	INC	A
010C7C 4F                  A  3088    	LD	C,A
010C7D C5                  A  3089    	PUSH	BC
010C7E 3A 16 54 01         A  3090    	LD	A,(_cur_col)
010C82 4F                  A  3091    	LD	C,A
010C83 C5                  A  3092    	PUSH	BC
010C84 CD 9E 02 01         A  3093    	CALL	_plot_char
010C88 C1                  A  3094    	POP	BC
010C89 C1                  A  3095    	POP	BC
010C8A C1                  A  3096    	POP	BC
                           A  3097    ;  767		}
                           A  3098    ;  768	}
010C8B                     A  3099    L_171:
010C8B DDF9                A  3100    	LD	SP,IX
010C8D DDE1                A  3101    	POP	IX
010C8F C9                  A  3102    	RET	
                           A  3103    
                           A  3104    
                           A  3105    ;**************************** _do_cup *********
                           A  3106    ;Name                         Addr/Register   S
                           A  3107    ;_plot_char                          IMPORT  --
                           A  3108    ;_cur_col                            STATIC    
                           A  3109    ;_scn_phys                           STATIC   4
                           A  3110    ;_paintall                           IMPORT  --
                           A  3111    ;_cur_row                            STATIC    
                           A  3112    ;_p_curr                             STATIC    
                           A  3113    ;_Show_Cursor                        IMPORT  --
                           A  3114    ;_cur_line                           STATIC    
                           A  3115    ;ch                                    IX-1    
                           A  3116    
                           A  3117    
                           A  3118    ; Stack Frame Size: 7 (bytes)
                           A  3119    ;       Spill Code: 0 (instruction)
                           A  3120    
                           A  3121    
                           A  3122    ;  769	
                           A  3123    ;  770	/* Cursor down. */
                           A  3124    ;  771	void do_cdw(void)
                           A  3125    ;  772	{
010C90                     A  3126    _do_cdw:
010C90 21FCFFFF            A  3127    	LD	HL,-4
010C94 CD 7E 24 01         A  3128    	CALL	__frameset
                           A  3129    ;  773		char ch;
                           A  3130    ;  774		
                           A  3131    ;  775		if (p_curr->p_next == p_root)
010C98 FD2A 07 54 01       A  3132    	LD	IY,(_p_curr)
010C9D FD0703              A  3133    	LD	BC,(IY+3)
010CA0 DD0FFC              A  3134    	LD	(IX+-4),BC
010CA3 2A 04 54 01         A  3135    	LD	HL,(_p_root)
010CA7 B7                  A  3136    	OR	A,A
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  62


PC     Object              I  Line    Source C:\proted\Debug\main.src
010CA8 ED42                A  3137    	SBC	HL,BC
010CAA 20 06               A  3138    	JR	NZ,L_173
                           A  3139    ;  776		{
                           A  3140    ;  777			Show_Cursor();
010CAC CD 34 18 01         A  3141    	CALL	_Show_Cursor
                           A  3142    ;  778			
                           A  3143    ;  779			return;
010CB0 18 6A               A  3144    	JR	L_178
                           A  3145    ;  780		}
010CB2                     A  3146    L_173:
                           A  3147    ;  781		
                           A  3148    ;  782		p_curr = p_curr->p_next;
010CB2 DD07FC              A  3149    	LD	BC,(IX+-4)
010CB5 ED43 07 54 01       A  3150    	LD	(_p_curr),BC
                           A  3151    ;  783		
                           A  3152    ;  784		cur_line++;
010CBA ED4B 0D 54 01       A  3153    	LD	BC,(_cur_line)
010CBF 03                  A  3154    	INC	BC
010CC0 ED43 0D 54 01       A  3155    	LD	(_cur_line),BC
                           A  3156    ;  785		
                           A  3157    ;  786		if (cur_row == SCNROWS - 1)
010CC5 2A 13 54 01         A  3158    	LD	HL,(_cur_row)
010CC9 B7                  A  3159    	OR	A,A
010CCA 01310000            A  3160    	LD	BC,49
010CCE ED42                A  3161    	SBC	HL,BC
010CD0 20 06               A  3162    	JR	NZ,L_177
                           A  3163    ;  787			paintall();	
010CD2 CD 6F 16 01         A  3164    	CALL	_paintall
                           A  3165    ;  788		else
010CD6 18 44               A  3166    	JR	L_178
010CD8                     A  3167    L_177:
                           A  3168    ;  789		{
                           A  3169    ;  790			ch = scn_phys[cur_row][cur_col]
010CD8 2A 13 54 01         A  3170    	LD	HL,(_cur_row)
010CDC 29                  A  3171    	ADD	HL,HL
010CDD 29                  A  3172    	ADD	HL,HL
010CDE ED4B 13 54 01       A  3173    	LD	BC,(_cur_row)
010CE3 09                  A  3174    	ADD	HL,BC
010CE4 29                  A  3175    	ADD	HL,HL
010CE5 29                  A  3176    	ADD	HL,HL
010CE6 29                  A  3177    	ADD	HL,HL
010CE7 29                  A  3178    	ADD	HL,HL
010CE8 01 1B 43 01         A  3179    	LD	BC,_scn_phys
010CEC 09                  A  3180    	ADD	HL,BC
010CED ED4B 16 54 01       A  3181    	LD	BC,(_cur_col)
010CF2 09                  A  3182    	ADD	HL,BC
010CF3 7E                  A  3183    	LD	A,(HL)
010CF4 DD77FF              A  3184    	LD	(IX+-1),A
                           A  3185    ;  791			
                           A  3186    ;  792			cur_row++;
010CF7 ED4B 13 54 01       A  3187    	LD	BC,(_cur_row)
010CFC 03                  A  3188    	INC	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  63


PC     Object              I  Line    Source C:\proted\Debug\main.src
010CFD ED43 13 54 01       A  3189    	LD	(_cur_row),BC
                           A  3190    ;  793			
                           A  3191    ;  794			plot_char(cur_col, cur_row - 1,
010D02 DD4EFF              A  3192    	LD	C,(IX+-1)
010D05 0600                A  3193    	LD	B,0
010D07 C5                  A  3194    	PUSH	BC
010D08 3A 13 54 01         A  3195    	LD	A,(_cur_row)
010D0C 3D                  A  3196    	DEC	A
010D0D 4F                  A  3197    	LD	C,A
010D0E C5                  A  3198    	PUSH	BC
010D0F 3A 16 54 01         A  3199    	LD	A,(_cur_col)
010D13 4F                  A  3200    	LD	C,A
010D14 C5                  A  3201    	PUSH	BC
010D15 CD 9E 02 01         A  3202    	CALL	_plot_char
010D19 C1                  A  3203    	POP	BC
010D1A C1                  A  3204    	POP	BC
010D1B C1                  A  3205    	POP	BC
                           A  3206    ;  795		}
                           A  3207    ;  796	}
010D1C                     A  3208    L_178:
010D1C DDF9                A  3209    	LD	SP,IX
010D1E DDE1                A  3210    	POP	IX
010D20 C9                  A  3211    	RET	
                           A  3212    
                           A  3213    
                           A  3214    ;**************************** _do_cdw *********
                           A  3215    ;Name                         Addr/Register   S
                           A  3216    ;_plot_char                          IMPORT  --
                           A  3217    ;_cur_col                            STATIC    
                           A  3218    ;_scn_phys                           STATIC   4
                           A  3219    ;_paintall                           IMPORT  --
                           A  3220    ;_cur_row                            STATIC    
                           A  3221    ;_cur_line                           STATIC    
                           A  3222    ;_Show_Cursor                        IMPORT  --
                           A  3223    ;_p_root                             STATIC    
                           A  3224    ;_p_curr                             STATIC    
                           A  3225    ;G_5                                   IX-4    
                           A  3226    ;ch                                    IX-1    
                           A  3227    
                           A  3228    
                           A  3229    ; Stack Frame Size: 10 (bytes)
                           A  3230    ;       Spill Code: 0 (instruction)
                           A  3231    
                           A  3232    
                           A  3233    ;  797	
                           A  3234    ;  798	/* Cursor left. */
                           A  3235    ;  799	void do_clf(void)
                           A  3236    ;  800	{
010D21                     A  3237    _do_clf:
010D21 21FFFFFF            A  3238    	LD	HL,-1
010D25 CD 7E 24 01         A  3239    	CALL	__frameset
                           A  3240    ;  801		char ch;
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  64


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3241    ;  802		
                           A  3242    ;  803		if (cur_char == 1)
010D29 01010000            A  3243    	LD	BC,1
010D2D 2A 10 54 01         A  3244    	LD	HL,(_cur_char)
010D31 B7                  A  3245    	OR	A,A
010D32 ED42                A  3246    	SBC	HL,BC
010D34 20 06               A  3247    	JR	NZ,L_181
                           A  3248    ;  804		{
                           A  3249    ;  805			Show_Cursor();
010D36 CD 34 18 01         A  3250    	CALL	_Show_Cursor
                           A  3251    ;  806			
                           A  3252    ;  807			return;
010D3A 18 62               A  3253    	JR	L_185
                           A  3254    ;  808		}
010D3C                     A  3255    L_181:
                           A  3256    ;  809		
                           A  3257    ;  810		cur_char--;
010D3C ED4B 10 54 01       A  3258    	LD	BC,(_cur_char)
010D41 0B                  A  3259    	DEC	BC
010D42 ED43 10 54 01       A  3260    	LD	(_cur_char),BC
                           A  3261    ;  811		
                           A  3262    ;  812		if (cur_col == 0)
010D47 2A 16 54 01         A  3263    	LD	HL,(_cur_col)
010D4B B7                  A  3264    	OR	A,A
010D4C 01000000            A  3265    	LD	BC,0
010D50 ED42                A  3266    	SBC	HL,BC
010D52 20 06               A  3267    	JR	NZ,L_184
                           A  3268    ;  813			paintall();
010D54 CD 6F 16 01         A  3269    	CALL	_paintall
                           A  3270    ;  814		else
010D58 18 44               A  3271    	JR	L_185
010D5A                     A  3272    L_184:
                           A  3273    ;  815		{
                           A  3274    ;  816			ch = scn_phys[cur_row][cur_col]
010D5A 2A 13 54 01         A  3275    	LD	HL,(_cur_row)
010D5E 29                  A  3276    	ADD	HL,HL
010D5F 29                  A  3277    	ADD	HL,HL
010D60 ED4B 13 54 01       A  3278    	LD	BC,(_cur_row)
010D65 09                  A  3279    	ADD	HL,BC
010D66 29                  A  3280    	ADD	HL,HL
010D67 29                  A  3281    	ADD	HL,HL
010D68 29                  A  3282    	ADD	HL,HL
010D69 29                  A  3283    	ADD	HL,HL
010D6A 01 1B 43 01         A  3284    	LD	BC,_scn_phys
010D6E 09                  A  3285    	ADD	HL,BC
010D6F ED4B 16 54 01       A  3286    	LD	BC,(_cur_col)
010D74 09                  A  3287    	ADD	HL,BC
010D75 7E                  A  3288    	LD	A,(HL)
010D76 DD77FF              A  3289    	LD	(IX+-1),A
                           A  3290    ;  817			
                           A  3291    ;  818			cur_col--;
010D79 ED4B 16 54 01       A  3292    	LD	BC,(_cur_col)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  65


PC     Object              I  Line    Source C:\proted\Debug\main.src
010D7E 0B                  A  3293    	DEC	BC
010D7F ED43 16 54 01       A  3294    	LD	(_cur_col),BC
                           A  3295    ;  819			
                           A  3296    ;  820			plot_char(cur_col + 1, cur_row,
010D84 DD4EFF              A  3297    	LD	C,(IX+-1)
010D87 3A 13 54 01         A  3298    	LD	A,(_cur_row)
010D8B 0600                A  3299    	LD	B,0
010D8D C5                  A  3300    	PUSH	BC
010D8E 4F                  A  3301    	LD	C,A
010D8F C5                  A  3302    	PUSH	BC
010D90 3A 16 54 01         A  3303    	LD	A,(_cur_col)
010D94 3C                  A  3304    	INC	A
010D95 4F                  A  3305    	LD	C,A
010D96 C5                  A  3306    	PUSH	BC
010D97 CD 9E 02 01         A  3307    	CALL	_plot_char
010D9B C1                  A  3308    	POP	BC
010D9C C1                  A  3309    	POP	BC
010D9D C1                  A  3310    	POP	BC
                           A  3311    ;  821		}
                           A  3312    ;  822	}
010D9E                     A  3313    L_185:
010D9E DDF9                A  3314    	LD	SP,IX
010DA0 DDE1                A  3315    	POP	IX
010DA2 C9                  A  3316    	RET	
                           A  3317    
                           A  3318    
                           A  3319    ;**************************** _do_clf *********
                           A  3320    ;Name                         Addr/Register   S
                           A  3321    ;_plot_char                          IMPORT  --
                           A  3322    ;_cur_row                            STATIC    
                           A  3323    ;_scn_phys                           STATIC   4
                           A  3324    ;_paintall                           IMPORT  --
                           A  3325    ;_cur_col                            STATIC    
                           A  3326    ;_Show_Cursor                        IMPORT  --
                           A  3327    ;_cur_char                           STATIC    
                           A  3328    ;ch                                    IX-1    
                           A  3329    
                           A  3330    
                           A  3331    ; Stack Frame Size: 7 (bytes)
                           A  3332    ;       Spill Code: 0 (instruction)
                           A  3333    
                           A  3334    
                           A  3335    ;  823	
                           A  3336    ;  824	/* Cursor right. */
                           A  3337    ;  825	void do_crt(void)
                           A  3338    ;  826	{
010DA3                     A  3339    _do_crt:
010DA3 21FFFFFF            A  3340    	LD	HL,-1
010DA7 CD 7E 24 01         A  3341    	CALL	__frameset
                           A  3342    ;  827		char ch;
                           A  3343    ;  828		
                           A  3344    ;  829		if (cur_char == MAXLNLEN)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  66


PC     Object              I  Line    Source C:\proted\Debug\main.src
010DAB 01500000            A  3345    	LD	BC,80
010DAF 2A 10 54 01         A  3346    	LD	HL,(_cur_char)
010DB3 B7                  A  3347    	OR	A,A
010DB4 ED42                A  3348    	SBC	HL,BC
010DB6 20 06               A  3349    	JR	NZ,L_188
                           A  3350    ;  830		{
                           A  3351    ;  831			Show_Cursor();
010DB8 CD 34 18 01         A  3352    	CALL	_Show_Cursor
                           A  3353    ;  832			
                           A  3354    ;  833			return;
010DBC 18 62               A  3355    	JR	L_192
                           A  3356    ;  834		}
010DBE                     A  3357    L_188:
                           A  3358    ;  835		
                           A  3359    ;  836		cur_char++;
010DBE ED4B 10 54 01       A  3360    	LD	BC,(_cur_char)
010DC3 03                  A  3361    	INC	BC
010DC4 ED43 10 54 01       A  3362    	LD	(_cur_char),BC
                           A  3363    ;  837		
                           A  3364    ;  838		if (cur_col == SCNCOLS - 1)
010DC9 2A 16 54 01         A  3365    	LD	HL,(_cur_col)
010DCD B7                  A  3366    	OR	A,A
010DCE 014F0000            A  3367    	LD	BC,79
010DD2 ED42                A  3368    	SBC	HL,BC
010DD4 20 06               A  3369    	JR	NZ,L_191
                           A  3370    ;  839			paintall();
010DD6 CD 6F 16 01         A  3371    	CALL	_paintall
                           A  3372    ;  840		else
010DDA 18 44               A  3373    	JR	L_192
010DDC                     A  3374    L_191:
                           A  3375    ;  841		{
                           A  3376    ;  842			ch = scn_phys[cur_row][cur_col]
010DDC 2A 13 54 01         A  3377    	LD	HL,(_cur_row)
010DE0 29                  A  3378    	ADD	HL,HL
010DE1 29                  A  3379    	ADD	HL,HL
010DE2 ED4B 13 54 01       A  3380    	LD	BC,(_cur_row)
010DE7 09                  A  3381    	ADD	HL,BC
010DE8 29                  A  3382    	ADD	HL,HL
010DE9 29                  A  3383    	ADD	HL,HL
010DEA 29                  A  3384    	ADD	HL,HL
010DEB 29                  A  3385    	ADD	HL,HL
010DEC 01 1B 43 01         A  3386    	LD	BC,_scn_phys
010DF0 09                  A  3387    	ADD	HL,BC
010DF1 ED4B 16 54 01       A  3388    	LD	BC,(_cur_col)
010DF6 09                  A  3389    	ADD	HL,BC
010DF7 7E                  A  3390    	LD	A,(HL)
010DF8 DD77FF              A  3391    	LD	(IX+-1),A
                           A  3392    ;  843			
                           A  3393    ;  844			cur_col++;
010DFB ED4B 16 54 01       A  3394    	LD	BC,(_cur_col)
010E00 03                  A  3395    	INC	BC
010E01 ED43 16 54 01       A  3396    	LD	(_cur_col),BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  67


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3397    ;  845			
                           A  3398    ;  846			plot_char(cur_col - 1, cur_row,
010E06 DD4EFF              A  3399    	LD	C,(IX+-1)
010E09 3A 13 54 01         A  3400    	LD	A,(_cur_row)
010E0D 0600                A  3401    	LD	B,0
010E0F C5                  A  3402    	PUSH	BC
010E10 4F                  A  3403    	LD	C,A
010E11 C5                  A  3404    	PUSH	BC
010E12 3A 16 54 01         A  3405    	LD	A,(_cur_col)
010E16 3D                  A  3406    	DEC	A
010E17 4F                  A  3407    	LD	C,A
010E18 C5                  A  3408    	PUSH	BC
010E19 CD 9E 02 01         A  3409    	CALL	_plot_char
010E1D C1                  A  3410    	POP	BC
010E1E C1                  A  3411    	POP	BC
010E1F C1                  A  3412    	POP	BC
                           A  3413    ;  847		}
                           A  3414    ;  848	}
010E20                     A  3415    L_192:
010E20 DDF9                A  3416    	LD	SP,IX
010E22 DDE1                A  3417    	POP	IX
010E24 C9                  A  3418    	RET	
                           A  3419    
                           A  3420    
                           A  3421    ;**************************** _do_crt *********
                           A  3422    ;Name                         Addr/Register   S
                           A  3423    ;_plot_char                          IMPORT  --
                           A  3424    ;_cur_row                            STATIC    
                           A  3425    ;_scn_phys                           STATIC   4
                           A  3426    ;_paintall                           IMPORT  --
                           A  3427    ;_cur_col                            STATIC    
                           A  3428    ;_Show_Cursor                        IMPORT  --
                           A  3429    ;_cur_char                           STATIC    
                           A  3430    ;ch                                    IX-1    
                           A  3431    
                           A  3432    
                           A  3433    ; Stack Frame Size: 7 (bytes)
                           A  3434    ;       Spill Code: 0 (instruction)
                           A  3435    
                           A  3436    
                           A  3437    ;  849	
                           A  3438    ;  850	/* Page down. */
                           A  3439    ;  851	void do_pdw(void)
                           A  3440    ;  852	{
010E25                     A  3441    _do_pdw:
010E25 21FDFFFF            A  3442    	LD	HL,-3
010E29 CD 7E 24 01         A  3443    	CALL	__frameset
                           A  3444    ;  853		register char i;
                           A  3445    ;  854		char ch, oldr = cur_row;
010E2D 3A 13 54 01         A  3446    	LD	A,(_cur_row)
010E31 DD77FE              A  3447    	LD	(IX+-2),A
010E34 DD36FF00            A  3448    	LD	(IX+-1),0
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  68


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3449    ;  855		
                           A  3450    ;  856		for (i = 0; i < SCNROWS; i++)
010E38 18 35               A  3451    	JR	L_200
010E3A                     A  3452    L_198:
                           A  3453    ;  857		{
                           A  3454    ;  858			if (cur_line == numlines + 1)
010E3A 2A 0A 54 01         A  3455    	LD	HL,(_numlines)
010E3E 23                  A  3456    	INC	HL
010E3F B7                  A  3457    	OR	A,A
010E40 ED4B 0D 54 01       A  3458    	LD	BC,(_cur_line)
010E45 ED42                A  3459    	SBC	HL,BC
010E47 28 2F               A  3460    	JR	Z,L_202
                           A  3461    ;  859				break;
                           A  3462    ;  860			
                           A  3463    ;  861			p_curr = p_curr->p_next;
010E49 FD2A 07 54 01       A  3464    	LD	IY,(_p_curr)
010E4E FD0703              A  3465    	LD	BC,(IY+3)
010E51 ED43 07 54 01       A  3466    	LD	(_p_curr),BC
                           A  3467    ;  862			
                           A  3468    ;  863			cur_line++;
010E56 ED4B 0D 54 01       A  3469    	LD	BC,(_cur_line)
010E5B 03                  A  3470    	INC	BC
010E5C ED43 0D 54 01       A  3471    	LD	(_cur_line),BC
                           A  3472    ;  864			cur_row++;
010E61 ED4B 13 54 01       A  3473    	LD	BC,(_cur_row)
010E66 03                  A  3474    	INC	BC
010E67 ED43 13 54 01       A  3475    	LD	(_cur_row),BC
010E6C DD34FF              A  3476    	INC	(IX+-1)
                           A  3477    ;  865		}
010E6F                     A  3478    L_200:
010E6F DD7EFF              A  3479    	LD	A,(IX+-1)
010E72 FE32                A  3480    	CP	A,50
010E74 FA 3A 0E 01         A  3481    	JP	M,L_198
010E78                     A  3482    L_202:
                           A  3483    ;  866		
                           A  3484    ;  867		if (cur_row > SCNROWS - 1)
010E78 ED4B 13 54 01       A  3485    	LD	BC,(_cur_row)
010E7D 21310000            A  3486    	LD	HL,49
010E81 B7                  A  3487    	OR	A,A
010E82 ED42                A  3488    	SBC	HL,BC
010E84 F2 8E 0E 01         A  3489    	JP	P,L__157
010E88 EA 9B 0E 01         A  3490    	JP	PE,L_203
010E8C 18 04               A  3491    	JR	L__158
010E8E                     A  3492    L__157:
010E8E E2 9B 0E 01         A  3493    	JP	PO,L_203
010E92                     A  3494    L__158:
                           A  3495    ;  868			cur_row = SCNROWS - 1;
010E92 01310000            A  3496    	LD	BC,49
010E96 ED43 13 54 01       A  3497    	LD	(_cur_row),BC
010E9B                     A  3498    L_203:
                           A  3499    ;  869		
                           A  3500    ;  870		paintall();
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  69


PC     Object              I  Line    Source C:\proted\Debug\main.src
010E9B CD 6F 16 01         A  3501    	CALL	_paintall
                           A  3502    ;  871		
                           A  3503    ;  872		ch = scn_phys[oldr][cur_col];
010E9F DD7EFE              A  3504    	LD	A,(IX+-2)
010EA2 17ED62              A  3505    	SEXT	HL
010EA5 DD6EFE              A  3506    	LD	L,(IX+-2)
010EA8 E5C1                A  3507    	LD	BC,HL
010EAA C5E1                A  3508    	LD	HL,BC
010EAC 29                  A  3509    	ADD	HL,HL
010EAD 29                  A  3510    	ADD	HL,HL
010EAE 09                  A  3511    	ADD	HL,BC
010EAF 29                  A  3512    	ADD	HL,HL
010EB0 29                  A  3513    	ADD	HL,HL
010EB1 29                  A  3514    	ADD	HL,HL
010EB2 29                  A  3515    	ADD	HL,HL
010EB3 01 1B 43 01         A  3516    	LD	BC,_scn_phys
010EB7 09                  A  3517    	ADD	HL,BC
010EB8 ED4B 16 54 01       A  3518    	LD	BC,(_cur_col)
010EBD 09                  A  3519    	ADD	HL,BC
010EBE 7E                  A  3520    	LD	A,(HL)
010EBF DD77FD              A  3521    	LD	(IX+-3),A
                           A  3522    ;  873		
                           A  3523    ;  874		plot_char(cur_col, oldr, ch);
010EC2 DD4EFD              A  3524    	LD	C,(IX+-3)
010EC5 0600                A  3525    	LD	B,0
010EC7 C5                  A  3526    	PUSH	BC
010EC8 DD4EFE              A  3527    	LD	C,(IX+-2)
010ECB 3A 16 54 01         A  3528    	LD	A,(_cur_col)
010ECF C5                  A  3529    	PUSH	BC
010ED0 4F                  A  3530    	LD	C,A
010ED1 C5                  A  3531    	PUSH	BC
010ED2 CD 9E 02 01         A  3532    	CALL	_plot_char
010ED6 C1                  A  3533    	POP	BC
010ED7 C1                  A  3534    	POP	BC
010ED8 C1                  A  3535    	POP	BC
                           A  3536    ;  875		
                           A  3537    ;  876		Show_Cursor();
010ED9 CD 34 18 01         A  3538    	CALL	_Show_Cursor
                           A  3539    ;  877	}
010EDD DDF9                A  3540    	LD	SP,IX
010EDF DDE1                A  3541    	POP	IX
010EE1 C9                  A  3542    	RET	
                           A  3543    
                           A  3544    
                           A  3545    ;**************************** _do_pdw *********
                           A  3546    ;Name                         Addr/Register   S
                           A  3547    ;_Show_Cursor                        IMPORT  --
                           A  3548    ;_plot_char                          IMPORT  --
                           A  3549    ;_cur_col                            STATIC    
                           A  3550    ;_scn_phys                           STATIC   4
                           A  3551    ;_paintall                           IMPORT  --
                           A  3552    ;_p_curr                             STATIC    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  70


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3553    ;_cur_line                           STATIC    
                           A  3554    ;_numlines                           STATIC    
                           A  3555    ;_cur_row                            STATIC    
                           A  3556    ;ch                                    IX-3    
                           A  3557    ;oldr                                  IX-2    
                           A  3558    ;i                                     IX-1    
                           A  3559    
                           A  3560    
                           A  3561    ; Stack Frame Size: 9 (bytes)
                           A  3562    ;       Spill Code: 0 (instruction)
                           A  3563    
                           A  3564    
                           A  3565    ;  878	
                           A  3566    ;  879	/* Page up. */
                           A  3567    ;  880	void do_pup(void)
                           A  3568    ;  881	{
010EE2                     A  3569    _do_pup:
010EE2 21FDFFFF            A  3570    	LD	HL,-3
010EE6 CD 7E 24 01         A  3571    	CALL	__frameset
                           A  3572    ;  882		register char i;
                           A  3573    ;  883		char ch, oldr = cur_row;
010EEA 3A 13 54 01         A  3574    	LD	A,(_cur_row)
010EEE DD77FE              A  3575    	LD	(IX+-2),A
010EF1 DD36FF00            A  3576    	LD	(IX+-1),0
                           A  3577    ;  884		
                           A  3578    ;  885		for (i = 0; i < SCNROWS; i++)
010EF5 18 33               A  3579    	JR	L_212
010EF7                     A  3580    L_210:
                           A  3581    ;  886		{
                           A  3582    ;  887			if (cur_line == 1)
010EF7 01010000            A  3583    	LD	BC,1
010EFB 2A 0D 54 01         A  3584    	LD	HL,(_cur_line)
010EFF B7                  A  3585    	OR	A,A
010F00 ED42                A  3586    	SBC	HL,BC
010F02 28 39               A  3587    	JR	Z,L_214
                           A  3588    ;  888				break;
                           A  3589    ;  889			
                           A  3590    ;  890			p_curr = p_curr->p_prev;
010F04 FD2A 07 54 01       A  3591    	LD	IY,(_p_curr)
010F09 FD0700              A  3592    	LD	BC,(IY+0)
010F0C ED43 07 54 01       A  3593    	LD	(_p_curr),BC
                           A  3594    ;  891			
                           A  3595    ;  892			cur_line--;
010F11 ED4B 0D 54 01       A  3596    	LD	BC,(_cur_line)
010F16 0B                  A  3597    	DEC	BC
010F17 ED43 0D 54 01       A  3598    	LD	(_cur_line),BC
                           A  3599    ;  893			cur_row--;
010F1C ED4B 13 54 01       A  3600    	LD	BC,(_cur_row)
010F21 0B                  A  3601    	DEC	BC
010F22 ED43 13 54 01       A  3602    	LD	(_cur_row),BC
010F27 DD34FF              A  3603    	INC	(IX+-1)
                           A  3604    ;  894		}
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  71


PC     Object              I  Line    Source C:\proted\Debug\main.src
010F2A                     A  3605    L_212:
010F2A DD7EFF              A  3606    	LD	A,(IX+-1)
010F2D FE32                A  3607    	CP	A,50
010F2F FA 39 0F 01         A  3608    	JP	M,L__163
010F33 EA F7 0E 01         A  3609    	JP	PE,L_210
010F37 18 04               A  3610    	JR	L__164
010F39                     A  3611    L__163:
010F39 E2 F7 0E 01         A  3612    	JP	PO,L_210
010F3D                     A  3613    L__164:
010F3D                     A  3614    L_214:
                           A  3615    ;  895		
                           A  3616    ;  896		if (cur_row < 0)
010F3D 01000000            A  3617    	LD	BC,0
010F41 2A 13 54 01         A  3618    	LD	HL,(_cur_row)
010F45 B7                  A  3619    	OR	A,A
010F46 ED42                A  3620    	SBC	HL,BC
010F48 F2 52 0F 01         A  3621    	JP	P,L__165
010F4C EA 5F 0F 01         A  3622    	JP	PE,L_215
010F50 18 04               A  3623    	JR	L__166
010F52                     A  3624    L__165:
010F52 E2 5F 0F 01         A  3625    	JP	PO,L_215
010F56                     A  3626    L__166:
                           A  3627    ;  897			cur_row = 0;	
010F56 01000000            A  3628    	LD	BC,0
010F5A ED43 13 54 01       A  3629    	LD	(_cur_row),BC
010F5F                     A  3630    L_215:
                           A  3631    ;  898		
                           A  3632    ;  899		paintall();
010F5F CD 6F 16 01         A  3633    	CALL	_paintall
                           A  3634    ;  900		
                           A  3635    ;  901		ch = scn_phys[oldr][cur_col];
010F63 DD7EFE              A  3636    	LD	A,(IX+-2)
010F66 17ED62              A  3637    	SEXT	HL
010F69 DD6EFE              A  3638    	LD	L,(IX+-2)
010F6C E5C1                A  3639    	LD	BC,HL
010F6E C5E1                A  3640    	LD	HL,BC
010F70 29                  A  3641    	ADD	HL,HL
010F71 29                  A  3642    	ADD	HL,HL
010F72 09                  A  3643    	ADD	HL,BC
010F73 29                  A  3644    	ADD	HL,HL
010F74 29                  A  3645    	ADD	HL,HL
010F75 29                  A  3646    	ADD	HL,HL
010F76 29                  A  3647    	ADD	HL,HL
010F77 01 1B 43 01         A  3648    	LD	BC,_scn_phys
010F7B 09                  A  3649    	ADD	HL,BC
010F7C ED4B 16 54 01       A  3650    	LD	BC,(_cur_col)
010F81 09                  A  3651    	ADD	HL,BC
010F82 7E                  A  3652    	LD	A,(HL)
010F83 DD77FD              A  3653    	LD	(IX+-3),A
                           A  3654    ;  902		
                           A  3655    ;  903		plot_char(cur_col, oldr, ch);
010F86 DD4EFD              A  3656    	LD	C,(IX+-3)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  72


PC     Object              I  Line    Source C:\proted\Debug\main.src
010F89 0600                A  3657    	LD	B,0
010F8B C5                  A  3658    	PUSH	BC
010F8C DD4EFE              A  3659    	LD	C,(IX+-2)
010F8F 3A 16 54 01         A  3660    	LD	A,(_cur_col)
010F93 C5                  A  3661    	PUSH	BC
010F94 4F                  A  3662    	LD	C,A
010F95 C5                  A  3663    	PUSH	BC
010F96 CD 9E 02 01         A  3664    	CALL	_plot_char
010F9A C1                  A  3665    	POP	BC
010F9B C1                  A  3666    	POP	BC
010F9C C1                  A  3667    	POP	BC
                           A  3668    ;  904		
                           A  3669    ;  905		Show_Cursor();
010F9D CD 34 18 01         A  3670    	CALL	_Show_Cursor
                           A  3671    ;  906	}
010FA1 DDF9                A  3672    	LD	SP,IX
010FA3 DDE1                A  3673    	POP	IX
010FA5 C9                  A  3674    	RET	
                           A  3675    
                           A  3676    
                           A  3677    ;**************************** _do_pup *********
                           A  3678    ;Name                         Addr/Register   S
                           A  3679    ;_Show_Cursor                        IMPORT  --
                           A  3680    ;_plot_char                          IMPORT  --
                           A  3681    ;_cur_col                            STATIC    
                           A  3682    ;_scn_phys                           STATIC   4
                           A  3683    ;_paintall                           IMPORT  --
                           A  3684    ;_p_curr                             STATIC    
                           A  3685    ;_cur_line                           STATIC    
                           A  3686    ;_cur_row                            STATIC    
                           A  3687    ;ch                                    IX-3    
                           A  3688    ;oldr                                  IX-2    
                           A  3689    ;i                                     IX-1    
                           A  3690    
                           A  3691    
                           A  3692    ; Stack Frame Size: 9 (bytes)
                           A  3693    ;       Spill Code: 0 (instruction)
                           A  3694    
                           A  3695    
                           A  3696    ;  907	
                           A  3697    ;  908	/* Return. */
                           A  3698    ;  909	void do_ret(void)
                           A  3699    ;  910	{
010FA6                     A  3700    _do_ret:
010FA6 21FCFFFF            A  3701    	LD	HL,-4
010FAA CD 7E 24 01         A  3702    	CALL	__frameset
                           A  3703    ;  911		char len = strlen(p_curr->p_data);
010FAE FD2A 07 54 01       A  3704    	LD	IY,(_p_curr)
010FB3 FD0706              A  3705    	LD	BC,(IY+6)
010FB6 C5                  A  3706    	PUSH	BC
010FB7 CD 3B 24 01         A  3707    	CALL	_strlen
010FBB C1                  A  3708    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  73


PC     Object              I  Line    Source C:\proted\Debug\main.src
010FBC DD75FC              A  3709    	LD	(IX+-4),L
                           A  3710    ;  912		char ch, oldr = cur_row, oldc = cur
010FBF 3A 13 54 01         A  3711    	LD	A,(_cur_row)
010FC3 DD77FF              A  3712    	LD	(IX+-1),A
010FC6 3A 16 54 01         A  3713    	LD	A,(_cur_col)
010FCA DD77FE              A  3714    	LD	(IX+-2),A
                           A  3715    ;  913		
                           A  3716    ;  914		gotoxy(len, cur_row);
010FCD 3A 13 54 01         A  3717    	LD	A,(_cur_row)
010FD1 4F                  A  3718    	LD	C,A
010FD2 0600                A  3719    	LD	B,0
010FD4 C5                  A  3720    	PUSH	BC
010FD5 DD4EFC              A  3721    	LD	C,(IX+-4)
010FD8 C5                  A  3722    	PUSH	BC
010FD9 CD 19 03 01         A  3723    	CALL	_gotoxy
010FDD C1                  A  3724    	POP	BC
010FDE C1                  A  3725    	POP	BC
                           A  3726    ;  915		
                           A  3727    ;  916		clreol();
010FDF CD D6 02 01         A  3728    	CALL	_clreol
                           A  3729    ;  917		
                           A  3730    ;  918		ch = scn_phys[oldr][oldc];
010FE3 DD7EFF              A  3731    	LD	A,(IX+-1)
010FE6 17ED62              A  3732    	SEXT	HL
010FE9 DD6EFF              A  3733    	LD	L,(IX+-1)
010FEC E5C1                A  3734    	LD	BC,HL
010FEE C5E1                A  3735    	LD	HL,BC
010FF0 29                  A  3736    	ADD	HL,HL
010FF1 29                  A  3737    	ADD	HL,HL
010FF2 09                  A  3738    	ADD	HL,BC
010FF3 29                  A  3739    	ADD	HL,HL
010FF4 29                  A  3740    	ADD	HL,HL
010FF5 29                  A  3741    	ADD	HL,HL
010FF6 29                  A  3742    	ADD	HL,HL
010FF7 DD7EFE              A  3743    	LD	A,(IX+-2)
010FFA 01 1B 43 01         A  3744    	LD	BC,_scn_phys
010FFE 09                  A  3745    	ADD	HL,BC
010FFF E5C1                A  3746    	LD	BC,HL
011001 17ED62              A  3747    	SEXT	HL
011004 DD6EFE              A  3748    	LD	L,(IX+-2)
011007 09                  A  3749    	ADD	HL,BC
011008 7E                  A  3750    	LD	A,(HL)
011009 DD77FD              A  3751    	LD	(IX+-3),A
                           A  3752    ;  919		
                           A  3753    ;  920		plot_char(oldc, oldr, ch);
01100C DD4EFD              A  3754    	LD	C,(IX+-3)
01100F 0600                A  3755    	LD	B,0
011011 C5                  A  3756    	PUSH	BC
011012 DD4EFF              A  3757    	LD	C,(IX+-1)
011015 C5                  A  3758    	PUSH	BC
011016 DD4EFE              A  3759    	LD	C,(IX+-2)
011019 C5                  A  3760    	PUSH	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  74


PC     Object              I  Line    Source C:\proted\Debug\main.src
01101A CD 9E 02 01         A  3761    	CALL	_plot_char
01101E C1                  A  3762    	POP	BC
01101F C1                  A  3763    	POP	BC
011020 C1                  A  3764    	POP	BC
                           A  3765    ;  921		
                           A  3766    ;  922		cur_char = 1;
011021 01010000            A  3767    	LD	BC,1
011025 ED43 10 54 01       A  3768    	LD	(_cur_char),BC
                           A  3769    ;  923		cur_col  = 0;
01102A 01000000            A  3770    	LD	BC,0
01102E ED43 16 54 01       A  3771    	LD	(_cur_col),BC
                           A  3772    ;  924		
                           A  3773    ;  925		ch = scn_phys[oldr][oldc];
011033 DD7EFF              A  3774    	LD	A,(IX+-1)
011036 17ED62              A  3775    	SEXT	HL
011039 DD6EFF              A  3776    	LD	L,(IX+-1)
01103C E5C1                A  3777    	LD	BC,HL
01103E C5E1                A  3778    	LD	HL,BC
011040 29                  A  3779    	ADD	HL,HL
011041 29                  A  3780    	ADD	HL,HL
011042 09                  A  3781    	ADD	HL,BC
011043 29                  A  3782    	ADD	HL,HL
011044 29                  A  3783    	ADD	HL,HL
011045 29                  A  3784    	ADD	HL,HL
011046 29                  A  3785    	ADD	HL,HL
011047 DD7EFE              A  3786    	LD	A,(IX+-2)
01104A 01 1B 43 01         A  3787    	LD	BC,_scn_phys
01104E 09                  A  3788    	ADD	HL,BC
01104F E5C1                A  3789    	LD	BC,HL
011051 17ED62              A  3790    	SEXT	HL
011054 DD6EFE              A  3791    	LD	L,(IX+-2)
011057 09                  A  3792    	ADD	HL,BC
011058 7E                  A  3793    	LD	A,(HL)
011059 DD77FD              A  3794    	LD	(IX+-3),A
                           A  3795    ;  926		
                           A  3796    ;  927		plot_char(oldc, oldr, ch);
01105C DD4EFD              A  3797    	LD	C,(IX+-3)
01105F 0600                A  3798    	LD	B,0
011061 C5                  A  3799    	PUSH	BC
011062 DD4EFF              A  3800    	LD	C,(IX+-1)
011065 C5                  A  3801    	PUSH	BC
011066 DD4EFE              A  3802    	LD	C,(IX+-2)
011069 C5                  A  3803    	PUSH	BC
01106A CD 9E 02 01         A  3804    	CALL	_plot_char
01106E C1                  A  3805    	POP	BC
01106F C1                  A  3806    	POP	BC
011070 C1                  A  3807    	POP	BC
                           A  3808    ;  928		
                           A  3809    ;  929		do_cdw();
011071 CD 90 0C 01         A  3810    	CALL	_do_cdw
                           A  3811    ;  930	}
011075 DDF9                A  3812    	LD	SP,IX
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  75


PC     Object              I  Line    Source C:\proted\Debug\main.src
011077 DDE1                A  3813    	POP	IX
011079 C9                  A  3814    	RET	
                           A  3815    
                           A  3816    
                           A  3817    ;**************************** _do_ret *********
                           A  3818    ;Name                         Addr/Register   S
                           A  3819    ;_do_cdw                             IMPORT  --
                           A  3820    ;_cur_char                           STATIC    
                           A  3821    ;_plot_char                          IMPORT  --
                           A  3822    ;_scn_phys                           STATIC   4
                           A  3823    ;_clreol                             IMPORT  --
                           A  3824    ;_gotoxy                             IMPORT  --
                           A  3825    ;_cur_col                            STATIC    
                           A  3826    ;_cur_row                            STATIC    
                           A  3827    ;_p_curr                             STATIC    
                           A  3828    ;_strlen                             IMPORT  --
                           A  3829    ;len                                   IX-4    
                           A  3830    ;ch                                    IX-3    
                           A  3831    ;oldc                                  IX-2    
                           A  3832    ;oldr                                  IX-1    
                           A  3833    
                           A  3834    
                           A  3835    ; Stack Frame Size: 10 (bytes)
                           A  3836    ;       Spill Code: 0 (instruction)
                           A  3837    
                           A  3838    
                           A  3839    ;  931	
                           A  3840    ;  932	/* Enhanced Return. Break a line into t
                           A  3841    ;  933	void do_enhanced_ret(void)
                           A  3842    ;  934	{
01107A                     A  3843    _do_enhanced_ret:
01107A 215FFFFF            A  3844    	LD	HL,-161
01107E CD 7E 24 01         A  3845    	CALL	__frameset
                           A  3846    ;  935		char len = strlen(p_curr->p_data);
011082 FD2A 07 54 01       A  3847    	LD	IY,(_p_curr)
011087 FD0706              A  3848    	LD	BC,(IY+6)
01108A C5                  A  3849    	PUSH	BC
01108B CD 3B 24 01         A  3850    	CALL	_strlen
01108F C1                  A  3851    	POP	BC
011090 DD75FF              A  3852    	LD	(IX+-1),L
                           A  3853    ;  936		char app[MAXLNLEN], app2[MAXLNLEN];
                           A  3854    ;  937		
                           A  3855    ;  938		if (cur_col < len)
011093 DD7EFF              A  3856    	LD	A,(IX+-1)
011096 17ED62              A  3857    	SEXT	HL
011099 DD6EFF              A  3858    	LD	L,(IX+-1)
01109C E5C1                A  3859    	LD	BC,HL
01109E 2A 16 54 01         A  3860    	LD	HL,(_cur_col)
0110A2 B7                  A  3861    	OR	A,A
0110A3 ED42                A  3862    	SBC	HL,BC
0110A5 F2 AF 10 01         A  3863    	JP	P,L__170
0110A9 EA 64 11 01         A  3864    	JP	PE,L_219
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  76


PC     Object              I  Line    Source C:\proted\Debug\main.src
0110AD 18 04               A  3865    	JR	L__171
0110AF                     A  3866    L__170:
0110AF E2 64 11 01         A  3867    	JP	PO,L_219
0110B3                     A  3868    L__171:
                           A  3869    ;  939		{
                           A  3870    ;  940			memset(app, 0, MAXLNLEN);
0110B3 01500000            A  3871    	LD	BC,80
0110B7 C5                  A  3872    	PUSH	BC
0110B8 01000000            A  3873    	LD	BC,0
0110BC C5                  A  3874    	PUSH	BC
0110BD ED65AF              A  3875    	PEA	IX+-81
0110C0 CD 3C 25 01         A  3876    	CALL	_memset
0110C4 C1                  A  3877    	POP	BC
0110C5 C1                  A  3878    	POP	BC
0110C6 C1                  A  3879    	POP	BC
                           A  3880    ;  941			memset(app2, 0, MAXLNLEN);
0110C7 01500000            A  3881    	LD	BC,80
0110CB C5                  A  3882    	PUSH	BC
0110CC 01000000            A  3883    	LD	BC,0
0110D0 C5                  A  3884    	PUSH	BC
0110D1 DDE5E1              A  3885    	LD	HL,IX
0110D4 015FFFFF            A  3886    	LD	BC,-161
0110D8 09                  A  3887    	ADD	HL,BC
0110D9 E5C1                A  3888    	LD	BC,HL
0110DB C5                  A  3889    	PUSH	BC
0110DC CD 3C 25 01         A  3890    	CALL	_memset
0110E0 C1                  A  3891    	POP	BC
0110E1 C1                  A  3892    	POP	BC
0110E2 C1                  A  3893    	POP	BC
                           A  3894    ;  942			
                           A  3895    ;  943			memmove(app, p_curr->p_data + c
0110E3 DD7EFF              A  3896    	LD	A,(IX+-1)
0110E6 17ED62              A  3897    	SEXT	HL
0110E9 DD6EFF              A  3898    	LD	L,(IX+-1)
0110EC B7                  A  3899    	OR	A,A
0110ED ED4B 16 54 01       A  3900    	LD	BC,(_cur_col)
0110F2 FD2A 07 54 01       A  3901    	LD	IY,(_p_curr)
0110F7 ED5B 16 54 01       A  3902    	LD	DE,(_cur_col)
0110FC ED42                A  3903    	SBC	HL,BC
0110FE E5                  A  3904    	PUSH	HL
0110FF FD2706              A  3905    	LD	HL,(IY+6)
011102 19                  A  3906    	ADD	HL,DE
011103 E5                  A  3907    	PUSH	HL
011104 ED65AF              A  3908    	PEA	IX+-81
011107 CD 5D 25 01         A  3909    	CALL	_memmove
01110B C1                  A  3910    	POP	BC
01110C C1                  A  3911    	POP	BC
01110D C1                  A  3912    	POP	BC
                           A  3913    ;  944			
                           A  3914    ;  945			memmove(app2, p_curr->p_data, c
01110E ED4B 16 54 01       A  3915    	LD	BC,(_cur_col)
011113 C5                  A  3916    	PUSH	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  77


PC     Object              I  Line    Source C:\proted\Debug\main.src
011114 FD2A 07 54 01       A  3917    	LD	IY,(_p_curr)
011119 FD0706              A  3918    	LD	BC,(IY+6)
01111C C5                  A  3919    	PUSH	BC
01111D DDE5E1              A  3920    	LD	HL,IX
011120 015FFFFF            A  3921    	LD	BC,-161
011124 09                  A  3922    	ADD	HL,BC
011125 E5C1                A  3923    	LD	BC,HL
011127 C5                  A  3924    	PUSH	BC
011128 CD 5D 25 01         A  3925    	CALL	_memmove
01112C C1                  A  3926    	POP	BC
01112D C1                  A  3927    	POP	BC
01112E C1                  A  3928    	POP	BC
                           A  3929    ;  946			
                           A  3930    ;  947			do_iln();
01112F CD D9 13 01         A  3931    	CALL	_do_iln
                           A  3932    ;  948			
                           A  3933    ;  949			tx_set(p_curr, app);
011133 ED65AF              A  3934    	PEA	IX+-81
011136 ED4B 07 54 01       A  3935    	LD	BC,(_p_curr)
01113B C5                  A  3936    	PUSH	BC
01113C CD F1 09 01         A  3937    	CALL	_tx_set
011140 C1                  A  3938    	POP	BC
011141 C1                  A  3939    	POP	BC
                           A  3940    ;  950			
                           A  3941    ;  951			tx_set(p_curr->p_prev, app2);
011142 DDE5E1              A  3942    	LD	HL,IX
011145 015FFFFF            A  3943    	LD	BC,-161
011149 09                  A  3944    	ADD	HL,BC
01114A E5C1                A  3945    	LD	BC,HL
01114C C5                  A  3946    	PUSH	BC
01114D FD2A 07 54 01       A  3947    	LD	IY,(_p_curr)
011152 FD0700              A  3948    	LD	BC,(IY+0)
011155 C5                  A  3949    	PUSH	BC
011156 CD F1 09 01         A  3950    	CALL	_tx_set
01115A C1                  A  3951    	POP	BC
01115B C1                  A  3952    	POP	BC
                           A  3953    ;  952			
                           A  3954    ;  953			paintall();
01115C CD 6F 16 01         A  3955    	CALL	_paintall
                           A  3956    ;  954			
                           A  3957    ;  955			do_cup();
011160 CD 01 0C 01         A  3958    	CALL	_do_cup
                           A  3959    ;  956		}
011164                     A  3960    L_219:
                           A  3961    ;  957		
                           A  3962    ;  958		do_ret();
011164 CD A6 0F 01         A  3963    	CALL	_do_ret
                           A  3964    ;  959	}
011168 DDF9                A  3965    	LD	SP,IX
01116A DDE1                A  3966    	POP	IX
01116C C9                  A  3967    	RET	
                           A  3968    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  78


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3969    
                           A  3970    ;**************************** _do_enhanced_ret 
                           A  3971    ;Name                         Addr/Register   S
                           A  3972    ;_do_ret                             IMPORT  --
                           A  3973    ;_do_cup                             IMPORT  --
                           A  3974    ;_paintall                           IMPORT  --
                           A  3975    ;_tx_set                             IMPORT  --
                           A  3976    ;_do_iln                             IMPORT  --
                           A  3977    ;_memmove                            IMPORT  --
                           A  3978    ;_memset                             IMPORT  --
                           A  3979    ;_cur_col                            STATIC    
                           A  3980    ;_p_curr                             STATIC    
                           A  3981    ;_strlen                             IMPORT  --
                           A  3982    ;app2                                IX-161    
                           A  3983    ;app                                  IX-81    
                           A  3984    ;len                                   IX-1    
                           A  3985    
                           A  3986    
                           A  3987    ; Stack Frame Size: 167 (bytes)
                           A  3988    ;       Spill Code: 0 (instruction)
                           A  3989    
                           A  3990    
                           A  3991    ;  960	
                           A  3992    ;  961	/* Tab. */
                           A  3993    ;  962	void do_tab(void)
                           A  3994    ;  963	{
01116D                     A  3995    _do_tab:
01116D 21FDFFFF            A  3996    	LD	HL,-3
011171 CD 7E 24 01         A  3997    	CALL	__frameset
                           A  3998    ;  964		int x = cur_char;
011175 ED4B 10 54 01       A  3999    	LD	BC,(_cur_char)
01117A DD0FFD              A  4000    	LD	(IX+-3),BC
                           A  4001    ;  965		
                           A  4002    ;  966		do
01117D                     A  4003    L_222:
                           A  4004    ;  967		{
                           A  4005    ;  968			do_crt();
01117D CD A3 0D 01         A  4006    	CALL	_do_crt
                           A  4007    ;  969			x++;
011181 DD07FD              A  4008    	LD	BC,(IX+-3)
011184 03                  A  4009    	INC	BC
011185 DD0FFD              A  4010    	LD	(IX+-3),BC
                           A  4011    ;  970		} while (((x - 1) % 8) != 0);
011188 C5E1                A  4012    	LD	HL,BC
01118A 2B                  A  4013    	DEC	HL
01118B 01080000            A  4014    	LD	BC,8
01118F CD FA 23 01         A  4015    	CALL	__irems
011193 B7                  A  4016    	OR	A,A
011194 01000000            A  4017    	LD	BC,0
011198 ED42                A  4018    	SBC	HL,BC
01119A 20 E1               A  4019    	JR	NZ,L_222
                           A  4020    ;  971	}
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  79


PC     Object              I  Line    Source C:\proted\Debug\main.src
01119C DDF9                A  4021    	LD	SP,IX
01119E DDE1                A  4022    	POP	IX
0111A0 C9                  A  4023    	RET	
                           A  4024    
                           A  4025    
                           A  4026    ;**************************** _do_tab *********
                           A  4027    ;Name                         Addr/Register   S
                           A  4028    ;_do_crt                             IMPORT  --
                           A  4029    ;_cur_char                           STATIC    
                           A  4030    ;x                                     IX-3    
                           A  4031    
                           A  4032    
                           A  4033    ; Stack Frame Size: 9 (bytes)
                           A  4034    ;       Spill Code: 0 (instruction)
                           A  4035    
                           A  4036    
                           A  4037    ;  972	
                           A  4038    ;  973	/* Jump to top of document. */
                           A  4039    ;  974	void do_top(void)
                           A  4040    ;  975	{
0111A1                     A  4041    _do_top:
0111A1 21FEFFFF            A  4042    	LD	HL,-2
0111A5 CD 7E 24 01         A  4043    	CALL	__frameset
                           A  4044    ;  976		char oldr, oldc;
                           A  4045    ;  977		
                           A  4046    ;  978		oldr = cur_row;
0111A9 3A 13 54 01         A  4047    	LD	A,(_cur_row)
0111AD DD77FF              A  4048    	LD	(IX+-1),A
                           A  4049    ;  979		oldc = cur_col;
0111B0 3A 16 54 01         A  4050    	LD	A,(_cur_col)
0111B4 DD77FE              A  4051    	LD	(IX+-2),A
                           A  4052    ;  980		
                           A  4053    ;  981		p_curr = p_root->p_next;
0111B7 FD2A 04 54 01       A  4054    	LD	IY,(_p_root)
0111BC FD0703              A  4055    	LD	BC,(IY+3)
0111BF ED43 07 54 01       A  4056    	LD	(_p_curr),BC
                           A  4057    ;  982		
                           A  4058    ;  983		cur_line = 1;
0111C4 01010000            A  4059    	LD	BC,1
0111C8 ED43 0D 54 01       A  4060    	LD	(_cur_line),BC
                           A  4061    ;  984		cur_char = 1;
0111CD ED43 10 54 01       A  4062    	LD	(_cur_char),BC
                           A  4063    ;  985		cur_row = 0;
0111D2 01000000            A  4064    	LD	BC,0
0111D6 ED43 13 54 01       A  4065    	LD	(_cur_row),BC
                           A  4066    ;  986		cur_col = 0;
0111DB ED43 16 54 01       A  4067    	LD	(_cur_col),BC
                           A  4068    ;  987		
                           A  4069    ;  988		paintall();
0111E0 CD 6F 16 01         A  4070    	CALL	_paintall
                           A  4071    ;  989		
                           A  4072    ;  990		plot_char(oldc, oldr, scn_phys[oldr
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  80


PC     Object              I  Line    Source C:\proted\Debug\main.src
0111E4 DD7EFF              A  4073    	LD	A,(IX+-1)
0111E7 17ED62              A  4074    	SEXT	HL
0111EA DD6EFF              A  4075    	LD	L,(IX+-1)
0111ED E5C1                A  4076    	LD	BC,HL
0111EF C5E1                A  4077    	LD	HL,BC
0111F1 29                  A  4078    	ADD	HL,HL
0111F2 29                  A  4079    	ADD	HL,HL
0111F3 09                  A  4080    	ADD	HL,BC
0111F4 29                  A  4081    	ADD	HL,HL
0111F5 29                  A  4082    	ADD	HL,HL
0111F6 29                  A  4083    	ADD	HL,HL
0111F7 29                  A  4084    	ADD	HL,HL
0111F8 01 1B 43 01         A  4085    	LD	BC,_scn_phys
0111FC 09                  A  4086    	ADD	HL,BC
0111FD E5C1                A  4087    	LD	BC,HL
0111FF DD7EFE              A  4088    	LD	A,(IX+-2)
011202 17ED62              A  4089    	SEXT	HL
011205 DD6EFE              A  4090    	LD	L,(IX+-2)
011208 09                  A  4091    	ADD	HL,BC
011209 4E                  A  4092    	LD	C,(HL)
01120A 0600                A  4093    	LD	B,0
01120C C5                  A  4094    	PUSH	BC
01120D DD4EFF              A  4095    	LD	C,(IX+-1)
011210 C5                  A  4096    	PUSH	BC
011211 DD4EFE              A  4097    	LD	C,(IX+-2)
011214 C5                  A  4098    	PUSH	BC
011215 CD 9E 02 01         A  4099    	CALL	_plot_char
011219 C1                  A  4100    	POP	BC
01121A C1                  A  4101    	POP	BC
01121B C1                  A  4102    	POP	BC
                           A  4103    ;  991	}
01121C DDF9                A  4104    	LD	SP,IX
01121E DDE1                A  4105    	POP	IX
011220 C9                  A  4106    	RET	
                           A  4107    
                           A  4108    
                           A  4109    ;**************************** _do_top *********
                           A  4110    ;Name                         Addr/Register   S
                           A  4111    ;_scn_phys                           STATIC   4
                           A  4112    ;_plot_char                          IMPORT  --
                           A  4113    ;_paintall                           IMPORT  --
                           A  4114    ;_cur_char                           STATIC    
                           A  4115    ;_cur_line                           STATIC    
                           A  4116    ;_p_curr                             STATIC    
                           A  4117    ;_p_root                             STATIC    
                           A  4118    ;_cur_col                            STATIC    
                           A  4119    ;_cur_row                            STATIC    
                           A  4120    ;oldc                                  IX-2    
                           A  4121    ;oldr                                  IX-1    
                           A  4122    
                           A  4123    
                           A  4124    ; Stack Frame Size: 8 (bytes)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  81


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4125    ;       Spill Code: 0 (instruction)
                           A  4126    
                           A  4127    
                           A  4128    ;  992	
                           A  4129    ;  993	/* Jump to bottom of document. */
                           A  4130    ;  994	void do_bot(char paint)
                           A  4131    ;  995	{
011221                     A  4132    _do_bot:
011221 21FEFFFF            A  4133    	LD	HL,-2
011225 CD 7E 24 01         A  4134    	CALL	__frameset
                           A  4135    ;  996		char oldr, oldc;
                           A  4136    ;  997		
                           A  4137    ;  998		oldr = cur_row;
011229 3A 13 54 01         A  4138    	LD	A,(_cur_row)
01122D DD77FF              A  4139    	LD	(IX+-1),A
                           A  4140    ;  999		oldc = cur_col;
011230 3A 16 54 01         A  4141    	LD	A,(_cur_col)
011234 DD77FE              A  4142    	LD	(IX+-2),A
                           A  4143    ; 1000		
                           A  4144    ; 1001		p_curr = p_root;
011237 ED4B 04 54 01       A  4145    	LD	BC,(_p_root)
01123C ED43 07 54 01       A  4146    	LD	(_p_curr),BC
                           A  4147    ; 1002		
                           A  4148    ; 1003		cur_line = numlines + 1;
011241 ED4B 0A 54 01       A  4149    	LD	BC,(_numlines)
011246 03                  A  4150    	INC	BC
011247 ED43 0D 54 01       A  4151    	LD	(_cur_line),BC
                           A  4152    ; 1004		cur_row = numlines;
01124C ED4B 0A 54 01       A  4153    	LD	BC,(_numlines)
011251 ED43 13 54 01       A  4154    	LD	(_cur_row),BC
                           A  4155    ; 1005		cur_char = 1;
011256 01010000            A  4156    	LD	BC,1
01125A ED43 10 54 01       A  4157    	LD	(_cur_char),BC
                           A  4158    ; 1006		cur_col = 0;
01125F 01000000            A  4159    	LD	BC,0
011263 ED43 16 54 01       A  4160    	LD	(_cur_col),BC
                           A  4161    ; 1007		
                           A  4162    ; 1008		if (cur_row > SCNROWS - 1)
011268 ED4B 0A 54 01       A  4163    	LD	BC,(_numlines)
01126D B7                  A  4164    	OR	A,A
01126E 21310000            A  4165    	LD	HL,49
011272 ED42                A  4166    	SBC	HL,BC
011274 F2 7E 12 01         A  4167    	JP	P,L__178
011278 EA 8B 12 01         A  4168    	JP	PE,L_228
01127C 18 04               A  4169    	JR	L__179
01127E                     A  4170    L__178:
01127E E2 8B 12 01         A  4171    	JP	PO,L_228
011282                     A  4172    L__179:
                           A  4173    ; 1009			cur_row = SCNROWS - 1;
011282 01310000            A  4174    	LD	BC,49
011286 ED43 13 54 01       A  4175    	LD	(_cur_row),BC
01128B                     A  4176    L_228:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  82


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4177    ; 1010		
                           A  4178    ; 1011		if (paint)
01128B DD7E06              A  4179    	LD	A,(IX+6)
01128E B7                  A  4180    	OR	A,A
01128F 28 04               A  4181    	JR	Z,L_229
                           A  4182    ; 1012			paintall();
011291 CD 6F 16 01         A  4183    	CALL	_paintall
011295                     A  4184    L_229:
                           A  4185    ; 1013		
                           A  4186    ; 1014		plot_char(oldc, oldr, scn_phys[oldr
011295 DD7EFF              A  4187    	LD	A,(IX+-1)
011298 17ED62              A  4188    	SEXT	HL
01129B DD6EFF              A  4189    	LD	L,(IX+-1)
01129E E5C1                A  4190    	LD	BC,HL
0112A0 C5E1                A  4191    	LD	HL,BC
0112A2 29                  A  4192    	ADD	HL,HL
0112A3 29                  A  4193    	ADD	HL,HL
0112A4 09                  A  4194    	ADD	HL,BC
0112A5 29                  A  4195    	ADD	HL,HL
0112A6 29                  A  4196    	ADD	HL,HL
0112A7 29                  A  4197    	ADD	HL,HL
0112A8 29                  A  4198    	ADD	HL,HL
0112A9 01 1B 43 01         A  4199    	LD	BC,_scn_phys
0112AD 09                  A  4200    	ADD	HL,BC
0112AE E5C1                A  4201    	LD	BC,HL
0112B0 DD7EFE              A  4202    	LD	A,(IX+-2)
0112B3 17ED62              A  4203    	SEXT	HL
0112B6 DD6EFE              A  4204    	LD	L,(IX+-2)
0112B9 09                  A  4205    	ADD	HL,BC
0112BA 4E                  A  4206    	LD	C,(HL)
0112BB 0600                A  4207    	LD	B,0
0112BD C5                  A  4208    	PUSH	BC
0112BE DD4EFF              A  4209    	LD	C,(IX+-1)
0112C1 C5                  A  4210    	PUSH	BC
0112C2 DD4EFE              A  4211    	LD	C,(IX+-2)
0112C5 C5                  A  4212    	PUSH	BC
0112C6 CD 9E 02 01         A  4213    	CALL	_plot_char
0112CA C1                  A  4214    	POP	BC
0112CB C1                  A  4215    	POP	BC
0112CC C1                  A  4216    	POP	BC
                           A  4217    ; 1015	}
0112CD DDF9                A  4218    	LD	SP,IX
0112CF DDE1                A  4219    	POP	IX
0112D1 C9                  A  4220    	RET	
                           A  4221    
                           A  4222    
                           A  4223    ;**************************** _do_bot *********
                           A  4224    ;Name                         Addr/Register   S
                           A  4225    ;_scn_phys                           STATIC   4
                           A  4226    ;_plot_char                          IMPORT  --
                           A  4227    ;_paintall                           IMPORT  --
                           A  4228    ;_cur_char                           STATIC    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  83


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4229    ;_cur_line                           STATIC    
                           A  4230    ;_numlines                           STATIC    
                           A  4231    ;_p_curr                             STATIC    
                           A  4232    ;_p_root                             STATIC    
                           A  4233    ;_cur_col                            STATIC    
                           A  4234    ;_cur_row                            STATIC    
                           A  4235    ;oldc                                  IX-2    
                           A  4236    ;oldr                                  IX-1    
                           A  4237    ;paint                                 IX+6    
                           A  4238    
                           A  4239    
                           A  4240    ; Stack Frame Size: 11 (bytes)
                           A  4241    ;       Spill Code: 0 (instruction)
                           A  4242    
                           A  4243    
                           A  4244    ; 1016	
                           A  4245    ; 1017	/* Type the specified character. */
                           A  4246    ; 1018	void do_chr(char ch)
                           A  4247    ; 1019	{
0112D2                     A  4248    _do_chr:
0112D2 21FAFFFF            A  4249    	LD	HL,-6
0112D6 CD 7E 24 01         A  4250    	CALL	__frameset
                           A  4251    ; 1020		register int i;
                           A  4252    ; 1021		
                           A  4253    ; 1022		if (p_curr == p_root)
0112DA ED4B 04 54 01       A  4254    	LD	BC,(_p_root)
0112DF 2A 07 54 01         A  4255    	LD	HL,(_p_curr)
0112E3 B7                  A  4256    	OR	A,A
0112E4 ED42                A  4257    	SBC	HL,BC
0112E6 28 75               A  4258    	JR	Z,L_240
                           A  4259    ; 1023			return;
                           A  4260    ; 1024	
                           A  4261    ; 1025		if (cur_char == MAXLNLEN + 1)
0112E8 01510000            A  4262    	LD	BC,81
0112EC 2A 10 54 01         A  4263    	LD	HL,(_cur_char)
0112F0 B7                  A  4264    	OR	A,A
0112F1 ED42                A  4265    	SBC	HL,BC
0112F3 20 06               A  4266    	JR	NZ,L_234
                           A  4267    ; 1026		{
                           A  4268    ; 1027			Show_Cursor();
0112F5 CD 34 18 01         A  4269    	CALL	_Show_Cursor
                           A  4270    ; 1028			
                           A  4271    ; 1029			return;
0112F9 18 62               A  4272    	JR	L_240
                           A  4273    ; 1030		}
0112FB                     A  4274    L_234:
                           A  4275    ; 1031		
                           A  4276    ; 1032		tx_get(p_curr);	
0112FB ED4B 07 54 01       A  4277    	LD	BC,(_p_curr)
011300 C5                  A  4278    	PUSH	BC
011301 CD 95 0B 01         A  4279    	CALL	_tx_get
011305 C1                  A  4280    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  84


PC     Object              I  Line    Source C:\proted\Debug\main.src
011306 014F0000            A  4281    	LD	BC,79
01130A DD0FFD              A  4282    	LD	(IX+-3),BC
                           A  4283    ; 1033		
                           A  4284    ; 1034		for (i = MAXLNLEN - 1; i > cur_char
01130D 18 19               A  4285    	JR	L_238
01130F                     A  4286    L_236:
                           A  4287    ; 1035			linbuf[i] = linbuf[i - 1];	
01130F DD07FD              A  4288    	LD	BC,(IX+-3)
011312 0B                  A  4289    	DEC	BC
011313 C5E1                A  4290    	LD	HL,BC
011315 11 19 54 01         A  4291    	LD	DE,_linbuf
011319 19                  A  4292    	ADD	HL,DE
01131A E5FDE1              A  4293    	LD	IY,HL
01131D DD27FD              A  4294    	LD	HL,(IX+-3)
011320 19                  A  4295    	ADD	HL,DE
011321 FD7E00              A  4296    	LD	A,(IY)
011324 77                  A  4297    	LD	(HL),A
011325 DD0FFD              A  4298    	LD	(IX+-3),BC
011328                     A  4299    L_238:
011328 ED4B 10 54 01       A  4300    	LD	BC,(_cur_char)
01132D 0B                  A  4301    	DEC	BC
01132E DD0FFA              A  4302    	LD	(IX+-6),BC
011331 DD07FD              A  4303    	LD	BC,(IX+-3)
011334 DD27FA              A  4304    	LD	HL,(IX+-6)
011337 B7                  A  4305    	OR	A,A
011338 ED42                A  4306    	SBC	HL,BC
01133A FA 0F 13 01         A  4307    	JP	M,L_236
                           A  4308    ; 1036		
                           A  4309    ; 1037		linbuf[cur_char - 1] = (char)(ch);
01133E 01 19 54 01         A  4310    	LD	BC,_linbuf
011342 DD27FA              A  4311    	LD	HL,(IX+-6)
011345 09                  A  4312    	ADD	HL,BC
011346 DD7E06              A  4313    	LD	A,(IX+6)
011349 77                  A  4314    	LD	(HL),A
                           A  4315    ; 1038		
                           A  4316    ; 1039		tx_put(p_curr);
01134A ED4B 07 54 01       A  4317    	LD	BC,(_p_curr)
01134F C5                  A  4318    	PUSH	BC
011350 CD DE 0B 01         A  4319    	CALL	_tx_put
011354 C1                  A  4320    	POP	BC
                           A  4321    ; 1040		
                           A  4322    ; 1041		do_crt();
011355 CD A3 0D 01         A  4323    	CALL	_do_crt
                           A  4324    ; 1042		paintrow();
011359 CD 8B 17 01         A  4325    	CALL	_paintrow
                           A  4326    ; 1043	}
01135D                     A  4327    L_240:
01135D DDF9                A  4328    	LD	SP,IX
01135F DDE1                A  4329    	POP	IX
011361 C9                  A  4330    	RET	
                           A  4331    
                           A  4332    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  85


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4333    ;**************************** _do_chr *********
                           A  4334    ;Name                         Addr/Register   S
                           A  4335    ;_paintrow                           IMPORT  --
                           A  4336    ;_do_crt                             IMPORT  --
                           A  4337    ;_tx_put                             IMPORT  --
                           A  4338    ;_linbuf                             STATIC    
                           A  4339    ;_tx_get                             IMPORT  --
                           A  4340    ;_Show_Cursor                        IMPORT  --
                           A  4341    ;_cur_char                           STATIC    
                           A  4342    ;_p_root                             STATIC    
                           A  4343    ;_p_curr                             STATIC    
                           A  4344    ;G_6                                   IX-6    
                           A  4345    ;i                                     IX-3    
                           A  4346    ;ch                                    IX+6    
                           A  4347    
                           A  4348    
                           A  4349    ; Stack Frame Size: 15 (bytes)
                           A  4350    ;       Spill Code: 0 (instruction)
                           A  4351    
                           A  4352    
                           A  4353    ; 1044	
                           A  4354    ; 1045	/* Delete character. */
                           A  4355    ; 1046	void do_dch(void)
                           A  4356    ; 1047	{
011362                     A  4357    _do_dch:
011362 21FDFFFF            A  4358    	LD	HL,-3
011366 CD 7E 24 01         A  4359    	CALL	__frameset
                           A  4360    ; 1048		register int i;
                           A  4361    ; 1049		
                           A  4362    ; 1050		if (p_curr == p_root)
01136A ED4B 04 54 01       A  4363    	LD	BC,(_p_root)
01136F 2A 07 54 01         A  4364    	LD	HL,(_p_curr)
011373 B7                  A  4365    	OR	A,A
011374 ED42                A  4366    	SBC	HL,BC
011376 28 5C               A  4367    	JR	Z,L_248
                           A  4368    ; 1051			return;
                           A  4369    ; 1052		
                           A  4370    ; 1053		tx_get(p_curr);
011378 ED4B 07 54 01       A  4371    	LD	BC,(_p_curr)
01137D C5                  A  4372    	PUSH	BC
01137E CD 95 0B 01         A  4373    	CALL	_tx_get
011382 C1                  A  4374    	POP	BC
011383 ED4B 10 54 01       A  4375    	LD	BC,(_cur_char)
011388 0B                  A  4376    	DEC	BC
011389 DD0FFD              A  4377    	LD	(IX+-3),BC
                           A  4378    ; 1054		
                           A  4379    ; 1055		for (i = cur_char - 1; i < MAXLNLEN
01138C 18 19               A  4380    	JR	L_246
01138E                     A  4381    L_244:
                           A  4382    ; 1056			linbuf[i] = linbuf[i + 1];
01138E DD07FD              A  4383    	LD	BC,(IX+-3)
011391 03                  A  4384    	INC	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  86


PC     Object              I  Line    Source C:\proted\Debug\main.src
011392 C5E1                A  4385    	LD	HL,BC
011394 11 19 54 01         A  4386    	LD	DE,_linbuf
011398 19                  A  4387    	ADD	HL,DE
011399 E5FDE1              A  4388    	LD	IY,HL
01139C DD27FD              A  4389    	LD	HL,(IX+-3)
01139F 19                  A  4390    	ADD	HL,DE
0113A0 FD7E00              A  4391    	LD	A,(IY)
0113A3 77                  A  4392    	LD	(HL),A
0113A4 DD0FFD              A  4393    	LD	(IX+-3),BC
0113A7                     A  4394    L_246:
0113A7 014F0000            A  4395    	LD	BC,79
0113AB DD27FD              A  4396    	LD	HL,(IX+-3)
0113AE B7                  A  4397    	OR	A,A
0113AF ED42                A  4398    	SBC	HL,BC
0113B1 FA BB 13 01         A  4399    	JP	M,L__187
0113B5 EA 8E 13 01         A  4400    	JP	PE,L_244
0113B9 18 04               A  4401    	JR	L__188
0113BB                     A  4402    L__187:
0113BB E2 8E 13 01         A  4403    	JP	PO,L_244
0113BF                     A  4404    L__188:
                           A  4405    ; 1057		
                           A  4406    ; 1058		linbuf[MAXLNLEN - 1] = ' ';
0113BF 21 68 54 01         A  4407    	LD	HL,_linbuf+79
0113C3 3620                A  4408    	LD	(HL),32
                           A  4409    ; 1059		
                           A  4410    ; 1060		tx_put(p_curr);
0113C5 ED4B 07 54 01       A  4411    	LD	BC,(_p_curr)
0113CA C5                  A  4412    	PUSH	BC
0113CB CD DE 0B 01         A  4413    	CALL	_tx_put
0113CF C1                  A  4414    	POP	BC
                           A  4415    ; 1061		
                           A  4416    ; 1062		paintrow();
0113D0 CD 8B 17 01         A  4417    	CALL	_paintrow
                           A  4418    ; 1063	}
0113D4                     A  4419    L_248:
0113D4 DDF9                A  4420    	LD	SP,IX
0113D6 DDE1                A  4421    	POP	IX
0113D8 C9                  A  4422    	RET	
                           A  4423    
                           A  4424    
                           A  4425    ;**************************** _do_dch *********
                           A  4426    ;Name                         Addr/Register   S
                           A  4427    ;_paintrow                           IMPORT  --
                           A  4428    ;_tx_put                             IMPORT  --
                           A  4429    ;_linbuf                             STATIC    
                           A  4430    ;_cur_char                           STATIC    
                           A  4431    ;_tx_get                             IMPORT  --
                           A  4432    ;_p_root                             STATIC    
                           A  4433    ;_p_curr                             STATIC    
                           A  4434    ;i                                     IX-3    
                           A  4435    
                           A  4436    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  87


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4437    ; Stack Frame Size: 9 (bytes)
                           A  4438    ;       Spill Code: 0 (instruction)
                           A  4439    
                           A  4440    
                           A  4441    ; 1064	
                           A  4442    ; 1065	/* Insert line. */
                           A  4443    ; 1066	void do_iln(void)
                           A  4444    ; 1067	{
0113D9                     A  4445    _do_iln:
                           A  4446    ; 1068		paintrow();
0113D9 CD 8B 17 01         A  4447    	CALL	_paintrow
                           A  4448    ; 1069		
                           A  4449    ; 1070		if (cur_line < numlines)
0113DD ED4B 0A 54 01       A  4450    	LD	BC,(_numlines)
0113E2 2A 0D 54 01         A  4451    	LD	HL,(_cur_line)
0113E6 B7                  A  4452    	OR	A,A
0113E7 ED42                A  4453    	SBC	HL,BC
0113E9 F2 F3 13 01         A  4454    	JP	P,L__193
0113ED EA 1B 14 01         A  4455    	JP	PE,L_250
0113F1 18 04               A  4456    	JR	L__194
0113F3                     A  4457    L__193:
0113F3 E2 1B 14 01         A  4458    	JP	PO,L_250
0113F7                     A  4459    L__194:
                           A  4460    ; 1071		{
                           A  4461    ; 1072			do_cdw();
0113F7 CD 90 0C 01         A  4462    	CALL	_do_cdw
                           A  4463    ; 1073			
                           A  4464    ; 1074			tx_ins(p_curr, "");
0113FB 01 22 27 01         A  4465    	LD	BC,L__191
0113FF C5                  A  4466    	PUSH	BC
011400 ED4B 07 54 01       A  4467    	LD	BC,(_p_curr)
011405 C5                  A  4468    	PUSH	BC
011406 CD A0 0A 01         A  4469    	CALL	_tx_ins
01140A C1                  A  4470    	POP	BC
01140B C1                  A  4471    	POP	BC
                           A  4472    ; 1075			
                           A  4473    ; 1076			p_curr = p_curr->p_prev;
01140C FD2A 07 54 01       A  4474    	LD	IY,(_p_curr)
011411 FD0700              A  4475    	LD	BC,(IY+0)
011414 ED43 07 54 01       A  4476    	LD	(_p_curr),BC
                           A  4477    ; 1077		}		
                           A  4478    ; 1078		else
011419 18 1B               A  4479    	JR	L_251
01141B                     A  4480    L_250:
                           A  4481    ; 1079		{
                           A  4482    ; 1080			tx_ins(p_root, "");		
01141B 01 23 27 01         A  4483    	LD	BC,L__192
01141F C5                  A  4484    	PUSH	BC
011420 ED4B 04 54 01       A  4485    	LD	BC,(_p_root)
011425 C5                  A  4486    	PUSH	BC
011426 CD A0 0A 01         A  4487    	CALL	_tx_ins
01142A C1                  A  4488    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  88


PC     Object              I  Line    Source C:\proted\Debug\main.src
01142B C1                  A  4489    	POP	BC
                           A  4490    ; 1081			
                           A  4491    ; 1082			do_bot(0);
01142C 01000000            A  4492    	LD	BC,0
011430 C5                  A  4493    	PUSH	BC
011431 CD 21 12 01         A  4494    	CALL	_do_bot
011435 C1                  A  4495    	POP	BC
                           A  4496    ; 1083		}
011436                     A  4497    L_251:
                           A  4498    ; 1084		
                           A  4499    ; 1085		cur_char = 1;
011436 01010000            A  4500    	LD	BC,1
01143A ED43 10 54 01       A  4501    	LD	(_cur_char),BC
                           A  4502    ; 1086		cur_col = 0;
01143F 01000000            A  4503    	LD	BC,0
011443 ED43 16 54 01       A  4504    	LD	(_cur_col),BC
                           A  4505    ; 1087		
                           A  4506    ; 1088		paintall();	
011448 CD 6F 16 01         A  4507    	CALL	_paintall
                           A  4508    ; 1089	}
01144C C9                  A  4509    	RET	
                           A  4510    
                           A  4511    
                           A  4512    ;**************************** _do_iln *********
                           A  4513    ;Name                         Addr/Register   S
                           A  4514    ;_paintall                           IMPORT  --
                           A  4515    ;_cur_col                            STATIC    
                           A  4516    ;_cur_char                           STATIC    
                           A  4517    ;_do_bot                             IMPORT  --
                           A  4518    ;_p_root                             STATIC    
                           A  4519    ;_p_curr                             STATIC    
                           A  4520    ;_tx_ins                             IMPORT  --
                           A  4521    ;_do_cdw                             IMPORT  --
                           A  4522    ;_numlines                           STATIC    
                           A  4523    ;_cur_line                           STATIC    
                           A  4524    ;_paintrow                           IMPORT  --
                           A  4525    
                           A  4526    
                           A  4527    ; Stack Frame Size: 6 (bytes)
                           A  4528    ;       Spill Code: 0 (instruction)
                           A  4529    
                           A  4530    
                           A  4531    	SEGMENT STRSECT
012722                     A  4532    L__191:
012722 00                  A  4533    	DB	0
012723                     A  4534    L__192:
012723 00                  A  4535    	DB	0
                           A  4536    	SEGMENT CODE
                           A  4537    ; 1090	
                           A  4538    ; 1091	/* Delete line. */
                           A  4539    ; 1092	void do_dln(void)
                           A  4540    ; 1093	{
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  89


PC     Object              I  Line    Source C:\proted\Debug\main.src
01144D                     A  4541    _do_dln:
01144D 21FDFFFF            A  4542    	LD	HL,-3
011451 CD 7E 24 01         A  4543    	CALL	__frameset
                           A  4544    ; 1094		p_line_t save = p_curr->p_next;
011455 FD2A 07 54 01       A  4545    	LD	IY,(_p_curr)
01145A FD0703              A  4546    	LD	BC,(IY+3)
01145D DD0FFD              A  4547    	LD	(IX+-3),BC
                           A  4548    ; 1095		
                           A  4549    ; 1096		if (p_curr == p_root)
011460 ED4B 04 54 01       A  4550    	LD	BC,(_p_root)
011465 2A 07 54 01         A  4551    	LD	HL,(_p_curr)
011469 B7                  A  4552    	OR	A,A
01146A ED42                A  4553    	SBC	HL,BC
01146C 28 17               A  4554    	JR	Z,L_255
                           A  4555    ; 1097			return;
                           A  4556    ; 1098		
                           A  4557    ; 1099		tx_del(p_curr);
01146E ED4B 07 54 01       A  4558    	LD	BC,(_p_curr)
011473 C5                  A  4559    	PUSH	BC
011474 CD 0A 0B 01         A  4560    	CALL	_tx_del
011478 C1                  A  4561    	POP	BC
                           A  4562    ; 1100		
                           A  4563    ; 1101		p_curr = save;
011479 DD07FD              A  4564    	LD	BC,(IX+-3)
01147C ED43 07 54 01       A  4565    	LD	(_p_curr),BC
                           A  4566    ; 1102		
                           A  4567    ; 1103		paintall();
011481 CD 6F 16 01         A  4568    	CALL	_paintall
                           A  4569    ; 1104	}
011485                     A  4570    L_255:
011485 DDF9                A  4571    	LD	SP,IX
011487 DDE1                A  4572    	POP	IX
011489 C9                  A  4573    	RET	
                           A  4574    
                           A  4575    
                           A  4576    ;**************************** _do_dln *********
                           A  4577    ;Name                         Addr/Register   S
                           A  4578    ;_paintall                           IMPORT  --
                           A  4579    ;_tx_del                             IMPORT  --
                           A  4580    ;_p_root                             STATIC    
                           A  4581    ;_p_curr                             STATIC    
                           A  4582    ;save                                  IX-3    
                           A  4583    
                           A  4584    
                           A  4585    ; Stack Frame Size: 9 (bytes)
                           A  4586    ;       Spill Code: 0 (instruction)
                           A  4587    
                           A  4588    
                           A  4589    ; 1105	
                           A  4590    ; 1106	/* Delete. */
                           A  4591    ; 1107	void do_del(void)
                           A  4592    ; 1108	{
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  90


PC     Object              I  Line    Source C:\proted\Debug\main.src
01148A                     A  4593    _do_del:
                           A  4594    ; 1109		if (cur_char == 1)
01148A 01010000            A  4595    	LD	BC,1
01148E 2A 10 54 01         A  4596    	LD	HL,(_cur_char)
011492 B7                  A  4597    	OR	A,A
011493 ED42                A  4598    	SBC	HL,BC
011495 20 1E               A  4599    	JR	NZ,L_259
                           A  4600    ; 1110			if (strlen(p_curr->p_data) <= 0
011497 FD2A 07 54 01       A  4601    	LD	IY,(_p_curr)
01149C FD0706              A  4602    	LD	BC,(IY+6)
01149F C5                  A  4603    	PUSH	BC
0114A0 CD 3B 24 01         A  4604    	CALL	_strlen
0114A4 C1                  A  4605    	POP	BC
0114A5 E5C1                A  4606    	LD	BC,HL
0114A7 B7                  A  4607    	OR	A,A
0114A8 ED62                A  4608    	SBC	HL,HL
0114AA B7                  A  4609    	OR	A,A
0114AB ED42                A  4610    	SBC	HL,BC
0114AD 30 0E               A  4611    	JR	NC,L_260
                           A  4612    ; 1111				return;
                           A  4613    ; 1112			else
                           A  4614    ; 1113			{
                           A  4615    ; 1114				do_enhanced_del();
0114AF CD BE 14 01         A  4616    	CALL	_do_enhanced_del
                           A  4617    ; 1115				
                           A  4618    ; 1116				return;
0114B3 18 08               A  4619    	JR	L_260
                           A  4620    ; 1117			}
0114B5                     A  4621    L_259:
                           A  4622    ; 1118		
                           A  4623    ; 1119		do_clf();
0114B5 CD 21 0D 01         A  4624    	CALL	_do_clf
                           A  4625    ; 1120		
                           A  4626    ; 1121		do_dch();
0114B9 CD 62 13 01         A  4627    	CALL	_do_dch
                           A  4628    ; 1122	}
0114BD                     A  4629    L_260:
0114BD C9                  A  4630    	RET	
                           A  4631    
                           A  4632    
                           A  4633    ;**************************** _do_del *********
                           A  4634    ;Name                         Addr/Register   S
                           A  4635    ;_do_dch                             IMPORT  --
                           A  4636    ;_do_clf                             IMPORT  --
                           A  4637    ;_do_enhanced_del                    IMPORT  --
                           A  4638    ;_p_curr                             STATIC    
                           A  4639    ;_strlen                             IMPORT  --
                           A  4640    ;_cur_char                           STATIC    
                           A  4641    
                           A  4642    
                           A  4643    ; Stack Frame Size: 6 (bytes)
                           A  4644    ;       Spill Code: 0 (instruction)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  91


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4645    
                           A  4646    
                           A  4647    ; 1123	
                           A  4648    ; 1124	/* Enhanced Delete. Can join current li
                           A  4649    ; 1125	void do_enhanced_del(void)
                           A  4650    ; 1126	{
0114BE                     A  4651    _do_enhanced_del:
0114BE 21AEFFFF            A  4652    	LD	HL,-82
0114C2 CD 7E 24 01         A  4653    	CALL	__frameset
                           A  4654    ; 1127		char app[MAXLNLEN], i, oldPos;
                           A  4655    ; 1128		
                           A  4656    ; 1129		if (cur_line == 1)
0114C6 01010000            A  4657    	LD	BC,1
0114CA 2A 0D 54 01         A  4658    	LD	HL,(_cur_line)
0114CE B7                  A  4659    	OR	A,A
0114CF ED42                A  4660    	SBC	HL,BC
0114D1 20 08               A  4661    	JR	NZ,L_262
                           A  4662    ; 1130		{
                           A  4663    ; 1131			Show_Cursor();
0114D3 CD 34 18 01         A  4664    	CALL	_Show_Cursor
                           A  4665    ; 1132			
                           A  4666    ; 1133			return;		
0114D7 C3 7C 15 01         A  4667    	JR	L_268
                           A  4668    ; 1134		}
0114DB                     A  4669    L_262:
                           A  4670    ; 1135		
                           A  4671    ; 1136		memset(app, 0, MAXLNLEN);	
0114DB 01500000            A  4672    	LD	BC,80
0114DF C5                  A  4673    	PUSH	BC
0114E0 01000000            A  4674    	LD	BC,0
0114E4 C5                  A  4675    	PUSH	BC
0114E5 ED65AE              A  4676    	PEA	IX+-82
0114E8 CD 3C 25 01         A  4677    	CALL	_memset
0114EC C1                  A  4678    	POP	BC
0114ED C1                  A  4679    	POP	BC
0114EE C1                  A  4680    	POP	BC
                           A  4681    ; 1137		
                           A  4682    ; 1138		memmove(app, p_curr->p_data, strlen
0114EF FD2A 07 54 01       A  4683    	LD	IY,(_p_curr)
0114F4 FD0706              A  4684    	LD	BC,(IY+6)
0114F7 C5                  A  4685    	PUSH	BC
0114F8 CD 3B 24 01         A  4686    	CALL	_strlen
0114FC C1                  A  4687    	POP	BC
0114FD E5                  A  4688    	PUSH	HL
0114FE FD2A 07 54 01       A  4689    	LD	IY,(_p_curr)
011503 FD0706              A  4690    	LD	BC,(IY+6)
011506 C5                  A  4691    	PUSH	BC
011507 ED65AE              A  4692    	PEA	IX+-82
01150A CD 5D 25 01         A  4693    	CALL	_memmove
01150E C1                  A  4694    	POP	BC
01150F C1                  A  4695    	POP	BC
011510 C1                  A  4696    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  92


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4697    ; 1139		
                           A  4698    ; 1140		do_dln();	
011511 CD 4D 14 01         A  4699    	CALL	_do_dln
                           A  4700    ; 1141		
                           A  4701    ; 1142		do_cup();
011515 CD 01 0C 01         A  4702    	CALL	_do_cup
                           A  4703    ; 1143		do_endline();
011519 CD EB 15 01         A  4704    	CALL	_do_endline
                           A  4705    ; 1144		
                           A  4706    ; 1145		oldPos = cur_col;
01151D 3A 16 54 01         A  4707    	LD	A,(_cur_col)
011521 DD77FE              A  4708    	LD	(IX+-2),A
011524 DD36FF00            A  4709    	LD	(IX+-1),0
                           A  4710    ; 1146		
                           A  4711    ; 1147		for (i = 0; i < strlen(app); i++)
011528 18 1B               A  4712    	JR	L_266
01152A                     A  4713    L_264:
                           A  4714    ; 1148			do_chr(app[i]);	
01152A DD7EFF              A  4715    	LD	A,(IX+-1)
01152D 17ED62              A  4716    	SEXT	HL
011530 DD6EFF              A  4717    	LD	L,(IX+-1)
011533 E5C1                A  4718    	LD	BC,HL
011535 ED22AE              A  4719    	LEA	HL,IX+-82
011538 09                  A  4720    	ADD	HL,BC
011539 4E                  A  4721    	LD	C,(HL)
01153A 0600                A  4722    	LD	B,0
01153C C5                  A  4723    	PUSH	BC
01153D CD D2 12 01         A  4724    	CALL	_do_chr
011541 C1                  A  4725    	POP	BC
011542 DD34FF              A  4726    	INC	(IX+-1)
011545                     A  4727    L_266:
011545 ED65AE              A  4728    	PEA	IX+-82
011548 CD 3B 24 01         A  4729    	CALL	_strlen
01154C C1                  A  4730    	POP	BC
01154D DD7EFF              A  4731    	LD	A,(IX+-1)
011550 E5C1                A  4732    	LD	BC,HL
011552 17ED62              A  4733    	SEXT	HL
011555 DD6EFF              A  4734    	LD	L,(IX+-1)
011558 B7                  A  4735    	OR	A,A
011559 ED42                A  4736    	SBC	HL,BC
01155B 38 CD               A  4737    	JR	C,L_264
                           A  4738    ; 1149		
                           A  4739    ; 1150		paintrow();
01155D CD 8B 17 01         A  4740    	CALL	_paintrow
                           A  4741    ; 1151		
                           A  4742    ; 1152		cur_col = oldPos;
011561 DD7EFE              A  4743    	LD	A,(IX+-2)
011564 17ED62              A  4744    	SEXT	HL
011567 DD6EFE              A  4745    	LD	L,(IX+-2)
01156A 22 16 54 01         A  4746    	LD	(_cur_col),HL
                           A  4747    ; 1153		cur_char = cur_col + 1;
01156E DD7EFE              A  4748    	LD	A,(IX+-2)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  93


PC     Object              I  Line    Source C:\proted\Debug\main.src
011571 17ED62              A  4749    	SEXT	HL
011574 DD6EFE              A  4750    	LD	L,(IX+-2)
011577 23                  A  4751    	INC	HL
011578 22 10 54 01         A  4752    	LD	(_cur_char),HL
                           A  4753    ; 1154	}
01157C                     A  4754    L_268:
01157C DDF9                A  4755    	LD	SP,IX
01157E DDE1                A  4756    	POP	IX
011580 C9                  A  4757    	RET	
                           A  4758    
                           A  4759    
                           A  4760    ;**************************** _do_enhanced_del 
                           A  4761    ;Name                         Addr/Register   S
                           A  4762    ;_cur_char                           STATIC    
                           A  4763    ;_paintrow                           IMPORT  --
                           A  4764    ;_do_chr                             IMPORT  --
                           A  4765    ;_cur_col                            STATIC    
                           A  4766    ;_do_endline                         IMPORT  --
                           A  4767    ;_do_cup                             IMPORT  --
                           A  4768    ;_do_dln                             IMPORT  --
                           A  4769    ;_p_curr                             STATIC    
                           A  4770    ;_strlen                             IMPORT  --
                           A  4771    ;_memmove                            IMPORT  --
                           A  4772    ;_memset                             IMPORT  --
                           A  4773    ;_Show_Cursor                        IMPORT  --
                           A  4774    ;_cur_line                           STATIC    
                           A  4775    ;app                                  IX-82    
                           A  4776    ;oldPos                                IX-2    
                           A  4777    ;i                                     IX-1    
                           A  4778    
                           A  4779    
                           A  4780    ; Stack Frame Size: 88 (bytes)
                           A  4781    ;       Spill Code: 0 (instruction)
                           A  4782    
                           A  4783    
                           A  4784    ; 1155	
                           A  4785    ; 1156	/* Go to the start of current line. */
                           A  4786    ; 1157	void do_home(void)
                           A  4787    ; 1158	{
011581                     A  4788    _do_home:
011581 21FEFFFF            A  4789    	LD	HL,-2
011585 CD 7E 24 01         A  4790    	CALL	__frameset
                           A  4791    ; 1159		char ch, oldcol;
                           A  4792    ; 1160		
                           A  4793    ; 1161		if (p_curr == p_root)
011589 ED4B 04 54 01       A  4794    	LD	BC,(_p_root)
01158E 2A 07 54 01         A  4795    	LD	HL,(_p_curr)
011592 B7                  A  4796    	OR	A,A
011593 ED42                A  4797    	SBC	HL,BC
011595 28 4F               A  4798    	JR	Z,L_271
                           A  4799    ; 1162			return;
                           A  4800    ; 1163		
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  94


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4801    ; 1164		ch = scn_phys[cur_row][cur_col];
011597 2A 13 54 01         A  4802    	LD	HL,(_cur_row)
01159B 29                  A  4803    	ADD	HL,HL
01159C 29                  A  4804    	ADD	HL,HL
01159D ED4B 13 54 01       A  4805    	LD	BC,(_cur_row)
0115A2 09                  A  4806    	ADD	HL,BC
0115A3 29                  A  4807    	ADD	HL,HL
0115A4 29                  A  4808    	ADD	HL,HL
0115A5 29                  A  4809    	ADD	HL,HL
0115A6 29                  A  4810    	ADD	HL,HL
0115A7 01 1B 43 01         A  4811    	LD	BC,_scn_phys
0115AB 09                  A  4812    	ADD	HL,BC
0115AC ED4B 16 54 01       A  4813    	LD	BC,(_cur_col)
0115B1 09                  A  4814    	ADD	HL,BC
0115B2 7E                  A  4815    	LD	A,(HL)
0115B3 DD77FF              A  4816    	LD	(IX+-1),A
                           A  4817    ; 1165		oldcol = cur_col;
0115B6 3A 16 54 01         A  4818    	LD	A,(_cur_col)
0115BA DD77FE              A  4819    	LD	(IX+-2),A
                           A  4820    ; 1166		
                           A  4821    ; 1167		cur_char = 1;
0115BD 01010000            A  4822    	LD	BC,1
0115C1 ED43 10 54 01       A  4823    	LD	(_cur_char),BC
                           A  4824    ; 1168		cur_col = 0;
0115C6 01000000            A  4825    	LD	BC,0
0115CA ED43 16 54 01       A  4826    	LD	(_cur_col),BC
                           A  4827    ; 1169		
                           A  4828    ; 1170		plot_char(oldcol, cur_row, ch);
0115CF DD4EFF              A  4829    	LD	C,(IX+-1)
0115D2 3A 13 54 01         A  4830    	LD	A,(_cur_row)
0115D6 0600                A  4831    	LD	B,0
0115D8 C5                  A  4832    	PUSH	BC
0115D9 4F                  A  4833    	LD	C,A
0115DA C5                  A  4834    	PUSH	BC
0115DB DD4EFE              A  4835    	LD	C,(IX+-2)
0115DE C5                  A  4836    	PUSH	BC
0115DF CD 9E 02 01         A  4837    	CALL	_plot_char
0115E3 C1                  A  4838    	POP	BC
0115E4 C1                  A  4839    	POP	BC
0115E5 C1                  A  4840    	POP	BC
                           A  4841    ; 1171	}
0115E6                     A  4842    L_271:
0115E6 DDF9                A  4843    	LD	SP,IX
0115E8 DDE1                A  4844    	POP	IX
0115EA C9                  A  4845    	RET	
                           A  4846    
                           A  4847    
                           A  4848    ;**************************** _do_home ********
                           A  4849    ;Name                         Addr/Register   S
                           A  4850    ;_plot_char                          IMPORT  --
                           A  4851    ;_cur_char                           STATIC    
                           A  4852    ;_cur_col                            STATIC    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  95


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4853    ;_cur_row                            STATIC    
                           A  4854    ;_scn_phys                           STATIC   4
                           A  4855    ;_p_root                             STATIC    
                           A  4856    ;_p_curr                             STATIC    
                           A  4857    ;oldcol                                IX-2    
                           A  4858    ;ch                                    IX-1    
                           A  4859    
                           A  4860    
                           A  4861    ; Stack Frame Size: 8 (bytes)
                           A  4862    ;       Spill Code: 0 (instruction)
                           A  4863    
                           A  4864    
                           A  4865    ; 1172	
                           A  4866    ; 1173	/* Go to the end of current line. */
                           A  4867    ; 1174	void do_endline(void)
                           A  4868    ; 1175	{
0115EB                     A  4869    _do_endline:
0115EB 21FDFFFF            A  4870    	LD	HL,-3
0115EF CD 7E 24 01         A  4871    	CALL	__frameset
                           A  4872    ; 1176		char len, ch, oldcol;
                           A  4873    ; 1177		
                           A  4874    ; 1178		if (p_curr == p_root)
0115F3 ED4B 04 54 01       A  4875    	LD	BC,(_p_root)
0115F8 2A 07 54 01         A  4876    	LD	HL,(_p_curr)
0115FC B7                  A  4877    	OR	A,A
0115FD ED42                A  4878    	SBC	HL,BC
0115FF 28 69               A  4879    	JR	Z,L_274
                           A  4880    ; 1179			return;
                           A  4881    ; 1180		
                           A  4882    ; 1181		len = strlen(p_curr->p_data);	
011601 FD2A 07 54 01       A  4883    	LD	IY,(_p_curr)
011606 FD0706              A  4884    	LD	BC,(IY+6)
011609 C5                  A  4885    	PUSH	BC
01160A CD 3B 24 01         A  4886    	CALL	_strlen
01160E C1                  A  4887    	POP	BC
01160F DD75FF              A  4888    	LD	(IX+-1),L
                           A  4889    ; 1182		
                           A  4890    ; 1183		ch = scn_phys[cur_row][cur_col];
011612 2A 13 54 01         A  4891    	LD	HL,(_cur_row)
011616 29                  A  4892    	ADD	HL,HL
011617 29                  A  4893    	ADD	HL,HL
011618 ED4B 13 54 01       A  4894    	LD	BC,(_cur_row)
01161D 09                  A  4895    	ADD	HL,BC
01161E 29                  A  4896    	ADD	HL,HL
01161F 29                  A  4897    	ADD	HL,HL
011620 29                  A  4898    	ADD	HL,HL
011621 29                  A  4899    	ADD	HL,HL
011622 01 1B 43 01         A  4900    	LD	BC,_scn_phys
011626 09                  A  4901    	ADD	HL,BC
011627 ED4B 16 54 01       A  4902    	LD	BC,(_cur_col)
01162C 09                  A  4903    	ADD	HL,BC
01162D 7E                  A  4904    	LD	A,(HL)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  96


PC     Object              I  Line    Source C:\proted\Debug\main.src
01162E DD77FE              A  4905    	LD	(IX+-2),A
                           A  4906    ; 1184		oldcol = cur_col;
011631 3A 16 54 01         A  4907    	LD	A,(_cur_col)
011635 DD77FD              A  4908    	LD	(IX+-3),A
                           A  4909    ; 1185		
                           A  4910    ; 1186		cur_col = len;
011638 DD7EFF              A  4911    	LD	A,(IX+-1)
01163B 17ED62              A  4912    	SEXT	HL
01163E DD6EFF              A  4913    	LD	L,(IX+-1)
011641 22 16 54 01         A  4914    	LD	(_cur_col),HL
                           A  4915    ; 1187		cur_char = len + 1;
011645 DD7EFF              A  4916    	LD	A,(IX+-1)
011648 17ED62              A  4917    	SEXT	HL
01164B DD6EFF              A  4918    	LD	L,(IX+-1)
01164E 23                  A  4919    	INC	HL
01164F 22 10 54 01         A  4920    	LD	(_cur_char),HL
                           A  4921    ; 1188		
                           A  4922    ; 1189		plot_char(oldcol, cur_row, ch);
011653 DD4EFE              A  4923    	LD	C,(IX+-2)
011656 3A 13 54 01         A  4924    	LD	A,(_cur_row)
01165A 0600                A  4925    	LD	B,0
01165C C5                  A  4926    	PUSH	BC
01165D 4F                  A  4927    	LD	C,A
01165E C5                  A  4928    	PUSH	BC
01165F DD4EFD              A  4929    	LD	C,(IX+-3)
011662 C5                  A  4930    	PUSH	BC
011663 CD 9E 02 01         A  4931    	CALL	_plot_char
011667 C1                  A  4932    	POP	BC
011668 C1                  A  4933    	POP	BC
011669 C1                  A  4934    	POP	BC
                           A  4935    ; 1190	}
01166A                     A  4936    L_274:
01166A DDF9                A  4937    	LD	SP,IX
01166C DDE1                A  4938    	POP	IX
01166E C9                  A  4939    	RET	
                           A  4940    
                           A  4941    
                           A  4942    ;**************************** _do_endline *****
                           A  4943    ;Name                         Addr/Register   S
                           A  4944    ;_plot_char                          IMPORT  --
                           A  4945    ;_cur_char                           STATIC    
                           A  4946    ;_cur_col                            STATIC    
                           A  4947    ;_cur_row                            STATIC    
                           A  4948    ;_scn_phys                           STATIC   4
                           A  4949    ;_strlen                             IMPORT  --
                           A  4950    ;_p_root                             STATIC    
                           A  4951    ;_p_curr                             STATIC    
                           A  4952    ;oldcol                                IX-3    
                           A  4953    ;ch                                    IX-2    
                           A  4954    ;len                                   IX-1    
                           A  4955    
                           A  4956    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  97


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4957    ; Stack Frame Size: 9 (bytes)
                           A  4958    ;       Spill Code: 0 (instruction)
                           A  4959    
                           A  4960    
                           A  4961    ; 1191	
                           A  4962    ; 1192	/* Redraws the virtual screen from scra
                           A  4963    ; 1193	void paintall(void)
                           A  4964    ; 1194	{
01166F                     A  4965    _paintall:
01166F 21F8FFFF            A  4966    	LD	HL,-8
011673 CD 7E 24 01         A  4967    	CALL	__frameset
                           A  4968    ; 1195		register unsigned char r;
                           A  4969    ; 1196		p_line_t p = p_curr;
011677 ED4B 07 54 01       A  4970    	LD	BC,(_p_curr)
01167C DD0FFC              A  4971    	LD	(IX+-4),BC
                           A  4972    ; 1197		int left_pos = cur_char - cur_col;
01167F 2A 10 54 01         A  4973    	LD	HL,(_cur_char)
011683 ED4B 16 54 01       A  4974    	LD	BC,(_cur_col)
011688 B7                  A  4975    	OR	A,A
011689 ED42                A  4976    	SBC	HL,BC
01168B DD2FF8              A  4977    	LD	(IX+-8),HL
01168E DD36FF00            A  4978    	LD	(IX+-1),0
                           A  4979    ; 1198		unsigned char len;
                           A  4980    ; 1199		
                           A  4981    ; 1200		for (r = 0; r < cur_row; r++)
011692 18 0C               A  4982    	JR	L_278
011694                     A  4983    L_276:
                           A  4984    ; 1201			p = p->p_prev;
011694 DD31FC              A  4985    	LD	IY,(IX+-4)
011697 FD0700              A  4986    	LD	BC,(IY+0)
01169A DD0FFC              A  4987    	LD	(IX+-4),BC
01169D DD34FF              A  4988    	INC	(IX+-1)
0116A0                     A  4989    L_278:
0116A0 DD7EFF              A  4990    	LD	A,(IX+-1)
0116A3 B7ED62              A  4991    	UEXT	HL
0116A6 6F                  A  4992    	LD	L,A
0116A7 B7                  A  4993    	OR	A,A
0116A8 ED4B 13 54 01       A  4994    	LD	BC,(_cur_row)
0116AD ED42                A  4995    	SBC	HL,BC
0116AF FA B9 16 01         A  4996    	JP	M,L__214
0116B3 EA 94 16 01         A  4997    	JP	PE,L_276
0116B7 18 04               A  4998    	JR	L__215
0116B9                     A  4999    L__214:
0116B9 E2 94 16 01         A  5000    	JP	PO,L_276
0116BD                     A  5001    L__215:
                           A  5002    ; 1202		
                           A  5003    ; 1203		sc_clr();
0116BD CD 5B 07 01         A  5004    	CALL	_sc_clr
0116C1 DD36FF00            A  5005    	LD	(IX+-1),0
                           A  5006    ; 1204		
                           A  5007    ; 1205		for (r = 0; r < SCNROWS; r++)
0116C5 C3 65 17 01         A  5008    	JR	L_289
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  98


PC     Object              I  Line    Source C:\proted\Debug\main.src
0116C9                     A  5009    L_287:
                           A  5010    ; 1206		{
                           A  5011    ; 1207			if (p == p_root)
0116C9 DD07FC              A  5012    	LD	BC,(IX+-4)
0116CC 2A 04 54 01         A  5013    	LD	HL,(_p_root)
0116D0 B7                  A  5014    	OR	A,A
0116D1 ED42                A  5015    	SBC	HL,BC
0116D3 20 1D               A  5016    	JR	NZ,L_282
                           A  5017    ; 1208			{
                           A  5018    ; 1209				sc_str(r, 0, "<eof>");
0116D5 01 24 27 01         A  5019    	LD	BC,L__210
0116D9 C5                  A  5020    	PUSH	BC
0116DA 01000000            A  5021    	LD	BC,0
0116DE C5                  A  5022    	PUSH	BC
0116DF DD4EFF              A  5023    	LD	C,(IX+-1)
0116E2 0600                A  5024    	LD	B,0
0116E4 C5                  A  5025    	PUSH	BC
0116E5 CD 1E 08 01         A  5026    	CALL	_sc_str
0116E9 C1                  A  5027    	POP	BC
0116EA C1                  A  5028    	POP	BC
0116EB C1                  A  5029    	POP	BC
                           A  5030    ; 1210				
                           A  5031    ; 1211				do_cup();
0116EC CD 01 0C 01         A  5032    	CALL	_do_cup
                           A  5033    ; 1212				
                           A  5034    ; 1213				break;
0116F0 18 7C               A  5035    	JR	L_290
                           A  5036    ; 1214			}
0116F2                     A  5037    L_282:
                           A  5038    ; 1215			
                           A  5039    ; 1216			len = strlen(p->p_data);
0116F2 DD31FC              A  5040    	LD	IY,(IX+-4)
0116F5 FD0706              A  5041    	LD	BC,(IY+6)
0116F8 C5                  A  5042    	PUSH	BC
0116F9 CD 3B 24 01         A  5043    	CALL	_strlen
0116FD C1                  A  5044    	POP	BC
0116FE DD75FB              A  5045    	LD	(IX+-5),L
                           A  5046    ; 1217			
                           A  5047    ; 1218			if (len >= left_pos)
011701 DD7EFB              A  5048    	LD	A,(IX+-5)
011704 B7ED62              A  5049    	UEXT	HL
011707 6F                  A  5050    	LD	L,A
011708 B7                  A  5051    	OR	A,A
011709 DD07F8              A  5052    	LD	BC,(IX+-8)
01170C ED42                A  5053    	SBC	HL,BC
01170E FA 18 17 01         A  5054    	JP	M,L__216
011712 EA 3C 17 01         A  5055    	JP	PE,L_285
011716 18 04               A  5056    	JR	L__217
011718                     A  5057    L__216:
011718 E2 3C 17 01         A  5058    	JP	PO,L_285
01171C                     A  5059    L__217:
                           A  5060    ; 1219				sc_str(r, 0, p->p_data + (l
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page:  99


PC     Object              I  Line    Source C:\proted\Debug\main.src
01171C DD07F8              A  5061    	LD	BC,(IX+-8)
01171F DD31FC              A  5062    	LD	IY,(IX+-4)
011722 FD2706              A  5063    	LD	HL,(IY+6)
011725 0B                  A  5064    	DEC	BC
011726 09                  A  5065    	ADD	HL,BC
011727 E5                  A  5066    	PUSH	HL
011728 01000000            A  5067    	LD	BC,0
01172C C5                  A  5068    	PUSH	BC
01172D DD4EFF              A  5069    	LD	C,(IX+-1)
011730 0600                A  5070    	LD	B,0
011732 C5                  A  5071    	PUSH	BC
011733 CD 1E 08 01         A  5072    	CALL	_sc_str
011737 C1                  A  5073    	POP	BC
011738 C1                  A  5074    	POP	BC
011739 C1                  A  5075    	POP	BC
                           A  5076    ; 1220			else
01173A 18 1D               A  5077    	JR	L_286
01173C                     A  5078    L_285:
                           A  5079    ; 1221				if (len == 0)
01173C DD7EFB              A  5080    	LD	A,(IX+-5)
01173F B7                  A  5081    	OR	A,A
011740 20 17               A  5082    	JR	NZ,L_286
                           A  5083    ; 1222					plot_char(0, r, ' ');
011742 01200000            A  5084    	LD	BC,32
011746 C5                  A  5085    	PUSH	BC
011747 DD4EFF              A  5086    	LD	C,(IX+-1)
01174A 0600                A  5087    	LD	B,0
01174C C5                  A  5088    	PUSH	BC
01174D 01000000            A  5089    	LD	BC,0
011751 C5                  A  5090    	PUSH	BC
011752 CD 9E 02 01         A  5091    	CALL	_plot_char
011756 C1                  A  5092    	POP	BC
011757 C1                  A  5093    	POP	BC
011758 C1                  A  5094    	POP	BC
011759                     A  5095    L_286:
                           A  5096    ; 1223			
                           A  5097    ; 1224			p = p->p_next;
011759 DD31FC              A  5098    	LD	IY,(IX+-4)
01175C FD0703              A  5099    	LD	BC,(IY+3)
01175F DD0FFC              A  5100    	LD	(IX+-4),BC
011762 DD34FF              A  5101    	INC	(IX+-1)
                           A  5102    ; 1225		}
011765                     A  5103    L_289:
011765 DD7EFF              A  5104    	LD	A,(IX+-1)
011768 FE32                A  5105    	CP	A,50
01176A DA C9 16 01         A  5106    	JR	C,L_287
01176E                     A  5107    L_290:
                           A  5108    ; 1226		
                           A  5109    ; 1227		te_mov(cur_row, cur_col);
01176E 3A 16 54 01         A  5110    	LD	A,(_cur_col)
011772 4F                  A  5111    	LD	C,A
011773 3A 13 54 01         A  5112    	LD	A,(_cur_row)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 100


PC     Object              I  Line    Source C:\proted\Debug\main.src
011777 0600                A  5113    	LD	B,0
011779 C5                  A  5114    	PUSH	BC
01177A 4F                  A  5115    	LD	C,A
01177B C5                  A  5116    	PUSH	BC
01177C CD 7D 06 01         A  5117    	CALL	_te_mov
011780 C1                  A  5118    	POP	BC
011781 C1                  A  5119    	POP	BC
                           A  5120    ; 1228	
                           A  5121    ; 1229		Show_Cursor();
011782 CD 34 18 01         A  5122    	CALL	_Show_Cursor
                           A  5123    ; 1230	}
011786 DDF9                A  5124    	LD	SP,IX
011788 DDE1                A  5125    	POP	IX
01178A C9                  A  5126    	RET	
                           A  5127    
                           A  5128    
                           A  5129    ;**************************** _paintall *******
                           A  5130    ;Name                         Addr/Register   S
                           A  5131    ;_Show_Cursor                        IMPORT  --
                           A  5132    ;_te_mov                             IMPORT  --
                           A  5133    ;_plot_char                          IMPORT  --
                           A  5134    ;_strlen                             IMPORT  --
                           A  5135    ;_do_cup                             IMPORT  --
                           A  5136    ;_sc_str                             IMPORT  --
                           A  5137    ;_p_root                             STATIC    
                           A  5138    ;_sc_clr                             IMPORT  --
                           A  5139    ;_cur_row                            STATIC    
                           A  5140    ;_cur_col                            STATIC    
                           A  5141    ;_cur_char                           STATIC    
                           A  5142    ;_p_curr                             STATIC    
                           A  5143    ;left_pos                              IX-8    
                           A  5144    ;len                                   IX-5    
                           A  5145    ;p                                     IX-4    
                           A  5146    ;r                                     IX-1    
                           A  5147    
                           A  5148    
                           A  5149    ; Stack Frame Size: 14 (bytes)
                           A  5150    ;       Spill Code: 0 (instruction)
                           A  5151    
                           A  5152    
                           A  5153    	SEGMENT STRSECT
012724                     A  5154    L__210:
012724 3C656F66 3E         A  5155    	DB	"<eof>"
012729 00                  A  5156    	DB	0
                           A  5157    	SEGMENT CODE
                           A  5158    ; 1231	
                           A  5159    ; 1232	/* Redraws the current row of the virtu
                           A  5160    ; 1233	/* from scratch from the current settin
                           A  5161    ; 1234	void paintrow(void)
                           A  5162    ; 1235	{
01178B                     A  5163    _paintrow:
01178B 21FEFFFF            A  5164    	LD	HL,-2
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 101


PC     Object              I  Line    Source C:\proted\Debug\main.src
01178F CD 7E 24 01         A  5165    	CALL	__frameset
                           A  5166    ; 1236		unsigned char left_pos = cur_char -
011793 3A 10 54 01         A  5167    	LD	A,(_cur_char)
011797 47                  A  5168    	LD	B,A
011798 3A 16 54 01         A  5169    	LD	A,(_cur_col)
01179C 4F                  A  5170    	LD	C,A
01179D 78                  A  5171    	LD	A,B
01179E 91                  A  5172    	SUB	A,C
01179F DD77FF              A  5173    	LD	(IX+-1),A
                           A  5174    ; 1237		char len;
                           A  5175    ; 1238		
                           A  5176    ; 1239		len = strlen(p_curr->p_data);
0117A2 FD2A 07 54 01       A  5177    	LD	IY,(_p_curr)
0117A7 FD0706              A  5178    	LD	BC,(IY+6)
0117AA C5                  A  5179    	PUSH	BC
0117AB CD 3B 24 01         A  5180    	CALL	_strlen
0117AF C1                  A  5181    	POP	BC
0117B0 DD75FE              A  5182    	LD	(IX+-2),L
                           A  5183    ; 1240		
                           A  5184    ; 1241		sc_crw(cur_row);
0117B3 3A 13 54 01         A  5185    	LD	A,(_cur_row)
0117B7 4F                  A  5186    	LD	C,A
0117B8 0600                A  5187    	LD	B,0
0117BA C5                  A  5188    	PUSH	BC
0117BB CD 72 07 01         A  5189    	CALL	_sc_crw
0117BF C1                  A  5190    	POP	BC
                           A  5191    ; 1242		
                           A  5192    ; 1243		if (p_curr == p_root)
0117C0 ED4B 04 54 01       A  5193    	LD	BC,(_p_root)
0117C5 2A 07 54 01         A  5194    	LD	HL,(_p_curr)
0117C9 B7                  A  5195    	OR	A,A
0117CA ED42                A  5196    	SBC	HL,BC
0117CC 20 1B               A  5197    	JR	NZ,L_294
                           A  5198    ; 1244			sc_str(cur_row, 0, "<eof>");
0117CE 01 2A 27 01         A  5199    	LD	BC,L__220
0117D2 C5                  A  5200    	PUSH	BC
0117D3 3A 13 54 01         A  5201    	LD	A,(_cur_row)
0117D7 4F                  A  5202    	LD	C,A
0117D8 11000000            A  5203    	LD	DE,0
0117DC D5                  A  5204    	PUSH	DE
0117DD 0600                A  5205    	LD	B,0
0117DF C5                  A  5206    	PUSH	BC
0117E0 CD 1E 08 01         A  5207    	CALL	_sc_str
0117E4 C1                  A  5208    	POP	BC
0117E5 C1                  A  5209    	POP	BC
0117E6 C1                  A  5210    	POP	BC
                           A  5211    ; 1245		else
0117E7 18 46               A  5212    	JR	L_295
0117E9                     A  5213    L_294:
                           A  5214    ; 1246			if (len >= left_pos)
0117E9 DD7EFE              A  5215    	LD	A,(IX+-2)
0117EC DDBEFF              A  5216    	CP	A,(IX+-1)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 102


PC     Object              I  Line    Source C:\proted\Debug\main.src
0117EF 38 3E               A  5217    	JR	C,L_295
                           A  5218    ; 1247			{
                           A  5219    ; 1248				sc_str(cur_row, 0, p_curr->
0117F1 DD7EFF              A  5220    	LD	A,(IX+-1)
0117F4 B7ED62              A  5221    	UEXT	HL
0117F7 6F                  A  5222    	LD	L,A
0117F8 E5C1                A  5223    	LD	BC,HL
0117FA FD2A 07 54 01       A  5224    	LD	IY,(_p_curr)
0117FF FD2706              A  5225    	LD	HL,(IY+6)
011802 0B                  A  5226    	DEC	BC
011803 09                  A  5227    	ADD	HL,BC
011804 E5                  A  5228    	PUSH	HL
011805 3A 13 54 01         A  5229    	LD	A,(_cur_row)
011809 4F                  A  5230    	LD	C,A
01180A 11000000            A  5231    	LD	DE,0
01180E D5                  A  5232    	PUSH	DE
01180F 0600                A  5233    	LD	B,0
011811 C5                  A  5234    	PUSH	BC
011812 CD 1E 08 01         A  5235    	CALL	_sc_str
011816 C1                  A  5236    	POP	BC
011817 C1                  A  5237    	POP	BC
011818 C1                  A  5238    	POP	BC
                           A  5239    ; 1249		
                           A  5240    ; 1250				gotoxy(len, cur_row);
011819 3A 13 54 01         A  5241    	LD	A,(_cur_row)
01181D 4F                  A  5242    	LD	C,A
01181E 0600                A  5243    	LD	B,0
011820 C5                  A  5244    	PUSH	BC
011821 DD4EFE              A  5245    	LD	C,(IX+-2)
011824 C5                  A  5246    	PUSH	BC
011825 CD 19 03 01         A  5247    	CALL	_gotoxy
011829 C1                  A  5248    	POP	BC
01182A C1                  A  5249    	POP	BC
                           A  5250    ; 1251				
                           A  5251    ; 1252				clreol();
01182B CD D6 02 01         A  5252    	CALL	_clreol
                           A  5253    ; 1253			}
                           A  5254    ; 1254	}
01182F                     A  5255    L_295:
01182F DDF9                A  5256    	LD	SP,IX
011831 DDE1                A  5257    	POP	IX
011833 C9                  A  5258    	RET	
                           A  5259    
                           A  5260    
                           A  5261    ;**************************** _paintrow *******
                           A  5262    ;Name                         Addr/Register   S
                           A  5263    ;_clreol                             IMPORT  --
                           A  5264    ;_gotoxy                             IMPORT  --
                           A  5265    ;_sc_str                             IMPORT  --
                           A  5266    ;_p_root                             STATIC    
                           A  5267    ;_cur_row                            STATIC    
                           A  5268    ;_sc_crw                             IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 103


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5269    ;_p_curr                             STATIC    
                           A  5270    ;_strlen                             IMPORT  --
                           A  5271    ;_cur_col                            STATIC    
                           A  5272    ;_cur_char                           STATIC    
                           A  5273    ;len                                   IX-2    
                           A  5274    ;left_pos                              IX-1    
                           A  5275    
                           A  5276    
                           A  5277    ; Stack Frame Size: 8 (bytes)
                           A  5278    ;       Spill Code: 0 (instruction)
                           A  5279    
                           A  5280    
                           A  5281    	SEGMENT STRSECT
01272A                     A  5282    L__220:
01272A 3C656F66 3E         A  5283    	DB	"<eof>"
01272F 00                  A  5284    	DB	0
                           A  5285    	SEGMENT CODE
                           A  5286    ; 1255	
                           A  5287    ; 1256	/* Show curson on screen. */
                           A  5288    ; 1257	void Show_Cursor(void)
                           A  5289    ; 1258	{
011834                     A  5290    _Show_Cursor:
                           A  5291    ; 1259		asm ("push ix");
011834 DDE5                A  5292    push ix
                           A  5293    ; 1260		asm ("ld a, kr_draw_cursor");
011836 3E2C                A  5294    ld a, kr_draw_cursor
                           A  5295    ; 1261		asm ("call.lil prose_kernal");
011838 5BCD200A 00         A  5296    call.lil prose_kernal
                           A  5297    ; 1262		asm ("pop ix");	
01183D DDE1                A  5298    pop ix
                           A  5299    ; 1263	}
01183F C9                  A  5300    	RET	
                           A  5301    
                           A  5302    
                           A  5303    ;**************************** _Show_Cursor ****
                           A  5304    ;Name                         Addr/Register   S
                           A  5305    
                           A  5306    
                           A  5307    ; Stack Frame Size: 6 (bytes)
                           A  5308    ;       Spill Code: 0 (instruction)
                           A  5309    
                           A  5310    
                           A  5311    ; 1264	
                           A  5312    ; 1265	/* Show PROTED men */
                           A  5313    ; 1266	void ShowMenu(void)
                           A  5314    ; 1267	{
011840                     A  5315    _ShowMenu:
                           A  5316    ; 1268		Enable_Back_Color();
011840 CD B3 18 01         A  5317    	CALL	_Enable_Back_Color
                           A  5318    ; 1269		
                           A  5319    ; 1270		gotoxy(0, 50);	
011844 01320000            A  5320    	LD	BC,50
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 104


PC     Object              I  Line    Source C:\proted\Debug\main.src
011848 C5                  A  5321    	PUSH	BC
011849 01000000            A  5322    	LD	BC,0
01184D C5                  A  5323    	PUSH	BC
01184E CD 19 03 01         A  5324    	CALL	_gotoxy
011852 C1                  A  5325    	POP	BC
011853 C1                  A  5326    	POP	BC
                           A  5327    ; 1271		print("+===========================
011854 01 30 27 01         A  5328    	LD	BC,L__224
011858 C5                  A  5329    	PUSH	BC
011859 CD 50 02 01         A  5330    	CALL	_print
01185D C1                  A  5331    	POP	BC
                           A  5332    ; 1272		print("| Ln:       , Col:          
01185E 01 81 27 01         A  5333    	LD	BC,L__225
011862 C5                  A  5334    	PUSH	BC
011863 CD 50 02 01         A  5335    	CALL	_print
011867 C1                  A  5336    	POP	BC
                           A  5337    ; 1273		print("|                           
011868 01 D2 27 01         A  5338    	LD	BC,L__226
01186C C5                  A  5339    	PUSH	BC
01186D CD 50 02 01         A  5340    	CALL	_print
011871 C1                  A  5341    	POP	BC
                           A  5342    ; 1274		print("| Command  shortcuts:       
011872 01 23 28 01         A  5343    	LD	BC,L__227
011876 C5                  A  5344    	PUSH	BC
011877 CD 50 02 01         A  5345    	CALL	_print
01187B C1                  A  5346    	POP	BC
                           A  5347    ; 1275		print("| Ctrl + L: insert a line.  
01187C 01 74 28 01         A  5348    	LD	BC,L__228
011880 C5                  A  5349    	PUSH	BC
011881 CD 50 02 01         A  5350    	CALL	_print
011885 C1                  A  5351    	POP	BC
                           A  5352    ; 1276		print("| Ctrl + N: redraw screen.  
011886 01 C5 28 01         A  5353    	LD	BC,L__229
01188A C5                  A  5354    	PUSH	BC
01188B CD 50 02 01         A  5355    	CALL	_print
01188F C1                  A  5356    	POP	BC
                           A  5357    ; 1277		print("| Ctrl + B: break a line.   
011890 01 16 29 01         A  5358    	LD	BC,L__230
011894 C5                  A  5359    	PUSH	BC
011895 CD 50 02 01         A  5360    	CALL	_print
011899 C1                  A  5361    	POP	BC
                           A  5362    ; 1278		print("|         Key enabled: Tab, 
01189A 01 67 29 01         A  5363    	LD	BC,L__231
01189E C5                  A  5364    	PUSH	BC
01189F CD 50 02 01         A  5365    	CALL	_print
0118A3 C1                  A  5366    	POP	BC
                           A  5367    ; 1279		print("+===========================
0118A4 01 B8 29 01         A  5368    	LD	BC,L__232
0118A8 C5                  A  5369    	PUSH	BC
0118A9 CD 50 02 01         A  5370    	CALL	_print
0118AD C1                  A  5371    	POP	BC
                           A  5372    ; 1280		
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 105


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5373    ; 1281		Disable_Back_Color();
0118AE CD C1 18 01         A  5374    	CALL	_Disable_Back_Color
                           A  5375    ; 1282	}
0118B2 C9                  A  5376    	RET	
                           A  5377    
                           A  5378    
                           A  5379    ;**************************** _ShowMenu *******
                           A  5380    ;Name                         Addr/Register   S
                           A  5381    ;_Disable_Back_Color                 IMPORT  --
                           A  5382    ;_print                              IMPORT  --
                           A  5383    ;_gotoxy                             IMPORT  --
                           A  5384    ;_Enable_Back_Color                  IMPORT  --
                           A  5385    
                           A  5386    
                           A  5387    ; Stack Frame Size: 6 (bytes)
                           A  5388    ;       Spill Code: 0 (instruction)
                           A  5389    
                           A  5390    
                           A  5391    	SEGMENT STRSECT
012730                     A  5392    L__224:
012730 2B3D3D3D 3D3D3D3D   A  5393    	DB	"+==================================]PR
012738 3D3D3D3D 3D3D3D3D 
012740 3D3D3D3D 3D3D3D3D 
012748 3D3D3D3D 3D3D3D3D 
012750 3D3D3D5D 50524F54 
012758 45445B3D 3D3D3D3D 
012760 3D3D3D3D 3D3D3D3D 
012768 3D3D3D3D 3D3D3D3D 
012770 3D3D3D3D 3D3D3D3D 
012778 3D3D3D3D 3D3D3D2B 
012780 00                  A  5394    	DB	0
012781                     A  5395    L__225:
012781 7C204C6E 3A202020   A  5396    	DB	"| Ln:       , Col:                    
012789 20202020 2C20436F 
012791 6C3A2020 20202020 
012799 20202020 20202020 
0127A1 20202020 20202020 
0127A9 20202020 20202020 
0127B1 20202020 20202020 
0127B9 20202020 20202020 
0127C1 20202020 20202020 
0127C9 20202020 2020207C 
0127D1 00                  A  5397    	DB	0
0127D2                     A  5398    L__226:
0127D2 7C202020 20202020   A  5399    	DB	"|                                     
0127DA 20202020 20202020 
0127E2 20202020 20202020 
0127EA 20202020 20202020 
0127F2 20202020 20202020 
0127FA 20202020 20202020 
012802 20202020 20202020 
01280A 20202020 20202020 
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 106


PC     Object              I  Line    Source C:\proted\Debug\main.src
012812 20202020 20202020 
01281A 20202020 2020207C 
012822 00                  A  5400    	DB	0
012823                     A  5401    L__227:
012823 7C20436F 6D6D616E   A  5402    	DB	"| Command  shortcuts:                 
01282B 64202073 686F7274 
012833 63757473 3A202020 
01283B 20202020 20202020 
012843 20202020 20202020 
01284B 20202020 20202020 
012853 20202020 20202020 
01285B 20202020 20202020 
012863 20202020 20202020 
01286B 20202020 2020207C 
012873 00                  A  5403    	DB	0
012874                     A  5404    L__228:
012874 7C204374 726C202B   A  5405    	DB	"| Ctrl + L: insert a line.   Ctrl + E:
01287C 204C3A20 696E7365 
012884 72742061 206C696E 
01288C 652E2020 20437472 
012894 6C202B20 453A2065 
01289C 6E64206F 66207465 
0128A4 78742E20 20204374 
0128AC 726C202B 204B3A20 
0128B4 64656C65 74652061 
0128BC 206C696E 652E207C 
0128C4 00                  A  5406    	DB	0
0128C5                     A  5407    L__229:
0128C5 7C204374 726C202B   A  5408    	DB	"| Ctrl + N: redraw screen.   Ctrl + T:
0128CD 204E3A20 72656472 
0128D5 61772073 63726565 
0128DD 6E2E2020 20437472 
0128E5 6C202B20 543A2074 
0128ED 6F70206F 66206669 
0128F5 6C652E20 20204374 
0128FD 726C202B 20533A20 
012905 73617665 2066696C 
01290D 652E2020 2020207C 
012915 00                  A  5409    	DB	0
012916                     A  5410    L__230:
012916 7C204374 726C202B   A  5411    	DB	"| Ctrl + B: break a line.    Ctrl + R:
01291E 20423A20 62726561 
012926 6B206120 6C696E65 
01292E 2E202020 20437472 
012936 6C202B20 523A2072 
01293E 656C6F61 64206669 
012946 6C652E20 20204374 
01294E 726C202B 20513A20 
012956 71756974 20746F20 
01295E 50524F53 452E207C 
012966 00                  A  5412    	DB	0
012967                     A  5413    L__231:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 107


PC     Object              I  Line    Source C:\proted\Debug\main.src
012967 7C202020 20202020   A  5414    	DB	"|         Key enabled: Tab, Cursor Key
01296F 20204B65 7920656E 
012977 61626C65 643A2054 
01297F 61622C20 43757273 
012987 6F72204B 6579732C 
01298F 20506755 702C2050 
012997 67446F77 6E2C2048 
01299F 6F6D652C 20456E64 
0129A7 2C204465 6C2E2020 
0129AF 20202020 2020207C 
0129B7 00                  A  5415    	DB	0
0129B8                     A  5416    L__232:
0129B8 2B3D3D3D 3D3D3D3D   A  5417    	DB	"+=====================================
0129C0 3D3D3D3D 3D3D3D3D 
0129C8 3D3D3D3D 3D3D3D3D 
0129D0 3D3D3D3D 3D3D3D3D 
0129D8 3D3D3D3D 3D3D3D3D 
0129E0 3D3D3D3D 3D3D3D3D 
0129E8 3D3D3D3D 3D3D3D3D 
0129F0 3D3D3D3D 3D3D3D3D 
0129F8 3D3D3D3D 3D3D3D3D 
012A00 3D3D3D3D 3D3D3D2B 
012A08 00                  A  5418    	DB	0
                           A  5419    	SEGMENT CODE
                           A  5420    ; 1283	
                           A  5421    ; 1284	/* Enable the background color for prin
                           A  5422    ; 1285	void Enable_Back_Color(void)
                           A  5423    ; 1286	{
0118B3                     A  5424    _Enable_Back_Color:
                           A  5425    ; 1287		asm ("push ix");
0118B3 DDE5                A  5426    push ix
                           A  5427    ; 1288		asm ("ld E, E7h");
0118B5 1EE7                A  5428    ld E, E7h
                           A  5429    ; 1289		asm ("ld a, kr_set_pen");
0118B7 3E2A                A  5430    ld a, kr_set_pen
                           A  5431    ; 1290		asm ("call.lil prose_kernal");
0118B9 5BCD200A 00         A  5432    call.lil prose_kernal
                           A  5433    ; 1291		asm ("pop ix");
0118BE DDE1                A  5434    pop ix
                           A  5435    ; 1292	}
0118C0 C9                  A  5436    	RET	
                           A  5437    
                           A  5438    
                           A  5439    ;**************************** _Enable_Back_Colo
                           A  5440    ;Name                         Addr/Register   S
                           A  5441    
                           A  5442    
                           A  5443    ; Stack Frame Size: 6 (bytes)
                           A  5444    ;       Spill Code: 0 (instruction)
                           A  5445    
                           A  5446    
                           A  5447    ; 1293	
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 108


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5448    ; 1294	/* Disable the background color for pri
                           A  5449    ; 1295	void Disable_Back_Color(void)
                           A  5450    ; 1296	{
0118C1                     A  5451    _Disable_Back_Color:
                           A  5452    ; 1297		asm ("push ix");
0118C1 DDE5                A  5453    push ix
                           A  5454    ; 1298		asm ("ld E, 07h");
0118C3 1E07                A  5455    ld E, 07h
                           A  5456    ; 1299		asm ("ld a, kr_set_pen");
0118C5 3E2A                A  5457    ld a, kr_set_pen
                           A  5458    ; 1300		asm ("call.lil prose_kernal");
0118C7 5BCD200A 00         A  5459    call.lil prose_kernal
                           A  5460    ; 1301		asm ("pop ix");
0118CC DDE1                A  5461    pop ix
                           A  5462    ; 1302	}
0118CE C9                  A  5463    	RET	
                           A  5464    
                           A  5465    
                           A  5466    ;**************************** _Disable_Back_Col
                           A  5467    ;Name                         Addr/Register   S
                           A  5468    
                           A  5469    
                           A  5470    ; Stack Frame Size: 6 (bytes)
                           A  5471    ;       Spill Code: 0 (instruction)
                           A  5472    
                           A  5473    
                           A  5474    ; 1303	
                           A  5475    ; 1304	/* Main edit loop */
                           A  5476    ; 1305	void edit(void)
                           A  5477    ; 1306	{
0118CF                     A  5478    _edit:
0118CF 21FFFFFF            A  5479    	LD	HL,-1
0118D3 CD 7E 24 01         A  5480    	CALL	__frameset
                           A  5481    ; 1307		cur_row = 0;
0118D7 01000000            A  5482    	LD	BC,0
0118DB ED43 13 54 01       A  5483    	LD	(_cur_row),BC
                           A  5484    ; 1308		cur_col = 0;
0118E0 ED43 16 54 01       A  5485    	LD	(_cur_col),BC
                           A  5486    ; 1309		cur_line = 1;
0118E5 01010000            A  5487    	LD	BC,1
0118E9 ED43 0D 54 01       A  5488    	LD	(_cur_line),BC
                           A  5489    ; 1310		cur_char = 1;
0118EE ED43 10 54 01       A  5490    	LD	(_cur_char),BC
                           A  5491    ; 1311		p_curr = p_root->p_next;	
0118F3 FD2A 04 54 01       A  5492    	LD	IY,(_p_root)
0118F8 FD0703              A  5493    	LD	BC,(IY+3)
0118FB ED43 07 54 01       A  5494    	LD	(_p_curr),BC
                           A  5495    ; 1312		
                           A  5496    ; 1313		paintall();
011900 CD 6F 16 01         A  5497    	CALL	_paintall
                           A  5498    ; 1314		
                           A  5499    ; 1315		sc_fup();
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 109


PC     Object              I  Line    Source C:\proted\Debug\main.src
011904 CD A2 09 01         A  5500    	CALL	_sc_fup
                           A  5501    ; 1316		
                           A  5502    ; 1317		while (TRUE)
011908                     A  5503    L_331:
                           A  5504    ; 1318		{
                           A  5505    ; 1319			char ch;
                           A  5506    ; 1320			
                           A  5507    ; 1321			sc_upd();
011908 CD 67 08 01         A  5508    	CALL	_sc_upd
                           A  5509    ; 1322			
                           A  5510    ; 1323			Show_Cursor_Position();
01190C CD 04 1B 01         A  5511    	CALL	_Show_Cursor_Position
                           A  5512    ; 1324			
                           A  5513    ; 1325			te_mov(cur_row, cur_col);
011910 3A 16 54 01         A  5514    	LD	A,(_cur_col)
011914 4F                  A  5515    	LD	C,A
011915 3A 13 54 01         A  5516    	LD	A,(_cur_row)
011919 0600                A  5517    	LD	B,0
01191B C5                  A  5518    	PUSH	BC
01191C 4F                  A  5519    	LD	C,A
01191D C5                  A  5520    	PUSH	BC
01191E CD 7D 06 01         A  5521    	CALL	_te_mov
011922 C1                  A  5522    	POP	BC
011923 C1                  A  5523    	POP	BC
                           A  5524    ; 1326	
                           A  5525    ; 1327			Show_Cursor();		
011924 CD 34 18 01         A  5526    	CALL	_Show_Cursor
                           A  5527    ; 1328			
                           A  5528    ; 1329			ch = te_gch();
011928 CD 13 06 01         A  5529    	CALL	_te_gch
01192C DD77FF              A  5530    	LD	(IX+-1),A
                           A  5531    ; 1330			
                           A  5532    ; 1331			if ((' ' <= ch) && (ch <= '~'))
01192F FE20                A  5533    	CP	A,32
011931 FA 55 19 01         A  5534    	JP	M,L_329
011935 3E7E                A  5535    	LD	A,126
011937 DDBEFF              A  5536    	CP	A,(IX+-1)
01193A FA 44 19 01         A  5537    	JP	M,L__254
01193E EA 55 19 01         A  5538    	JP	PE,L_329
011942 18 04               A  5539    	JR	L__255
011944                     A  5540    L__254:
011944 E2 55 19 01         A  5541    	JP	PO,L_329
011948                     A  5542    L__255:
                           A  5543    ; 1332				do_chr(ch);
011948 DD4EFF              A  5544    	LD	C,(IX+-1)
01194B 0600                A  5545    	LD	B,0
01194D C5                  A  5546    	PUSH	BC
01194E CD D2 12 01         A  5547    	CALL	_do_chr
011952 C1                  A  5548    	POP	BC
                           A  5549    ; 1333			else
011953 18 B3               A  5550    	JR	L_331
011955                     A  5551    L_329:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 110


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5552    ; 1334				switch (ch)
011955 DD7EFF              A  5553    	LD	A,(IX+-1)
011958 17ED62              A  5554    	SEXT	HL
01195B DD6EFF              A  5555    	LD	L,(IX+-1)
01195E E5C1                A  5556    	LD	BC,HL
011960                     A  5557    L__239:
011960 11010000            A  5558    	LD	DE,1
011964 B7                  A  5559    	OR	A,A
011965 ED52                A  5560    	SBC	HL,DE
011967 38 9F               A  5561    	JR	C,L_331
011969 21140000            A  5562    	LD	HL,20
01196D B7                  A  5563    	OR	A,A
01196E ED42                A  5564    	SBC	HL,BC
011970 38 96               A  5565    	JR	C,L_331
011972 C5E1                A  5566    	LD	HL,BC
011974 29                  A  5567    	ADD	HL,HL
011975 29                  A  5568    	ADD	HL,HL
011976 B7                  A  5569    	OR	A,A
011977 ED42                A  5570    	SBC	HL,BC
011979 01 7E 19 01         A  5571    	LD	BC,L__238-3
01197D 09                  A  5572    	ADD	HL,BC
01197E ED27                A  5573    	LD	HL,(HL)
011980 E9                  A  5574    	JP	(HL)
011981                     A  5575    L__238:
011981 631A01              A  5576    	DW24	L_320	
                           A  5577    
011984 BD1901              A  5578    	DW24	L_301	
                           A  5579    
011987 C51901              A  5580    	DW24	L_302	
                           A  5581    
01198A CD1901              A  5582    	DW24	L_303	
                           A  5583    
01198D D51901              A  5584    	DW24	L_304	
                           A  5585    
011990 E31901              A  5586    	DW24	L_305	
                           A  5587    
011993 081901              A  5588    	DW24	L_331	
                           A  5589    
011996 EB1901              A  5590    	DW24	L_306	
                           A  5591    
011999 F31901              A  5592    	DW24	L_307	
                           A  5593    
01199C 081901              A  5594    	DW24	L_331	
                           A  5595    
01199F FB1901              A  5596    	DW24	L_308	
                           A  5597    
0119A2 031A01              A  5598    	DW24	L_309	
                           A  5599    
0119A5 0B1A01              A  5600    	DW24	L_310	
                           A  5601    
0119A8 131A01              A  5602    	DW24	L_311	
                           A  5603    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 111


PC     Object              I  Line    Source C:\proted\Debug\main.src
0119AB 081901              A  5604    	DW24	L_331	
                           A  5605    
0119AE 081901              A  5606    	DW24	L_331	
                           A  5607    
0119B1 331A01              A  5608    	DW24	L_315	
                           A  5609    
0119B4 1B1A01              A  5610    	DW24	L_312	
                           A  5611    
0119B7 231A01              A  5612    	DW24	L_313	
                           A  5613    
0119BA 2B1A01              A  5614    	DW24	L_314	
                           A  5615    
                           A  5616    ; 1335				{
                           A  5617    ; 1336					case		2: do_enhan
0119BD                     A  5618    L_301:
0119BD CD 7A 10 01         A  5619    	CALL	_do_enhanced_ret
0119C1 C3 08 19 01         A  5620    	JR	L_331
                           A  5621    ; 1337					case		3: do_pup()
0119C5                     A  5622    L_302:
0119C5 CD E2 0E 01         A  5623    	CALL	_do_pup
0119C9 C3 08 19 01         A  5624    	JR	L_331
                           A  5625    ; 1338					case		4: do_dch()
0119CD                     A  5626    L_303:
0119CD CD 62 13 01         A  5627    	CALL	_do_dch
0119D1 C3 08 19 01         A  5628    	JR	L_331
                           A  5629    ; 1339					case		5: do_bot(1
0119D5                     A  5630    L_304:
0119D5 01010000            A  5631    	LD	BC,1
0119D9 C5                  A  5632    	PUSH	BC
0119DA CD 21 12 01         A  5633    	CALL	_do_bot
0119DE C1                  A  5634    	POP	BC
0119DF C3 08 19 01         A  5635    	JR	L_331
                           A  5636    ; 1340					case 		6: do_pdw()
0119E3                     A  5637    L_305:
0119E3 CD 25 0E 01         A  5638    	CALL	_do_pdw
0119E7 C3 08 19 01         A  5639    	JR	L_331
                           A  5640    ; 1341					case 		8: do_del()
0119EB                     A  5641    L_306:
0119EB CD 8A 14 01         A  5642    	CALL	_do_del
0119EF C3 08 19 01         A  5643    	JR	L_331
                           A  5644    ; 1342					case		9: do_tab()
0119F3                     A  5645    L_307:
0119F3 CD 6D 11 01         A  5646    	CALL	_do_tab
0119F7 C3 08 19 01         A  5647    	JR	L_331
                           A  5648    ; 1343					case		11: do_dln(
0119FB                     A  5649    L_308:
0119FB CD 4D 14 01         A  5650    	CALL	_do_dln
0119FF C3 08 19 01         A  5651    	JR	L_331
                           A  5652    ; 1344					case		12: do_iln(
011A03                     A  5653    L_309:
011A03 CD D9 13 01         A  5654    	CALL	_do_iln
011A07 C3 08 19 01         A  5655    	JR	L_331
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 112


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5656    ; 1345					case 		13: do_ret(
011A0B                     A  5657    L_310:
011A0B CD A6 0F 01         A  5658    	CALL	_do_ret
011A0F C3 08 19 01         A  5659    	JR	L_331
                           A  5660    ; 1346					case		14: do_red(
011A13                     A  5661    L_311:
011A13 CD FC 0B 01         A  5662    	CALL	_do_red
011A17 C3 08 19 01         A  5663    	JR	L_331
                           A  5664    ; 1347					case		18: reload_
011A1B                     A  5665    L_312:
011A1B CD F0 1E 01         A  5666    	CALL	_reload_file
011A1F C3 08 19 01         A  5667    	JR	L_331
                           A  5668    ; 1348					case		19: save_fi
011A23                     A  5669    L_313:
011A23 CD B8 1D 01         A  5670    	CALL	_save_file
011A27 C3 08 19 01         A  5671    	JR	L_331
                           A  5672    ; 1349					case		20: do_top(
011A2B                     A  5673    L_314:
011A2B CD A1 11 01         A  5674    	CALL	_do_top
011A2F C3 08 19 01         A  5675    	JR	L_331
                           A  5676    ; 1350					
                           A  5677    ; 1351					case		17: msg_win
011A33                     A  5678    L_315:
011A33 01 09 2A 01         A  5679    	LD	BC,L__242
011A37 C5                  A  5680    	PUSH	BC
011A38 01 0D 2A 01         A  5681    	LD	BC,L__243
011A3C C5                  A  5682    	PUSH	BC
011A3D CD 97 1F 01         A  5683    	CALL	_msg_window
011A41 C1                  A  5684    	POP	BC
011A42 C1                  A  5685    	POP	BC
                           A  5686    ; 1352									getch()
011A43 CD 25 01 01         A  5687    	CALL	_getch
                           A  5688    ; 1353									close_m
011A47 CD BB 21 01         A  5689    	CALL	_close_msg_window
                           A  5690    ; 1354									
                           A  5691    ; 1355									if ((As
011A4B 3A 73 54 01         A  5692    	LD	A,(_Ascii)
011A4F FE59                A  5693    	CP	A,89
011A51 CA FF 1A 01         A  5694    	JR	Z,L_318
011A55 3A 73 54 01         A  5695    	LD	A,(_Ascii)
011A59 FE79                A  5696    	CP	A,121
011A5B C2 08 19 01         A  5697    	JR	NZ,L_331
011A5F C3 FF 1A 01         A  5698    	JR	L_318
                           A  5699    ; 1356									 contin
                           A  5700    ; 1357									
                           A  5701    ; 1358									goto qu
                           A  5702    ; 1359						
                           A  5703    ; 1360					case		1:
011A63                     A  5704    L_320:
                           A  5705    ; 1361						switch (Scancode)
011A63 3A 74 54 01         A  5706    	LD	A,(_Scancode)
011A67 B7ED62              A  5707    	UEXT	HL
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 113


PC     Object              I  Line    Source C:\proted\Debug\main.src
011A6A 6F                  A  5708    	LD	L,A
011A6B E5C1                A  5709    	LD	BC,HL
011A6D                     A  5710    L__248:
011A6D 11720000            A  5711    	LD	DE,114
011A71 B7                  A  5712    	OR	A,A
011A72 ED52                A  5713    	SBC	HL,DE
011A74 38 26               A  5714    	JR	C,L__249
011A76 21750000            A  5715    	LD	HL,117
011A7A B7                  A  5716    	OR	A,A
011A7B ED42                A  5717    	SBC	HL,BC
011A7D DA 08 19 01         A  5718    	JR	C,L_331
011A81 C5E1                A  5719    	LD	HL,BC
011A83 29                  A  5720    	ADD	HL,HL
011A84 29                  A  5721    	ADD	HL,HL
011A85 B7                  A  5722    	OR	A,A
011A86 ED42                A  5723    	SBC	HL,BC
011A88 11 3A 19 01         A  5724    	LD	DE,L__247-342
011A8C 19                  A  5725    	ADD	HL,DE
011A8D ED27                A  5726    	LD	HL,(HL)
011A8F E9                  A  5727    	JP	(HL)
011A90                     A  5728    L__247:
011A90 E71A01              A  5729    	DW24	L_324	
                           A  5730    
011A93 081901              A  5731    	DW24	L_331	
                           A  5732    
011A96 CF1A01              A  5733    	DW24	L_321	
                           A  5734    
011A99 DF1A01              A  5735    	DW24	L_323	
                           A  5736    
011A9C                     A  5737    L__249:
011A9C 11690000            A  5738    	LD	DE,105
011AA0 C5E1                A  5739    	LD	HL,BC
011AA2 B7                  A  5740    	OR	A,A
011AA3 ED52                A  5741    	SBC	HL,DE
011AA5 DA 08 19 01         A  5742    	JR	C,L_331
011AA9 216C0000            A  5743    	LD	HL,108
011AAD B7                  A  5744    	OR	A,A
011AAE ED42                A  5745    	SBC	HL,BC
011AB0 DA 08 19 01         A  5746    	JR	C,L_331
011AB4 C5E1                A  5747    	LD	HL,BC
011AB6 29                  A  5748    	ADD	HL,HL
011AB7 29                  A  5749    	ADD	HL,HL
011AB8 B7                  A  5750    	OR	A,A
011AB9 ED42                A  5751    	SBC	HL,BC
011ABB 01 88 19 01         A  5752    	LD	BC,L__246-315
011ABF 09                  A  5753    	ADD	HL,BC
011AC0 ED27                A  5754    	LD	HL,(HL)
011AC2 E9                  A  5755    	JP	(HL)
011AC3                     A  5756    L__246:
011AC3 F71A01              A  5757    	DW24	L_326	
                           A  5758    
011AC6 081901              A  5759    	DW24	L_331	
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 114


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5760    
011AC9 D71A01              A  5761    	DW24	L_322	
                           A  5762    
011ACC EF1A01              A  5763    	DW24	L_325	
                           A  5764    
                           A  5765    ; 1362						{
                           A  5766    ; 1363							case	0x74: d
011ACF                     A  5767    L_321:
011ACF CD A3 0D 01         A  5768    	CALL	_do_crt
011AD3 C3 08 19 01         A  5769    	JR	L_331
                           A  5770    ; 1364							case	0x6B: d
011AD7                     A  5771    L_322:
011AD7 CD 21 0D 01         A  5772    	CALL	_do_clf
011ADB C3 08 19 01         A  5773    	JR	L_331
                           A  5774    ; 1365							case	0x75: d
011ADF                     A  5775    L_323:
011ADF CD 01 0C 01         A  5776    	CALL	_do_cup
011AE3 C3 08 19 01         A  5777    	JR	L_331
                           A  5778    ; 1366							case	0x72: d
011AE7                     A  5779    L_324:
011AE7 CD 90 0C 01         A  5780    	CALL	_do_cdw
011AEB C3 08 19 01         A  5781    	JR	L_331
                           A  5782    ; 1367							case	0x6C: d
011AEF                     A  5783    L_325:
011AEF CD 81 15 01         A  5784    	CALL	_do_home
011AF3 C3 08 19 01         A  5785    	JR	L_331
                           A  5786    ; 1368							case	0x69: d
011AF7                     A  5787    L_326:
011AF7 CD EB 15 01         A  5788    	CALL	_do_endline
011AFB C3 08 19 01         A  5789    	JR	L_331
011AFF                     A  5790    L_318:
                           A  5791    ; 1369						}
                           A  5792    ; 1370						break;
                           A  5793    ; 1371				}
                           A  5794    ; 1372		}
                           A  5795    ; 1373		
                           A  5796    ; 1374		quit:;
                           A  5797    ; 1375	}
011AFF DDF9                A  5798    	LD	SP,IX
011B01 DDE1                A  5799    	POP	IX
011B03 C9                  A  5800    	RET	
                           A  5801    
                           A  5802    
                           A  5803    ;**************************** _edit ***********
                           A  5804    ;Name                         Addr/Register   S
                           A  5805    ;_do_endline                         IMPORT  --
                           A  5806    ;_do_home                            IMPORT  --
                           A  5807    ;_do_cdw                             IMPORT  --
                           A  5808    ;_do_cup                             IMPORT  --
                           A  5809    ;_do_clf                             IMPORT  --
                           A  5810    ;_do_crt                             IMPORT  --
                           A  5811    ;_Scancode                           STATIC    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 115


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5812    ;_Ascii                              STATIC    
                           A  5813    ;_close_msg_window                   IMPORT  --
                           A  5814    ;_getch                              IMPORT  --
                           A  5815    ;_msg_window                         IMPORT  --
                           A  5816    ;_do_top                             IMPORT  --
                           A  5817    ;_save_file                          IMPORT  --
                           A  5818    ;_reload_file                        IMPORT  --
                           A  5819    ;_do_red                             IMPORT  --
                           A  5820    ;_do_ret                             IMPORT  --
                           A  5821    ;_do_iln                             IMPORT  --
                           A  5822    ;_do_dln                             IMPORT  --
                           A  5823    ;_do_tab                             IMPORT  --
                           A  5824    ;_do_del                             IMPORT  --
                           A  5825    ;_do_pdw                             IMPORT  --
                           A  5826    ;_do_bot                             IMPORT  --
                           A  5827    ;_do_dch                             IMPORT  --
                           A  5828    ;_do_pup                             IMPORT  --
                           A  5829    ;_do_enhanced_ret                    IMPORT  --
                           A  5830    ;_do_chr                             IMPORT  --
                           A  5831    ;_te_gch                             IMPORT  --
                           A  5832    ;_Show_Cursor                        IMPORT  --
                           A  5833    ;_te_mov                             IMPORT  --
                           A  5834    ;_Show_Cursor_Position               IMPORT  --
                           A  5835    ;_sc_upd                             IMPORT  --
                           A  5836    ;_sc_fup                             IMPORT  --
                           A  5837    ;_paintall                           IMPORT  --
                           A  5838    ;_p_curr                             STATIC    
                           A  5839    ;_p_root                             STATIC    
                           A  5840    ;_cur_char                           STATIC    
                           A  5841    ;_cur_line                           STATIC    
                           A  5842    ;_cur_col                            STATIC    
                           A  5843    ;_cur_row                            STATIC    
                           A  5844    ;ch                                    IX-1    
                           A  5845    
                           A  5846    
                           A  5847    ; Stack Frame Size: 7 (bytes)
                           A  5848    ;       Spill Code: 0 (instruction)
                           A  5849    
                           A  5850    
                           A  5851    	SEGMENT STRSECT
012A09                     A  5852    L__242:
012A09 592F6E              A  5853    	DB	"Y/n"
012A0C 00                  A  5854    	DB	0
012A0D                     A  5855    L__243:
012A0D 51756974 20746F20   A  5856    	DB	"Quit to PROSE ?"
012A15 50524F53 45203F 
012A1C 00                  A  5857    	DB	0
                           A  5858    	SEGMENT CODE
                           A  5859    ; 1376	
                           A  5860    ; 1377	/* Draw on screen the cursor position *
                           A  5861    ; 1378	void Show_Cursor_Position(void)
                           A  5862    ; 1379	{
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 116


PC     Object              I  Line    Source C:\proted\Debug\main.src
011B04                     A  5863    _Show_Cursor_Position:
                           A  5864    ; 1380		Enable_Back_Color();
011B04 CD B3 18 01         A  5865    	CALL	_Enable_Back_Color
                           A  5866    ; 1381		
                           A  5867    ; 1382		uitoa(cur_line, convBuf);
011B08 01 85 54 01         A  5868    	LD	BC,_convBuf
011B0C C5                  A  5869    	PUSH	BC
011B0D ED4B 0D 54 01       A  5870    	LD	BC,(_cur_line)
011B12 C5                  A  5871    	PUSH	BC
011B13 CD A0 03 01         A  5872    	CALL	_uitoa
011B17 C1                  A  5873    	POP	BC
011B18 C1                  A  5874    	POP	BC
                           A  5875    ; 1383		
                           A  5876    ; 1384		gotoxy(5, 51);
011B19 01330000            A  5877    	LD	BC,51
011B1D C5                  A  5878    	PUSH	BC
011B1E 01050000            A  5879    	LD	BC,5
011B22 C5                  A  5880    	PUSH	BC
011B23 CD 19 03 01         A  5881    	CALL	_gotoxy
011B27 C1                  A  5882    	POP	BC
011B28 C1                  A  5883    	POP	BC
                           A  5884    ; 1385		
                           A  5885    ; 1386		print("      ");
011B29 01 1D 2A 01         A  5886    	LD	BC,L__257
011B2D C5                  A  5887    	PUSH	BC
011B2E CD 50 02 01         A  5888    	CALL	_print
011B32 C1                  A  5889    	POP	BC
                           A  5890    ; 1387		
                           A  5891    ; 1388		gotoxy(5, 51);
011B33 01330000            A  5892    	LD	BC,51
011B37 C5                  A  5893    	PUSH	BC
011B38 01050000            A  5894    	LD	BC,5
011B3C C5                  A  5895    	PUSH	BC
011B3D CD 19 03 01         A  5896    	CALL	_gotoxy
011B41 C1                  A  5897    	POP	BC
011B42 C1                  A  5898    	POP	BC
                           A  5899    ; 1389		
                           A  5900    ; 1390		print(convBuf);	
011B43 01 85 54 01         A  5901    	LD	BC,_convBuf
011B47 C5                  A  5902    	PUSH	BC
011B48 CD 50 02 01         A  5903    	CALL	_print
011B4C C1                  A  5904    	POP	BC
                           A  5905    ; 1391		
                           A  5906    ; 1392		uitoa(cur_col + 1, convBuf);
011B4D 01 85 54 01         A  5907    	LD	BC,_convBuf
011B51 C5                  A  5908    	PUSH	BC
011B52 ED4B 16 54 01       A  5909    	LD	BC,(_cur_col)
011B57 03                  A  5910    	INC	BC
011B58 C5                  A  5911    	PUSH	BC
011B59 CD A0 03 01         A  5912    	CALL	_uitoa
011B5D C1                  A  5913    	POP	BC
011B5E C1                  A  5914    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 117


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5915    ; 1393		
                           A  5916    ; 1394		gotoxy(18, 51);
011B5F 01330000            A  5917    	LD	BC,51
011B63 C5                  A  5918    	PUSH	BC
011B64 01120000            A  5919    	LD	BC,18
011B68 C5                  A  5920    	PUSH	BC
011B69 CD 19 03 01         A  5921    	CALL	_gotoxy
011B6D C1                  A  5922    	POP	BC
011B6E C1                  A  5923    	POP	BC
                           A  5924    ; 1395		
                           A  5925    ; 1396		print("         ");
011B6F 01 24 2A 01         A  5926    	LD	BC,L__258
011B73 C5                  A  5927    	PUSH	BC
011B74 CD 50 02 01         A  5928    	CALL	_print
011B78 C1                  A  5929    	POP	BC
                           A  5930    ; 1397		
                           A  5931    ; 1398		gotoxy(18, 51);
011B79 01330000            A  5932    	LD	BC,51
011B7D C5                  A  5933    	PUSH	BC
011B7E 01120000            A  5934    	LD	BC,18
011B82 C5                  A  5935    	PUSH	BC
011B83 CD 19 03 01         A  5936    	CALL	_gotoxy
011B87 C1                  A  5937    	POP	BC
011B88 C1                  A  5938    	POP	BC
                           A  5939    ; 1399		
                           A  5940    ; 1400		print(convBuf);	
011B89 01 85 54 01         A  5941    	LD	BC,_convBuf
011B8D C5                  A  5942    	PUSH	BC
011B8E CD 50 02 01         A  5943    	CALL	_print
011B92 C1                  A  5944    	POP	BC
                           A  5945    ; 1401		
                           A  5946    ; 1402		Disable_Back_Color();
011B93 CD C1 18 01         A  5947    	CALL	_Disable_Back_Color
                           A  5948    ; 1403	}
011B97 C9                  A  5949    	RET	
                           A  5950    
                           A  5951    
                           A  5952    ;**************************** _Show_Cursor_Posi
                           A  5953    ;Name                         Addr/Register   S
                           A  5954    ;_Disable_Back_Color                 IMPORT  --
                           A  5955    ;_cur_col                            STATIC    
                           A  5956    ;_print                              IMPORT  --
                           A  5957    ;_gotoxy                             IMPORT  --
                           A  5958    ;_cur_line                           STATIC    
                           A  5959    ;_convBuf                            STATIC    
                           A  5960    ;_uitoa                              IMPORT  --
                           A  5961    ;_Enable_Back_Color                  IMPORT  --
                           A  5962    
                           A  5963    
                           A  5964    ; Stack Frame Size: 6 (bytes)
                           A  5965    ;       Spill Code: 0 (instruction)
                           A  5966    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 118


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5967    
                           A  5968    	SEGMENT STRSECT
012A1D                     A  5969    L__257:
012A1D 20202020 2020       A  5970    	DB	"      "
012A23 00                  A  5971    	DB	0
012A24                     A  5972    L__258:
012A24 20202020 20202020   A  5973    	DB	"         "
012A2C 20 
012A2D 00                  A  5974    	DB	0
                           A  5975    	SEGMENT CODE
                           A  5976    ; 1404	
                           A  5977    ; 1405	/* Return 1 if the filename passed as p
                           A  5978    ; 1406	char FileExists(void)
                           A  5979    ; 1407	{
011B98                     A  5980    _FileExists:
011B98 21FFFFFF            A  5981    	LD	HL,-1
011B9C CD 7E 24 01         A  5982    	CALL	__frameset
                           A  5983    ; 1408		char ret;
                           A  5984    ; 1409		
                           A  5985    ; 1410		ret = 0;
011BA0 DD36FF00            A  5986    	LD	(IX+-1),0
                           A  5987    ; 1411		
                           A  5988    ; 1412		asm ("push ix");
011BA4 DDE5                A  5989    push ix
                           A  5990    ; 1413		asm ("ld hl, (_K_xHL)");
011BA6 2A 78 54 01         A  5991    ld hl, (_K_xHL)
                           A  5992    ; 1414		asm ("ld a, kr_find_file");
011BAA 3E0B                A  5993    ld a, kr_find_file
                           A  5994    ; 1415		asm ("call.lil prose_kernal");
011BAC 5BCD200A 00         A  5995    call.lil prose_kernal
                           A  5996    ; 1416		asm ("pop ix");	
011BB1 DDE1                A  5997    pop ix
                           A  5998    ; 1417		asm ("jr nz, FindError");
011BB3 20 04               A  5999    jr nz, FindError
                           A  6000    ; 1418		
                           A  6001    ; 1419		ret = 1;
011BB5 DD36FF01            A  6002    	LD	(IX+-1),1
                           A  6003    ; 1420		
                           A  6004    ; 1421		asm ("FindError:");
011BB9                     A  6005    FindError:
                           A  6006    ; 1422		
                           A  6007    ; 1423		return ret;
011BB9 DD7EFF              A  6008    	LD	A,(IX+-1)
                           A  6009    ; 1424	}
011BBC DDF9                A  6010    	LD	SP,IX
011BBE DDE1                A  6011    	POP	IX
011BC0 C9                  A  6012    	RET	
                           A  6013    
                           A  6014    
                           A  6015    ;**************************** _FileExists *****
                           A  6016    ;Name                         Addr/Register   S
                           A  6017    ;ret                                   IX-1    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 119


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  6018    
                           A  6019    
                           A  6020    ; Stack Frame Size: 7 (bytes)
                           A  6021    ;       Spill Code: 0 (instruction)
                           A  6022    
                           A  6023    
                           A  6024    ; 1425	
                           A  6025    ; 1426	/* Load file into Video Ram B, after bu
                           A  6026    ; 1427	void load_file(void)
                           A  6027    ; 1428	{
011BC1                     A  6028    _load_file:
011BC1 21F8FFFF            A  6029    	LD	HL,-8
011BC5 CD 7E 24 01         A  6030    	CALL	__frameset
                           A  6031    ; 1429		register unsigned int i;
                           A  6032    ; 1430		char pos = 0, len;
011BC9 DD36FF00            A  6033    	LD	(IX+-1),0
                           A  6034    ; 1431		
                           A  6035    ; 1432		msg_window("Loading file", "Please 
011BCD 01 2E 2A 01         A  6036    	LD	BC,L__261
011BD1 C5                  A  6037    	PUSH	BC
011BD2 01 3D 2A 01         A  6038    	LD	BC,L__262
011BD6 C5                  A  6039    	PUSH	BC
011BD7 CD 97 1F 01         A  6040    	CALL	_msg_window
011BDB C1                  A  6041    	POP	BC
011BDC C1                  A  6042    	POP	BC
                           A  6043    ; 1433		
                           A  6044    ; 1434		asm ("push ix");
011BDD DDE5                A  6045    push ix
                           A  6046    ; 1435		asm ("ld hl, (_K_xHL)");
011BDF 2A 78 54 01         A  6047    ld hl, (_K_xHL)
                           A  6048    ; 1436		asm ("ld a, kr_find_file");
011BE3 3E0B                A  6049    ld a, kr_find_file
                           A  6050    ; 1437		asm ("call.lil prose_kernal");
011BE5 5BCD200A 00         A  6051    call.lil prose_kernal
                           A  6052    ; 1438		asm ("pop ix");	
011BEA DDE1                A  6053    pop ix
                           A  6054    ; 1439		asm ("jr nz, LoadError");
011BEC C2 9B 1D 01         A  6055    jr nz, LoadError
                           A  6056    ; 1440		asm ("ld (_filesize), de");
011BF0 ED53 7E 54 01       A  6057    ld (_filesize), de
                           A  6058    ; 1441		
                           A  6059    ; 1442		asm ("push ix");
011BF5 DDE5                A  6060    push ix
                           A  6061    ; 1443		asm ("ld de, (_filesize)");
011BF7 ED5B 7E 54 01       A  6062    ld de, (_filesize)
                           A  6063    ; 1444		asm ("ld a, kr_set_load_length");
011BFC 3E0D                A  6064    ld a, kr_set_load_length
                           A  6065    ; 1445		asm ("call.lil prose_kernal");
011BFE 5BCD200A 00         A  6066    call.lil prose_kernal
                           A  6067    ; 1446		asm ("pop ix");
011C03 DDE1                A  6068    pop ix
                           A  6069    ; 1447		
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 120


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  6070    ; 1448		asm ("push ix");
011C05 DDE5                A  6071    push ix
                           A  6072    ; 1449		asm ("ld hl, (_BufferFile)");
011C07 2A 90 54 01         A  6073    ld hl, (_BufferFile)
                           A  6074    ; 1450		asm ("ld a, kr_read_file");
011C0B 3E0E                A  6075    ld a, kr_read_file
                           A  6076    ; 1451		asm ("call.lil prose_kernal");
011C0D 5BCD200A 00         A  6077    call.lil prose_kernal
                           A  6078    ; 1452		asm ("jr nz, LoadError");
011C12 C2 9B 1D 01         A  6079    jr nz, LoadError
                           A  6080    ; 1453		asm ("pop ix");
011C16 DDE1                A  6081    pop ix
                           A  6082    ; 1454		
                           A  6083    ; 1455		memset(linbuf, 0, sizeof(linbuf));
011C18 015A0000            A  6084    	LD	BC,90
011C1C C5                  A  6085    	PUSH	BC
011C1D 01000000            A  6086    	LD	BC,0
011C21 C5                  A  6087    	PUSH	BC
011C22 01 19 54 01         A  6088    	LD	BC,_linbuf
011C26 C5                  A  6089    	PUSH	BC
011C27 CD 3C 25 01         A  6090    	CALL	_memset
                           A  6091    ; 1456		
                           A  6092    ; 1457		linbuf[0] = EOS;
011C2B AF                  A  6093    	XOR	A,A
011C2C 32 19 54 01         A  6094    	LD	(_linbuf),A
                           A  6095    ; 1458		i = 0;	
011C30 11000000            A  6096    	LD	DE,0
011C34 C1                  A  6097    	POP	BC
011C35 C1                  A  6098    	POP	BC
011C36 C1                  A  6099    	POP	BC
011C37 DD1FFC              A  6100    	LD	(IX+-4),DE
                           A  6101    ; 1459		
                           A  6102    ; 1460		while (i <= filesize)
011C3A C3 89 1D 01         A  6103    	JR	L_349
011C3E                     A  6104    L_350:
                           A  6105    ; 1461		{
                           A  6106    ; 1462			if (pos < MAXLNLEN - 1)
011C3E DD7EFF              A  6107    	LD	A,(IX+-1)
011C41 FE4F                A  6108    	CP	A,79
011C43 F2 4D 1C 01         A  6109    	JP	P,L__272
011C47 EA 1C 1D 01         A  6110    	JP	PE,L_348
011C4B 18 04               A  6111    	JR	L__273
011C4D                     A  6112    L__272:
011C4D E2 1C 1D 01         A  6113    	JP	PO,L_348
011C51                     A  6114    L__273:
                           A  6115    ; 1463			{
                           A  6116    ; 1464				linbuf[pos] = BufferFile[i]
011C51 DD7EFF              A  6117    	LD	A,(IX+-1)
011C54 17ED62              A  6118    	SEXT	HL
011C57 DD6EFF              A  6119    	LD	L,(IX+-1)
011C5A 01 19 54 01         A  6120    	LD	BC,_linbuf
011C5E 09                  A  6121    	ADD	HL,BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 121


PC     Object              I  Line    Source C:\proted\Debug\main.src
011C5F DD2FF8              A  6122    	LD	(IX+-8),HL
011C62 DD07FC              A  6123    	LD	BC,(IX+-4)
011C65 2A 90 54 01         A  6124    	LD	HL,(_BufferFile)
011C69 09                  A  6125    	ADD	HL,BC
011C6A 7E                  A  6126    	LD	A,(HL)
011C6B DD27F8              A  6127    	LD	HL,(IX+-8)
011C6E 77                  A  6128    	LD	(HL),A
                           A  6129    ; 1465				
                           A  6130    ; 1466				if ((linbuf[pos] == EOL) ||
011C6F DD27F8              A  6131    	LD	HL,(IX+-8)
011C72 7E                  A  6132    	LD	A,(HL)
011C73 47                  A  6133    	LD	B,A
011C74 17ED62              A  6134    	SEXT	HL
011C77 68                  A  6135    	LD	L,B
011C78 B7                  A  6136    	OR	A,A
011C79 010A0000            A  6137    	LD	BC,10
011C7D ED42                A  6138    	SBC	HL,BC
011C7F 28 0E               A  6139    	JR	Z,L_341
011C81 DD07FC              A  6140    	LD	BC,(IX+-4)
011C84 2A 7E 54 01         A  6141    	LD	HL,(_filesize)
011C88 B7                  A  6142    	OR	A,A
011C89 ED42                A  6143    	SBC	HL,BC
011C8B C2 10 1D 01         A  6144    	JR	NZ,L_342
011C8F                     A  6145    L_341:
                           A  6146    ; 1467				{
                           A  6147    ; 1468					len = strlen(linbuf);
011C8F 01 19 54 01         A  6148    	LD	BC,_linbuf
011C93 C5                  A  6149    	PUSH	BC
011C94 CD 3B 24 01         A  6150    	CALL	_strlen
011C98 C1                  A  6151    	POP	BC
011C99 DD75FB              A  6152    	LD	(IX+-5),L
                           A  6153    ; 1469					
                           A  6154    ; 1470					if (linbuf[pos] == EOL)
011C9C DD7EFF              A  6155    	LD	A,(IX+-1)
011C9F 17ED62              A  6156    	SEXT	HL
011CA2 DD6EFF              A  6157    	LD	L,(IX+-1)
011CA5 01 19 54 01         A  6158    	LD	BC,_linbuf
011CA9 09                  A  6159    	ADD	HL,BC
011CAA 7E                  A  6160    	LD	A,(HL)
011CAB 47                  A  6161    	LD	B,A
011CAC 17ED62              A  6162    	SEXT	HL
011CAF 68                  A  6163    	LD	L,B
011CB0 B7                  A  6164    	OR	A,A
011CB1 010A0000            A  6165    	LD	BC,10
011CB5 ED42                A  6166    	SBC	HL,BC
011CB7 20 13               A  6167    	JR	NZ,L_338
                           A  6168    ; 1471						linbuf[len - 1] = E
011CB9 DD7EFB              A  6169    	LD	A,(IX+-5)
011CBC 17ED62              A  6170    	SEXT	HL
011CBF DD6EFB              A  6171    	LD	L,(IX+-5)
011CC2 2B                  A  6172    	DEC	HL
011CC3 01 19 54 01         A  6173    	LD	BC,_linbuf
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 122


PC     Object              I  Line    Source C:\proted\Debug\main.src
011CC7 09                  A  6174    	ADD	HL,BC
011CC8 3600                A  6175    	LD	(HL),0
                           A  6176    ; 1472					else
011CCA 18 11               A  6177    	JR	L_339
011CCC                     A  6178    L_338:
                           A  6179    ; 1473						linbuf[pos + 1] = E
011CCC DD7EFF              A  6180    	LD	A,(IX+-1)
011CCF 17ED62              A  6181    	SEXT	HL
011CD2 DD6EFF              A  6182    	LD	L,(IX+-1)
011CD5 23                  A  6183    	INC	HL
011CD6 01 19 54 01         A  6184    	LD	BC,_linbuf
011CDA 09                  A  6185    	ADD	HL,BC
011CDB 3600                A  6186    	LD	(HL),0
011CDD                     A  6187    L_339:
                           A  6188    ; 1474					
                           A  6189    ; 1475					purify(linbuf);
011CDD C5                  A  6190    	PUSH	BC
011CDE CD 51 05 01         A  6191    	CALL	_purify
011CE2 C1                  A  6192    	POP	BC
                           A  6193    ; 1476						
                           A  6194    ; 1477					tx_ins(p_root, linbuf);
011CE3 01 19 54 01         A  6195    	LD	BC,_linbuf
011CE7 C5                  A  6196    	PUSH	BC
011CE8 ED4B 04 54 01       A  6197    	LD	BC,(_p_root)
011CED C5                  A  6198    	PUSH	BC
011CEE CD A0 0A 01         A  6199    	CALL	_tx_ins
011CF2 C1                  A  6200    	POP	BC
011CF3 C1                  A  6201    	POP	BC
                           A  6202    ; 1478				
                           A  6203    ; 1479					pos = 0;
011CF4 DD36FF00            A  6204    	LD	(IX+-1),0
                           A  6205    ; 1480					memset(linbuf, 0, sizeo
011CF8 015A0000            A  6206    	LD	BC,90
011CFC C5                  A  6207    	PUSH	BC
011CFD 01000000            A  6208    	LD	BC,0
011D01 C5                  A  6209    	PUSH	BC
011D02 01 19 54 01         A  6210    	LD	BC,_linbuf
011D06 C5                  A  6211    	PUSH	BC
011D07 CD 3C 25 01         A  6212    	CALL	_memset
011D0B C1                  A  6213    	POP	BC
011D0C C1                  A  6214    	POP	BC
011D0D C1                  A  6215    	POP	BC
                           A  6216    ; 1481				}
                           A  6217    ; 1482				else
011D0E 18 03               A  6218    	JR	L_344
011D10                     A  6219    L_342:
                           A  6220    ; 1483					pos++;
011D10 DD34FF              A  6221    	INC	(IX+-1)
011D13                     A  6222    L_344:
                           A  6223    ; 1484				
                           A  6224    ; 1485				i++;
011D13 DD07FC              A  6225    	LD	BC,(IX+-4)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 123


PC     Object              I  Line    Source C:\proted\Debug\main.src
011D16 03                  A  6226    	INC	BC
011D17 DD0FFC              A  6227    	LD	(IX+-4),BC
                           A  6228    ; 1486			}
                           A  6229    ; 1487			else
011D1A 18 6D               A  6230    	JR	L_349
011D1C                     A  6231    L_348:
                           A  6232    ; 1488			{
                           A  6233    ; 1489				purify(linbuf);
011D1C 01 19 54 01         A  6234    	LD	BC,_linbuf
011D20 C5                  A  6235    	PUSH	BC
011D21 CD 51 05 01         A  6236    	CALL	_purify
011D25 C1                  A  6237    	POP	BC
                           A  6238    ; 1490				
                           A  6239    ; 1491				tx_ins(p_root, linbuf);
011D26 01 19 54 01         A  6240    	LD	BC,_linbuf
011D2A C5                  A  6241    	PUSH	BC
011D2B ED4B 04 54 01       A  6242    	LD	BC,(_p_root)
011D30 C5                  A  6243    	PUSH	BC
011D31 CD A0 0A 01         A  6244    	CALL	_tx_ins
011D35 C1                  A  6245    	POP	BC
011D36 C1                  A  6246    	POP	BC
                           A  6247    ; 1492				
                           A  6248    ; 1493				pos = 0;
011D37 DD36FF00            A  6249    	LD	(IX+-1),0
                           A  6250    ; 1494				memset(linbuf, 0, sizeof(li
011D3B 015A0000            A  6251    	LD	BC,90
011D3F C5                  A  6252    	PUSH	BC
011D40 01000000            A  6253    	LD	BC,0
011D44 C5                  A  6254    	PUSH	BC
011D45 01 19 54 01         A  6255    	LD	BC,_linbuf
011D49 C5                  A  6256    	PUSH	BC
011D4A CD 3C 25 01         A  6257    	CALL	_memset
011D4E C1                  A  6258    	POP	BC
011D4F C1                  A  6259    	POP	BC
011D50 C1                  A  6260    	POP	BC
                           A  6261    ; 1495				
                           A  6262    ; 1496				if ((BufferFile[i] == 0x0D)
011D51 DD07FC              A  6263    	LD	BC,(IX+-4)
011D54 2A 90 54 01         A  6264    	LD	HL,(_BufferFile)
011D58 09                  A  6265    	ADD	HL,BC
011D59 7E                  A  6266    	LD	A,(HL)
011D5A 47                  A  6267    	LD	B,A
011D5B 17ED62              A  6268    	SEXT	HL
011D5E 68                  A  6269    	LD	L,B
011D5F B7                  A  6270    	OR	A,A
011D60 010D0000            A  6271    	LD	BC,13
011D64 ED42                A  6272    	SBC	HL,BC
011D66 20 21               A  6273    	JR	NZ,L_349
011D68 DD07FC              A  6274    	LD	BC,(IX+-4)
011D6B 03                  A  6275    	INC	BC
011D6C 2A 90 54 01         A  6276    	LD	HL,(_BufferFile)
011D70 09                  A  6277    	ADD	HL,BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 124


PC     Object              I  Line    Source C:\proted\Debug\main.src
011D71 7E                  A  6278    	LD	A,(HL)
011D72 47                  A  6279    	LD	B,A
011D73 17ED62              A  6280    	SEXT	HL
011D76 68                  A  6281    	LD	L,B
011D77 B7                  A  6282    	OR	A,A
011D78 010A0000            A  6283    	LD	BC,10
011D7C ED42                A  6284    	SBC	HL,BC
011D7E 20 09               A  6285    	JR	NZ,L_349
                           A  6286    ; 1497					i += 2;
011D80 DD31FC              A  6287    	LD	IY,(IX+-4)
011D83 ED3302              A  6288    	LEA	IY,IY+2
011D86 DD3EFC              A  6289    	LD	(IX+-4),IY
                           A  6290    ; 1498			}
                           A  6291    ; 1499		}	
011D89                     A  6292    L_349:
011D89 DD07FC              A  6293    	LD	BC,(IX+-4)
011D8C 2A 7E 54 01         A  6294    	LD	HL,(_filesize)
011D90 B7                  A  6295    	OR	A,A
011D91 ED42                A  6296    	SBC	HL,BC
011D93 D2 3E 1C 01         A  6297    	JR	NC,L_350
                           A  6298    ; 1500		
                           A  6299    ; 1501		asm ("jp f_end");
011D97 C3 AF 1D 01         A  6300    jp f_end
                           A  6301    ; 1502		
                           A  6302    ; 1503		asm ("LoadError:");
011D9B                     A  6303    LoadError:
                           A  6304    ; 1504		msg_window("Loading file", "File er
011D9B 01 4A 2A 01         A  6305    	LD	BC,L__270
011D9F C5                  A  6306    	PUSH	BC
011DA0 01 56 2A 01         A  6307    	LD	BC,L__271
011DA4 C5                  A  6308    	PUSH	BC
011DA5 CD 97 1F 01         A  6309    	CALL	_msg_window
011DA9 C1                  A  6310    	POP	BC
011DAA C1                  A  6311    	POP	BC
                           A  6312    ; 1505		getch();	
011DAB CD 25 01 01         A  6313    	CALL	_getch
                           A  6314    ; 1506		
                           A  6315    ; 1507		asm ("f_end:");
011DAF                     A  6316    f_end:
                           A  6317    ; 1508		
                           A  6318    ; 1509		close_msg_window();
011DAF CD BB 21 01         A  6319    	CALL	_close_msg_window
                           A  6320    ; 1510	}
011DB3 DDF9                A  6321    	LD	SP,IX
011DB5 DDE1                A  6322    	POP	IX
011DB7 C9                  A  6323    	RET	
                           A  6324    
                           A  6325    
                           A  6326    ;**************************** _load_file ******
                           A  6327    ;Name                         Addr/Register   S
                           A  6328    ;_close_msg_window                   IMPORT  --
                           A  6329    ;_getch                              IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 125


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  6330    ;_p_root                             STATIC    
                           A  6331    ;_tx_ins                             IMPORT  --
                           A  6332    ;_purify                             IMPORT  --
                           A  6333    ;_strlen                             IMPORT  --
                           A  6334    ;_filesize                           STATIC    
                           A  6335    ;_BufferFile                         STATIC    
                           A  6336    ;_linbuf                             STATIC    
                           A  6337    ;_memset                             IMPORT  --
                           A  6338    ;_msg_window                         IMPORT  --
                           A  6339    ;len                                   IX-5    
                           A  6340    ;i                                     IX-4    
                           A  6341    ;pos                                   IX-1    
                           A  6342    
                           A  6343    
                           A  6344    ; Stack Frame Size: 14 (bytes)
                           A  6345    ;       Spill Code: 0 (instruction)
                           A  6346    
                           A  6347    
                           A  6348    	SEGMENT STRSECT
012A2E                     A  6349    L__261:
012A2E 506C6561 73652077   A  6350    	DB	"Please wait..."
012A36 6169742E 2E2E 
012A3C 00                  A  6351    	DB	0
012A3D                     A  6352    L__262:
012A3D 4C6F6164 696E6720   A  6353    	DB	"Loading file"
012A45 66696C65 
012A49 00                  A  6354    	DB	0
012A4A                     A  6355    L__270:
012A4A 46696C65 20657272   A  6356    	DB	"File error!"
012A52 6F7221 
012A55 00                  A  6357    	DB	0
012A56                     A  6358    L__271:
012A56 4C6F6164 696E6720   A  6359    	DB	"Loading file"
012A5E 66696C65 
012A62 00                  A  6360    	DB	0
                           A  6361    	SEGMENT CODE
                           A  6362    ; 1511	
                           A  6363    ; 1512	/* From text list create the file into 
                           A  6364    ; 1513	void save_file(void)
                           A  6365    ; 1514	{
011DB8                     A  6366    _save_file:
011DB8 21FAFFFF            A  6367    	LD	HL,-6
011DBC CD 7E 24 01         A  6368    	CALL	__frameset
                           A  6369    ; 1515		p_line_t p_line = p_root->p_next;
011DC0 FD2A 04 54 01       A  6370    	LD	IY,(_p_root)
011DC5 FD0703              A  6371    	LD	BC,(IY+3)
011DC8 DD0FFD              A  6372    	LD	(IX+-3),BC
                           A  6373    ; 1516		int slen;	
                           A  6374    ; 1517		
                           A  6375    ; 1518		
                           A  6376    ; 1519		if (UseFile == 0)
011DCB 3A 84 54 01         A  6377    	LD	A,(_UseFile)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 126


PC     Object              I  Line    Source C:\proted\Debug\main.src
011DCF B7                  A  6378    	OR	A,A
011DD0 20 1B               A  6379    	JR	NZ,L_354
                           A  6380    ; 1520		{
                           A  6381    ; 1521			asm ("ld hl, (_NonameFile)");
011DD2 2A 93 54 01         A  6382    ld hl, (_NonameFile)
                           A  6383    ; 1522			asm ("ld (_K_xHL), hl");
011DD6 22 78 54 01         A  6384    ld (_K_xHL), hl
                           A  6385    ; 1523			
                           A  6386    ; 1524			msg_window("Please wait, saving
011DDA ED4B 93 54 01       A  6387    	LD	BC,(_NonameFile)
011DDF C5                  A  6388    	PUSH	BC
011DE0 01 63 2A 01         A  6389    	LD	BC,L__276
011DE4 C5                  A  6390    	PUSH	BC
011DE5 CD 97 1F 01         A  6391    	CALL	_msg_window
011DE9 C1                  A  6392    	POP	BC
011DEA C1                  A  6393    	POP	BC
                           A  6394    ; 1525		}
                           A  6395    ; 1526		else
011DEB 18 10               A  6396    	JR	L_355
011DED                     A  6397    L_354:
                           A  6398    ; 1527			msg_window("Saving file", "Plea
011DED 01 77 2A 01         A  6399    	LD	BC,L__277
011DF1 C5                  A  6400    	PUSH	BC
011DF2 01 86 2A 01         A  6401    	LD	BC,L__278
011DF6 C5                  A  6402    	PUSH	BC
011DF7 CD 97 1F 01         A  6403    	CALL	_msg_window
011DFB C1                  A  6404    	POP	BC
011DFC C1                  A  6405    	POP	BC
011DFD                     A  6406    L_355:
                           A  6407    ; 1528		
                           A  6408    ; 1529		asm ("push ix");
011DFD DDE5                A  6409    push ix
                           A  6410    ; 1530		asm ("ld hl, (_K_xHL)");
011DFF 2A 78 54 01         A  6411    ld hl, (_K_xHL)
                           A  6412    ; 1531		asm ("ld a, kr_erase_file");
011E03 3E0F                A  6413    ld a, kr_erase_file
                           A  6414    ; 1532		asm ("call.lil prose_kernal");
011E05 5BCD200A 00         A  6415    call.lil prose_kernal
                           A  6416    ; 1533		asm ("pop ix");	
011E0A DDE1                A  6417    pop ix
                           A  6418    ; 1534		
                           A  6419    ; 1535		asm ("push ix");
011E0C DDE5                A  6420    push ix
                           A  6421    ; 1536		asm ("ld hl, (_K_xHL)");
011E0E 2A 78 54 01         A  6422    ld hl, (_K_xHL)
                           A  6423    ; 1537		asm ("ld a, kr_create_file");
011E12 3E11                A  6424    ld a, kr_create_file
                           A  6425    ; 1538		asm ("call.lil prose_kernal");
011E14 5BCD200A 00         A  6426    call.lil prose_kernal
                           A  6427    ; 1539		asm ("pop ix");
011E19 DDE1                A  6428    pop ix
                           A  6429    ; 1540		asm ("jr nz, SaveError");	
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 127


PC     Object              I  Line    Source C:\proted\Debug\main.src
011E1B C2 D3 1E 01         A  6430    jr nz, SaveError
                           A  6431    ; 1541		
                           A  6432    ; 1542		filesize = 0;	
011E1F 01000000            A  6433    	LD	BC,0
011E23 ED43 7E 54 01       A  6434    	LD	(_filesize),BC
                           A  6435    ; 1543		
                           A  6436    ; 1544		while (p_line != p_root)
011E28 18 73               A  6437    	JR	L_358
011E2A                     A  6438    L_359:
                           A  6439    ; 1545		{
                           A  6440    ; 1546			slen = strlen(p_line->p_data);
011E2A DD31FD              A  6441    	LD	IY,(IX+-3)
011E2D FD0706              A  6442    	LD	BC,(IY+6)
011E30 C5                  A  6443    	PUSH	BC
011E31 CD 3B 24 01         A  6444    	CALL	_strlen
011E35 C1                  A  6445    	POP	BC
011E36 DD2FFA              A  6446    	LD	(IX+-6),HL
                           A  6447    ; 1547			
                           A  6448    ; 1548			if (slen > 0)
011E39 E5C1                A  6449    	LD	BC,HL
011E3B B7                  A  6450    	OR	A,A
011E3C ED62                A  6451    	SBC	HL,HL
011E3E B7                  A  6452    	OR	A,A
011E3F ED42                A  6453    	SBC	HL,BC
011E41 F2 62 1E 01         A  6454    	JP	P,L_357
                           A  6455    ; 1549				memmove(BufferFile + filesi
011E45 DD07FA              A  6456    	LD	BC,(IX+-6)
011E48 C5                  A  6457    	PUSH	BC
011E49 DD31FD              A  6458    	LD	IY,(IX+-3)
011E4C FD0706              A  6459    	LD	BC,(IY+6)
011E4F C5                  A  6460    	PUSH	BC
011E50 ED4B 7E 54 01       A  6461    	LD	BC,(_filesize)
011E55 2A 90 54 01         A  6462    	LD	HL,(_BufferFile)
011E59 09                  A  6463    	ADD	HL,BC
011E5A E5                  A  6464    	PUSH	HL
011E5B CD 5D 25 01         A  6465    	CALL	_memmove
011E5F C1                  A  6466    	POP	BC
011E60 C1                  A  6467    	POP	BC
011E61 C1                  A  6468    	POP	BC
011E62                     A  6469    L_357:
                           A  6470    ; 1550			
                           A  6471    ; 1551			filesize += slen;
011E62 DD07FA              A  6472    	LD	BC,(IX+-6)
011E65 2A 7E 54 01         A  6473    	LD	HL,(_filesize)
011E69 09                  A  6474    	ADD	HL,BC
011E6A 22 7E 54 01         A  6475    	LD	(_filesize),HL
                           A  6476    ; 1552			
                           A  6477    ; 1553			BufferFile[filesize] = 0x0D;
011E6E ED4B 7E 54 01       A  6478    	LD	BC,(_filesize)
011E73 2A 90 54 01         A  6479    	LD	HL,(_BufferFile)
011E77 09                  A  6480    	ADD	HL,BC
011E78 360D                A  6481    	LD	(HL),13
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 128


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  6482    ; 1554			BufferFile[filesize + 1] = 0x0A
011E7A ED4B 7E 54 01       A  6483    	LD	BC,(_filesize)
011E7F 03                  A  6484    	INC	BC
011E80 2A 90 54 01         A  6485    	LD	HL,(_BufferFile)
011E84 09                  A  6486    	ADD	HL,BC
011E85 360A                A  6487    	LD	(HL),10
                           A  6488    ; 1555			
                           A  6489    ; 1556			filesize += 2;
011E87 FD2A 7E 54 01       A  6490    	LD	IY,(_filesize)
011E8C ED0302              A  6491    	LEA	BC,IY+2
011E8F ED43 7E 54 01       A  6492    	LD	(_filesize),BC
                           A  6493    ; 1557			
                           A  6494    ; 1558			p_line = p_line->p_next;
011E94 DD31FD              A  6495    	LD	IY,(IX+-3)
011E97 FD0703              A  6496    	LD	BC,(IY+3)
011E9A DD0FFD              A  6497    	LD	(IX+-3),BC
                           A  6498    ; 1559		}
011E9D                     A  6499    L_358:
011E9D DD07FD              A  6500    	LD	BC,(IX+-3)
011EA0 2A 04 54 01         A  6501    	LD	HL,(_p_root)
011EA4 B7                  A  6502    	OR	A,A
011EA5 ED42                A  6503    	SBC	HL,BC
011EA7 20 81               A  6504    	JR	NZ,L_359
                           A  6505    ; 1560		
                           A  6506    ; 1561		filesize -= 2;
011EA9 FD2A 7E 54 01       A  6507    	LD	IY,(_filesize)
011EAE ED03FE              A  6508    	LEA	BC,IY+-2
011EB1 ED43 7E 54 01       A  6509    	LD	(_filesize),BC
                           A  6510    ; 1562		
                           A  6511    ; 1563		asm ("push ix");
011EB6 DDE5                A  6512    push ix
                           A  6513    ; 1564		asm ("ld hl, (_K_xHL)");
011EB8 2A 78 54 01         A  6514    ld hl, (_K_xHL)
                           A  6515    ; 1565		asm ("ld de, (_BufferFile)");
011EBC ED5B 90 54 01       A  6516    ld de, (_BufferFile)
                           A  6517    ; 1566		asm ("ld bc, (_filesize)");
011EC1 ED4B 7E 54 01       A  6518    ld bc, (_filesize)
                           A  6519    ; 1567		asm ("ld a, kr_write_file");
011EC6 3E12                A  6520    ld a, kr_write_file
                           A  6521    ; 1568		asm ("call.lil prose_kernal");
011EC8 5BCD200A 00         A  6522    call.lil prose_kernal
                           A  6523    ; 1569		asm ("pop ix");	
011ECD DDE1                A  6524    pop ix
                           A  6525    ; 1570		
                           A  6526    ; 1571		asm ("jp s_end");
011ECF C3 E7 1E 01         A  6527    jp s_end
                           A  6528    ; 1572		
                           A  6529    ; 1573		asm ("SaveError:");
011ED3                     A  6530    SaveError:
                           A  6531    ; 1574		msg_window("Saving file", "File err
011ED3 01 92 2A 01         A  6532    	LD	BC,L__281
011ED7 C5                  A  6533    	PUSH	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 129


PC     Object              I  Line    Source C:\proted\Debug\main.src
011ED8 01 9E 2A 01         A  6534    	LD	BC,L__282
011EDC C5                  A  6535    	PUSH	BC
011EDD CD 97 1F 01         A  6536    	CALL	_msg_window
011EE1 C1                  A  6537    	POP	BC
011EE2 C1                  A  6538    	POP	BC
                           A  6539    ; 1575		getch();	
011EE3 CD 25 01 01         A  6540    	CALL	_getch
                           A  6541    ; 1576		
                           A  6542    ; 1577		asm ("s_end:");
011EE7                     A  6543    s_end:
                           A  6544    ; 1578		close_msg_window();
011EE7 CD BB 21 01         A  6545    	CALL	_close_msg_window
                           A  6546    ; 1579	}
011EEB DDF9                A  6547    	LD	SP,IX
011EED DDE1                A  6548    	POP	IX
011EEF C9                  A  6549    	RET	
                           A  6550    
                           A  6551    
                           A  6552    ;**************************** _save_file ******
                           A  6553    ;Name                         Addr/Register   S
                           A  6554    ;_close_msg_window                   IMPORT  --
                           A  6555    ;_getch                              IMPORT  --
                           A  6556    ;_BufferFile                         STATIC    
                           A  6557    ;_memmove                            IMPORT  --
                           A  6558    ;_strlen                             IMPORT  --
                           A  6559    ;_filesize                           STATIC    
                           A  6560    ;_NonameFile                         STATIC    
                           A  6561    ;_msg_window                         IMPORT  --
                           A  6562    ;_UseFile                            STATIC    
                           A  6563    ;_p_root                             STATIC    
                           A  6564    ;slen                                  IX-6    
                           A  6565    ;p_line                                IX-3    
                           A  6566    
                           A  6567    
                           A  6568    ; Stack Frame Size: 12 (bytes)
                           A  6569    ;       Spill Code: 0 (instruction)
                           A  6570    
                           A  6571    
                           A  6572    	SEGMENT STRSECT
012A63                     A  6573    L__276:
012A63 506C6561 73652077   A  6574    	DB	"Please wait, saving"
012A6B 6169742C 20736176 
012A73 696E67 
012A76 00                  A  6575    	DB	0
012A77                     A  6576    L__277:
012A77 506C6561 73652077   A  6577    	DB	"Please wait..."
012A7F 6169742E 2E2E 
012A85 00                  A  6578    	DB	0
012A86                     A  6579    L__278:
012A86 53617669 6E672066   A  6580    	DB	"Saving file"
012A8E 696C65 
012A91 00                  A  6581    	DB	0
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 130


PC     Object              I  Line    Source C:\proted\Debug\main.src
012A92                     A  6582    L__281:
012A92 46696C65 20657272   A  6583    	DB	"File error!"
012A9A 6F7221 
012A9D 00                  A  6584    	DB	0
012A9E                     A  6585    L__282:
012A9E 53617669 6E672066   A  6586    	DB	"Saving file"
012AA6 696C65 
012AA9 00                  A  6587    	DB	0
                           A  6588    	SEGMENT CODE
                           A  6589    ; 1580	
                           A  6590    ; 1581	/* Reload the file if exist */
                           A  6591    ; 1582	void reload_file(void)
                           A  6592    ; 1583	{
011EF0                     A  6593    _reload_file:
                           A  6594    ; 1584		if (UseFile == 1)
011EF0 3A 84 54 01         A  6595    	LD	A,(_UseFile)
011EF4 FE01                A  6596    	CP	A,1
011EF6 C2 96 1F 01         A  6597    	JR	NZ,L_367
                           A  6598    ; 1585			if (FileExists() == 1)
011EFA CD 98 1B 01         A  6599    	CALL	_FileExists
011EFE 47                  A  6600    	LD	B,A
011EFF 17ED62              A  6601    	SEXT	HL
011F02 68                  A  6602    	LD	L,B
011F03 B7                  A  6603    	OR	A,A
011F04 01010000            A  6604    	LD	BC,1
011F08 ED42                A  6605    	SBC	HL,BC
011F0A C2 96 1F 01         A  6606    	JR	NZ,L_367
                           A  6607    ; 1586			{
                           A  6608    ; 1587				msg_window("Reload file ?",
011F0E 01 AA 2A 01         A  6609    	LD	BC,L__286
011F12 C5                  A  6610    	PUSH	BC
011F13 01 AE 2A 01         A  6611    	LD	BC,L__287
011F17 C5                  A  6612    	PUSH	BC
011F18 CD 97 1F 01         A  6613    	CALL	_msg_window
011F1C C1                  A  6614    	POP	BC
011F1D C1                  A  6615    	POP	BC
                           A  6616    ; 1588				getch();
011F1E CD 25 01 01         A  6617    	CALL	_getch
                           A  6618    ; 1589				close_msg_window();
011F22 CD BB 21 01         A  6619    	CALL	_close_msg_window
                           A  6620    ; 1590				
                           A  6621    ; 1591				if ((Ascii != 89) && (Ascii
011F26 3A 73 54 01         A  6622    	LD	A,(_Ascii)
011F2A FE59                A  6623    	CP	A,89
011F2C 28 08               A  6624    	JR	Z,L_364
011F2E 3A 73 54 01         A  6625    	LD	A,(_Ascii)
011F32 FE79                A  6626    	CP	A,121
011F34 20 60               A  6627    	JR	NZ,L_367
                           A  6628    ; 1592					return;
011F36                     A  6629    L_364:
                           A  6630    ; 1593				
                           A  6631    ; 1594				sc_fin();
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 131


PC     Object              I  Line    Source C:\proted\Debug\main.src
011F36 CD C6 09 01         A  6632    	CALL	_sc_fin
                           A  6633    ; 1595				te_fin();
011F3A CD 56 07 01         A  6634    	CALL	_te_fin
                           A  6635    ; 1596				
                           A  6636    ; 1597				memset(BufferFile, 0, 1024 
011F3E 01000008            A  6637    	LD	BC,524288
011F42 C5                  A  6638    	PUSH	BC
011F43 01000000            A  6639    	LD	BC,0
011F47 C5                  A  6640    	PUSH	BC
011F48 ED4B 90 54 01       A  6641    	LD	BC,(_BufferFile)
011F4D C5                  A  6642    	PUSH	BC
011F4E CD 3C 25 01         A  6643    	CALL	_memset
011F52 C1                  A  6644    	POP	BC
011F53 C1                  A  6645    	POP	BC
011F54 C1                  A  6646    	POP	BC
                           A  6647    ; 1598				
                           A  6648    ; 1599				te_ini();
011F55 CD 4C 07 01         A  6649    	CALL	_te_ini
                           A  6650    ; 1600				sc_ini();
011F59 CD BD 09 01         A  6651    	CALL	_sc_ini
                           A  6652    ; 1601				tx_ini();			
011F5D CD CF 09 01         A  6653    	CALL	_tx_ini
                           A  6654    ; 1602				
                           A  6655    ; 1603				load_file();
011F61 CD C1 1B 01         A  6656    	CALL	_load_file
                           A  6657    ; 1604				
                           A  6658    ; 1605				cur_row = 0;
011F65 01000000            A  6659    	LD	BC,0
011F69 ED43 13 54 01       A  6660    	LD	(_cur_row),BC
                           A  6661    ; 1606				cur_col = 0;
011F6E ED43 16 54 01       A  6662    	LD	(_cur_col),BC
                           A  6663    ; 1607				cur_line = 1;
011F73 01010000            A  6664    	LD	BC,1
011F77 ED43 0D 54 01       A  6665    	LD	(_cur_line),BC
                           A  6666    ; 1608				cur_char = 1;
011F7C ED43 10 54 01       A  6667    	LD	(_cur_char),BC
                           A  6668    ; 1609				p_curr = p_root->p_next;	011F81 FD2A 04 54 01       A  6669    	LD	IY,(_p_root)
011F86 FD0703              A  6670    	LD	BC,(IY+3)
011F89 ED43 07 54 01       A  6671    	LD	(_p_curr),BC
                           A  6672    ; 1610		
                           A  6673    ; 1611				paintall();
011F8E CD 6F 16 01         A  6674    	CALL	_paintall
                           A  6675    ; 1612		
                           A  6676    ; 1613				sc_fup();
011F92 CD A2 09 01         A  6677    	CALL	_sc_fup
                           A  6678    ; 1614			}
                           A  6679    ; 1615	}
011F96                     A  6680    L_367:
011F96 C9                  A  6681    	RET	
                           A  6682    
                           A  6683    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 132


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  6684    ;**************************** _reload_file ****
                           A  6685    ;Name                         Addr/Register   S
                           A  6686    ;_sc_fup                             IMPORT  --
                           A  6687    ;_paintall                           IMPORT  --
                           A  6688    ;_p_curr                             STATIC    
                           A  6689    ;_p_root                             STATIC    
                           A  6690    ;_cur_char                           STATIC    
                           A  6691    ;_cur_line                           STATIC    
                           A  6692    ;_cur_col                            STATIC    
                           A  6693    ;_cur_row                            STATIC    
                           A  6694    ;_load_file                          IMPORT  --
                           A  6695    ;_tx_ini                             IMPORT  --
                           A  6696    ;_sc_ini                             IMPORT  --
                           A  6697    ;_te_ini                             IMPORT  --
                           A  6698    ;_BufferFile                         STATIC    
                           A  6699    ;_memset                             IMPORT  --
                           A  6700    ;_te_fin                             IMPORT  --
                           A  6701    ;_sc_fin                             IMPORT  --
                           A  6702    ;_Ascii                              STATIC    
                           A  6703    ;_close_msg_window                   IMPORT  --
                           A  6704    ;_getch                              IMPORT  --
                           A  6705    ;_msg_window                         IMPORT  --
                           A  6706    ;_FileExists                         IMPORT  --
                           A  6707    ;_UseFile                            STATIC    
                           A  6708    
                           A  6709    
                           A  6710    ; Stack Frame Size: 6 (bytes)
                           A  6711    ;       Spill Code: 0 (instruction)
                           A  6712    
                           A  6713    
                           A  6714    	SEGMENT STRSECT
012AAA                     A  6715    L__286:
012AAA 592F6E              A  6716    	DB	"Y/n"
012AAD 00                  A  6717    	DB	0
012AAE                     A  6718    L__287:
012AAE 52656C6F 61642066   A  6719    	DB	"Reload file ?"
012AB6 696C6520 3F 
012ABB 00                  A  6720    	DB	0
                           A  6721    	SEGMENT CODE
                           A  6722    ; 1616	
                           A  6723    ; 1617	/* Draw on screen the message box width
                           A  6724    ; 1618	void msg_window(char *msg1, char *msg2)
                           A  6725    ; 1619	{
011F97                     A  6726    _msg_window:
011F97 21FCFFFF            A  6727    	LD	HL,-4
011F9B CD 7E 24 01         A  6728    	CALL	__frameset
                           A  6729    ; 1620		char r, c, len, posx;
                           A  6730    ; 1621	
                           A  6731    ; 1622		memset(backbuffer, 0, sizeof(backbu
011F9F 01400100            A  6732    	LD	BC,320
011FA3 C5                  A  6733    	PUSH	BC
011FA4 01000000            A  6734    	LD	BC,0
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 133


PC     Object              I  Line    Source C:\proted\Debug\main.src
011FA8 C5                  A  6735    	PUSH	BC
011FA9 01 BB 52 01         A  6736    	LD	BC,_backbuffer
011FAD C5                  A  6737    	PUSH	BC
011FAE CD 3C 25 01         A  6738    	CALL	_memset
011FB2 C1                  A  6739    	POP	BC
011FB3 C1                  A  6740    	POP	BC
011FB4 C1                  A  6741    	POP	BC
011FB5 DD36FE00            A  6742    	LD	(IX+-2),0
                           A  6743    ; 1623		
                           A  6744    ; 1624		for (r = 0; r < 4; r++)
011FB9 18 74               A  6745    	JR	L_375
011FBB                     A  6746    L_373:
011FBB DD36FF00            A  6747    	LD	(IX+-1),0
                           A  6748    ; 1625			for (c = 0; c < SCNCOLS; c++)
011FBF 18 58               A  6749    	JR	L_372
011FC1                     A  6750    L_370:
                           A  6751    ; 1626				backbuffer[r][c] = scn_phys
011FC1 DD7EFE              A  6752    	LD	A,(IX+-2)
011FC4 17ED62              A  6753    	SEXT	HL
011FC7 DD6EFE              A  6754    	LD	L,(IX+-2)
011FCA E5FDE1              A  6755    	LD	IY,HL
011FCD ED0317              A  6756    	LEA	BC,IY+23
011FD0 C5E1                A  6757    	LD	HL,BC
011FD2 29                  A  6758    	ADD	HL,HL
011FD3 29                  A  6759    	ADD	HL,HL
011FD4 09                  A  6760    	ADD	HL,BC
011FD5 29                  A  6761    	ADD	HL,HL
011FD6 29                  A  6762    	ADD	HL,HL
011FD7 29                  A  6763    	ADD	HL,HL
011FD8 29                  A  6764    	ADD	HL,HL
011FD9 DD7EFF              A  6765    	LD	A,(IX+-1)
011FDC 01 1B 43 01         A  6766    	LD	BC,_scn_phys
011FE0 09                  A  6767    	ADD	HL,BC
011FE1 E5C1                A  6768    	LD	BC,HL
011FE3 17ED62              A  6769    	SEXT	HL
011FE6 DD6EFF              A  6770    	LD	L,(IX+-1)
011FE9 DD7EFE              A  6771    	LD	A,(IX+-2)
011FEC 09                  A  6772    	ADD	HL,BC
011FED E5FDE1              A  6773    	LD	IY,HL
011FF0 17ED62              A  6774    	SEXT	HL
011FF3 DD6EFE              A  6775    	LD	L,(IX+-2)
011FF6 DD7EFF              A  6776    	LD	A,(IX+-1)
011FF9 E5C1                A  6777    	LD	BC,HL
011FFB C5E1                A  6778    	LD	HL,BC
011FFD 29                  A  6779    	ADD	HL,HL
011FFE 29                  A  6780    	ADD	HL,HL
011FFF 09                  A  6781    	ADD	HL,BC
012000 29                  A  6782    	ADD	HL,HL
012001 29                  A  6783    	ADD	HL,HL
012002 29                  A  6784    	ADD	HL,HL
012003 29                  A  6785    	ADD	HL,HL
012004 01 BB 52 01         A  6786    	LD	BC,_backbuffer
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 134


PC     Object              I  Line    Source C:\proted\Debug\main.src
012008 09                  A  6787    	ADD	HL,BC
012009 E5C1                A  6788    	LD	BC,HL
01200B 17ED62              A  6789    	SEXT	HL
01200E DD6EFF              A  6790    	LD	L,(IX+-1)
012011 FD7E00              A  6791    	LD	A,(IY)
012014 09                  A  6792    	ADD	HL,BC
012015 77                  A  6793    	LD	(HL),A
012016 DD34FF              A  6794    	INC	(IX+-1)
012019                     A  6795    L_372:
012019 DD7EFF              A  6796    	LD	A,(IX+-1)
01201C FE50                A  6797    	CP	A,80
01201E FA 28 20 01         A  6798    	JP	M,L__307
012022 EA C1 1F 01         A  6799    	JP	PE,L_370
012026 18 04               A  6800    	JR	L__308
012028                     A  6801    L__307:
012028 E2 C1 1F 01         A  6802    	JP	PO,L_370
01202C                     A  6803    L__308:
01202C DD34FE              A  6804    	INC	(IX+-2)
01202F                     A  6805    L_375:
01202F DD7EFE              A  6806    	LD	A,(IX+-2)
012032 FE04                A  6807    	CP	A,4
012034 FA 3E 20 01         A  6808    	JP	M,L__309
012038 EA BB 1F 01         A  6809    	JP	PE,L_373
01203C 18 04               A  6810    	JR	L__310
01203E                     A  6811    L__309:
01203E E2 BB 1F 01         A  6812    	JP	PO,L_373
012042                     A  6813    L__310:
                           A  6814    ; 1627		
                           A  6815    ; 1628		Enable_Back_Color();
012042 CD B3 18 01         A  6816    	CALL	_Enable_Back_Color
                           A  6817    ; 1629		
                           A  6818    ; 1630		gotoxy(0, 23);
012046 01170000            A  6819    	LD	BC,23
01204A C5                  A  6820    	PUSH	BC
01204B 01000000            A  6821    	LD	BC,0
01204F C5                  A  6822    	PUSH	BC
012050 CD 19 03 01         A  6823    	CALL	_gotoxy
012054 C1                  A  6824    	POP	BC
012055 C1                  A  6825    	POP	BC
                           A  6826    ; 1631			
                           A  6827    ; 1632		len = strlen(msg1);
012056 DD0706              A  6828    	LD	BC,(IX+6)
012059 C5                  A  6829    	PUSH	BC
01205A CD 3B 24 01         A  6830    	CALL	_strlen
01205E C1                  A  6831    	POP	BC
01205F DD75FD              A  6832    	LD	(IX+-3),L
                           A  6833    ; 1633		posx = 40 - (len / 2);
012062 DD7EFD              A  6834    	LD	A,(IX+-3)
012065 17ED62              A  6835    	SEXT	HL
012068 DD6EFD              A  6836    	LD	L,(IX+-3)
01206B 01020000            A  6837    	LD	BC,2
01206F CD E9 24 01         A  6838    	CALL	__idivs
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 135


PC     Object              I  Line    Source C:\proted\Debug\main.src
012073 3E28                A  6839    	LD	A,40
012075 95                  A  6840    	SUB	A,L
012076 DD77FC              A  6841    	LD	(IX+-4),A
                           A  6842    ; 1634		
                           A  6843    ; 1635		print("+===========================
012079 01 BC 2A 01         A  6844    	LD	BC,L__293
01207D C5                  A  6845    	PUSH	BC
01207E CD 50 02 01         A  6846    	CALL	_print
012082 C1                  A  6847    	POP	BC
                           A  6848    ; 1636		print("|");
012083 01 0D 2B 01         A  6849    	LD	BC,L__294
012087 C5                  A  6850    	PUSH	BC
012088 CD 50 02 01         A  6851    	CALL	_print
01208C C1                  A  6852    	POP	BC
01208D DD36FF01            A  6853    	LD	(IX+-1),1
                           A  6854    ; 1637		
                           A  6855    ; 1638		for (c = 1; c < posx - 1; c++)
012091 18 0D               A  6856    	JR	L_380
012093                     A  6857    L_378:
                           A  6858    ; 1639			print(" ");
012093 01 0F 2B 01         A  6859    	LD	BC,L__295
012097 C5                  A  6860    	PUSH	BC
012098 CD 50 02 01         A  6861    	CALL	_print
01209C C1                  A  6862    	POP	BC
01209D DD34FF              A  6863    	INC	(IX+-1)
0120A0                     A  6864    L_380:
0120A0 DD7EFC              A  6865    	LD	A,(IX+-4)
0120A3 17ED62              A  6866    	SEXT	HL
0120A6 DD6EFC              A  6867    	LD	L,(IX+-4)
0120A9 E5C1                A  6868    	LD	BC,HL
0120AB 0B                  A  6869    	DEC	BC
0120AC DD7EFF              A  6870    	LD	A,(IX+-1)
0120AF 17ED62              A  6871    	SEXT	HL
0120B2 DD6EFF              A  6872    	LD	L,(IX+-1)
0120B5 B7                  A  6873    	OR	A,A
0120B6 ED42                A  6874    	SBC	HL,BC
0120B8 FA C2 20 01         A  6875    	JP	M,L__311
0120BC EA 93 20 01         A  6876    	JP	PE,L_378
0120C0 18 04               A  6877    	JR	L__312
0120C2                     A  6878    L__311:
0120C2 E2 93 20 01         A  6879    	JP	PO,L_378
0120C6                     A  6880    L__312:
                           A  6881    ; 1640		
                           A  6882    ; 1641		print(msg1);
0120C6 DD0706              A  6883    	LD	BC,(IX+6)
0120C9 C5                  A  6884    	PUSH	BC
0120CA CD 50 02 01         A  6885    	CALL	_print
0120CE C1                  A  6886    	POP	BC
0120CF DD7EFF              A  6887    	LD	A,(IX+-1)
0120D2 DD86FD              A  6888    	ADD	A,(IX+-3)
0120D5 DD77FE              A  6889    	LD	(IX+-2),A
                           A  6890    ; 1642		
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 136


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  6891    ; 1643		for (r = c + len; r < SCNCOLS - 1; 
0120D8 18 0D               A  6892    	JR	L_385
0120DA                     A  6893    L_383:
                           A  6894    ; 1644			print(" ");
0120DA 01 11 2B 01         A  6895    	LD	BC,L__297
0120DE C5                  A  6896    	PUSH	BC
0120DF CD 50 02 01         A  6897    	CALL	_print
0120E3 C1                  A  6898    	POP	BC
0120E4 DD34FE              A  6899    	INC	(IX+-2)
0120E7                     A  6900    L_385:
0120E7 DD7EFE              A  6901    	LD	A,(IX+-2)
0120EA FE4F                A  6902    	CP	A,79
0120EC FA F6 20 01         A  6903    	JP	M,L__313
0120F0 EA DA 20 01         A  6904    	JP	PE,L_383
0120F4 18 04               A  6905    	JR	L__314
0120F6                     A  6906    L__313:
0120F6 E2 DA 20 01         A  6907    	JP	PO,L_383
0120FA                     A  6908    L__314:
                           A  6909    ; 1645		
                           A  6910    ; 1646		print("|");
0120FA 01 13 2B 01         A  6911    	LD	BC,L__299
0120FE C5                  A  6912    	PUSH	BC
0120FF CD 50 02 01         A  6913    	CALL	_print
012103 C1                  A  6914    	POP	BC
                           A  6915    ; 1647		
                           A  6916    ; 1648		len = strlen(msg2);
012104 DD0709              A  6917    	LD	BC,(IX+9)
012107 C5                  A  6918    	PUSH	BC
012108 CD 3B 24 01         A  6919    	CALL	_strlen
01210C C1                  A  6920    	POP	BC
01210D DD75FD              A  6921    	LD	(IX+-3),L
                           A  6922    ; 1649		posx = 40 - (len / 2);
012110 DD7EFD              A  6923    	LD	A,(IX+-3)
012113 17ED62              A  6924    	SEXT	HL
012116 DD6EFD              A  6925    	LD	L,(IX+-3)
012119 01020000            A  6926    	LD	BC,2
01211D CD E9 24 01         A  6927    	CALL	__idivs
012121 3E28                A  6928    	LD	A,40
012123 95                  A  6929    	SUB	A,L
012124 DD77FC              A  6930    	LD	(IX+-4),A
                           A  6931    ; 1650		print("|");
012127 01 15 2B 01         A  6932    	LD	BC,L__300
01212B C5                  A  6933    	PUSH	BC
01212C CD 50 02 01         A  6934    	CALL	_print
012130 C1                  A  6935    	POP	BC
012131 DD36FF01            A  6936    	LD	(IX+-1),1
                           A  6937    ; 1651		
                           A  6938    ; 1652		for (c = 1; c < posx - 1; c++)
012135 18 0D               A  6939    	JR	L_390
012137                     A  6940    L_388:
                           A  6941    ; 1653			print(" ");
012137 01 17 2B 01         A  6942    	LD	BC,L__301
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 137


PC     Object              I  Line    Source C:\proted\Debug\main.src
01213B C5                  A  6943    	PUSH	BC
01213C CD 50 02 01         A  6944    	CALL	_print
012140 C1                  A  6945    	POP	BC
012141 DD34FF              A  6946    	INC	(IX+-1)
012144                     A  6947    L_390:
012144 DD7EFC              A  6948    	LD	A,(IX+-4)
012147 17ED62              A  6949    	SEXT	HL
01214A DD6EFC              A  6950    	LD	L,(IX+-4)
01214D E5C1                A  6951    	LD	BC,HL
01214F 0B                  A  6952    	DEC	BC
012150 DD7EFF              A  6953    	LD	A,(IX+-1)
012153 17ED62              A  6954    	SEXT	HL
012156 DD6EFF              A  6955    	LD	L,(IX+-1)
012159 B7                  A  6956    	OR	A,A
01215A ED42                A  6957    	SBC	HL,BC
01215C FA 66 21 01         A  6958    	JP	M,L__315
012160 EA 37 21 01         A  6959    	JP	PE,L_388
012164 18 04               A  6960    	JR	L__316
012166                     A  6961    L__315:
012166 E2 37 21 01         A  6962    	JP	PO,L_388
01216A                     A  6963    L__316:
                           A  6964    ; 1654		
                           A  6965    ; 1655		print(msg2);
01216A DD0709              A  6966    	LD	BC,(IX+9)
01216D C5                  A  6967    	PUSH	BC
01216E CD 50 02 01         A  6968    	CALL	_print
012172 C1                  A  6969    	POP	BC
012173 DD7EFF              A  6970    	LD	A,(IX+-1)
012176 DD86FD              A  6971    	ADD	A,(IX+-3)
012179 DD77FE              A  6972    	LD	(IX+-2),A
                           A  6973    ; 1656		
                           A  6974    ; 1657		for (r = c + len; r < SCNCOLS - 1; 
01217C 18 0D               A  6975    	JR	L_395
01217E                     A  6976    L_393:
                           A  6977    ; 1658			print(" ");
01217E 01 19 2B 01         A  6978    	LD	BC,L__303
012182 C5                  A  6979    	PUSH	BC
012183 CD 50 02 01         A  6980    	CALL	_print
012187 C1                  A  6981    	POP	BC
012188 DD34FE              A  6982    	INC	(IX+-2)
01218B                     A  6983    L_395:
01218B DD7EFE              A  6984    	LD	A,(IX+-2)
01218E FE4F                A  6985    	CP	A,79
012190 FA 9A 21 01         A  6986    	JP	M,L__317
012194 EA 7E 21 01         A  6987    	JP	PE,L_393
012198 18 04               A  6988    	JR	L__318
01219A                     A  6989    L__317:
01219A E2 7E 21 01         A  6990    	JP	PO,L_393
01219E                     A  6991    L__318:
                           A  6992    ; 1659		
                           A  6993    ; 1660		print("|");
01219E 01 1B 2B 01         A  6994    	LD	BC,L__305
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 138


PC     Object              I  Line    Source C:\proted\Debug\main.src
0121A2 C5                  A  6995    	PUSH	BC
0121A3 CD 50 02 01         A  6996    	CALL	_print
0121A7 C1                  A  6997    	POP	BC
                           A  6998    ; 1661		
                           A  6999    ; 1662		print("+===========================
0121A8 01 1D 2B 01         A  7000    	LD	BC,L__306
0121AC C5                  A  7001    	PUSH	BC
0121AD CD 50 02 01         A  7002    	CALL	_print
0121B1 C1                  A  7003    	POP	BC
                           A  7004    ; 1663		
                           A  7005    ; 1664		Disable_Back_Color();
0121B2 CD C1 18 01         A  7006    	CALL	_Disable_Back_Color
                           A  7007    ; 1665	}
0121B6 DDF9                A  7008    	LD	SP,IX
0121B8 DDE1                A  7009    	POP	IX
0121BA C9                  A  7010    	RET	
                           A  7011    
                           A  7012    
                           A  7013    ;**************************** _msg_window *****
                           A  7014    ;Name                         Addr/Register   S
                           A  7015    ;_Disable_Back_Color                 IMPORT  --
                           A  7016    ;_print                              IMPORT  --
                           A  7017    ;_strlen                             IMPORT  --
                           A  7018    ;_gotoxy                             IMPORT  --
                           A  7019    ;_Enable_Back_Color                  IMPORT  --
                           A  7020    ;_scn_phys                           STATIC   4
                           A  7021    ;_backbuffer                         STATIC    
                           A  7022    ;_memset                             IMPORT  --
                           A  7023    ;posx                                  IX-4    
                           A  7024    ;len                                   IX-3    
                           A  7025    ;r                                     IX-2    
                           A  7026    ;c                                     IX-1    
                           A  7027    ;msg2                                  IX+9    
                           A  7028    ;msg1                                  IX+6    
                           A  7029    
                           A  7030    
                           A  7031    ; Stack Frame Size: 16 (bytes)
                           A  7032    ;       Spill Code: 0 (instruction)
                           A  7033    
                           A  7034    
                           A  7035    	SEGMENT STRSECT
012ABC                     A  7036    L__293:
012ABC 2B3D3D3D 3D3D3D3D   A  7037    	DB	"+==================================]PR
012AC4 3D3D3D3D 3D3D3D3D 
012ACC 3D3D3D3D 3D3D3D3D 
012AD4 3D3D3D3D 3D3D3D3D 
012ADC 3D3D3D5D 50524F54 
012AE4 45445B3D 3D3D3D3D 
012AEC 3D3D3D3D 3D3D3D3D 
012AF4 3D3D3D3D 3D3D3D3D 
012AFC 3D3D3D3D 3D3D3D3D 
012B04 3D3D3D3D 3D3D3D2B 
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 139


PC     Object              I  Line    Source C:\proted\Debug\main.src
012B0C 00                  A  7038    	DB	0
012B0D                     A  7039    L__294:
012B0D 7C                  A  7040    	DB	"|"
012B0E 00                  A  7041    	DB	0
012B0F                     A  7042    L__295:
012B0F 20                  A  7043    	DB	" "
012B10 00                  A  7044    	DB	0
012B11                     A  7045    L__297:
012B11 20                  A  7046    	DB	" "
012B12 00                  A  7047    	DB	0
012B13                     A  7048    L__299:
012B13 7C                  A  7049    	DB	"|"
012B14 00                  A  7050    	DB	0
012B15                     A  7051    L__300:
012B15 7C                  A  7052    	DB	"|"
012B16 00                  A  7053    	DB	0
012B17                     A  7054    L__301:
012B17 20                  A  7055    	DB	" "
012B18 00                  A  7056    	DB	0
012B19                     A  7057    L__303:
012B19 20                  A  7058    	DB	" "
012B1A 00                  A  7059    	DB	0
012B1B                     A  7060    L__305:
012B1B 7C                  A  7061    	DB	"|"
012B1C 00                  A  7062    	DB	0
012B1D                     A  7063    L__306:
012B1D 2B3D3D3D 3D3D3D3D   A  7064    	DB	"+=====================================
012B25 3D3D3D3D 3D3D3D3D 
012B2D 3D3D3D3D 3D3D3D3D 
012B35 3D3D3D3D 3D3D3D3D 
012B3D 3D3D3D3D 3D3D3D3D 
012B45 3D3D3D3D 3D3D3D3D 
012B4D 3D3D3D3D 3D3D3D3D 
012B55 3D3D3D3D 3D3D3D3D 
012B5D 3D3D3D3D 3D3D3D3D 
012B65 3D3D3D3D 3D3D3D2B 
012B6D 00                  A  7065    	DB	0
                           A  7066    	SEGMENT CODE
                           A  7067    ; 1666	
                           A  7068    ; 1667	/* Close the message box */
                           A  7069    ; 1668	void close_msg_window(void)
                           A  7070    ; 1669	{
0121BB                     A  7071    _close_msg_window:
0121BB 21FEFFFF            A  7072    	LD	HL,-2
0121BF CD 7E 24 01         A  7073    	CALL	__frameset
                           A  7074    ; 1670		register char r, c;
                           A  7075    ; 1671		
                           A  7076    ; 1672		Disable_Back_Color();
0121C3 CD C1 18 01         A  7077    	CALL	_Disable_Back_Color
0121C7 DD36FF00            A  7078    	LD	(IX+-1),0
                           A  7079    ; 1673		
                           A  7080    ; 1674		for (r = 0; r < 4; r++)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 140


PC     Object              I  Line    Source C:\proted\Debug\main.src
0121CB 18 5A               A  7081    	JR	L_405
0121CD                     A  7082    L_403:
0121CD DD36FE00            A  7083    	LD	(IX+-2),0
                           A  7084    ; 1675			for (c = 0; c < SCNCOLS; c++)
0121D1 18 3E               A  7085    	JR	L_402
0121D3                     A  7086    L_400:
                           A  7087    ; 1676				plot_char(c, r + 23, backbu
0121D3 DD7EFF              A  7088    	LD	A,(IX+-1)
0121D6 17ED62              A  7089    	SEXT	HL
0121D9 DD6EFF              A  7090    	LD	L,(IX+-1)
0121DC E5C1                A  7091    	LD	BC,HL
0121DE C5E1                A  7092    	LD	HL,BC
0121E0 29                  A  7093    	ADD	HL,HL
0121E1 29                  A  7094    	ADD	HL,HL
0121E2 09                  A  7095    	ADD	HL,BC
0121E3 29                  A  7096    	ADD	HL,HL
0121E4 29                  A  7097    	ADD	HL,HL
0121E5 29                  A  7098    	ADD	HL,HL
0121E6 29                  A  7099    	ADD	HL,HL
0121E7 01 BB 52 01         A  7100    	LD	BC,_backbuffer
0121EB 09                  A  7101    	ADD	HL,BC
0121EC E5C1                A  7102    	LD	BC,HL
0121EE DD7EFE              A  7103    	LD	A,(IX+-2)
0121F1 17ED62              A  7104    	SEXT	HL
0121F4 DD6EFE              A  7105    	LD	L,(IX+-2)
0121F7 09                  A  7106    	ADD	HL,BC
0121F8 4E                  A  7107    	LD	C,(HL)
0121F9 0600                A  7108    	LD	B,0
0121FB C5                  A  7109    	PUSH	BC
0121FC DD7EFF              A  7110    	LD	A,(IX+-1)
0121FF C617                A  7111    	ADD	A,23
012201 4F                  A  7112    	LD	C,A
012202 C5                  A  7113    	PUSH	BC
012203 DD4EFE              A  7114    	LD	C,(IX+-2)
012206 C5                  A  7115    	PUSH	BC
012207 CD 9E 02 01         A  7116    	CALL	_plot_char
01220B C1                  A  7117    	POP	BC
01220C C1                  A  7118    	POP	BC
01220D C1                  A  7119    	POP	BC
01220E DD34FE              A  7120    	INC	(IX+-2)
012211                     A  7121    L_402:
012211 DD7EFE              A  7122    	LD	A,(IX+-2)
012214 FE50                A  7123    	CP	A,80
012216 FA 20 22 01         A  7124    	JP	M,L__322
01221A EA D3 21 01         A  7125    	JP	PE,L_400
01221E 18 04               A  7126    	JR	L__323
012220                     A  7127    L__322:
012220 E2 D3 21 01         A  7128    	JP	PO,L_400
012224                     A  7129    L__323:
012224 DD34FF              A  7130    	INC	(IX+-1)
012227                     A  7131    L_405:
012227 DD7EFF              A  7132    	LD	A,(IX+-1)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 141


PC     Object              I  Line    Source C:\proted\Debug\main.src
01222A FE04                A  7133    	CP	A,4
01222C FA 36 22 01         A  7134    	JP	M,L__324
012230 EA CD 21 01         A  7135    	JP	PE,L_403
012234 18 04               A  7136    	JR	L__325
012236                     A  7137    L__324:
012236 E2 CD 21 01         A  7138    	JP	PO,L_403
01223A                     A  7139    L__325:
01223A DDF9                A  7140    	LD	SP,IX
01223C DDE1                A  7141    	POP	IX
01223E C9                  A  7142    	RET	
                           A  7143    
                           A  7144    
                           A  7145    ;**************************** _close_msg_window
                           A  7146    ;Name                         Addr/Register   S
                           A  7147    ;_backbuffer                         STATIC    
                           A  7148    ;_plot_char                          IMPORT  --
                           A  7149    ;_Disable_Back_Color                 IMPORT  --
                           A  7150    ;c                                     IX-2    
                           A  7151    ;r                                     IX-1    
                           A  7152    
                           A  7153    
                           A  7154    ; Stack Frame Size: 8 (bytes)
                           A  7155    ;       Spill Code: 0 (instruction)
                           A  7156    
                           A  7157    
                           A  7158    	XREF _strlen:ROM
                           A  7159    	XREF _memmove:ROM
                           A  7160    	XREF _memset:ROM
                           A  7161    	XREF _memcmp:ROM
                           A  7162    	XREF _strcpy:ROM
                           A  7163    	XREF _malloc:ROM
                           A  7164    	XREF _free:ROM
                           A  7165    	XREF __idivs:ROM
                           A  7166    	XREF __idivu:ROM
                           A  7167    	XREF __irems:ROM
                           A  7168    	XREF __iremu:ROM
                           A  7169    	XREF __frameset0:ROM
                           A  7170    	XREF __frameset:ROM
                           A  7171    	XDEF _close_msg_window
                           A  7172    	XDEF _msg_window
                           A  7173    	XDEF _reload_file
                           A  7174    	XDEF _save_file
                           A  7175    	XDEF _load_file
                           A  7176    	XDEF _FileExists
                           A  7177    	XDEF _Show_Cursor_Position
                           A  7178    	XDEF _edit
                           A  7179    	XDEF _Disable_Back_Color
                           A  7180    	XDEF _Enable_Back_Color
                           A  7181    	XDEF _ShowMenu
                           A  7182    	XDEF _Show_Cursor
                           A  7183    	XDEF _paintrow
                           A  7184    	XDEF _paintall
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 142


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  7185    	XDEF _do_endline
                           A  7186    	XDEF _do_home
                           A  7187    	XDEF _do_enhanced_del
                           A  7188    	XDEF _do_del
                           A  7189    	XDEF _do_dln
                           A  7190    	XDEF _do_iln
                           A  7191    	XDEF _do_dch
                           A  7192    	XDEF _do_chr
                           A  7193    	XDEF _do_bot
                           A  7194    	XDEF _do_top
                           A  7195    	XDEF _do_tab
                           A  7196    	XDEF _do_enhanced_ret
                           A  7197    	XDEF _do_ret
                           A  7198    	XDEF _do_pup
                           A  7199    	XDEF _do_pdw
                           A  7200    	XDEF _do_crt
                           A  7201    	XDEF _do_clf
                           A  7202    	XDEF _do_cdw
                           A  7203    	XDEF _do_cup
                           A  7204    	XDEF _do_red
                           A  7205    	XDEF _tx_put
                           A  7206    	XDEF _tx_get
                           A  7207    	XDEF _tx_del
                           A  7208    	XDEF _tx_ins
                           A  7209    	XDEF _tx_set
                           A  7210    	XDEF _tx_ini
                           A  7211    	XDEF _sc_fin
                           A  7212    	XDEF _sc_ini
                           A  7213    	XDEF _sc_fup
                           A  7214    	XDEF _sc_upd
                           A  7215    	XDEF _sc_str
                           A  7216    	XDEF _sc_chr
                           A  7217    	XDEF _sc_crw
                           A  7218    	XDEF _sc_clr
                           A  7219    	XDEF _te_fin
                           A  7220    	XDEF _te_ini
                           A  7221    	XDEF _te_clr
                           A  7222    	XDEF _te_cln
                           A  7223    	XDEF _te_mov
                           A  7224    	XDEF _te_str
                           A  7225    	XDEF _te_chr
                           A  7226    	XDEF _te_gch
                           A  7227    	XDEF _te_flu
                           A  7228    	XDEF _purify
                           A  7229    	XDEF _zap_trail
                           A  7230    	XDEF _blankrow
                           A  7231    	XDEF _mymalloc
                           A  7232    	XDEF _uitoa
                           A  7233    	XDEF _as
                           A  7234    	XDEF _bomb
                           A  7235    	XDEF _get_prose_version
                           A  7236    	XDEF _gotoxy
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED20-Jul-11     11:48:41     page: 143


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  7237    	XDEF _clreol
                           A  7238    	XDEF _plot_char
                           A  7239    	XDEF _get_cursor_position
                           A  7240    	XDEF _print
                           A  7241    	XDEF _getch
                           A  7242    	XDEF _GetCh
                           A  7243    	XDEF _main
                           A  7244    	XDEF _convBuf
                           A  7245    	XDEF _UseFile
                           A  7246    	XDEF _BufferFile
                           A  7247    	XDEF _filesize
                           A  7248    	XDEF _K_xBC
                           A  7249    	XDEF _K_xHL
                           A  7250    	XDEF _linbuf
                           A  7251    	XDEF _cur_col
                           A  7252    	XDEF _cur_row
                           A  7253    	XDEF _cur_char
                           A  7254    	XDEF _cur_line
                           A  7255    	XDEF _numlines
                           A  7256    	XDEF _p_curr
                           A  7257    	XDEF _p_root
                           A  7258    	XDEF _root
                           A  7259    	XDEF _backbuffer
                           A  7260    	XDEF _scn_phys
                           A  7261    	XDEF _scn_virt
                           A  7262    	XDEF _tebuflen
                           A  7263    	END


Errors: 0
Warnings: 0
Lines Assembled: 7264
