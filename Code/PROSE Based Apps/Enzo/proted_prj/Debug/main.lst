Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:   1


PC     Object              I  Line    Source 
                           A     1    ; Zilog eZ80 ANSI C Compiler Release 3.3
                           A     2    ; -nomodsect -optspeed -noreduceopt -peephole -
                           A     3    ; -localcse -const=ROM 
                           A     4    	FILE	"..\MAIN.C"
                           A     5    	.assume ADL=1
                           A     6    	SEGMENT BSS
012C8E                     A     7    _tebuflen:
012C8E                     A     8    	DS	3
012C91                     A     9    _tebuf:
012C91                     A    10    	DS	2058
01349B                     A    11    _scn_virt:
01349B                     A    12    	DS	4000
01443B                     A    13    _scn_phys:
01443B                     A    14    	DS	4000
0153DB                     A    15    _backbuffer:
0153DB                     A    16    	DS	320
01551B                     A    17    _root:
01551B                     A    18    	DS	9
015524                     A    19    _p_root:
015524                     A    20    	DS	3
015527                     A    21    _p_curr:
015527                     A    22    	DS	3
01552A                     A    23    _numlines:
01552A                     A    24    	DS	3
01552D                     A    25    _cur_line:
01552D                     A    26    	DS	3
015530                     A    27    _cur_char:
015530                     A    28    	DS	3
015533                     A    29    _cur_row:
015533                     A    30    	DS	3
015536                     A    31    _cur_col:
015536                     A    32    	DS	3
015539                     A    33    _linbuf:
015539                     A    34    	DS	90
015593                     A    35    _Ascii:
015593                     A    36    	DS	1
015594                     A    37    _Scancode:
015594                     A    38    	DS	1
015595                     A    39    _B:
015595                     A    40    	DS	1
015596                     A    41    _C:
015596                     A    42    	DS	1
015597                     A    43    _E:
015597                     A    44    	DS	1
015598                     A    45    _InsertMode:
015598                     A    46    	DS	1
015599                     A    47    _K_xHL:
015599                     A    48    	DS	3
01559C                     A    49    _K_xBC:
01559C                     A    50    	DS	3
01559F                     A    51    _filesize:
01559F                     A    52    	DS	3
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:   2


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A    53    	SEGMENT DATA
0155B1                     A    54    _BufferFile:
0155B1 0000C0              A    55    	DW24	12582912
                           A    56    	SEGMENT BSS
0155A2                     A    57    _TxtPnt:
0155A2                     A    58    	DS	3
                           A    59    	SEGMENT STRSECT
012646                     A    60    L__0:
012646 6E6F6E61 6D652E74   A    61    	DB	"noname.txt"
01264E 7874 
012650 00                  A    62    	DB	0
                           A    63    	SEGMENT DATA
0155B4                     A    64    _NonameFile:
0155B4 462601              A    65    	DW24	L__0
                           A    66    	SEGMENT BSS
0155A5                     A    67    _UseFile:
0155A5                     A    68    	DS	1
0155A6                     A    69    _convBuf:
0155A6                     A    70    	DS	5
                           A    71    ;    1	/*
                           A    72    ;    2		PROTED: PROse Text eDitor
                           A    73    ;    3		
                           A    74    ;    4		coded by Calogiuri Enzo Antonio for
                           A    75    ;    5	*/
                           A    76    ;    6	
                           A    77    ;    7	#include <stdio.h>
                           A    78    ;    8	#include <stdlib.h>
                           A    79    ;    9	#include <string.h>
                           A    80    ;   10	#include <stddef.h>
                           A    81    ;   11	
                           A    82    ;   12	#include "PROSE_Header.h"
                           A    83    ;   13	
                           A    84    ;   14	#define TEBUFMAX		2048			                           A    85    ;   15	#define MAXLNLEN		80				                           A    86    ;   16	#define SCNROWS			50				                           A    87    ;   17	#define SCNCOLS			80				                           A    88    ;   18	#define VERSION			"1.1"			                           A    89    ;   19	#define FUDGE			10
                           A    90    ;   20	#define FALSE			0
                           A    91    ;   21	#define TRUE			1
                           A    92    ;   22	#define SCNSIZE 		(SCNROWS * SCNC
                           A    93    ;   23	
                           A    94    ;   24	#define EOS 			'\0'
                           A    95    ;   25	#define EOL 			'\n'
                           A    96    ;   26	#define CH_TAB 			9
                           A    97    ;   27	
                           A    98    ;   28	int tebuflen;
                           A    99    ;   29	static char tebuf[TEBUFMAX + FUDGE];
                           A   100    ;   30	char scn_virt[SCNROWS][SCNCOLS];
                           A   101    ;   31	char scn_phys[SCNROWS][SCNCOLS];
                           A   102    ;   32	char backbuffer[4][SCNCOLS];
                           A   103    ;   33	
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:   3


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A   104    ;   34	typedef struct line_t_ line_t;
                           A   105    ;   35	#define p_line_t line_t *
                           A   106    ;   36	struct line_t_
                           A   107    ;   37	 {
                           A   108    ;   38	   p_line_t 	p_prev;					                           A   109    ;   39	   p_line_t 	p_next;					                           A   110    ;   40	   char   		*p_data; 				                           A   111    ;   41	 };
                           A   112    ;   42	 
                           A   113    ;   43	line_t root;							                           A   114    ;   44	p_line_t p_root;						                           A   115    ;   45	p_line_t p_curr;						                           A   116    ;   46	int numlines, cur_line, cur_char, cur_r
                           A   117    ;   47	char linbuf[MAXLNLEN+FUDGE]; 
                           A   118    ;   48	
                           A   119    ;   49	static unsigned char Ascii, Scancode, B
                           A   120    ;   50	unsigned int K_xHL, K_xBC, filesize;
                           A   121    ;   51	char *BufferFile = (char *)0x0C00000;	                           A   122    ;   52	static char *TxtPnt;
                           A   123    ;   53	static char *NonameFile = "noname.txt";
                           A   124    ;   54	char UseFile;
                           A   125    ;   55	
                           A   126    ;   56	void GetCh(void);
                           A   127    ;   57	unsigned char getch(void);
                           A   128    ;   58	void print(const char *Txt);
                           A   129    ;   59	void get_cursor_position(unsigned char 
                           A   130    ;   60	void plot_char(unsigned char x, unsigne
                           A   131    ;   61	void clreol(void);
                           A   132    ;   62	void gotoxy(unsigned char x, unsigned c
                           A   133    ;   63	int get_prose_version(void);
                           A   134    ;   64	void get_display_size(void);
                           A   135    ;   65	
                           A   136    ;   66	void uitoa(unsigned int val, char *stri
                           A   137    ;   67	char convBuf[5];
                           A   138    	SEGMENT CODE
                           A   139    ;   68	
                           A   140    ;   69	void ShowMenu(void);
                           A   141    ;   70	void ShowInsertMode(void);
                           A   142    ;   71	void Enable_Back_Color(void);
                           A   143    ;   72	void Disable_Back_Color(void);
                           A   144    ;   73	void Show_Cursor(void);
                           A   145    ;   74	void Show_Cursor_Position(void);
                           A   146    ;   75	
                           A   147    ;   76	char FileExists(void);
                           A   148    ;   77	void load_file(void);
                           A   149    ;   78	void save_file(void);
                           A   150    ;   79	void reload_file(void);
                           A   151    ;   80	
                           A   152    ;   81	void msg_window(char *msg1, char *msg2)
                           A   153    ;   82	void close_msg_window(void);
                           A   154    ;   83	
                           A   155    ;   84	/*-------------------------------------
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:   4


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A   156    ;   85	
                           A   157    ;   86	void bomb(char *txt);
                           A   158    ;   87	void as(char b, char *txt);
                           A   159    ;   88	void *mymalloc(size_t n);
                           A   160    ;   89	char blankrow(char *p);
                           A   161    ;   90	void zap_trail(char *s);
                           A   162    ;   91	void purify(char *st);
                           A   163    ;   92	void te_flu(void);
                           A   164    ;   93	unsigned char te_gch(void);
                           A   165    ;   94	void te_chr(char ch);
                           A   166    ;   95	void te_str(char *s);
                           A   167    ;   96	void te_mov(unsigned char r, unsigned c
                           A   168    ;   97	void te_cln(unsigned char row);
                           A   169    ;   98	void te_clr(void);
                           A   170    ;   99	void te_ini(void);
                           A   171    ;  100	void te_fin(void);
                           A   172    ;  101	
                           A   173    ;  102	void sc_clr(void);
                           A   174    ;  103	void sc_crw(unsigned char row);
                           A   175    ;  104	void sc_chr(unsigned char row, unsigned
                           A   176    ;  105	void sc_str(unsigned char row, unsigned
                           A   177    ;  106	void sc_upd(void);
                           A   178    ;  107	void sc_fup(void);
                           A   179    ;  108	void sc_ini(void);
                           A   180    ;  109	void sc_fin(void);
                           A   181    ;  110	
                           A   182    ;  111	void tx_ini(void);
                           A   183    ;  112	void tx_set(p_line_t p_line, char *s);
                           A   184    ;  113	void tx_ins(p_line_t p_line, char *s);
                           A   185    ;  114	void tx_del(p_line_t p_line);
                           A   186    ;  115	void tx_get(p_line_t p_line);
                           A   187    ;  116	void tx_put(p_line_t p_line);
                           A   188    ;  117	
                           A   189    ;  118	void do_red(void);
                           A   190    ;  119	void do_cup(void);
                           A   191    ;  120	void do_cdw(void);
                           A   192    ;  121	void do_clf(void);
                           A   193    ;  122	void do_crt(void);
                           A   194    ;  123	void do_pdw(void);
                           A   195    ;  124	void do_pup(void);
                           A   196    ;  125	void do_ret(void);
                           A   197    ;  126	void do_enhanced_ret(void);
                           A   198    ;  127	void do_tab(void);
                           A   199    ;  128	void do_top(void);
                           A   200    ;  129	void do_bot(char paint);
                           A   201    ;  130	void do_chr(char ch);
                           A   202    ;  131	void do_dch(void);
                           A   203    ;  132	void do_iln(void);
                           A   204    ;  133	void do_dln(void);
                           A   205    ;  134	void do_del(void);
                           A   206    ;  135	void do_enhanced_del(void);
                           A   207    ;  136	void do_home(void);
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:   5


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A   208    ;  137	void do_endline(void);
                           A   209    ;  138	void do_ins(void);
                           A   210    ;  139	
                           A   211    ;  140	void paintall(void);
                           A   212    ;  141	void paintrow(void);
                           A   213    ;  142	
                           A   214    ;  143	void edit(void);
                           A   215    ;  144	
                           A   216    ;  145	/*-------------------------------------
                           A   217    ;  146	void main(void)
                           A   218    ;  147	{
010000                     A   219    _main:
                           A   220    ;  148		INIT_HARDWARE;
       0000009A            A   221    PB_DR		equ 09Ah
       0000009B            A   222    PB_DDR		equ 09Bh
       0000009C            A   223    PB_ALT1		equ 09Ch
       0000009D            A   224    PB_ALT2		equ 09Dh
       0000009E            A   225    PC_DR		equ 09Eh
       0000009F            A   226    PC_DDR		equ 09Fh
       000000A0            A   227    PC_ALT1		equ 0A0h
       000000A1            A   228    PC_ALT2		equ 0A1h
       000000A2            A   229    PD_DR		equ 0A2h
       000000A3            A   230    PD_DDR		equ 0A3h
       000000A4            A   231    PD_ALT1		equ 0A4h
       000000A5            A   232    PD_ALT2		equ 0A5h
       000000C0            A   233    UART0_RBR	equ 0C0h
       000000C0            A   234    UART0_THR	equ 0C0h
       000000C0            A   235    UART0_BRG_L	equ 0C0h
       000000C1            A   236    UART0_BRG_H	equ 0C1h
       000000C1            A   237    UART0_IER	equ 0C1h
       000000C2            A   238    UART0_FCTL	equ 0C2h
       000000C3            A   239    UART0_LCTL	equ 0C3h
       000000C4            A   240    UART0_MCTL	equ 0C4h
       000000C5            A   241    UART0_LSR	equ 0C5h
       000000C6            A   242    UART0_MSR	equ 0C6h
       000000A8            A   243    CS0_LBR		equ 0A8h
       000000A9            A   244    CS0_UBR		equ 0A9h
       000000AA            A   245    CS0_CTL		equ 0AAh
       000000AB            A   246    CS1_LBR		equ 0ABh
       000000AC            A   247    CS1_UBR		equ 0ACh
       000000AD            A   248    CS1_CTL		equ 0ADh
       000000AE            A   249    CS2_LBR		equ 0AEh
       000000AF            A   250    CS2_UBR		equ 0AFh
       000000B0            A   251    CS2_CTL		equ 0B0h
       000000B1            A   252    CS3_LBR		equ 0B1h
       000000B2            A   253    CS3_UBR		equ 0B2h
       000000B3            A   254    CS3_CTL		equ 0B3h
       00000080            A   255    TMR0_CTL		equ 080h
       00000081            A   256    TMR0_DR_L	equ 081h
       00000081            A   257    TMR0_RR_L	equ 081h
       00000082            A   258    TMR0_DR_H	equ 082h
       00000082            A   259    TMR0_RR_H	equ 082h
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:   6


PC     Object              I  Line    Source C:\proted\Debug\main.src
       00000092            A   260    TMR_ISS		equ 092h
       000000ED            A   261    RTC_CTRL		equ 0EDh
       000000EC            A   262    RTC_ACTRL	equ 0ECh
       000000E0            A   263    RTC_SEC		equ 0E0h
       000000E1            A   264    RTC_MIN		equ 0E1h
       000000E2            A   265    RTC_HRS		equ 0E2h
       000000E3            A   266    RTC_DOW		equ 0E3h
       000000E4            A   267    RTC_DOM		equ 0E4h
       000000E5            A   268    RTC_MON		equ 0E5h
       000000E6            A   269    RTC_YR		equ 0E6h
       000000E7            A   270    RTC_CEN		equ 0E7h
       00000000            A   271    port_pic_data		equ 000h
       00000001            A   272    port_pic_ctrl		equ 001h
       00000001            A   273    port_hw_flags		equ 001h
       00000002            A   274    port_sdc_ctrl		equ 002h
       00000002            A   275    port_keyboard_data	equ 002h
       00000003            A   276    port_sdc_data		equ 003h
       00000004            A   277    port_memory_paging	equ 004h
       00000005            A   278    port_irq_ctrl		equ 005h
       00000006            A   279    port_nmi_ack			equ 006h
       00000007            A   280    port_ps2_ctrl		equ 007h
       00000008            A   281    port_selector		equ 008h
       00000006            A   282    port_mouse_data		equ 006h
       00000009            A   283    port_clear_flags		equ 009h
       00000000            A   284    sdc_power			equ 0h
       00000001            A   285    sdc_cs				equ 1h
       00000002            A   286    sdc_speed			equ 2h
       00000004            A   287    sdc_serializer_busy	equ 4h
       00000005            A   288    vrt					equ 5h
       00000000            A   289    sysram_addr			equ 0000000h
       00800000            A   290    vram_a_addr			equ 0800000h
       00C00000            A   291    vram_b_addr			equ 0C00000h
       00FF0000            A   292    hw_palette			equ 0ff0000h
       00FF0800            A   293    hw_sprite_registers	equ 0ff0800h
       00FF1000            A   294    hw_video_parameters	equ 0ff1000h
       00FF1400            A   295    hw_audio_registers	equ 0ff1400h
       00FF1800            A   296    hw_video_settings	equ 0ff1800h
       00FF1000            A   297    tilemap_parameters	equ hw_video_parameters + 0
       00FF1020            A   298    bitmap_parameters	equ hw_video_parameters + 2
       00FF1800            A   299    video_control		equ hw_video_settings + 00h
       00FF1801            A   300    sprite_control		equ hw_video_settings + 01h
       00FF1802            A   301    bgnd_palette_select	equ hw_video_settings + 02h
       00FF1803            A   302    sprite_palette_select	equ hw_video_settings +
       00FF1804            A   303    right_border_position	equ hw_video_settings +
       00000A00            A   304    os_start			equ 0A00h
       00000A14            A   305    prose_return		equ os_start + 14h
       00000A20            A   306    prose_kernal		equ os_start + 20h
                           A   307    ;  149		INIT_KJT;
       00000000            A   308    kr_mount_volumes			equ 00h
       00000001            A   309    kr_get_device_info		equ 01h
       00000002            A   310    kr_check_volume_format	equ 02h
       00000003            A   311    kr_change_volume			equ 03h
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:   7


PC     Object              I  Line    Source C:\proted\Debug\main.src
       00000004            A   312    kr_get_volume_info		equ 04h
       00000005            A   313    kr_format_device			equ 05h
       00000006            A   314    kr_make_dir				equ 06h
       00000007            A   315    kr_change_dir			equ 07h
       00000008            A   316    kr_parent_dir			equ 08h
       00000009            A   317    kr_root_dir				equ 09h
       0000000A            A   318    kr_delete_dir			equ 0Ah
       0000000B            A   319    kr_find_file				equ 0Bh
       0000000C            A   320    kr_set_file_pointer		equ 0Ch
       0000000D            A   321    kr_set_load_length		equ 0Dh
       0000000E            A   322    kr_read_file				equ 0Eh
       0000000F            A   323    kr_erase_file			equ 0Fh
       00000010            A   324    kr_rename_file			equ 10h
       00000011            A   325    kr_create_file			equ 11h
       00000012            A   326    kr_write_file			equ 12h
       00000013            A   327    kr_get_total_sectors		equ 13h
       00000014            A   328    kr_dir_list_first_entry	equ 14h
       00000015            A   329    kr_dir_list_get_entry	equ 15h
       00000016            A   330    kr_dir_list_next_entry	equ 16h
       00000017            A   331    kr_read_sector			equ 17h
       00000018            A   332    kr_write_sector			equ 18h
       00000019            A   333    kr_file_sector_list		equ 19h
       0000001A            A   334    kr_get_dir_cluster		equ 1Ah
       0000001B            A   335    kr_set_dir_cluster		equ 1Bh
       0000001C            A   336    kr_get_dir_name			equ 1Ch
       0000001D            A   337    kr_wait_key				equ 1Dh
       0000001E            A   338    kr_get_key				equ 1Eh
       0000001F            A   339    kr_get_key_mod_flags		equ 1Fh
       00000020            A   340    kr_serial_receive_header	equ 20h
       00000021            A   341    kr_serial_receive_file	equ 21h
       00000022            A   342    kr_serial_send_file		equ 22h
       00000023            A   343    kr_serial_tx_byte		equ 23h
       00000024            A   344    kr_serial_rx_byte		equ 24h
       00000025            A   345    kr_print_string			equ 25h
       00000026            A   346    kr_clear_screen			equ 26h
       00000027            A   347    kr_wait_vrt				equ 27h
       00000028            A   348    kr_set_cursor_position	equ 28h
       00000029            A   349    kr_plot_char				equ 29h
       0000002A            A   350    kr_set_pen				equ 2Ah
       0000002B            A   351    kr_background_colours	equ 2Bh
       0000002C            A   352    kr_draw_cursor			equ 2Ch
       0000002D            A   353    kr_get_pen				equ 2Dh
       0000002E            A   354    kr_scroll_up				equ 2Eh
       0000002F            A   355    kr_os_display			equ 2Fh
       00000030            A   356    kr_get_display_size		equ 30h
       00000031            A   357    kr_get_charmap_addr_xy	equ 31h
       00000032            A   358    kr_get_cursor_position	equ 32h
       00000033            A   359    kr_set_envar				equ 33h
       00000034            A   360    kr_get_envar				equ 34h
       00000035            A   361    kr_delete_envar			equ 35h
       00000036            A   362    kr_set_mouse_window		equ 36h
       00000037            A   363    kr_get_mouse_position	equ 37h
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:   8


PC     Object              I  Line    Source C:\proted\Debug\main.src
       00000038            A   364    kr_get_mouse_motion		equ 38h
       00000039            A   365    kr_time_delay			equ 39h
       0000003A            A   366    kr_compare_strings		equ 3Ah
       0000003B            A   367    kr_hex_byte_to_ascii		equ 3Bh
       0000003C            A   368    kr_ascii_to_hex_word		equ 3Ch
       0000003D            A   369    kr_get_string			equ 3Dh
       0000003E            A   370    kr_get_version			equ 3Eh
       0000003F            A   371    kr_dont_store_registers	equ 3Fh
       00000040            A   372    kr_get_font_info			equ 40h
       00000041            A   373    kr_read_rtc				equ 41h
       00000042            A   374    kr_write_rtc				equ 42h
       00000043            A   375    kr_get_keymap_location	equ 43h
                           A   376    ;  150		
                           A   377    ;  151		CREATE_HEADER;
010000 18 0E               A   378    jr skip_header
010002 50524F              A   379    db 'PRO'
010005 000001              A   380    mb_loc dw24 10000h
010008 000000              A   381    dw24 0
01000B 0000                A   382    dw 0
01000D 0000                A   383    dw 0
01000F 01                  A   384    db 1
010010                     A   385    skip_header
                           A   386    ;  152		
                           A   387    ;  153		UseFile = 0;	
010010 AF                  A   388    	XOR	A,A
010011 32 A5 55 01         A   389    	LD	(_UseFile),A
                           A   390    ;  154		
                           A   391    ;  155		asm ("ld a, (hl)");
010015 7E                  A   392    ld a, (hl)
                           A   393    ;  156		asm ("or a");
010016 B7                  A   394    or a
                           A   395    ;  157		asm ("jr z, no_param");
010017 28 0A               A   396    jr z, no_param
                           A   397    ;  158		asm ("ld (_K_xHL), hl");	//If pa
010019 22 99 55 01         A   398    ld (_K_xHL), hl
                           A   399    ;  159		
                           A   400    ;  160		UseFile = 1;
01001D 3E01                A   401    	LD	A,1
01001F 32 A5 55 01         A   402    	LD	(_UseFile),A
                           A   403    ;  161		
                           A   404    ;  162		asm ("no_param:");
010023                     A   405    no_param:
                           A   406    ;  163		
                           A   407    ;  164		if (get_prose_version() < 0x2F)
010023 CD 4F 03 01         A   408    	CALL	_get_prose_version
010027 012F0000            A   409    	LD	BC,47
01002B B7                  A   410    	OR	A,A
01002C ED42                A   411    	SBC	HL,BC
01002E F2 38 00 01         A   412    	JP	P,L__15
010032 EA 50 00 01         A   413    	JP	PE,L_1
010036 18 04               A   414    	JR	L__16
010038                     A   415    L__15:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:   9


PC     Object              I  Line    Source C:\proted\Debug\main.src
010038 E2 50 00 01         A   416    	JP	PO,L_1
01003C                     A   417    L__16:
                           A   418    ;  165		{
                           A   419    ;  166			print("Proted require PROSE ver
01003C 01 51 26 01         A   420    	LD	BC,L__2
010040 C5                  A   421    	PUSH	BC
010041 CD 5A 02 01         A   422    	CALL	_print
010045 C1                  A   423    	POP	BC
                           A   424    ;  167			
                           A   425    ;  168			QUIT_TO_PROSE;
010046 AF                  A   426    xor a
010047 5BC3140A 00         A   427    jp.lil prose_return
                           A   428    ;  169			
                           A   429    ;  170			return;
01004C C3 2B 01 01         A   430    	JR	L_8
                           A   431    ;  171		}
010050                     A   432    L_1:
                           A   433    ;  172		
                           A   434    ;  173		get_display_size();
010050 CD 67 03 01         A   435    	CALL	_get_display_size
                           A   436    ;  174		
                           A   437    ;  175		if (!((B == 80) && (C == 60)))
010054 3A 95 55 01         A   438    	LD	A,(_B)
010058 FE50                A   439    	CP	A,80
01005A 20 08               A   440    	JR	NZ,L_3
01005C 3A 96 55 01         A   441    	LD	A,(_C)
010060 FE3C                A   442    	CP	A,60
010062 28 14               A   443    	JR	Z,L_4
010064                     A   444    L_3:
                           A   445    ;  176		{
                           A   446    ;  177			print("Proted require 80x60 cha
010064 01 79 26 01         A   447    	LD	BC,L__5
010068 C5                  A   448    	PUSH	BC
010069 CD 5A 02 01         A   449    	CALL	_print
01006D C1                  A   450    	POP	BC
                           A   451    ;  178			
                           A   452    ;  179			QUIT_TO_PROSE;
01006E AF                  A   453    xor a
01006F 5BC3140A 00         A   454    jp.lil prose_return
                           A   455    ;  180			
                           A   456    ;  181			return;
010074 C3 2B 01 01         A   457    	JR	L_8
                           A   458    ;  182		}
010078                     A   459    L_4:
                           A   460    ;  183		
                           A   461    ;  184		asm ("push ix");
010078 DDE5                A   462    push ix
                           A   463    ;  185		asm ("ld a, kr_clear_screen");
01007A 3E26                A   464    ld a, kr_clear_screen
                           A   465    ;  186		asm ("call.lil prose_kernal");
01007C 5BCD200A 00         A   466    call.lil prose_kernal
                           A   467    ;  187		asm ("pop ix");
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  10


PC     Object              I  Line    Source C:\proted\Debug\main.src
010081 DDE1                A   468    pop ix
                           A   469    ;  188		
                           A   470    ;  189		memset(BufferFile, 0, 1024 * 512);	010083 01000008            A   471    	LD	BC,524288
010087 C5                  A   472    	PUSH	BC
010088 01000000            A   473    	LD	BC,0
01008C C5                  A   474    	PUSH	BC
01008D ED4B B1 55 01       A   475    	LD	BC,(_BufferFile)
010092 C5                  A   476    	PUSH	BC
010093 CD F7 25 01         A   477    	CALL	_memset
010097 C1                  A   478    	POP	BC
010098 C1                  A   479    	POP	BC
010099 C1                  A   480    	POP	BC
                           A   481    ;  190		
                           A   482    ;  191		ShowMenu();
01009A CD 89 18 01         A   483    	CALL	_ShowMenu
                           A   484    ;  192		
                           A   485    ;  193		te_ini();
01009E CD 6C 07 01         A   486    	CALL	_te_ini
                           A   487    ;  194		sc_ini();
0100A2 CD DD 09 01         A   488    	CALL	_sc_ini
                           A   489    ;  195		tx_ini();
0100A6 CD EF 09 01         A   490    	CALL	_tx_ini
                           A   491    ;  196		
                           A   492    ;  197		if (UseFile == 1)
0100AA 3A A5 55 01         A   493    	LD	A,(_UseFile)
0100AE FE01                A   494    	CP	A,1
0100B0 20 16               A   495    	JR	NZ,L_7
                           A   496    ;  198			if (FileExists() == 1)
0100B2 CD 53 1C 01         A   497    	CALL	_FileExists
0100B6 47                  A   498    	LD	B,A
0100B7 17ED62              A   499    	SEXT	HL
0100BA 68                  A   500    	LD	L,B
0100BB B7                  A   501    	OR	A,A
0100BC 01010000            A   502    	LD	BC,1
0100C0 ED42                A   503    	SBC	HL,BC
0100C2 20 04               A   504    	JR	NZ,L_7
                           A   505    ;  199				load_file();		
0100C4 CD 7C 1C 01         A   506    	CALL	_load_file
0100C8                     A   507    L_7:
                           A   508    ;  200		
                           A   509    ;  201		edit();
0100C8 CD 72 19 01         A   510    	CALL	_edit
                           A   511    ;  202		
                           A   512    ;  203		sc_fin();
0100CC CD E6 09 01         A   513    	CALL	_sc_fin
                           A   514    ;  204		te_fin();
0100D0 CD 76 07 01         A   515    	CALL	_te_fin
                           A   516    ;  205		
                           A   517    ;  206		asm ("proted_exit:");
0100D4                     A   518    proted_exit:
                           A   519    ;  207		asm ("push ix");
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  11


PC     Object              I  Line    Source C:\proted\Debug\main.src
0100D4 DDE5                A   520    push ix
                           A   521    ;  208		asm ("ld a, kr_clear_screen");
0100D6 3E26                A   522    ld a, kr_clear_screen
                           A   523    ;  209		asm ("call.lil prose_kernal");
0100D8 5BCD200A 00         A   524    call.lil prose_kernal
                           A   525    ;  210		asm ("pop ix");
0100DD DDE1                A   526    pop ix
                           A   527    ;  211		
                           A   528    ;  212		print("\n\r");
0100DF 01 AB 26 01         A   529    	LD	BC,L__8
0100E3 C5                  A   530    	PUSH	BC
0100E4 CD 5A 02 01         A   531    	CALL	_print
0100E8 C1                  A   532    	POP	BC
                           A   533    ;  213		print("PROTED ver ");
0100E9 01 AE 26 01         A   534    	LD	BC,L__9
0100ED C5                  A   535    	PUSH	BC
0100EE CD 5A 02 01         A   536    	CALL	_print
0100F2 C1                  A   537    	POP	BC
                           A   538    ;  214		print(VERSION);
0100F3 01 BA 26 01         A   539    	LD	BC,L__10
0100F7 C5                  A   540    	PUSH	BC
0100F8 CD 5A 02 01         A   541    	CALL	_print
0100FC C1                  A   542    	POP	BC
                           A   543    ;  215		print(" rel.: ");
0100FD 01 BE 26 01         A   544    	LD	BC,L__11
010101 C5                  A   545    	PUSH	BC
010102 CD 5A 02 01         A   546    	CALL	_print
010106 C1                  A   547    	POP	BC
                           A   548    ;  216		print(__DATE__);
010107 01 C6 26 01         A   549    	LD	BC,L__12
01010B C5                  A   550    	PUSH	BC
01010C CD 5A 02 01         A   551    	CALL	_print
010110 C1                  A   552    	POP	BC
                           A   553    ;  217		print("\n\r");
010111 01 D2 26 01         A   554    	LD	BC,L__13
010115 C5                  A   555    	PUSH	BC
010116 CD 5A 02 01         A   556    	CALL	_print
01011A C1                  A   557    	POP	BC
                           A   558    ;  218		print("Created by Calogiuri Enzo An
01011B 01 D5 26 01         A   559    	LD	BC,L__14
01011F C5                  A   560    	PUSH	BC
010120 CD 5A 02 01         A   561    	CALL	_print
010124 C1                  A   562    	POP	BC
                           A   563    ;  219		
                           A   564    ;  220		QUIT_TO_PROSE;
010125 AF                  A   565    xor a
010126 5BC3140A 00         A   566    jp.lil prose_return
                           A   567    ;  221	}
01012B                     A   568    L_8:
01012B C9                  A   569    	RET	
                           A   570    
                           A   571    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  12


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A   572    ;**************************** _main ***********
                           A   573    ;Name                         Addr/Register   S
                           A   574    ;_te_fin                             IMPORT  --
                           A   575    ;_sc_fin                             IMPORT  --
                           A   576    ;_edit                               IMPORT  --
                           A   577    ;_load_file                          IMPORT  --
                           A   578    ;_FileExists                         IMPORT  --
                           A   579    ;_tx_ini                             IMPORT  --
                           A   580    ;_sc_ini                             IMPORT  --
                           A   581    ;_te_ini                             IMPORT  --
                           A   582    ;_ShowMenu                           IMPORT  --
                           A   583    ;_BufferFile                         STATIC    
                           A   584    ;_memset                             IMPORT  --
                           A   585    ;_C                                  STATIC    
                           A   586    ;_B                                  STATIC    
                           A   587    ;_get_display_size                   IMPORT  --
                           A   588    ;_print                              IMPORT  --
                           A   589    ;_get_prose_version                  IMPORT  --
                           A   590    ;_UseFile                            STATIC    
                           A   591    
                           A   592    
                           A   593    ; Stack Frame Size: 6 (bytes)
                           A   594    ;       Spill Code: 0 (instruction)
                           A   595    
                           A   596    
                           A   597    	SEGMENT STRSECT
012651                     A   598    L__2:
012651 50726F74 65642072   A   599    	DB	"Proted require PROSE ver 2F or later!"
012659 65717569 72652050 
012661 524F5345 20766572 
012669 20324620 6F72206C 
012671 61746572 21 
012676 0A0D00              A   600    	DB	10,13,0
012679                     A   601    L__5:
012679 50726F74 65642072   A   602    	DB	"Proted require 80x60 characters mode (
012681 65717569 72652038 
012689 30783630 20636861 
012691 72616374 65727320 
012699 6D6F6465 2028564D 
0126A1 4F444520 302921 
0126A8 0A0D00              A   603    	DB	10,13,0
0126AB                     A   604    L__8:
0126AB 0A0D00              A   605    	DB	10,13,0
0126AE                     A   606    L__9:
0126AE 50524F54 45442076   A   607    	DB	"PROTED ver "
0126B6 657220 
0126B9 00                  A   608    	DB	0
0126BA                     A   609    L__10:
0126BA 312E31              A   610    	DB	"1.1"
0126BD 00                  A   611    	DB	0
0126BE                     A   612    L__11:
0126BE 2072656C 2E3A20     A   613    	DB	" rel.: "
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  13


PC     Object              I  Line    Source C:\proted\Debug\main.src
0126C5 00                  A   614    	DB	0
0126C6                     A   615    L__12:
0126C6 4A756C20 32312032   A   616    	DB	"Jul 21 2011"
0126CE 303131 
0126D1 00                  A   617    	DB	0
0126D2                     A   618    L__13:
0126D2 0A0D00              A   619    	DB	10,13,0
0126D5                     A   620    L__14:
0126D5 43726561 74656420   A   621    	DB	"Created by Calogiuri Enzo Antonio for 
0126DD 62792043 616C6F67 
0126E5 69757269 20456E7A 
0126ED 6F20416E 746F6E69 
0126F5 6F20666F 7220655A 
0126FD 38305020 66616E73 
012705 203A2D29 
012709 0A0D00              A   622    	DB	10,13,0
                           A   623    	SEGMENT CODE
                           A   624    ;  222	
                           A   625    ;  223	/* Get ascii and scancode value of key 
                           A   626    ;  224	void GetCh(void)
                           A   627    ;  225	{
01012C                     A   628    _GetCh:
                           A   629    ;  226		Ascii = Scancode = 0;
01012C AF                  A   630    	XOR	A,A
01012D 32 94 55 01         A   631    	LD	(_Scancode),A
010131 AF                  A   632    	XOR	A,A
010132 32 93 55 01         A   633    	LD	(_Ascii),A
                           A   634    ;  227		
                           A   635    ;  228		asm ("push ix");
010136 DDE5                A   636    push ix
                           A   637    ;  229		asm ("ld a, kr_get_key");
010138 3E1E                A   638    ld a, kr_get_key
                           A   639    ;  230		asm ("call.lil prose_kernal");
01013A 5BCD200A 00         A   640    call.lil prose_kernal
                           A   641    ;  231		asm ("jr nz, NoKeyInB");
01013F 20 09               A   642    jr nz, NoKeyInB
                           A   643    ;  232		asm ("ld (_Scancode), a");
010141 32 94 55 01         A   644    ld (_Scancode), a
                           A   645    ;  233		asm ("ld a, b");
010145 78                  A   646    ld a, b
                           A   647    ;  234		asm ("ld (_Ascii), a");
010146 32 93 55 01         A   648    ld (_Ascii), a
                           A   649    ;  235		asm ("NoKeyInB:");
01014A                     A   650    NoKeyInB:
                           A   651    ;  236		asm ("pop ix");
01014A DDE1                A   652    pop ix
                           A   653    ;  237	}
01014C C9                  A   654    	RET	
                           A   655    
                           A   656    
                           A   657    ;**************************** _GetCh **********
                           A   658    ;Name                         Addr/Register   S
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  14


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A   659    ;_Ascii                              STATIC    
                           A   660    ;_Scancode                           STATIC    
                           A   661    
                           A   662    
                           A   663    ; Stack Frame Size: 6 (bytes)
                           A   664    ;       Spill Code: 0 (instruction)
                           A   665    
                           A   666    
                           A   667    ;  238	
                           A   668    ;  239	/* Manage the input from keyboard */
                           A   669    ;  240	unsigned char getch(void)
                           A   670    ;  241	{
01014D                     A   671    _getch:
                           A   672    ;  242		while (1)
01014D                     A   673    L_30:
                           A   674    ;  243		{	
                           A   675    ;  244			GetCh();	
01014D CD 2C 01 01         A   676    	CALL	_GetCh
                           A   677    ;  245			
                           A   678    ;  246			switch (Scancode)
010151 3A 94 55 01         A   679    	LD	A,(_Scancode)
010155 B7ED62              A   680    	UEXT	HL
010158 6F                  A   681    	LD	L,A
010159 E5C1                A   682    	LD	BC,HL
01015B                     A   683    L__20:
01015B 115A0000            A   684    	LD	DE,90
01015F B7                  A   685    	OR	A,A
010160 ED52                A   686    	SBC	HL,DE
010162 CA 31 02 01         A   687    	JR	Z,L_15
010166 215A0000            A   688    	LD	HL,90
01016A B7                  A   689    	OR	A,A
01016B ED42                A   690    	SBC	HL,BC
01016D 38 29               A   691    	JR	C,L__22
01016F 11120000            A   692    	LD	DE,18
010173 C5E1                A   693    	LD	HL,BC
010175 B7                  A   694    	OR	A,A
010176 ED52                A   695    	SBC	HL,DE
010178 CA 3D 02 01         A   696    	JR	Z,L_17
01017C 21120000            A   697    	LD	HL,18
010180 B7                  A   698    	OR	A,A
010181 ED42                A   699    	SBC	HL,BC
010183 DA 4C 02 01         A   700    	JR	C,L_28
010187 110D0000            A   701    	LD	DE,13
01018B C5E1                A   702    	LD	HL,BC
01018D B7                  A   703    	OR	A,A
01018E ED52                A   704    	SBC	HL,DE
010190 CA 29 02 01         A   705    	JR	Z,L_14
010194 C3 4C 02 01         A   706    	JR	L_28
010198                     A   707    L__22:
010198 11690000            A   708    	LD	DE,105
01019C C5E1                A   709    	LD	HL,BC
01019E B7                  A   710    	OR	A,A
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  15


PC     Object              I  Line    Source C:\proted\Debug\main.src
01019F ED52                A   711    	SBC	HL,DE
0101A1 38 59               A   712    	JR	C,L__26
0101A3 217D0000            A   713    	LD	HL,125
0101A7 B7                  A   714    	OR	A,A
0101A8 ED42                A   715    	SBC	HL,BC
0101AA DA 4C 02 01         A   716    	JR	C,L_28
0101AE C5E1                A   717    	LD	HL,BC
0101B0 29                  A   718    	ADD	HL,HL
0101B1 29                  A   719    	ADD	HL,HL
0101B2 B7                  A   720    	OR	A,A
0101B3 ED42                A   721    	SBC	HL,BC
0101B5 11 82 00 01         A   722    	LD	DE,L__19-315
0101B9 19                  A   723    	ADD	HL,DE
0101BA ED27                A   724    	LD	HL,(HL)
0101BC E9                  A   725    	JP	(HL)
0101BD                     A   726    L__19:
0101BD 460201              A   727    	DW24	L_24	
                           A   728    
0101C0 4C0201              A   729    	DW24	L_28	
                           A   730    
0101C3 460201              A   731    	DW24	L_20	
                           A   732    
0101C6 460201              A   733    	DW24	L_23	
                           A   734    
0101C9 4C0201              A   735    	DW24	L_28	
                           A   736    
0101CC 4C0201              A   737    	DW24	L_28	
                           A   738    
0101CF 4C0201              A   739    	DW24	L_28	
                           A   740    
0101D2 460201              A   741    	DW24	L_25	
                           A   742    
0101D5 110201              A   743    	DW24	L_11	
                           A   744    
0101D8 460201              A   745    	DW24	L_22	
                           A   746    
0101DB 4C0201              A   747    	DW24	L_28	
                           A   748    
0101DE 460201              A   749    	DW24	L_26	
                           A   750    
0101E1 460201              A   751    	DW24	L_21	
                           A   752    
0101E4 4C0201              A   753    	DW24	L_28	
                           A   754    
0101E7 4C0201              A   755    	DW24	L_28	
                           A   756    
0101EA 4C0201              A   757    	DW24	L_28	
                           A   758    
0101ED 4C0201              A   759    	DW24	L_28	
                           A   760    
0101F0 190201              A   761    	DW24	L_12	
                           A   762    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  16


PC     Object              I  Line    Source C:\proted\Debug\main.src
0101F3 4C0201              A   763    	DW24	L_28	
                           A   764    
0101F6 4C0201              A   765    	DW24	L_28	
                           A   766    
0101F9 090201              A   767    	DW24	L_10	
                           A   768    
0101FC                     A   769    L__26:
0101FC 11660000            A   770    	LD	DE,102
010200 C5E1                A   771    	LD	HL,BC
010202 B7                  A   772    	OR	A,A
010203 ED52                A   773    	SBC	HL,DE
010205 28 1A               A   774    	JR	Z,L_13
010207 18 43               A   775    	JR	L_28
                           A   776    ;  247			{
                           A   777    ;  248				case 0x7D	: Ascii = 3; br
010209                     A   778    L_10:
010209 3E03                A   779    	LD	A,3
01020B 32 93 55 01         A   780    	LD	(_Ascii),A
01020F 18 3B               A   781    	JR	L_28
                           A   782    ;  249				
                           A   783    ;  250				case 0x71	: Ascii = 4; br
010211                     A   784    L_11:
010211 3E04                A   785    	LD	A,4
010213 32 93 55 01         A   786    	LD	(_Ascii),A
010217 18 33               A   787    	JR	L_28
                           A   788    ;  251	
                           A   789    ;  252				case 0x7A	: Ascii = 6; br
010219                     A   790    L_12:
010219 3E06                A   791    	LD	A,6
01021B 32 93 55 01         A   792    	LD	(_Ascii),A
01021F 18 2B               A   793    	JR	L_28
                           A   794    ;  253				
                           A   795    ;  254				case 102	: Ascii = 8; br
010221                     A   796    L_13:
010221 3E08                A   797    	LD	A,8
010223 32 93 55 01         A   798    	LD	(_Ascii),A
010227 18 23               A   799    	JR	L_28
                           A   800    ;  255				
                           A   801    ;  256				case 0xD	: Ascii = 9; br
010229                     A   802    L_14:
010229 3E09                A   803    	LD	A,9
01022B 32 93 55 01         A   804    	LD	(_Ascii),A
01022F 18 1B               A   805    	JR	L_28
                           A   806    ;  257				
                           A   807    ;  258				case 90		: Ascii = 13; b
010231                     A   808    L_15:
010231 3E0D                A   809    	LD	A,13
010233 32 93 55 01         A   810    	LD	(_Ascii),A
010237 18 13               A   811    	JR	L_28
                           A   812    ;  259				
                           A   813    ;  260				case 0x12	: while (Ascii 
010239                     A   814    L_18:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  17


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A   815    ;  261								GetCh();
010239 CD 2C 01 01         A   816    	CALL	_GetCh
01023D                     A   817    L_17:
01023D 3A 93 55 01         A   818    	LD	A,(_Ascii)
010241 B7                  A   819    	OR	A,A
010242 28 F5               A   820    	JR	Z,L_18
                           A   821    ;  262								
                           A   822    ;  263							  break;
010244 18 06               A   823    	JR	L_28
                           A   824    ;  264				
                           A   825    ;  265				case 0x6B	:
010246                     A   826    L_20:
                           A   827    ;  266				case 0x75	:
010246                     A   828    L_21:
                           A   829    ;  267				case 0x72	:
010246                     A   830    L_22:
                           A   831    ;  268				case 0x6C	:
010246                     A   832    L_23:
                           A   833    ;  269				case 0x69	:
010246                     A   834    L_24:
                           A   835    ;  270				case 0x70	:
010246                     A   836    L_25:
                           A   837    ;  271				case 0x74	: Ascii = 1; br
010246                     A   838    L_26:
010246 3E01                A   839    	LD	A,1
010248 32 93 55 01         A   840    	LD	(_Ascii),A
                           A   841    ;  272			}
01024C                     A   842    L_28:
                           A   843    ;  273			
                           A   844    ;  274			if (Ascii != 0)
01024C 3A 93 55 01         A   845    	LD	A,(_Ascii)
010250 B7                  A   846    	OR	A,A
010251 CA 4D 01 01         A   847    	JR	Z,L_30
                           A   848    ;  275				break;		
                           A   849    ;  276		}	
                           A   850    ;  277			
                           A   851    ;  278		return Ascii;
010255 3A 93 55 01         A   852    	LD	A,(_Ascii)
                           A   853    ;  279	}
010259 C9                  A   854    	RET	
                           A   855    
                           A   856    
                           A   857    ;**************************** _getch **********
                           A   858    ;Name                         Addr/Register   S
                           A   859    ;_Ascii                              STATIC    
                           A   860    ;_Scancode                           STATIC    
                           A   861    ;_GetCh                              IMPORT  --
                           A   862    
                           A   863    
                           A   864    ; Stack Frame Size: 6 (bytes)
                           A   865    ;       Spill Code: 0 (instruction)
                           A   866    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  18


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A   867    
                           A   868    ;  280	
                           A   869    ;  281	/* Print on screen a text at current x,
                           A   870    ;  282	void print(const char *Txt)
                           A   871    ;  283	{
01025A                     A   872    _print:
01025A CD 2C 25 01         A   873    	CALL	__frameset0
                           A   874    ;  284		TxtPnt = Txt;
01025E DD0706              A   875    	LD	BC,(IX+6)
010261 ED43 A2 55 01       A   876    	LD	(_TxtPnt),BC
                           A   877    ;  285		
                           A   878    ;  286		asm ("push ix");
010266 DDE5                A   879    push ix
                           A   880    ;  287		asm ("ld hl, (_TxtPnt)");
010268 2A A2 55 01         A   881    ld hl, (_TxtPnt)
                           A   882    ;  288		asm ("ld a, kr_print_string");
01026C 3E25                A   883    ld a, kr_print_string
                           A   884    ;  289		asm ("call.lil prose_kernal");
01026E 5BCD200A 00         A   885    call.lil prose_kernal
                           A   886    ;  290		asm ("pop ix");
010273 DDE1                A   887    pop ix
                           A   888    ;  291	}
010275 DDF9                A   889    	LD	SP,IX
010277 DDE1                A   890    	POP	IX
010279 C9                  A   891    	RET	
                           A   892    
                           A   893    
                           A   894    ;**************************** _print **********
                           A   895    ;Name                         Addr/Register   S
                           A   896    ;_TxtPnt                             STATIC    
                           A   897    ;Txt                                   IX+6    
                           A   898    
                           A   899    
                           A   900    ; Stack Frame Size: 9 (bytes)
                           A   901    ;       Spill Code: 0 (instruction)
                           A   902    
                           A   903    
                           A   904    ;  292	
                           A   905    ;  293	/* Get the x and the y of screen cursor
                           A   906    ;  294	void get_cursor_position(unsigned char 
                           A   907    ;  295	{
01027A                     A   908    _get_cursor_position:
01027A CD 2C 25 01         A   909    	CALL	__frameset0
                           A   910    ;  296		asm ("push ix");
01027E DDE5                A   911    push ix
                           A   912    ;  297		asm ("ld a, kr_get_cursor_position"
010280 3E32                A   913    ld a, kr_get_cursor_position
                           A   914    ;  298		asm ("call.lil prose_kernal");
010282 5BCD200A 00         A   915    call.lil prose_kernal
                           A   916    ;  299		asm ("ld a, b");
010287 78                  A   917    ld a, b
                           A   918    ;  300		asm ("ld (_B), a");
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  19


PC     Object              I  Line    Source C:\proted\Debug\main.src
010288 32 95 55 01         A   919    ld (_B), a
                           A   920    ;  301		asm ("ld a, c");
01028C 79                  A   921    ld a, c
                           A   922    ;  302		asm ("ld (_C), a");
01028D 32 96 55 01         A   923    ld (_C), a
                           A   924    ;  303		asm ("pop ix");
010291 DDE1                A   925    pop ix
                           A   926    ;  304		
                           A   927    ;  305		*X = B;
010293 DD2706              A   928    	LD	HL,(IX+6)
010296 3A 95 55 01         A   929    	LD	A,(_B)
01029A 77                  A   930    	LD	(HL),A
                           A   931    ;  306		*Y = C;
01029B DD2709              A   932    	LD	HL,(IX+9)
01029E 3A 96 55 01         A   933    	LD	A,(_C)
0102A2 77                  A   934    	LD	(HL),A
                           A   935    ;  307	}
0102A3 DDF9                A   936    	LD	SP,IX
0102A5 DDE1                A   937    	POP	IX
0102A7 C9                  A   938    	RET	
                           A   939    
                           A   940    
                           A   941    ;**************************** _get_cursor_posit
                           A   942    ;Name                         Addr/Register   S
                           A   943    ;_C                                  STATIC    
                           A   944    ;_B                                  STATIC    
                           A   945    ;Y                                     IX+9    
                           A   946    ;X                                     IX+6    
                           A   947    
                           A   948    
                           A   949    ; Stack Frame Size: 12 (bytes)
                           A   950    ;       Spill Code: 0 (instruction)
                           A   951    
                           A   952    
                           A   953    ;  308	
                           A   954    ;  309	/* Draw a character at X, Y coordinates
                           A   955    ;  310	void plot_char(unsigned char x, unsigne
                           A   956    ;  311	{
0102A8                     A   957    _plot_char:
0102A8 CD 2C 25 01         A   958    	CALL	__frameset0
                           A   959    ;  312		B = x;
0102AC DD7E06              A   960    	LD	A,(IX+6)
0102AF 32 95 55 01         A   961    	LD	(_B),A
                           A   962    ;  313		C = y;
0102B3 DD7E09              A   963    	LD	A,(IX+9)
0102B6 32 96 55 01         A   964    	LD	(_C),A
                           A   965    ;  314		E = Ch;
0102BA DD7E0C              A   966    	LD	A,(IX+12)
0102BD 32 97 55 01         A   967    	LD	(_E),A
                           A   968    ;  315		
                           A   969    ;  316		asm ("push ix");
0102C1 DDE5                A   970    push ix
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  20


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A   971    ;  317		asm ("ld hl, _B");
0102C3 21 95 55 01         A   972    ld hl, _B
                           A   973    ;  318		asm ("ld B, (hl)");
0102C7 46                  A   974    ld B, (hl)
                           A   975    ;  319		asm ("ld hl, _C");
0102C8 21 96 55 01         A   976    ld hl, _C
                           A   977    ;  320		asm ("ld C, (hl)");
0102CC 4E                  A   978    ld C, (hl)
                           A   979    ;  321		asm ("ld hl, _E");
0102CD 21 97 55 01         A   980    ld hl, _E
                           A   981    ;  322		asm ("ld E, (hl)");
0102D1 5E                  A   982    ld E, (hl)
                           A   983    ;  323		asm ("ld a, kr_plot_char");
0102D2 3E29                A   984    ld a, kr_plot_char
                           A   985    ;  324		asm ("call.lil prose_kernal");
0102D4 5BCD200A 00         A   986    call.lil prose_kernal
                           A   987    ;  325		asm ("pop ix");
0102D9 DDE1                A   988    pop ix
                           A   989    ;  326	}
0102DB DDF9                A   990    	LD	SP,IX
0102DD DDE1                A   991    	POP	IX
0102DF C9                  A   992    	RET	
                           A   993    
                           A   994    
                           A   995    ;**************************** _plot_char ******
                           A   996    ;Name                         Addr/Register   S
                           A   997    ;_E                                  STATIC    
                           A   998    ;_C                                  STATIC    
                           A   999    ;_B                                  STATIC    
                           A  1000    ;Ch                                   IX+12    
                           A  1001    ;y                                     IX+9    
                           A  1002    ;x                                     IX+6    
                           A  1003    
                           A  1004    
                           A  1005    ; Stack Frame Size: 15 (bytes)
                           A  1006    ;       Spill Code: 0 (instruction)
                           A  1007    
                           A  1008    
                           A  1009    ;  327	
                           A  1010    ;  328	/* Clear the row on screen from current
                           A  1011    ;  329	void clreol(void)
                           A  1012    ;  330	{
0102E0                     A  1013    _clreol:
0102E0 21FDFFFF            A  1014    	LD	HL,-3
0102E4 CD 39 25 01         A  1015    	CALL	__frameset
                           A  1016    ;  331		unsigned char x, y;
                           A  1017    ;  332		register char i;
                           A  1018    ;  333		
                           A  1019    ;  334		get_cursor_position(&x, &y);
0102E8 ED65FE              A  1020    	PEA	IX+-2
0102EB ED65FD              A  1021    	PEA	IX+-3
0102EE CD 7A 02 01         A  1022    	CALL	_get_cursor_position
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  21


PC     Object              I  Line    Source C:\proted\Debug\main.src
0102F2 C1                  A  1023    	POP	BC
0102F3 C1                  A  1024    	POP	BC
0102F4 DD7EFD              A  1025    	LD	A,(IX+-3)
0102F7 DD77FF              A  1026    	LD	(IX+-1),A
                           A  1027    ;  335		
                           A  1028    ;  336		for (i = x; i < 80; i++)
0102FA 18 19               A  1029    	JR	L_39
0102FC                     A  1030    L_37:
                           A  1031    ;  337			plot_char(i, y, ' ');		
0102FC 01200000            A  1032    	LD	BC,32
010300 C5                  A  1033    	PUSH	BC
010301 DD4EFE              A  1034    	LD	C,(IX+-2)
010304 0600                A  1035    	LD	B,0
010306 C5                  A  1036    	PUSH	BC
010307 DD4EFF              A  1037    	LD	C,(IX+-1)
01030A C5                  A  1038    	PUSH	BC
01030B CD A8 02 01         A  1039    	CALL	_plot_char
01030F C1                  A  1040    	POP	BC
010310 C1                  A  1041    	POP	BC
010311 C1                  A  1042    	POP	BC
010312 DD34FF              A  1043    	INC	(IX+-1)
010315                     A  1044    L_39:
010315 DD7EFF              A  1045    	LD	A,(IX+-1)
010318 FE50                A  1046    	CP	A,80
01031A FA FC 02 01         A  1047    	JP	M,L_37
                           A  1048    ;  338	}
01031E DDF9                A  1049    	LD	SP,IX
010320 DDE1                A  1050    	POP	IX
010322 C9                  A  1051    	RET	
                           A  1052    
                           A  1053    
                           A  1054    ;**************************** _clreol *********
                           A  1055    ;Name                         Addr/Register   S
                           A  1056    ;_plot_char                          IMPORT  --
                           A  1057    ;_get_cursor_position                IMPORT  --
                           A  1058    ;x                                     IX-3    
                           A  1059    ;y                                     IX-2    
                           A  1060    ;i                                     IX-1    
                           A  1061    
                           A  1062    
                           A  1063    ; Stack Frame Size: 9 (bytes)
                           A  1064    ;       Spill Code: 0 (instruction)
                           A  1065    
                           A  1066    
                           A  1067    ;  339	
                           A  1068    ;  340	/* Move screen cursor at x,y position *
                           A  1069    ;  341	void gotoxy(unsigned char x, unsigned c
                           A  1070    ;  342	{
010323                     A  1071    _gotoxy:
010323 CD 2C 25 01         A  1072    	CALL	__frameset0
                           A  1073    ;  343		B = x;
010327 DD7E06              A  1074    	LD	A,(IX+6)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  22


PC     Object              I  Line    Source C:\proted\Debug\main.src
01032A 32 95 55 01         A  1075    	LD	(_B),A
                           A  1076    ;  344		C = y;
01032E DD7E09              A  1077    	LD	A,(IX+9)
010331 32 96 55 01         A  1078    	LD	(_C),A
                           A  1079    ;  345		
                           A  1080    ;  346		asm ("push ix");
010335 DDE5                A  1081    push ix
                           A  1082    ;  347		asm ("ld hl, _B");
010337 21 95 55 01         A  1083    ld hl, _B
                           A  1084    ;  348		asm ("ld B, (hl)");
01033B 46                  A  1085    ld B, (hl)
                           A  1086    ;  349		asm ("ld hl, _C");
01033C 21 96 55 01         A  1087    ld hl, _C
                           A  1088    ;  350		asm ("ld C, (hl)");
010340 4E                  A  1089    ld C, (hl)
                           A  1090    ;  351		asm ("ld a, kr_set_cursor_position"
010341 3E28                A  1091    ld a, kr_set_cursor_position
                           A  1092    ;  352		asm ("call.lil prose_kernal");
010343 5BCD200A 00         A  1093    call.lil prose_kernal
                           A  1094    ;  353		asm ("pop ix");
010348 DDE1                A  1095    pop ix
                           A  1096    ;  354	}
01034A DDF9                A  1097    	LD	SP,IX
01034C DDE1                A  1098    	POP	IX
01034E C9                  A  1099    	RET	
                           A  1100    
                           A  1101    
                           A  1102    ;**************************** _gotoxy *********
                           A  1103    ;Name                         Addr/Register   S
                           A  1104    ;_C                                  STATIC    
                           A  1105    ;_B                                  STATIC    
                           A  1106    ;y                                     IX+9    
                           A  1107    ;x                                     IX+6    
                           A  1108    
                           A  1109    
                           A  1110    ; Stack Frame Size: 12 (bytes)
                           A  1111    ;       Spill Code: 0 (instruction)
                           A  1112    
                           A  1113    
                           A  1114    ;  355	
                           A  1115    ;  356	/* Return only PROSE version */
                           A  1116    ;  357	int get_prose_version(void)
                           A  1117    ;  358	{
01034F                     A  1118    _get_prose_version:
                           A  1119    ;  359		asm ("push ix");
01034F DDE5                A  1120    push ix
                           A  1121    ;  360		asm ("push de");
010351 D5                  A  1122    push de
                           A  1123    ;  361		asm ("push hl");
010352 E5                  A  1124    push hl
                           A  1125    ;  362		asm ("ld a, kr_get_version");
010353 3E3E                A  1126    ld a, kr_get_version
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  23


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1127    ;  363		asm ("call.lil prose_kernal");
010355 5BCD200A 00         A  1128    call.lil prose_kernal
                           A  1129    ;  364		asm ("ld (_K_xBC), hl");
01035A 22 9C 55 01         A  1130    ld (_K_xBC), hl
                           A  1131    ;  365		asm ("pop hl");
01035E E1                  A  1132    pop hl
                           A  1133    ;  366		asm ("pop de");
01035F D1                  A  1134    pop de
                           A  1135    ;  367		asm ("pop ix");
010360 DDE1                A  1136    pop ix
                           A  1137    ;  368		
                           A  1138    ;  369		return K_xBC;
010362 2A 9C 55 01         A  1139    	LD	HL,(_K_xBC)
                           A  1140    ;  370	}
010366 C9                  A  1141    	RET	
                           A  1142    
                           A  1143    
                           A  1144    ;**************************** _get_prose_versio
                           A  1145    ;Name                         Addr/Register   S
                           A  1146    ;_K_xBC                              STATIC    
                           A  1147    
                           A  1148    
                           A  1149    ; Stack Frame Size: 6 (bytes)
                           A  1150    ;       Spill Code: 0 (instruction)
                           A  1151    
                           A  1152    
                           A  1153    ;  371	
                           A  1154    ;  372	/* Return PROSE screen dimension stored
                           A  1155    ;  373	void get_display_size(void)
                           A  1156    ;  374	{
010367                     A  1157    _get_display_size:
                           A  1158    ;  375		asm ("push ix");
010367 DDE5                A  1159    push ix
                           A  1160    ;  376		asm ("ld a, kr_get_display_size");
010369 3E30                A  1161    ld a, kr_get_display_size
                           A  1162    ;  377		asm ("call.lil prose_kernal");
01036B 5BCD200A 00         A  1163    call.lil prose_kernal
                           A  1164    ;  378		asm ("ld a, b");
010370 78                  A  1165    ld a, b
                           A  1166    ;  379		asm ("ld (_B), a");
010371 32 95 55 01         A  1167    ld (_B), a
                           A  1168    ;  380		asm ("ld a, c");
010375 79                  A  1169    ld a, c
                           A  1170    ;  381		asm ("ld (_C), a");
010376 32 96 55 01         A  1171    ld (_C), a
                           A  1172    ;  382		asm ("pop ix");
01037A DDE1                A  1173    pop ix
                           A  1174    ;  383	}
01037C C9                  A  1175    	RET	
                           A  1176    
                           A  1177    
                           A  1178    ;**************************** _get_display_size
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  24


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1179    ;Name                         Addr/Register   S
                           A  1180    
                           A  1181    
                           A  1182    ; Stack Frame Size: 6 (bytes)
                           A  1183    ;       Spill Code: 0 (instruction)
                           A  1184    
                           A  1185    
                           A  1186    ;  384	
                           A  1187    ;  385	/*-------------------------------------
                           A  1188    ;  386	
                           A  1189    ;  387	/* Writes out its argument string and t
                           A  1190    ;  388	void bomb(char *txt)
                           A  1191    ;  389	{
01037D                     A  1192    _bomb:
01037D CD 2C 25 01         A  1193    	CALL	__frameset0
                           A  1194    ;  390		msg_window("Proted assertion failur
010381 DD0706              A  1195    	LD	BC,(IX+6)
010384 C5                  A  1196    	PUSH	BC
010385 01 0C 27 01         A  1197    	LD	BC,L__40
010389 C5                  A  1198    	PUSH	BC
01038A CD 52 20 01         A  1199    	CALL	_msg_window
01038E C1                  A  1200    	POP	BC
01038F C1                  A  1201    	POP	BC
                           A  1202    ;  391		
                           A  1203    ;  392		while (1)
010390                     A  1204    L_46:
                           A  1205    ;  393		{
                           A  1206    ;  394			getch();
010390 CD 4D 01 01         A  1207    	CALL	_getch
                           A  1208    ;  395			
                           A  1209    ;  396			if (Ascii == 13)
010394 3A 93 55 01         A  1210    	LD	A,(_Ascii)
010398 FE0D                A  1211    	CP	A,13
01039A 20 F4               A  1212    	JR	NZ,L_46
                           A  1213    ;  397				break;
                           A  1214    ;  398		}
                           A  1215    ;  399	
                           A  1216    ;  400		asm ("ld a, 0ffh");
01039C 3EFF                A  1217    ld a, 0ffh
                           A  1218    ;  401		asm ("jp.lil prose_return");
01039E 5BC3140A 00         A  1219    jp.lil prose_return
                           A  1220    ;  402	}
0103A3 DDF9                A  1221    	LD	SP,IX
0103A5 DDE1                A  1222    	POP	IX
0103A7 C9                  A  1223    	RET	
                           A  1224    
                           A  1225    
                           A  1226    ;**************************** _bomb ***********
                           A  1227    ;Name                         Addr/Register   S
                           A  1228    ;_Ascii                              STATIC    
                           A  1229    ;_getch                              IMPORT  --
                           A  1230    ;_msg_window                         IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  25


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1231    ;txt                                   IX+6    
                           A  1232    
                           A  1233    
                           A  1234    ; Stack Frame Size: 9 (bytes)
                           A  1235    ;       Spill Code: 0 (instruction)
                           A  1236    
                           A  1237    
                           A  1238    	SEGMENT STRSECT
01270C                     A  1239    L__40:
01270C 50726F74 65642061   A  1240    	DB	"Proted assertion failure. Press RETURN
012714 73736572 74696F6E 
01271C 20666169 6C757265 
012724 2E205072 65737320 
01272C 52455455 524E2074 
012734 6F206162 6F727421 
01273C 00                  A  1241    	DB	0
                           A  1242    	SEGMENT CODE
                           A  1243    ;  403	
                           A  1244    ;  404	/* Bombs with an assertion failure if i
                           A  1245    ;  405	void as(char b, char *txt)
                           A  1246    ;  406	{
0103A8                     A  1247    _as:
0103A8 CD 2C 25 01         A  1248    	CALL	__frameset0
                           A  1249    ;  407		if (!b)
0103AC DD7E06              A  1250    	LD	A,(IX+6)
0103AF B7                  A  1251    	OR	A,A
0103B0 20 09               A  1252    	JR	NZ,L_50
                           A  1253    ;  408			bomb(txt);
0103B2 DD0709              A  1254    	LD	BC,(IX+9)
0103B5 C5                  A  1255    	PUSH	BC
0103B6 CD 7D 03 01         A  1256    	CALL	_bomb
0103BA C1                  A  1257    	POP	BC
                           A  1258    ;  409	}
0103BB                     A  1259    L_50:
0103BB DDF9                A  1260    	LD	SP,IX
0103BD DDE1                A  1261    	POP	IX
0103BF C9                  A  1262    	RET	
                           A  1263    
                           A  1264    
                           A  1265    ;**************************** _as *************
                           A  1266    ;Name                         Addr/Register   S
                           A  1267    ;_bomb                               IMPORT  --
                           A  1268    ;txt                                   IX+9    
                           A  1269    ;b                                     IX+6    
                           A  1270    
                           A  1271    
                           A  1272    ; Stack Frame Size: 12 (bytes)
                           A  1273    ;       Spill Code: 0 (instruction)
                           A  1274    
                           A  1275    
                           A  1276    ;  410	
                           A  1277    ;  411	/* Convert an unsigned int into string 
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  26


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1278    ;  412	void uitoa(unsigned int val, char *stri
                           A  1279    ;  413	{
0103C0                     A  1280    _uitoa:
0103C0 21FAFFFF            A  1281    	LD	HL,-6
0103C4 CD 39 25 01         A  1282    	CALL	__frameset
                           A  1283    ;  414		char index = 0, i = 0;
0103C8 DD36FF00            A  1284    	LD	(IX+-1),0
0103CC DD36FE00            A  1285    	LD	(IX+-2),0
                           A  1286    ;  415		
                           A  1287    ;  416		do {
0103D0                     A  1288    L_53:
                           A  1289    ;  417			string[index] = '0' + (val % 10
0103D0 DD7EFF              A  1290    	LD	A,(IX+-1)
0103D3 17ED62              A  1291    	SEXT	HL
0103D6 DD6EFF              A  1292    	LD	L,(IX+-1)
0103D9 DD0709              A  1293    	LD	BC,(IX+9)
0103DC 09                  A  1294    	ADD	HL,BC
0103DD DD2FFB              A  1295    	LD	(IX+-5),HL
0103E0 DD2706              A  1296    	LD	HL,(IX+6)
0103E3 010A0000            A  1297    	LD	BC,10
0103E7 CD ED 24 01         A  1298    	CALL	__iremu
0103EB 7D                  A  1299    	LD	A,L
0103EC C630                A  1300    	ADD	A,48
0103EE DD27FB              A  1301    	LD	HL,(IX+-5)
0103F1 77                  A  1302    	LD	(HL),A
                           A  1303    ;  418			
                           A  1304    ;  419			if (string[index] > '9')
0103F2 DD27FB              A  1305    	LD	HL,(IX+-5)
0103F5 7E                  A  1306    	LD	A,(HL)
0103F6 47                  A  1307    	LD	B,A
0103F7 17ED62              A  1308    	SEXT	HL
0103FA 68                  A  1309    	LD	L,B
0103FB E5C1                A  1310    	LD	BC,HL
0103FD 21390000            A  1311    	LD	HL,57
010401 B7                  A  1312    	OR	A,A
010402 ED42                A  1313    	SBC	HL,BC
010404 F2 12 04 01         A  1314    	JP	P,L_52
                           A  1315    ;  420				string[index] += 'A' - '9' 
010408 DD27FB              A  1316    	LD	HL,(IX+-5)
01040B 7E                  A  1317    	LD	A,(HL)
01040C C607                A  1318    	ADD	A,7
01040E DD27FB              A  1319    	LD	HL,(IX+-5)
010411 77                  A  1320    	LD	(HL),A
010412                     A  1321    L_52:
                           A  1322    ;  421			
                           A  1323    ;  422			val /= 10;
010412 010A0000            A  1324    	LD	BC,10
010416 DD2706              A  1325    	LD	HL,(IX+6)
010419 CD 0B 25 01         A  1326    	CALL	__idivu
01041D DD2F06              A  1327    	LD	(IX+6),HL
                           A  1328    ;  423			++index;
010420 DD34FF              A  1329    	INC	(IX+-1)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  27


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1330    ;  424	  } while (val != 0);
010423 DD2706              A  1331    	LD	HL,(IX+6)
010426 B7                  A  1332    	OR	A,A
010427 01000000            A  1333    	LD	BC,0
01042B ED42                A  1334    	SBC	HL,BC
01042D 20 A1               A  1335    	JR	NZ,L_53
                           A  1336    ;  425	  
                           A  1337    ;  426	  string[index--] = '\0'; 
01042F DD7EFF              A  1338    	LD	A,(IX+-1)
010432 17ED62              A  1339    	SEXT	HL
010435 DD6EFF              A  1340    	LD	L,(IX+-1)
010438 DD0709              A  1341    	LD	BC,(IX+9)
01043B 09                  A  1342    	ADD	HL,BC
01043C 3600                A  1343    	LD	(HL),0
01043E DD35FF              A  1344    	DEC	(IX+-1)
                           A  1345    ;  427	  
                           A  1346    ;  428	  while (index > i)
010441 18 49               A  1347    	JR	L_57
010443                     A  1348    L_58:
                           A  1349    ;  429	  {
                           A  1350    ;  430	    char tmp = string[i];
010443 DD7EFE              A  1351    	LD	A,(IX+-2)
010446 17ED62              A  1352    	SEXT	HL
010449 DD6EFE              A  1353    	LD	L,(IX+-2)
01044C DD0709              A  1354    	LD	BC,(IX+9)
01044F 09                  A  1355    	ADD	HL,BC
010450 7E                  A  1356    	LD	A,(HL)
010451 DD77FA              A  1357    	LD	(IX+-6),A
                           A  1358    ;  431		  
                           A  1359    ;  432	    string[i] = string[index];
010454 DD7EFF              A  1360    	LD	A,(IX+-1)
010457 17ED62              A  1361    	SEXT	HL
01045A DD6EFF              A  1362    	LD	L,(IX+-1)
01045D DD7EFE              A  1363    	LD	A,(IX+-2)
010460 DD0709              A  1364    	LD	BC,(IX+9)
010463 09                  A  1365    	ADD	HL,BC
010464 E5FDE1              A  1366    	LD	IY,HL
010467 17ED62              A  1367    	SEXT	HL
01046A DD6EFE              A  1368    	LD	L,(IX+-2)
01046D FD7E00              A  1369    	LD	A,(IY)
010470 DD0709              A  1370    	LD	BC,(IX+9)
010473 09                  A  1371    	ADD	HL,BC
010474 77                  A  1372    	LD	(HL),A
                           A  1373    ;  433	    string[index] = tmp;
010475 DD7EFF              A  1374    	LD	A,(IX+-1)
010478 17ED62              A  1375    	SEXT	HL
01047B DD6EFF              A  1376    	LD	L,(IX+-1)
01047E DD7EFA              A  1377    	LD	A,(IX+-6)
010481 DD0709              A  1378    	LD	BC,(IX+9)
010484 09                  A  1379    	ADD	HL,BC
010485 77                  A  1380    	LD	(HL),A
                           A  1381    ;  434	    ++i;
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  28


PC     Object              I  Line    Source C:\proted\Debug\main.src
010486 DD34FE              A  1382    	INC	(IX+-2)
                           A  1383    ;  435	    --index;
010489 DD35FF              A  1384    	DEC	(IX+-1)
                           A  1385    ;  436	  }
01048C                     A  1386    L_57:
01048C DD7EFE              A  1387    	LD	A,(IX+-2)
01048F DDBEFF              A  1388    	CP	A,(IX+-1)
010492 FA 9C 04 01         A  1389    	JP	M,L__48
010496 EA 43 04 01         A  1390    	JP	PE,L_58
01049A 18 04               A  1391    	JR	L__49
01049C                     A  1392    L__48:
01049C E2 43 04 01         A  1393    	JP	PO,L_58
0104A0                     A  1394    L__49:
                           A  1395    ;  437	}
0104A0 DDF9                A  1396    	LD	SP,IX
0104A2 DDE1                A  1397    	POP	IX
0104A4 C9                  A  1398    	RET	
                           A  1399    
                           A  1400    
                           A  1401    ;**************************** _uitoa **********
                           A  1402    ;Name                         Addr/Register   S
                           A  1403    ;tmp                                   IX-6    
                           A  1404    ;G_0                                   IX-5    
                           A  1405    ;i                                     IX-2    
                           A  1406    ;index                                 IX-1    
                           A  1407    ;string                                IX+9    
                           A  1408    ;val                                   IX+6    
                           A  1409    
                           A  1410    
                           A  1411    ; Stack Frame Size: 18 (bytes)
                           A  1412    ;       Spill Code: 0 (instruction)
                           A  1413    
                           A  1414    
                           A  1415    ;  438	
                           A  1416    ;  439	/* The same as malloc except it bombs i
                           A  1417    ;  440	void *mymalloc(size_t n)
                           A  1418    ;  441	{
0104A5                     A  1419    _mymalloc:
0104A5 21FDFFFF            A  1420    	LD	HL,-3
0104A9 CD 39 25 01         A  1421    	CALL	__frameset
                           A  1422    ;  442		void *p;
                           A  1423    ;  443		
                           A  1424    ;  444		if (n == 0)
0104AD 01000000            A  1425    	LD	BC,0
0104B1 DD2706              A  1426    	LD	HL,(IX+6)
0104B4 B7                  A  1427    	OR	A,A
0104B5 ED42                A  1428    	SBC	HL,BC
0104B7 20 07               A  1429    	JR	NZ,L_62
                           A  1430    ;  445			n++;
0104B9 DD0706              A  1431    	LD	BC,(IX+6)
0104BC 03                  A  1432    	INC	BC
0104BD DD0F06              A  1433    	LD	(IX+6),BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  29


PC     Object              I  Line    Source C:\proted\Debug\main.src
0104C0                     A  1434    L_62:
                           A  1435    ;  446		
                           A  1436    ;  447		p = malloc(n);
0104C0 DD0706              A  1437    	LD	BC,(IX+6)
0104C3 C5                  A  1438    	PUSH	BC
0104C4 CD 1F 24 01         A  1439    	CALL	_malloc
0104C8 C1                  A  1440    	POP	BC
0104C9 DD2FFD              A  1441    	LD	(IX+-3),HL
                           A  1442    ;  448		
                           A  1443    ;  449		as(p != NULL, "out of memory!");
0104CC 01 3D 27 01         A  1444    	LD	BC,L__52
0104D0 C5                  A  1445    	PUSH	BC
0104D1 DD27FD              A  1446    	LD	HL,(IX+-3)
0104D4 01000000            A  1447    	LD	BC,0
0104D8 B7                  A  1448    	OR	A,A
0104D9 ED42                A  1449    	SBC	HL,BC
0104DB 28 04               A  1450    	JR	Z,L__54
0104DD 3E01                A  1451    	LD	A,1
0104DF 18 01               A  1452    	JR	L__55
0104E1                     A  1453    L__54:
0104E1 AF                  A  1454    	XOR	A,A
0104E2                     A  1455    L__55:
0104E2 4F                  A  1456    	LD	C,A
0104E3 0600                A  1457    	LD	B,0
0104E5 C5                  A  1458    	PUSH	BC
0104E6 CD A8 03 01         A  1459    	CALL	_as
0104EA C1                  A  1460    	POP	BC
0104EB C1                  A  1461    	POP	BC
                           A  1462    ;  450		
                           A  1463    ;  451		return p;
0104EC DD27FD              A  1464    	LD	HL,(IX+-3)
                           A  1465    ;  452	}
0104EF DDF9                A  1466    	LD	SP,IX
0104F1 DDE1                A  1467    	POP	IX
0104F3 C9                  A  1468    	RET	
                           A  1469    
                           A  1470    
                           A  1471    ;**************************** _mymalloc *******
                           A  1472    ;Name                         Addr/Register   S
                           A  1473    ;_as                                 IMPORT  --
                           A  1474    ;_malloc                             IMPORT  --
                           A  1475    ;p                                     IX-3    
                           A  1476    ;n                                     IX+6    
                           A  1477    
                           A  1478    
                           A  1479    ; Stack Frame Size: 12 (bytes)
                           A  1480    ;       Spill Code: 0 (instruction)
                           A  1481    
                           A  1482    
                           A  1483    	SEGMENT STRSECT
01273D                     A  1484    L__52:
01273D 6F757420 6F66206D   A  1485    	DB	"out of memory!"
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  30


PC     Object              I  Line    Source C:\proted\Debug\main.src
012745 656D6F72 7921 
01274B 00                  A  1486    	DB	0
                           A  1487    	SEGMENT CODE
                           A  1488    ;  453	
                           A  1489    ;  454	/* Returns TRUE if p[0..SCNCOLS - 1] ar
                           A  1490    ;  455	char blankrow(char *p)
                           A  1491    ;  456	{
0104F4                     A  1492    _blankrow:
0104F4 21FFFFFF            A  1493    	LD	HL,-1
0104F8 CD 39 25 01         A  1494    	CALL	__frameset
0104FC DD36FF00            A  1495    	LD	(IX+-1),0
                           A  1496    ;  457		register unsigned char i;
                           A  1497    ;  458		
                           A  1498    ;  459		for (i = 0; i < SCNCOLS; i++)
010500 18 20               A  1499    	JR	L_68
010502                     A  1500    L_66:
                           A  1501    ;  460			if (p[i] != ' ')
010502 DD7EFF              A  1502    	LD	A,(IX+-1)
010505 B7ED62              A  1503    	UEXT	HL
010508 6F                  A  1504    	LD	L,A
010509 DD0706              A  1505    	LD	BC,(IX+6)
01050C 09                  A  1506    	ADD	HL,BC
01050D 7E                  A  1507    	LD	A,(HL)
01050E 47                  A  1508    	LD	B,A
01050F 17ED62              A  1509    	SEXT	HL
010512 68                  A  1510    	LD	L,B
010513 B7                  A  1511    	OR	A,A
010514 01200000            A  1512    	LD	BC,32
010518 ED42                A  1513    	SBC	HL,BC
01051A 28 03               A  1514    	JR	Z,L_67
                           A  1515    ;  461				return FALSE;
01051C AF                  A  1516    	XOR	A,A
01051D 18 0C               A  1517    	JR	L_70
01051F                     A  1518    L_67:
01051F DD34FF              A  1519    	INC	(IX+-1)
010522                     A  1520    L_68:
010522 DD7EFF              A  1521    	LD	A,(IX+-1)
010525 FE50                A  1522    	CP	A,80
010527 38 D9               A  1523    	JR	C,L_66
                           A  1524    ;  462			
                           A  1525    ;  463		return TRUE;
010529 3E01                A  1526    	LD	A,1
                           A  1527    ;  464	}
01052B                     A  1528    L_70:
01052B DDF9                A  1529    	LD	SP,IX
01052D DDE1                A  1530    	POP	IX
01052F C9                  A  1531    	RET	
                           A  1532    
                           A  1533    
                           A  1534    ;**************************** _blankrow *******
                           A  1535    ;Name                         Addr/Register   S
                           A  1536    ;i                                     IX-1    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  31


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1537    ;p                                     IX+6    
                           A  1538    
                           A  1539    
                           A  1540    ; Stack Frame Size: 10 (bytes)
                           A  1541    ;       Spill Code: 0 (instruction)
                           A  1542    
                           A  1543    
                           A  1544    ;  465	
                           A  1545    ;  466	/* Deletes trailing blanks from its arg
                           A  1546    ;  467	void zap_trail(char *s)
                           A  1547    ;  468	{
010530                     A  1548    _zap_trail:
010530 21FDFFFF            A  1549    	LD	HL,-3
010534 CD 39 25 01         A  1550    	CALL	__frameset
                           A  1551    ;  469		char *p = s;
010538 DD0706              A  1552    	LD	BC,(IX+6)
01053B DD0FFD              A  1553    	LD	(IX+-3),BC
                           A  1554    ;  470		
                           A  1555    ;  471		while (*s != EOS)
01053E 18 20               A  1556    	JR	L_74
010540                     A  1557    L_75:
                           A  1558    ;  472		{
                           A  1559    ;  473			if (*s != ' ')
010540 DD2706              A  1560    	LD	HL,(IX+6)
010543 7E                  A  1561    	LD	A,(HL)
010544 47                  A  1562    	LD	B,A
010545 17ED62              A  1563    	SEXT	HL
010548 68                  A  1564    	LD	L,B
010549 B7                  A  1565    	OR	A,A
01054A 01200000            A  1566    	LD	BC,32
01054E ED42                A  1567    	SBC	HL,BC
010550 28 07               A  1568    	JR	Z,L_73
                           A  1569    ;  474				p = s + 1;
010552 DD0706              A  1570    	LD	BC,(IX+6)
010555 03                  A  1571    	INC	BC
010556 DD0FFD              A  1572    	LD	(IX+-3),BC
010559                     A  1573    L_73:
                           A  1574    ;  475			
                           A  1575    ;  476			s++;
010559 DD0706              A  1576    	LD	BC,(IX+6)
01055C 03                  A  1577    	INC	BC
01055D DD0F06              A  1578    	LD	(IX+6),BC
                           A  1579    ;  477		}
010560                     A  1580    L_74:
010560 DD2706              A  1581    	LD	HL,(IX+6)
010563 7E                  A  1582    	LD	A,(HL)
010564 B7                  A  1583    	OR	A,A
010565 20 D9               A  1584    	JR	NZ,L_75
                           A  1585    ;  478		
                           A  1586    ;  479		*p = EOS;
010567 DD27FD              A  1587    	LD	HL,(IX+-3)
01056A 3600                A  1588    	LD	(HL),0
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  32


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1589    ;  480	}
01056C DDF9                A  1590    	LD	SP,IX
01056E DDE1                A  1591    	POP	IX
010570 C9                  A  1592    	RET	
                           A  1593    
                           A  1594    
                           A  1595    ;**************************** _zap_trail ******
                           A  1596    ;Name                         Addr/Register   S
                           A  1597    ;p                                     IX-3    
                           A  1598    ;s                                     IX+6    
                           A  1599    
                           A  1600    
                           A  1601    ; Stack Frame Size: 12 (bytes)
                           A  1602    ;       Spill Code: 0 (instruction)
                           A  1603    
                           A  1604    
                           A  1605    ;  481	
                           A  1606    ;  482	/* Deletes all non-printables from the 
                           A  1607    ;  483	/* Replaces each TAB by a space.       
                           A  1608    ;  484	void purify(char *st)
                           A  1609    ;  485	{
010571                     A  1610    _purify:
010571 21F4FFFF            A  1611    	LD	HL,-12
010575 CD 39 25 01         A  1612    	CALL	__frameset
                           A  1613    ;  486		char *s = st;
010579 DD0706              A  1614    	LD	BC,(IX+6)
01057C DD0FFD              A  1615    	LD	(IX+-3),BC
                           A  1616    ;  487		char *d = st;
01057F DD0706              A  1617    	LD	BC,(IX+6)
010582 DD0FFA              A  1618    	LD	(IX+-6),BC
                           A  1619    ;  488		
                           A  1620    ;  489		while (*s)
010585 18 73               A  1621    	JR	L_86
010587                     A  1622    L_87:
                           A  1623    ;  490		{
                           A  1624    ;  491			if ((' ' <= *s) && (*s <= '~'))
010587 DD27FD              A  1625    	LD	HL,(IX+-3)
01058A 7E                  A  1626    	LD	A,(HL)
01058B 47                  A  1627    	LD	B,A
01058C 17ED62              A  1628    	SEXT	HL
01058F 68                  A  1629    	LD	L,B
010590 B7                  A  1630    	OR	A,A
010591 01200000            A  1631    	LD	BC,32
010595 ED42                A  1632    	SBC	HL,BC
010597 FA D0 05 01         A  1633    	JP	M,L_83
01059B DD27FD              A  1634    	LD	HL,(IX+-3)
01059E 7E                  A  1635    	LD	A,(HL)
01059F 47                  A  1636    	LD	B,A
0105A0 17ED62              A  1637    	SEXT	HL
0105A3 68                  A  1638    	LD	L,B
0105A4 E5C1                A  1639    	LD	BC,HL
0105A6 217E0000            A  1640    	LD	HL,126
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  33


PC     Object              I  Line    Source C:\proted\Debug\main.src
0105AA B7                  A  1641    	OR	A,A
0105AB ED42                A  1642    	SBC	HL,BC
0105AD FA B7 05 01         A  1643    	JP	M,L__67
0105B1 EA D0 05 01         A  1644    	JP	PE,L_83
0105B5 18 04               A  1645    	JR	L__68
0105B7                     A  1646    L__67:
0105B7 E2 D0 05 01         A  1647    	JP	PO,L_83
0105BB                     A  1648    L__68:
                           A  1649    ;  492				*d++ = *s;
0105BB DD07FA              A  1650    	LD	BC,(IX+-6)
0105BE DD0FF7              A  1651    	LD	(IX+-9),BC
0105C1 DD27FD              A  1652    	LD	HL,(IX+-3)
0105C4 7E                  A  1653    	LD	A,(HL)
0105C5 DD27F7              A  1654    	LD	HL,(IX+-9)
0105C8 77                  A  1655    	LD	(HL),A
0105C9 DD07FA              A  1656    	LD	BC,(IX+-6)
0105CC 03                  A  1657    	INC	BC
0105CD DD0FFA              A  1658    	LD	(IX+-6),BC
0105D0                     A  1659    L_83:
                           A  1660    ;  493			
                           A  1661    ;  494			if (*s == CH_TAB)		
0105D0 DD27FD              A  1662    	LD	HL,(IX+-3)
0105D3 7E                  A  1663    	LD	A,(HL)
0105D4 47                  A  1664    	LD	B,A
0105D5 17ED62              A  1665    	SEXT	HL
0105D8 68                  A  1666    	LD	L,B
0105D9 B7                  A  1667    	OR	A,A
0105DA 01090000            A  1668    	LD	BC,9
0105DE ED42                A  1669    	SBC	HL,BC
0105E0 20 11               A  1670    	JR	NZ,L_85
                           A  1671    ;  495				*d++ = ' ';
0105E2 DD07FA              A  1672    	LD	BC,(IX+-6)
0105E5 DD0FF4              A  1673    	LD	(IX+-12),BC
0105E8 C5E1                A  1674    	LD	HL,BC
0105EA 3620                A  1675    	LD	(HL),32
0105EC DD07FA              A  1676    	LD	BC,(IX+-6)
0105EF 03                  A  1677    	INC	BC
0105F0 DD0FFA              A  1678    	LD	(IX+-6),BC
0105F3                     A  1679    L_85:
                           A  1680    ;  496			
                           A  1681    ;  497			s++;
0105F3 DD07FD              A  1682    	LD	BC,(IX+-3)
0105F6 03                  A  1683    	INC	BC
0105F7 DD0FFD              A  1684    	LD	(IX+-3),BC
                           A  1685    ;  498		}
0105FA                     A  1686    L_86:
0105FA DD27FD              A  1687    	LD	HL,(IX+-3)
0105FD 7E                  A  1688    	LD	A,(HL)
0105FE B7                  A  1689    	OR	A,A
0105FF 20 86               A  1690    	JR	NZ,L_87
                           A  1691    ;  499		
                           A  1692    ;  500		*d = EOS;
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  34


PC     Object              I  Line    Source C:\proted\Debug\main.src
010601 DD27FA              A  1693    	LD	HL,(IX+-6)
010604 3600                A  1694    	LD	(HL),0
                           A  1695    ;  501	}
010606 DDF9                A  1696    	LD	SP,IX
010608 DDE1                A  1697    	POP	IX
01060A C9                  A  1698    	RET	
                           A  1699    
                           A  1700    
                           A  1701    ;**************************** _purify *********
                           A  1702    ;Name                         Addr/Register   S
                           A  1703    ;d                                     IX-6    
                           A  1704    ;s                                     IX-3    
                           A  1705    ;st                                    IX+6    
                           A  1706    
                           A  1707    
                           A  1708    ; Stack Frame Size: 21 (bytes)
                           A  1709    ;       Spill Code: 0 (instruction)
                           A  1710    
                           A  1711    
                           A  1712    ;  502	
                           A  1713    ;  503	/* Flushes the terminal's output buffer
                           A  1714    ;  504	void te_flu(void)
                           A  1715    ;  505	{
01060B                     A  1716    _te_flu:
                           A  1717    ;  506		if (tebuflen == 0)
01060B 01000000            A  1718    	LD	BC,0
01060F 2A 8E 2C 01         A  1719    	LD	HL,(_tebuflen)
010613 B7                  A  1720    	OR	A,A
010614 ED42                A  1721    	SBC	HL,BC
010616 28 1A               A  1722    	JR	Z,L_92
                           A  1723    ;  507			return;
                           A  1724    ;  508		
                           A  1725    ;  509		tebuf[tebuflen] = EOS;
                           A  1726    ;  510		
                           A  1727    ;  511		print(tebuf);
010618 01 91 2C 01         A  1728    	LD	BC,_tebuf
01061C C5                  A  1729    	PUSH	BC
01061D 2A 8E 2C 01         A  1730    	LD	HL,(_tebuflen)
010621 09                  A  1731    	ADD	HL,BC
010622 3600                A  1732    	LD	(HL),0
010624 CD 5A 02 01         A  1733    	CALL	_print
010628 C1                  A  1734    	POP	BC
                           A  1735    ;  512		
                           A  1736    ;  513		tebuflen = 0;
010629 01000000            A  1737    	LD	BC,0
01062D ED43 8E 2C 01       A  1738    	LD	(_tebuflen),BC
                           A  1739    ;  514	}
010632                     A  1740    L_92:
010632 C9                  A  1741    	RET	
                           A  1742    
                           A  1743    
                           A  1744    ;**************************** _te_flu *********
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  35


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1745    ;Name                         Addr/Register   S
                           A  1746    ;_print                              IMPORT  --
                           A  1747    ;_tebuf                              STATIC   2
                           A  1748    ;_tebuflen                           STATIC    
                           A  1749    
                           A  1750    
                           A  1751    ; Stack Frame Size: 6 (bytes)
                           A  1752    ;       Spill Code: 0 (instruction)
                           A  1753    
                           A  1754    
                           A  1755    ;  515	
                           A  1756    ;  516	/* Get a character from the console. */
                           A  1757    ;  517	unsigned char te_gch(void)
                           A  1758    ;  518	{
010633                     A  1759    _te_gch:
                           A  1760    ;  519		te_flu();
010633 CD 0B 06 01         A  1761    	CALL	_te_flu
                           A  1762    ;  520		
                           A  1763    ;  521		return getch();
010637 CD 4D 01 01         A  1764    	CALL	_getch
                           A  1765    ;  522	}
01063B C9                  A  1766    	RET	
                           A  1767    
                           A  1768    
                           A  1769    ;**************************** _te_gch *********
                           A  1770    ;Name                         Addr/Register   S
                           A  1771    ;_getch                              IMPORT  --
                           A  1772    ;_te_flu                             IMPORT  --
                           A  1773    
                           A  1774    
                           A  1775    ; Stack Frame Size: 6 (bytes)
                           A  1776    ;       Spill Code: 0 (instruction)
                           A  1777    
                           A  1778    
                           A  1779    ;  523	
                           A  1780    ;  524	/* Writes its argument character to the
                           A  1781    ;  525	void te_chr(char ch)
                           A  1782    ;  526	{
01063C                     A  1783    _te_chr:
01063C CD 2C 25 01         A  1784    	CALL	__frameset0
                           A  1785    ;  527		tebuf[tebuflen++] = (char) ch;
010640 01 91 2C 01         A  1786    	LD	BC,_tebuf
010644 2A 8E 2C 01         A  1787    	LD	HL,(_tebuflen)
010648 09                  A  1788    	ADD	HL,BC
010649 DD7E06              A  1789    	LD	A,(IX+6)
01064C 77                  A  1790    	LD	(HL),A
01064D ED4B 8E 2C 01       A  1791    	LD	BC,(_tebuflen)
010652 03                  A  1792    	INC	BC
010653 ED43 8E 2C 01       A  1793    	LD	(_tebuflen),BC
                           A  1794    ;  528		
                           A  1795    ;  529		if (tebuflen == TEBUFMAX)
010658 2A 8E 2C 01         A  1796    	LD	HL,(_tebuflen)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  36


PC     Object              I  Line    Source C:\proted\Debug\main.src
01065C B7                  A  1797    	OR	A,A
01065D 01000800            A  1798    	LD	BC,2048
010661 ED42                A  1799    	SBC	HL,BC
010663 20 04               A  1800    	JR	NZ,L_96
                           A  1801    ;  530			te_flu();
010665 CD 0B 06 01         A  1802    	CALL	_te_flu
                           A  1803    ;  531	}
010669                     A  1804    L_96:
010669 DDF9                A  1805    	LD	SP,IX
01066B DDE1                A  1806    	POP	IX
01066D C9                  A  1807    	RET	
                           A  1808    
                           A  1809    
                           A  1810    ;**************************** _te_chr *********
                           A  1811    ;Name                         Addr/Register   S
                           A  1812    ;_te_flu                             IMPORT  --
                           A  1813    ;_tebuflen                           STATIC    
                           A  1814    ;_tebuf                              STATIC   2
                           A  1815    ;ch                                    IX+6    
                           A  1816    
                           A  1817    
                           A  1818    ; Stack Frame Size: 9 (bytes)
                           A  1819    ;       Spill Code: 0 (instruction)
                           A  1820    
                           A  1821    
                           A  1822    ;  532	
                           A  1823    ;  533	/* Writes its argument string to the te
                           A  1824    ;  534	void te_str(char *s)
                           A  1825    ;  535	{
01066E                     A  1826    _te_str:
01066E 21FDFFFF            A  1827    	LD	HL,-3
010672 CD 39 25 01         A  1828    	CALL	__frameset
                           A  1829    ;  536		while (*s)
010676 18 19               A  1830    	JR	L_98
010678                     A  1831    L_99:
                           A  1832    ;  537			te_chr((unsigned char)(*s++));
010678 DD0706              A  1833    	LD	BC,(IX+6)
01067B DD0FFD              A  1834    	LD	(IX+-3),BC
01067E DD0706              A  1835    	LD	BC,(IX+6)
010681 03                  A  1836    	INC	BC
010682 DD0F06              A  1837    	LD	(IX+6),BC
010685 DD27FD              A  1838    	LD	HL,(IX+-3)
010688 4E                  A  1839    	LD	C,(HL)
010689 0600                A  1840    	LD	B,0
01068B C5                  A  1841    	PUSH	BC
01068C CD 3C 06 01         A  1842    	CALL	_te_chr
010690 C1                  A  1843    	POP	BC
010691                     A  1844    L_98:
010691 DD2706              A  1845    	LD	HL,(IX+6)
010694 7E                  A  1846    	LD	A,(HL)
010695 B7                  A  1847    	OR	A,A
010696 20 E0               A  1848    	JR	NZ,L_99
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  37


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  1849    ;  538	}
010698 DDF9                A  1850    	LD	SP,IX
01069A DDE1                A  1851    	POP	IX
01069C C9                  A  1852    	RET	
                           A  1853    
                           A  1854    
                           A  1855    ;**************************** _te_str *********
                           A  1856    ;Name                         Addr/Register   S
                           A  1857    ;_te_chr                             IMPORT  --
                           A  1858    ;s                                     IX+6    
                           A  1859    
                           A  1860    
                           A  1861    ; Stack Frame Size: 12 (bytes)
                           A  1862    ;       Spill Code: 0 (instruction)
                           A  1863    
                           A  1864    
                           A  1865    ;  539	
                           A  1866    ;  540	/* Moves the cursor to the specified ro
                           A  1867    ;  541	void te_mov(unsigned char r, unsigned c
                           A  1868    ;  542	{
01069D                     A  1869    _te_mov:
01069D 21FAFFFF            A  1870    	LD	HL,-6
0106A1 CD 39 25 01         A  1871    	CALL	__frameset
                           A  1872    ;  543		as((0 <= r) && (r <= SCNROWS), "te_
0106A5 DD7E06              A  1873    	LD	A,(IX+6)
0106A8 B7                  A  1874    	OR	A,A
0106A9 38 10               A  1875    	JR	C,L_103
0106AB 3E32                A  1876    	LD	A,50
0106AD DDBE06              A  1877    	CP	A,(IX+6)
0106B0 38 09               A  1878    	JR	C,L_103
0106B2 01010000            A  1879    	LD	BC,1
0106B6 DD0FFD              A  1880    	LD	(IX+-3),BC
0106B9 18 07               A  1881    	JR	L_104
0106BB                     A  1882    L_103:
0106BB 01000000            A  1883    	LD	BC,0
0106BF DD0FFD              A  1884    	LD	(IX+-3),BC
0106C2                     A  1885    L_104:
0106C2 01 4C 27 01         A  1886    	LD	BC,L__79
0106C6 C5                  A  1887    	PUSH	BC
0106C7 DD4EFD              A  1888    	LD	C,(IX+-3)
0106CA 0600                A  1889    	LD	B,0
0106CC C5                  A  1890    	PUSH	BC
0106CD CD A8 03 01         A  1891    	CALL	_as
0106D1 C1                  A  1892    	POP	BC
0106D2 C1                  A  1893    	POP	BC
                           A  1894    ;  544		
                           A  1895    ;  545		as((0 <= c) && (c <= SCNCOLS), "te_
0106D3 DD7E09              A  1896    	LD	A,(IX+9)
0106D6 B7                  A  1897    	OR	A,A
0106D7 38 10               A  1898    	JR	C,L_108
0106D9 3E50                A  1899    	LD	A,80
0106DB DDBE09              A  1900    	CP	A,(IX+9)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  38


PC     Object              I  Line    Source C:\proted\Debug\main.src
0106DE 38 09               A  1901    	JR	C,L_108
0106E0 01010000            A  1902    	LD	BC,1
0106E4 DD0FFA              A  1903    	LD	(IX+-6),BC
0106E7 18 07               A  1904    	JR	L_109
0106E9                     A  1905    L_108:
0106E9 01000000            A  1906    	LD	BC,0
0106ED DD0FFA              A  1907    	LD	(IX+-6),BC
0106F0                     A  1908    L_109:
0106F0 01 5D 27 01         A  1909    	LD	BC,L__82
0106F4 C5                  A  1910    	PUSH	BC
0106F5 DD4EFA              A  1911    	LD	C,(IX+-6)
0106F8 0600                A  1912    	LD	B,0
0106FA C5                  A  1913    	PUSH	BC
0106FB CD A8 03 01         A  1914    	CALL	_as
0106FF C1                  A  1915    	POP	BC
010700 C1                  A  1916    	POP	BC
                           A  1917    ;  546		
                           A  1918    ;  547		te_flu();
010701 CD 0B 06 01         A  1919    	CALL	_te_flu
                           A  1920    ;  548		
                           A  1921    ;  549		gotoxy(c, r);
010705 DD4E06              A  1922    	LD	C,(IX+6)
010708 0600                A  1923    	LD	B,0
01070A C5                  A  1924    	PUSH	BC
01070B DD4E09              A  1925    	LD	C,(IX+9)
01070E C5                  A  1926    	PUSH	BC
01070F CD 23 03 01         A  1927    	CALL	_gotoxy
010713 C1                  A  1928    	POP	BC
010714 C1                  A  1929    	POP	BC
                           A  1930    ;  550	}
010715 DDF9                A  1931    	LD	SP,IX
010717 DDE1                A  1932    	POP	IX
010719 C9                  A  1933    	RET	
                           A  1934    
                           A  1935    
                           A  1936    ;**************************** _te_mov *********
                           A  1937    ;Name                         Addr/Register   S
                           A  1938    ;_gotoxy                             IMPORT  --
                           A  1939    ;_te_flu                             IMPORT  --
                           A  1940    ;_as                                 IMPORT  --
                           A  1941    ;temp110                               IX-6    
                           A  1942    ;temp105                               IX-3    
                           A  1943    ;c                                     IX+9    
                           A  1944    ;r                                     IX+6    
                           A  1945    
                           A  1946    
                           A  1947    ; Stack Frame Size: 18 (bytes)
                           A  1948    ;       Spill Code: 0 (instruction)
                           A  1949    
                           A  1950    
                           A  1951    	SEGMENT STRSECT
01274C                     A  1952    L__79:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  39


PC     Object              I  Line    Source C:\proted\Debug\main.src
01274C 74655F6D 6F763A20   A  1953    	DB	"te_mov: Bad row."
012754 42616420 726F772E 
01275C 00                  A  1954    	DB	0
01275D                     A  1955    L__82:
01275D 74655F6D 6F763A20   A  1956    	DB	"te_mov: Bad col."
012765 42616420 636F6C2E 
01276D 00                  A  1957    	DB	0
                           A  1958    	SEGMENT CODE
                           A  1959    ;  551	
                           A  1960    ;  552	/* Sets the specified row of the termin
                           A  1961    ;  553	/* Leaves the cursor at the start of th
                           A  1962    ;  554	void te_cln(unsigned char row)
                           A  1963    ;  555	{
01071A                     A  1964    _te_cln:
01071A CD 2C 25 01         A  1965    	CALL	__frameset0
                           A  1966    ;  556		te_mov(row, 0);
01071E 01000000            A  1967    	LD	BC,0
010722 C5                  A  1968    	PUSH	BC
010723 DD4E06              A  1969    	LD	C,(IX+6)
010726 0600                A  1970    	LD	B,0
010728 C5                  A  1971    	PUSH	BC
010729 CD 9D 06 01         A  1972    	CALL	_te_mov
01072D C1                  A  1973    	POP	BC
01072E C1                  A  1974    	POP	BC
                           A  1975    ;  557		
                           A  1976    ;  558		clreol();
01072F CD E0 02 01         A  1977    	CALL	_clreol
                           A  1978    ;  559	}
010733 DDF9                A  1979    	LD	SP,IX
010735 DDE1                A  1980    	POP	IX
010737 C9                  A  1981    	RET	
                           A  1982    
                           A  1983    
                           A  1984    ;**************************** _te_cln *********
                           A  1985    ;Name                         Addr/Register   S
                           A  1986    ;_clreol                             IMPORT  --
                           A  1987    ;_te_mov                             IMPORT  --
                           A  1988    ;row                                   IX+6    
                           A  1989    
                           A  1990    
                           A  1991    ; Stack Frame Size: 9 (bytes)
                           A  1992    ;       Spill Code: 0 (instruction)
                           A  1993    
                           A  1994    
                           A  1995    ;  560	
                           A  1996    ;  561	/* Homes the cursor and clears the scre
                           A  1997    ;  562	void te_clr(void)
                           A  1998    ;  563	{
010738                     A  1999    _te_clr:
010738 21FFFFFF            A  2000    	LD	HL,-1
01073C CD 39 25 01         A  2001    	CALL	__frameset
010740 DD36FF00            A  2002    	LD	(IX+-1),0
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  40


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  2003    ;  564		register unsigned char r;
                           A  2004    ;  565		
                           A  2005    ;  566		for (r = 0; r < SCNROWS; r++)
010744 18 0E               A  2006    	JR	L_116
010746                     A  2007    L_114:
                           A  2008    ;  567			te_cln(r);
010746 DD4EFF              A  2009    	LD	C,(IX+-1)
010749 0600                A  2010    	LD	B,0
01074B C5                  A  2011    	PUSH	BC
01074C CD 1A 07 01         A  2012    	CALL	_te_cln
010750 C1                  A  2013    	POP	BC
010751 DD34FF              A  2014    	INC	(IX+-1)
010754                     A  2015    L_116:
010754 DD7EFF              A  2016    	LD	A,(IX+-1)
010757 FE32                A  2017    	CP	A,50
010759 38 EB               A  2018    	JR	C,L_114
                           A  2019    ;  568		
                           A  2020    ;  569		te_mov(0, 0);
01075B 01000000            A  2021    	LD	BC,0
01075F C5                  A  2022    	PUSH	BC
010760 C5                  A  2023    	PUSH	BC
010761 CD 9D 06 01         A  2024    	CALL	_te_mov
010765 C1                  A  2025    	POP	BC
010766 C1                  A  2026    	POP	BC
                           A  2027    ;  570	}
010767 DDF9                A  2028    	LD	SP,IX
010769 DDE1                A  2029    	POP	IX
01076B C9                  A  2030    	RET	
                           A  2031    
                           A  2032    
                           A  2033    ;**************************** _te_clr *********
                           A  2034    ;Name                         Addr/Register   S
                           A  2035    ;_te_mov                             IMPORT  --
                           A  2036    ;_te_cln                             IMPORT  --
                           A  2037    ;r                                     IX-1    
                           A  2038    
                           A  2039    
                           A  2040    ; Stack Frame Size: 7 (bytes)
                           A  2041    ;       Spill Code: 0 (instruction)
                           A  2042    
                           A  2043    
                           A  2044    ;  571	
                           A  2045    ;  572	/* Initializes the terminal package. */
                           A  2046    ;  573	void te_ini(void)
                           A  2047    ;  574	{
01076C                     A  2048    _te_ini:
                           A  2049    ;  575		tebuflen = 0;
01076C 01000000            A  2050    	LD	BC,0
010770 ED43 8E 2C 01       A  2051    	LD	(_tebuflen),BC
                           A  2052    ;  576	}
010775 C9                  A  2053    	RET	
                           A  2054    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  41


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  2055    
                           A  2056    ;**************************** _te_ini *********
                           A  2057    ;Name                         Addr/Register   S
                           A  2058    ;_tebuflen                           STATIC    
                           A  2059    
                           A  2060    
                           A  2061    ; Stack Frame Size: 6 (bytes)
                           A  2062    ;       Spill Code: 0 (instruction)
                           A  2063    
                           A  2064    
                           A  2065    ;  577	
                           A  2066    ;  578	/* Finalize the terminal package. */
                           A  2067    ;  579	void te_fin(void)
                           A  2068    ;  580	{
010776                     A  2069    _te_fin:
                           A  2070    ;  581		te_flu();
010776 CD 0B 06 01         A  2071    	CALL	_te_flu
                           A  2072    ;  582	}
01077A C9                  A  2073    	RET	
                           A  2074    
                           A  2075    
                           A  2076    ;**************************** _te_fin *********
                           A  2077    ;Name                         Addr/Register   S
                           A  2078    ;_te_flu                             IMPORT  --
                           A  2079    
                           A  2080    
                           A  2081    ; Stack Frame Size: 6 (bytes)
                           A  2082    ;       Spill Code: 0 (instruction)
                           A  2083    
                           A  2084    
                           A  2085    ;  583	
                           A  2086    ;  584	/* Clear the virtual screen. */
                           A  2087    ;  585	void sc_clr(void)
                           A  2088    ;  586	{
01077B                     A  2089    _sc_clr:
                           A  2090    ;  587		memset(&scn_virt[0][0], ' ', SCNSIZ
01077B 01A00F00            A  2091    	LD	BC,4000
01077F C5                  A  2092    	PUSH	BC
010780 01200000            A  2093    	LD	BC,32
010784 C5                  A  2094    	PUSH	BC
010785 01 9B 34 01         A  2095    	LD	BC,_scn_virt
010789 C5                  A  2096    	PUSH	BC
01078A CD F7 25 01         A  2097    	CALL	_memset
01078E C1                  A  2098    	POP	BC
01078F C1                  A  2099    	POP	BC
010790 C1                  A  2100    	POP	BC
                           A  2101    ;  588	}
010791 C9                  A  2102    	RET	
                           A  2103    
                           A  2104    
                           A  2105    ;**************************** _sc_clr *********
                           A  2106    ;Name                         Addr/Register   S
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  42


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  2107    ;_scn_virt                           STATIC   4
                           A  2108    ;_memset                             IMPORT  --
                           A  2109    
                           A  2110    
                           A  2111    ; Stack Frame Size: 6 (bytes)
                           A  2112    ;       Spill Code: 0 (instruction)
                           A  2113    
                           A  2114    
                           A  2115    ;  589	
                           A  2116    ;  590	/* Clear the specified row of the virtu
                           A  2117    ;  591	void sc_crw(unsigned char row)
                           A  2118    ;  592	{
010792                     A  2119    _sc_crw:
010792 21FDFFFF            A  2120    	LD	HL,-3
010796 CD 39 25 01         A  2121    	CALL	__frameset
                           A  2122    ;  593		as((0 <= row) && (row <= SCNROWS), 
01079A DD7E06              A  2123    	LD	A,(IX+6)
01079D B7                  A  2124    	OR	A,A
01079E 38 10               A  2125    	JR	C,L_124
0107A0 3E32                A  2126    	LD	A,50
0107A2 DDBE06              A  2127    	CP	A,(IX+6)
0107A5 38 09               A  2128    	JR	C,L_124
0107A7 01010000            A  2129    	LD	BC,1
0107AB DD0FFD              A  2130    	LD	(IX+-3),BC
0107AE 18 07               A  2131    	JR	L_125
0107B0                     A  2132    L_124:
0107B0 01000000            A  2133    	LD	BC,0
0107B4 DD0FFD              A  2134    	LD	(IX+-3),BC
0107B7                     A  2135    L_125:
0107B7 01 6E 27 01         A  2136    	LD	BC,L__92
0107BB C5                  A  2137    	PUSH	BC
0107BC DD4EFD              A  2138    	LD	C,(IX+-3)
0107BF 0600                A  2139    	LD	B,0
0107C1 C5                  A  2140    	PUSH	BC
0107C2 CD A8 03 01         A  2141    	CALL	_as
0107C6 C1                  A  2142    	POP	BC
0107C7 C1                  A  2143    	POP	BC
                           A  2144    ;  594		
                           A  2145    ;  595		memset(&scn_virt[row][0], ' ', SCNC
0107C8 01500000            A  2146    	LD	BC,80
0107CC C5                  A  2147    	PUSH	BC
0107CD 01200000            A  2148    	LD	BC,32
0107D1 C5                  A  2149    	PUSH	BC
0107D2 DD7E06              A  2150    	LD	A,(IX+6)
0107D5 B7ED62              A  2151    	UEXT	HL
0107D8 6F                  A  2152    	LD	L,A
0107D9 E5C1                A  2153    	LD	BC,HL
0107DB C5E1                A  2154    	LD	HL,BC
0107DD 29                  A  2155    	ADD	HL,HL
0107DE 29                  A  2156    	ADD	HL,HL
0107DF 09                  A  2157    	ADD	HL,BC
0107E0 29                  A  2158    	ADD	HL,HL
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  43


PC     Object              I  Line    Source C:\proted\Debug\main.src
0107E1 29                  A  2159    	ADD	HL,HL
0107E2 29                  A  2160    	ADD	HL,HL
0107E3 29                  A  2161    	ADD	HL,HL
0107E4 01 9B 34 01         A  2162    	LD	BC,_scn_virt
0107E8 09                  A  2163    	ADD	HL,BC
0107E9 E5                  A  2164    	PUSH	HL
0107EA CD F7 25 01         A  2165    	CALL	_memset
0107EE C1                  A  2166    	POP	BC
0107EF C1                  A  2167    	POP	BC
0107F0 C1                  A  2168    	POP	BC
                           A  2169    ;  596	}
0107F1 DDF9                A  2170    	LD	SP,IX
0107F3 DDE1                A  2171    	POP	IX
0107F5 C9                  A  2172    	RET	
                           A  2173    
                           A  2174    
                           A  2175    ;**************************** _sc_crw *********
                           A  2176    ;Name                         Addr/Register   S
                           A  2177    ;_scn_virt                           STATIC   4
                           A  2178    ;_memset                             IMPORT  --
                           A  2179    ;_as                                 IMPORT  --
                           A  2180    ;temp126                               IX-3    
                           A  2181    ;row                                   IX+6    
                           A  2182    
                           A  2183    
                           A  2184    ; Stack Frame Size: 12 (bytes)
                           A  2185    ;       Spill Code: 0 (instruction)
                           A  2186    
                           A  2187    
                           A  2188    	SEGMENT STRSECT
01276E                     A  2189    L__92:
01276E 73635F63 72773A20   A  2190    	DB	"sc_crw: Bad row number."
012776 42616420 726F7720 
01277E 6E756D62 65722E 
012785 00                  A  2191    	DB	0
                           A  2192    	SEGMENT CODE
                           A  2193    ;  597	
                           A  2194    ;  598	/* Places the specified character at th
                           A  2195    ;  599	/* screen. If the row and column are of
                           A  2196    ;  600	void sc_chr(unsigned char row, unsigned
                           A  2197    ;  601	{
0107F6                     A  2198    _sc_chr:
0107F6 CD 2C 25 01         A  2199    	CALL	__frameset0
                           A  2200    ;  602		if (((0 <= row) && (row < SCNROWS))
0107FA DD7E06              A  2201    	LD	A,(IX+6)
0107FD B7                  A  2202    	OR	A,A
0107FE 38 39               A  2203    	JR	C,L_132
010800 DD7E06              A  2204    	LD	A,(IX+6)
010803 FE32                A  2205    	CP	A,50
010805 30 32               A  2206    	JR	NC,L_132
010807 DD7E09              A  2207    	LD	A,(IX+9)
01080A B7                  A  2208    	OR	A,A
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  44


PC     Object              I  Line    Source C:\proted\Debug\main.src
01080B 38 2C               A  2209    	JR	C,L_132
01080D DD7E09              A  2210    	LD	A,(IX+9)
010810 FE50                A  2211    	CP	A,80
010812 30 25               A  2212    	JR	NC,L_132
                           A  2213    ;  603			scn_virt[row - 0][col - 0] = (c
010814 DD7E06              A  2214    	LD	A,(IX+6)
010817 B7ED62              A  2215    	UEXT	HL
01081A 6F                  A  2216    	LD	L,A
01081B E5C1                A  2217    	LD	BC,HL
01081D C5E1                A  2218    	LD	HL,BC
01081F DD7E09              A  2219    	LD	A,(IX+9)
010822 29                  A  2220    	ADD	HL,HL
010823 29                  A  2221    	ADD	HL,HL
010824 09                  A  2222    	ADD	HL,BC
010825 29                  A  2223    	ADD	HL,HL
010826 29                  A  2224    	ADD	HL,HL
010827 29                  A  2225    	ADD	HL,HL
010828 29                  A  2226    	ADD	HL,HL
010829 01 9B 34 01         A  2227    	LD	BC,_scn_virt
01082D 09                  A  2228    	ADD	HL,BC
01082E E5C1                A  2229    	LD	BC,HL
010830 B7ED62              A  2230    	UEXT	HL
010833 6F                  A  2231    	LD	L,A
010834 DD7E0C              A  2232    	LD	A,(IX+12)
010837 09                  A  2233    	ADD	HL,BC
010838 77                  A  2234    	LD	(HL),A
                           A  2235    ;  604	}
010839                     A  2236    L_132:
010839 DDF9                A  2237    	LD	SP,IX
01083B DDE1                A  2238    	POP	IX
01083D C9                  A  2239    	RET	
                           A  2240    
                           A  2241    
                           A  2242    ;**************************** _sc_chr *********
                           A  2243    ;Name                         Addr/Register   S
                           A  2244    ;_scn_virt                           STATIC   4
                           A  2245    ;ch                                   IX+12    
                           A  2246    ;col                                   IX+9    
                           A  2247    ;row                                   IX+6    
                           A  2248    
                           A  2249    
                           A  2250    ; Stack Frame Size: 15 (bytes)
                           A  2251    ;       Spill Code: 0 (instruction)
                           A  2252    
                           A  2253    
                           A  2254    ;  605	
                           A  2255    ;  606	/* Writes the specified string on the v
                           A  2256    ;  607	/* The function ignores any part of the
                           A  2257    ;  608	void sc_str(unsigned char row, unsigned
                           A  2258    ;  609	{
01083E                     A  2259    _sc_str:
01083E 21F9FFFF            A  2260    	LD	HL,-7
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  45


PC     Object              I  Line    Source C:\proted\Debug\main.src
010842 CD 39 25 01         A  2261    	CALL	__frameset
                           A  2262    ;  610		unsigned char c = col;
010846 DD7E09              A  2263    	LD	A,(IX+9)
010849 DD77FF              A  2264    	LD	(IX+-1),A
                           A  2265    ;  611		char *t = s;
01084C DD070C              A  2266    	LD	BC,(IX+12)
01084F DD0FFC              A  2267    	LD	(IX+-4),BC
                           A  2268    ;  612		
                           A  2269    ;  613		while (*t)
010852 18 27               A  2270    	JR	L_135
010854                     A  2271    L_136:
                           A  2272    ;  614			sc_chr(row, c++, (unsigned char
010854 DD7EFF              A  2273    	LD	A,(IX+-1)
010857 DD07FC              A  2274    	LD	BC,(IX+-4)
01085A DD0FF9              A  2275    	LD	(IX+-7),BC
01085D DD34FF              A  2276    	INC	(IX+-1)
010860 DD07FC              A  2277    	LD	BC,(IX+-4)
010863 03                  A  2278    	INC	BC
010864 DD0FFC              A  2279    	LD	(IX+-4),BC
010867 DD27F9              A  2280    	LD	HL,(IX+-7)
01086A 4E                  A  2281    	LD	C,(HL)
01086B 0600                A  2282    	LD	B,0
01086D C5                  A  2283    	PUSH	BC
01086E 4F                  A  2284    	LD	C,A
01086F C5                  A  2285    	PUSH	BC
010870 DD4E06              A  2286    	LD	C,(IX+6)
010873 C5                  A  2287    	PUSH	BC
010874 CD F6 07 01         A  2288    	CALL	_sc_chr
010878 C1                  A  2289    	POP	BC
010879 C1                  A  2290    	POP	BC
01087A C1                  A  2291    	POP	BC
01087B                     A  2292    L_135:
01087B DD27FC              A  2293    	LD	HL,(IX+-4)
01087E 7E                  A  2294    	LD	A,(HL)
01087F B7                  A  2295    	OR	A,A
010880 20 D2               A  2296    	JR	NZ,L_136
                           A  2297    ;  615	}
010882 DDF9                A  2298    	LD	SP,IX
010884 DDE1                A  2299    	POP	IX
010886 C9                  A  2300    	RET	
                           A  2301    
                           A  2302    
                           A  2303    ;**************************** _sc_str *********
                           A  2304    ;Name                         Addr/Register   S
                           A  2305    ;_sc_chr                             IMPORT  --
                           A  2306    ;t                                     IX-4    
                           A  2307    ;c                                     IX-1    
                           A  2308    ;s                                    IX+12    
                           A  2309    ;col                                   IX+9    
                           A  2310    ;row                                   IX+6    
                           A  2311    
                           A  2312    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  46


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  2313    ; Stack Frame Size: 22 (bytes)
                           A  2314    ;       Spill Code: 0 (instruction)
                           A  2315    
                           A  2316    
                           A  2317    ;  616	
                           A  2318    ;  617	/* Updates the physical screen from the
                           A  2319    ;  618	/* - Identifying the differences betwee
                           A  2320    ;  619	/* - Sending characters to the terminal
                           A  2321    ;  620	/* - Setting the physical screen to the
                           A  2322    ;  621	void sc_upd(void)
                           A  2323    ;  622	{
010887                     A  2324    _sc_upd:
010887 21F3FFFF            A  2325    	LD	HL,-13
01088B CD 39 25 01         A  2326    	CALL	__frameset
01088F DD36FC00            A  2327    	LD	(IX+-4),0
                           A  2328    ;  623		register unsigned char r, c;
                           A  2329    ;  624		
                           A  2330    ;  625		for (r = 0; r < SCNROWS; r++)
010893 C3 B0 09 01         A  2331    	JR	L_155
010897                     A  2332    L_153:
                           A  2333    ;  626		{
                           A  2334    ;  627			if (memcmp(&scn_virt[r - 0][0],
010897 DD7EFC              A  2335    	LD	A,(IX+-4)
01089A B7ED62              A  2336    	UEXT	HL
01089D 6F                  A  2337    	LD	L,A
01089E E5C1                A  2338    	LD	BC,HL
0108A0 C5E1                A  2339    	LD	HL,BC
0108A2 29                  A  2340    	ADD	HL,HL
0108A3 29                  A  2341    	ADD	HL,HL
0108A4 09                  A  2342    	ADD	HL,BC
0108A5 29                  A  2343    	ADD	HL,HL
0108A6 29                  A  2344    	ADD	HL,HL
0108A7 29                  A  2345    	ADD	HL,HL
0108A8 29                  A  2346    	ADD	HL,HL
0108A9 DD2FFD              A  2347    	LD	(IX+-3),HL
0108AC 01500000            A  2348    	LD	BC,80
0108B0 C5                  A  2349    	PUSH	BC
0108B1 DD27FD              A  2350    	LD	HL,(IX+-3)
0108B4 01 3B 44 01         A  2351    	LD	BC,_scn_phys
0108B8 09                  A  2352    	ADD	HL,BC
0108B9 E5                  A  2353    	PUSH	HL
0108BA DD27FD              A  2354    	LD	HL,(IX+-3)
0108BD 01 9B 34 01         A  2355    	LD	BC,_scn_virt
0108C1 09                  A  2356    	ADD	HL,BC
0108C2 E5                  A  2357    	PUSH	HL
0108C3 CD 49 25 01         A  2358    	CALL	_memcmp
0108C7 C1                  A  2359    	POP	BC
0108C8 C1                  A  2360    	POP	BC
0108C9 C1                  A  2361    	POP	BC
0108CA 01000000            A  2362    	LD	BC,0
0108CE B7                  A  2363    	OR	A,A
0108CF ED42                A  2364    	SBC	HL,BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  47


PC     Object              I  Line    Source C:\proted\Debug\main.src
0108D1 CA AD 09 01         A  2365    	JR	Z,L_154
                           A  2366    ;  628				continue;
                           A  2367    ;  629			
                           A  2368    ;  630			if ((blankrow(&scn_virt[r - 0][
0108D5 DD07FD              A  2369    	LD	BC,(IX+-3)
0108D8 DD0FF3              A  2370    	LD	(IX+-13),BC
0108DB DD07FD              A  2371    	LD	BC,(IX+-3)
0108DE DD0FF8              A  2372    	LD	(IX+-8),BC
0108E1 DD27FD              A  2373    	LD	HL,(IX+-3)
0108E4 01 9B 34 01         A  2374    	LD	BC,_scn_virt
0108E8 09                  A  2375    	ADD	HL,BC
0108E9 E5                  A  2376    	PUSH	HL
0108EA CD F4 04 01         A  2377    	CALL	_blankrow
0108EE C1                  A  2378    	POP	BC
0108EF B7                  A  2379    	OR	A,A
0108F0 28 2A               A  2380    	JR	Z,L_150
0108F2 DD07FD              A  2381    	LD	BC,(IX+-3)
0108F5 DD0FF3              A  2382    	LD	(IX+-13),BC
0108F8 DD07FD              A  2383    	LD	BC,(IX+-3)
0108FB DD0FF8              A  2384    	LD	(IX+-8),BC
0108FE DD27FD              A  2385    	LD	HL,(IX+-3)
010901 01 3B 44 01         A  2386    	LD	BC,_scn_phys
010905 09                  A  2387    	ADD	HL,BC
010906 E5                  A  2388    	PUSH	HL
010907 CD F4 04 01         A  2389    	CALL	_blankrow
01090B C1                  A  2390    	POP	BC
01090C B7                  A  2391    	OR	A,A
01090D 20 0D               A  2392    	JR	NZ,L_150
                           A  2393    ;  631				te_cln(r);
01090F DD4EFC              A  2394    	LD	C,(IX+-4)
010912 0600                A  2395    	LD	B,0
010914 C5                  A  2396    	PUSH	BC
010915 CD 1A 07 01         A  2397    	CALL	_te_cln
010919 C1                  A  2398    	POP	BC
                           A  2399    ;  632			else
01091A 18 72               A  2400    	JR	L_152
01091C                     A  2401    L_150:
                           A  2402    ;  633			{
                           A  2403    ;  634				char there = FALSE;
01091C DD36F700            A  2404    	LD	(IX+-9),0
010920 DD36FB00            A  2405    	LD	(IX+-5),0
                           A  2406    ;  635				
                           A  2407    ;  636				for (c = 0; c < SCNCOLS; c+
010924 18 61               A  2408    	JR	L_148
010926                     A  2409    L_146:
                           A  2410    ;  637				{
                           A  2411    ;  638					char ch = scn_virt[r - 
010926 DD07F3              A  2412    	LD	BC,(IX+-13)
010929 DD0FF8              A  2413    	LD	(IX+-8),BC
01092C C5E1                A  2414    	LD	HL,BC
01092E 01 9B 34 01         A  2415    	LD	BC,_scn_virt
010932 09                  A  2416    	ADD	HL,BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  48


PC     Object              I  Line    Source C:\proted\Debug\main.src
010933 E5C1                A  2417    	LD	BC,HL
010935 DD7EFB              A  2418    	LD	A,(IX+-5)
010938 B7ED62              A  2419    	UEXT	HL
01093B 6F                  A  2420    	LD	L,A
01093C 09                  A  2421    	ADD	HL,BC
01093D 7E                  A  2422    	LD	A,(HL)
01093E DD77F6              A  2423    	LD	(IX+-10),A
                           A  2424    ;  639					
                           A  2425    ;  640					if (ch != scn_phys[r - 
010941 DD27F8              A  2426    	LD	HL,(IX+-8)
010944 01 3B 44 01         A  2427    	LD	BC,_scn_phys
010948 09                  A  2428    	ADD	HL,BC
010949 E5C1                A  2429    	LD	BC,HL
01094B DD7EFB              A  2430    	LD	A,(IX+-5)
01094E B7ED62              A  2431    	UEXT	HL
010951 6F                  A  2432    	LD	L,A
010952 09                  A  2433    	ADD	HL,BC
010953 7E                  A  2434    	LD	A,(HL)
010954 DDBEF6              A  2435    	CP	A,(IX+-10)
010957 28 27               A  2436    	JR	Z,L_145
                           A  2437    ;  641					{
                           A  2438    ;  642						if (!there)
010959 DD7EF7              A  2439    	LD	A,(IX+-9)
01095C B7                  A  2440    	OR	A,A
01095D 20 10               A  2441    	JR	NZ,L_143
                           A  2442    ;  643							te_mov(r, c);
01095F DD4EFB              A  2443    	LD	C,(IX+-5)
010962 0600                A  2444    	LD	B,0
010964 C5                  A  2445    	PUSH	BC
010965 DD4EFC              A  2446    	LD	C,(IX+-4)
010968 C5                  A  2447    	PUSH	BC
010969 CD 9D 06 01         A  2448    	CALL	_te_mov
01096D C1                  A  2449    	POP	BC
01096E C1                  A  2450    	POP	BC
01096F                     A  2451    L_143:
                           A  2452    ;  644						
                           A  2453    ;  645						te_chr((unsigned ch
01096F DD4EF6              A  2454    	LD	C,(IX+-10)
010972 0600                A  2455    	LD	B,0
010974 C5                  A  2456    	PUSH	BC
010975 CD 3C 06 01         A  2457    	CALL	_te_chr
010979 C1                  A  2458    	POP	BC
                           A  2459    ;  646						
                           A  2460    ;  647						there = TRUE;
01097A DD36F701            A  2461    	LD	(IX+-9),1
                           A  2462    ;  648					}
                           A  2463    ;  649					else
01097E 18 04               A  2464    	JR	L_147
010980                     A  2465    L_145:
                           A  2466    ;  650						there = FALSE;
010980 DD36F700            A  2467    	LD	(IX+-9),0
                           A  2468    ;  651				}
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  49


PC     Object              I  Line    Source C:\proted\Debug\main.src
010984                     A  2469    L_147:
010984 DD34FB              A  2470    	INC	(IX+-5)
010987                     A  2471    L_148:
010987 DD7EFB              A  2472    	LD	A,(IX+-5)
01098A FE50                A  2473    	CP	A,80
01098C 38 98               A  2474    	JR	C,L_146
                           A  2475    ;  652			}
01098E                     A  2476    L_152:
                           A  2477    ;  653			
                           A  2478    ;  654			memmove(&scn_phys[r - 0][0], &s
01098E DD07F8              A  2479    	LD	BC,(IX+-8)
010991 C5E1                A  2480    	LD	HL,BC
010993 11500000            A  2481    	LD	DE,80
010997 D5                  A  2482    	PUSH	DE
010998 11 9B 34 01         A  2483    	LD	DE,_scn_virt
01099C 19                  A  2484    	ADD	HL,DE
01099D E5                  A  2485    	PUSH	HL
01099E C5E1                A  2486    	LD	HL,BC
0109A0 01 3B 44 01         A  2487    	LD	BC,_scn_phys
0109A4 09                  A  2488    	ADD	HL,BC
0109A5 E5                  A  2489    	PUSH	HL
0109A6 CD 18 26 01         A  2490    	CALL	_memmove
0109AA C1                  A  2491    	POP	BC
0109AB C1                  A  2492    	POP	BC
0109AC C1                  A  2493    	POP	BC
                           A  2494    ;  655		}	
0109AD                     A  2495    L_154:
0109AD DD34FC              A  2496    	INC	(IX+-4)
0109B0                     A  2497    L_155:
0109B0 DD7EFC              A  2498    	LD	A,(IX+-4)
0109B3 FE32                A  2499    	CP	A,50
0109B5 DA 97 08 01         A  2500    	JR	C,L_153
                           A  2501    ;  656		
                           A  2502    ;  657		te_flu();	
0109B9 CD 0B 06 01         A  2503    	CALL	_te_flu
                           A  2504    ;  658	}
0109BD DDF9                A  2505    	LD	SP,IX
0109BF DDE1                A  2506    	POP	IX
0109C1 C9                  A  2507    	RET	
                           A  2508    
                           A  2509    
                           A  2510    ;**************************** _sc_upd *********
                           A  2511    ;Name                         Addr/Register   S
                           A  2512    ;_te_flu                             IMPORT  --
                           A  2513    ;_memmove                            IMPORT  --
                           A  2514    ;_te_chr                             IMPORT  --
                           A  2515    ;_te_mov                             IMPORT  --
                           A  2516    ;_te_cln                             IMPORT  --
                           A  2517    ;_blankrow                           IMPORT  --
                           A  2518    ;_scn_virt                           STATIC   4
                           A  2519    ;_scn_phys                           STATIC   4
                           A  2520    ;_memcmp                             IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  50


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  2521    ;G_3                                  IX-13    
                           A  2522    ;ch                                   IX-10    
                           A  2523    ;there                                 IX-9    
                           A  2524    ;G_4                                   IX-8    
                           A  2525    ;c                                     IX-5    
                           A  2526    ;r                                     IX-4    
                           A  2527    ;G_1                                   IX-3    
                           A  2528    
                           A  2529    
                           A  2530    ; Stack Frame Size: 19 (bytes)
                           A  2531    ;       Spill Code: 0 (instruction)
                           A  2532    
                           A  2533    
                           A  2534    ;  659	
                           A  2535    ;  660	/* Forced update. Forces the terminals 
                           A  2536    ;  661	/* the virtual screen.                 
                           A  2537    ;  662	void sc_fup(void)
                           A  2538    ;  663	{
0109C2                     A  2539    _sc_fup:
                           A  2540    ;  664		memset(&scn_phys[0][0], 0, SCNSIZE)
0109C2 01A00F00            A  2541    	LD	BC,4000
0109C6 C5                  A  2542    	PUSH	BC
0109C7 01000000            A  2543    	LD	BC,0
0109CB C5                  A  2544    	PUSH	BC
0109CC 01 3B 44 01         A  2545    	LD	BC,_scn_phys
0109D0 C5                  A  2546    	PUSH	BC
0109D1 CD F7 25 01         A  2547    	CALL	_memset
0109D5 C1                  A  2548    	POP	BC
0109D6 C1                  A  2549    	POP	BC
0109D7 C1                  A  2550    	POP	BC
                           A  2551    ;  665		
                           A  2552    ;  666		sc_upd();
0109D8 CD 87 08 01         A  2553    	CALL	_sc_upd
                           A  2554    ;  667	}
0109DC C9                  A  2555    	RET	
                           A  2556    
                           A  2557    
                           A  2558    ;**************************** _sc_fup *********
                           A  2559    ;Name                         Addr/Register   S
                           A  2560    ;_sc_upd                             IMPORT  --
                           A  2561    ;_scn_phys                           STATIC   4
                           A  2562    ;_memset                             IMPORT  --
                           A  2563    
                           A  2564    
                           A  2565    ; Stack Frame Size: 6 (bytes)
                           A  2566    ;       Spill Code: 0 (instruction)
                           A  2567    
                           A  2568    
                           A  2569    ;  668	
                           A  2570    ;  669	/* Initializes the screen package, clea
                           A  2571    ;  670	void sc_ini(void)
                           A  2572    ;  671	{
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  51


PC     Object              I  Line    Source C:\proted\Debug\main.src
0109DD                     A  2573    _sc_ini:
                           A  2574    ;  672		sc_clr();
0109DD CD 7B 07 01         A  2575    	CALL	_sc_clr
                           A  2576    ;  673		
                           A  2577    ;  674		sc_fup();
0109E1 CD C2 09 01         A  2578    	CALL	_sc_fup
                           A  2579    ;  675	}
0109E5 C9                  A  2580    	RET	
                           A  2581    
                           A  2582    
                           A  2583    ;**************************** _sc_ini *********
                           A  2584    ;Name                         Addr/Register   S
                           A  2585    ;_sc_fup                             IMPORT  --
                           A  2586    ;_sc_clr                             IMPORT  --
                           A  2587    
                           A  2588    
                           A  2589    ; Stack Frame Size: 6 (bytes)
                           A  2590    ;       Spill Code: 0 (instruction)
                           A  2591    
                           A  2592    
                           A  2593    ;  676	
                           A  2594    ;  677	/* Finalizes the screen package, cleari
                           A  2595    ;  678	void sc_fin(void)
                           A  2596    ;  679	{
0109E6                     A  2597    _sc_fin:
                           A  2598    ;  680		sc_clr();
0109E6 CD 7B 07 01         A  2599    	CALL	_sc_clr
                           A  2600    ;  681		
                           A  2601    ;  682		sc_fup();
0109EA CD C2 09 01         A  2602    	CALL	_sc_fup
                           A  2603    ;  683	}
0109EE C9                  A  2604    	RET	
                           A  2605    
                           A  2606    
                           A  2607    ;**************************** _sc_fin *********
                           A  2608    ;Name                         Addr/Register   S
                           A  2609    ;_sc_fup                             IMPORT  --
                           A  2610    ;_sc_clr                             IMPORT  --
                           A  2611    
                           A  2612    
                           A  2613    ; Stack Frame Size: 6 (bytes)
                           A  2614    ;       Spill Code: 0 (instruction)
                           A  2615    
                           A  2616    
                           A  2617    ;  684	
                           A  2618    ;  685	/* Initialize the text data structure t
                           A  2619    ;  686	void tx_ini(void)
                           A  2620    ;  687	{
0109EF                     A  2621    _tx_ini:
                           A  2622    ;  688		p_root = &root;
0109EF 01 1B 55 01         A  2623    	LD	BC,_root
0109F3 ED43 24 55 01       A  2624    	LD	(_p_root),BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  52


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  2625    ;  689		p_root->p_next = p_root;
0109F8 ED43 1E 55 01       A  2626    	LD	(_root+3),BC
                           A  2627    ;  690		p_root->p_prev = p_root;
0109FD ED43 1B 55 01       A  2628    	LD	(_root),BC
                           A  2629    ;  691		p_root->p_data = NULL;
010A02 01000000            A  2630    	LD	BC,0
010A06 ED43 21 55 01       A  2631    	LD	(_root+6),BC
                           A  2632    ;  692		
                           A  2633    ;  693		numlines = 0;
010A0B ED43 2A 55 01       A  2634    	LD	(_numlines),BC
                           A  2635    ;  694	}
010A10 C9                  A  2636    	RET	
                           A  2637    
                           A  2638    
                           A  2639    ;**************************** _tx_ini *********
                           A  2640    ;Name                         Addr/Register   S
                           A  2641    ;_numlines                           STATIC    
                           A  2642    ;_p_root                             STATIC    
                           A  2643    ;_root                               STATIC    
                           A  2644    
                           A  2645    
                           A  2646    ; Stack Frame Size: 6 (bytes)
                           A  2647    ;       Spill Code: 0 (instruction)
                           A  2648    
                           A  2649    
                           A  2650    ;  695	
                           A  2651    ;  696	/* Sets the specified line to the speci
                           A  2652    ;  697	/* Deletes trailing spaces from the arg
                           A  2653    ;  698	void tx_set(p_line_t p_line, char *s)
                           A  2654    ;  699	{
010A11                     A  2655    _tx_set:
010A11 21FDFFFF            A  2656    	LD	HL,-3
010A15 CD 39 25 01         A  2657    	CALL	__frameset
                           A  2658    ;  700		size_t len;
                           A  2659    ;  701		
                           A  2660    ;  702		zap_trail(s);
010A19 DD0709              A  2661    	LD	BC,(IX+9)
010A1C C5                  A  2662    	PUSH	BC
010A1D CD 30 05 01         A  2663    	CALL	_zap_trail
010A21 C1                  A  2664    	POP	BC
                           A  2665    ;  703		
                           A  2666    ;  704		len = strlen(s);
010A22 DD0709              A  2667    	LD	BC,(IX+9)
010A25 C5                  A  2668    	PUSH	BC
010A26 CD F6 24 01         A  2669    	CALL	_strlen
010A2A C1                  A  2670    	POP	BC
010A2B DD2FFD              A  2671    	LD	(IX+-3),HL
                           A  2672    ;  705		
                           A  2673    ;  706		as(len <= MAXLNLEN, "tx_set: Line t
010A2E 01 86 27 01         A  2674    	LD	BC,L__113
010A32 C5                  A  2675    	PUSH	BC
010A33 DD07FD              A  2676    	LD	BC,(IX+-3)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  53


PC     Object              I  Line    Source C:\proted\Debug\main.src
010A36 21500000            A  2677    	LD	HL,80
010A3A B7                  A  2678    	OR	A,A
010A3B ED42                A  2679    	SBC	HL,BC
010A3D 38 04               A  2680    	JR	C,L__115
010A3F 3E01                A  2681    	LD	A,1
010A41 18 01               A  2682    	JR	L__116
010A43                     A  2683    L__115:
010A43 AF                  A  2684    	XOR	A,A
010A44                     A  2685    L__116:
010A44 4F                  A  2686    	LD	C,A
010A45 0600                A  2687    	LD	B,0
010A47 C5                  A  2688    	PUSH	BC
010A48 CD A8 03 01         A  2689    	CALL	_as
010A4C C1                  A  2690    	POP	BC
010A4D C1                  A  2691    	POP	BC
                           A  2692    ;  707		as(p_line != p_root, "tx_set: Attem
010A4E 01 9D 27 01         A  2693    	LD	BC,L__117
010A52 C5                  A  2694    	PUSH	BC
010A53 DD0706              A  2695    	LD	BC,(IX+6)
010A56 2A 24 55 01         A  2696    	LD	HL,(_p_root)
010A5A B7                  A  2697    	OR	A,A
010A5B ED42                A  2698    	SBC	HL,BC
010A5D 28 04               A  2699    	JR	Z,L__119
010A5F 3E01                A  2700    	LD	A,1
010A61 18 01               A  2701    	JR	L__120
010A63                     A  2702    L__119:
010A63 AF                  A  2703    	XOR	A,A
010A64                     A  2704    L__120:
010A64 4F                  A  2705    	LD	C,A
010A65 0600                A  2706    	LD	B,0
010A67 C5                  A  2707    	PUSH	BC
010A68 CD A8 03 01         A  2708    	CALL	_as
010A6C C1                  A  2709    	POP	BC
010A6D C1                  A  2710    	POP	BC
                           A  2711    ;  708		as(p_line->p_data != NULL, "tx_set:
010A6E 01 C3 27 01         A  2712    	LD	BC,L__121
010A72 C5                  A  2713    	PUSH	BC
010A73 DD3106              A  2714    	LD	IY,(IX+6)
010A76 FD2706              A  2715    	LD	HL,(IY+6)
010A79 01000000            A  2716    	LD	BC,0
010A7D B7                  A  2717    	OR	A,A
010A7E ED42                A  2718    	SBC	HL,BC
010A80 28 04               A  2719    	JR	Z,L__123
010A82 3E01                A  2720    	LD	A,1
010A84 18 01               A  2721    	JR	L__124
010A86                     A  2722    L__123:
010A86 AF                  A  2723    	XOR	A,A
010A87                     A  2724    L__124:
010A87 4F                  A  2725    	LD	C,A
010A88 0600                A  2726    	LD	B,0
010A8A C5                  A  2727    	PUSH	BC
010A8B CD A8 03 01         A  2728    	CALL	_as
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  54


PC     Object              I  Line    Source C:\proted\Debug\main.src
010A8F C1                  A  2729    	POP	BC
010A90 C1                  A  2730    	POP	BC
                           A  2731    ;  709		
                           A  2732    ;  710		free(p_line->p_data);
010A91 DD3106              A  2733    	LD	IY,(IX+6)
010A94 FD0706              A  2734    	LD	BC,(IY+6)
010A97 C5                  A  2735    	PUSH	BC
010A98 CD FB 22 01         A  2736    	CALL	_free
010A9C C1                  A  2737    	POP	BC
                           A  2738    ;  711		
                           A  2739    ;  712		p_line->p_data = mymalloc(len + 1);
010A9D DD07FD              A  2740    	LD	BC,(IX+-3)
010AA0 03                  A  2741    	INC	BC
010AA1 C5                  A  2742    	PUSH	BC
010AA2 CD A5 04 01         A  2743    	CALL	_mymalloc
010AA6 C1                  A  2744    	POP	BC
010AA7 DD3106              A  2745    	LD	IY,(IX+6)
010AAA FD2F06              A  2746    	LD	(IY+6),HL
                           A  2747    ;  713		
                           A  2748    ;  714		strcpy(p_line->p_data, s);
010AAD DD0709              A  2749    	LD	BC,(IX+9)
010AB0 C5                  A  2750    	PUSH	BC
010AB1 FD0706              A  2751    	LD	BC,(IY+6)
010AB4 C5                  A  2752    	PUSH	BC
010AB5 CD DD 25 01         A  2753    	CALL	_strcpy
010AB9 C1                  A  2754    	POP	BC
010ABA C1                  A  2755    	POP	BC
                           A  2756    ;  715	}
010ABB DDF9                A  2757    	LD	SP,IX
010ABD DDE1                A  2758    	POP	IX
010ABF C9                  A  2759    	RET	
                           A  2760    
                           A  2761    
                           A  2762    ;**************************** _tx_set *********
                           A  2763    ;Name                         Addr/Register   S
                           A  2764    ;_strcpy                             IMPORT  --
                           A  2765    ;_mymalloc                           IMPORT  --
                           A  2766    ;_free                               IMPORT  --
                           A  2767    ;_p_root                             STATIC    
                           A  2768    ;_as                                 IMPORT  --
                           A  2769    ;_strlen                             IMPORT  --
                           A  2770    ;_zap_trail                          IMPORT  --
                           A  2771    ;len                                   IX-3    
                           A  2772    ;s                                     IX+9    
                           A  2773    ;p_line                                IX+6    
                           A  2774    
                           A  2775    
                           A  2776    ; Stack Frame Size: 15 (bytes)
                           A  2777    ;       Spill Code: 0 (instruction)
                           A  2778    
                           A  2779    
                           A  2780    	SEGMENT STRSECT
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  55


PC     Object              I  Line    Source C:\proted\Debug\main.src
012786                     A  2781    L__113:
012786 74785F73 65743A20   A  2782    	DB	"tx_set: Line too long."
01278E 4C696E65 20746F6F 
012796 206C6F6E 672E 
01279C 00                  A  2783    	DB	0
01279D                     A  2784    L__117:
01279D 74785F73 65743A20   A  2785    	DB	"tx_set: Attempt to set the root line."
0127A5 41747465 6D707420 
0127AD 746F2073 65742074 
0127B5 68652072 6F6F7420 
0127BD 6C696E65 2E 
0127C2 00                  A  2786    	DB	0
0127C3                     A  2787    L__121:
0127C3 74785F73 65743A20   A  2788    	DB	"tx_set: p_data=NULL."
0127CB 705F6461 74613D4E 
0127D3 554C4C2E 
0127D7 00                  A  2789    	DB	0
                           A  2790    	SEGMENT CODE
                           A  2791    ;  716	
                           A  2792    ;  717	/* Insert a line containing the specifi
                           A  2793    ;  718	/* just before the specified line.     
                           A  2794    ;  719	void tx_ins(p_line_t p_line, char *s)
                           A  2795    ;  720	{
010AC0                     A  2796    _tx_ins:
010AC0 21FDFFFF            A  2797    	LD	HL,-3
010AC4 CD 39 25 01         A  2798    	CALL	__frameset
                           A  2799    ;  721		p_line_t p_new = mymalloc(sizeof(li
010AC8 01090000            A  2800    	LD	BC,9
010ACC C5                  A  2801    	PUSH	BC
010ACD CD A5 04 01         A  2802    	CALL	_mymalloc
010AD1 C1                  A  2803    	POP	BC
010AD2 DD2FFD              A  2804    	LD	(IX+-3),HL
                           A  2805    ;  722		
                           A  2806    ;  723		p_new->p_prev = p_line->p_prev;
010AD5 DD3106              A  2807    	LD	IY,(IX+6)
010AD8 FD0700              A  2808    	LD	BC,(IY+0)
010ADB DD31FD              A  2809    	LD	IY,(IX+-3)
010ADE FD0F00              A  2810    	LD	(IY+0),BC
                           A  2811    ;  724		p_new->p_next = p_line;
010AE1 DD0706              A  2812    	LD	BC,(IX+6)
010AE4 FD0F03              A  2813    	LD	(IY+3),BC
                           A  2814    ;  725		
                           A  2815    ;  726		p_line->p_prev = p_new;
010AE7 DD07FD              A  2816    	LD	BC,(IX+-3)
010AEA DD3106              A  2817    	LD	IY,(IX+6)
010AED FD0F00              A  2818    	LD	(IY+0),BC
                           A  2819    ;  727		p_new->p_prev->p_next = p_new;
010AF0 DD31FD              A  2820    	LD	IY,(IX+-3)
010AF3 FD3700              A  2821    	LD	IY,(IY+0)
010AF6 DD07FD              A  2822    	LD	BC,(IX+-3)
                           A  2823    ;  728		
                           A  2824    ;  729		p_new->p_data = mymalloc(0);
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  56


PC     Object              I  Line    Source C:\proted\Debug\main.src
010AF9 11000000            A  2825    	LD	DE,0
010AFD D5                  A  2826    	PUSH	DE
010AFE FD0F03              A  2827    	LD	(IY+3),BC
010B01 CD A5 04 01         A  2828    	CALL	_mymalloc
010B05 C1                  A  2829    	POP	BC
010B06 DD31FD              A  2830    	LD	IY,(IX+-3)
010B09 FD2F06              A  2831    	LD	(IY+6),HL
                           A  2832    ;  730		
                           A  2833    ;  731		tx_set(p_new, s);
010B0C DD0709              A  2834    	LD	BC,(IX+9)
010B0F C5                  A  2835    	PUSH	BC
010B10 DD07FD              A  2836    	LD	BC,(IX+-3)
010B13 C5                  A  2837    	PUSH	BC
010B14 CD 11 0A 01         A  2838    	CALL	_tx_set
010B18 C1                  A  2839    	POP	BC
010B19 C1                  A  2840    	POP	BC
                           A  2841    ;  732		
                           A  2842    ;  733		numlines++;
010B1A ED4B 2A 55 01       A  2843    	LD	BC,(_numlines)
010B1F 03                  A  2844    	INC	BC
010B20 ED43 2A 55 01       A  2845    	LD	(_numlines),BC
                           A  2846    ;  734	}
010B25 DDF9                A  2847    	LD	SP,IX
010B27 DDE1                A  2848    	POP	IX
010B29 C9                  A  2849    	RET	
                           A  2850    
                           A  2851    
                           A  2852    ;**************************** _tx_ins *********
                           A  2853    ;Name                         Addr/Register   S
                           A  2854    ;_numlines                           STATIC    
                           A  2855    ;_tx_set                             IMPORT  --
                           A  2856    ;_mymalloc                           IMPORT  --
                           A  2857    ;p_new                                 IX-3    
                           A  2858    ;s                                     IX+9    
                           A  2859    ;p_line                                IX+6    
                           A  2860    
                           A  2861    
                           A  2862    ; Stack Frame Size: 15 (bytes)
                           A  2863    ;       Spill Code: 0 (instruction)
                           A  2864    
                           A  2865    
                           A  2866    ;  735	
                           A  2867    ;  736	/* Deletes the specified line. */
                           A  2868    ;  737	void tx_del(p_line_t p_line)
                           A  2869    ;  738	{
010B2A                     A  2870    _tx_del:
010B2A 21FDFFFF            A  2871    	LD	HL,-3
010B2E CD 39 25 01         A  2872    	CALL	__frameset
                           A  2873    ;  739		as(p_line != NULL, "tx_del: NULL.")
010B32 01 D8 27 01         A  2874    	LD	BC,L__127
010B36 C5                  A  2875    	PUSH	BC
010B37 DD2706              A  2876    	LD	HL,(IX+6)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  57


PC     Object              I  Line    Source C:\proted\Debug\main.src
010B3A 01000000            A  2877    	LD	BC,0
010B3E B7                  A  2878    	OR	A,A
010B3F ED42                A  2879    	SBC	HL,BC
010B41 28 04               A  2880    	JR	Z,L__129
010B43 3E01                A  2881    	LD	A,1
010B45 18 01               A  2882    	JR	L__130
010B47                     A  2883    L__129:
010B47 AF                  A  2884    	XOR	A,A
010B48                     A  2885    L__130:
010B48 4F                  A  2886    	LD	C,A
010B49 0600                A  2887    	LD	B,0
010B4B C5                  A  2888    	PUSH	BC
010B4C CD A8 03 01         A  2889    	CALL	_as
010B50 C1                  A  2890    	POP	BC
010B51 C1                  A  2891    	POP	BC
                           A  2892    ;  740		as(p_line != p_root, "tx_del: Attem
010B52 01 E6 27 01         A  2893    	LD	BC,L__131
010B56 C5                  A  2894    	PUSH	BC
010B57 DD0706              A  2895    	LD	BC,(IX+6)
010B5A 2A 24 55 01         A  2896    	LD	HL,(_p_root)
010B5E B7                  A  2897    	OR	A,A
010B5F ED42                A  2898    	SBC	HL,BC
010B61 28 04               A  2899    	JR	Z,L__133
010B63 3E01                A  2900    	LD	A,1
010B65 18 01               A  2901    	JR	L__134
010B67                     A  2902    L__133:
010B67 AF                  A  2903    	XOR	A,A
010B68                     A  2904    L__134:
010B68 4F                  A  2905    	LD	C,A
010B69 0600                A  2906    	LD	B,0
010B6B C5                  A  2907    	PUSH	BC
010B6C CD A8 03 01         A  2908    	CALL	_as
010B70 C1                  A  2909    	POP	BC
010B71 C1                  A  2910    	POP	BC
                           A  2911    ;  741		
                           A  2912    ;  742		p_line->p_prev->p_next = p_line->p_
010B72 DD3106              A  2913    	LD	IY,(IX+6)
010B75 FD0700              A  2914    	LD	BC,(IY+0)
010B78 DD0FFD              A  2915    	LD	(IX+-3),BC
010B7B FD0703              A  2916    	LD	BC,(IY+3)
010B7E DD31FD              A  2917    	LD	IY,(IX+-3)
010B81 FD0F03              A  2918    	LD	(IY+3),BC
                           A  2919    ;  743		p_line->p_next->p_prev = p_line->p_
010B84 DD3106              A  2920    	LD	IY,(IX+6)
010B87 FD3703              A  2921    	LD	IY,(IY+3)
010B8A DD07FD              A  2922    	LD	BC,(IX+-3)
010B8D FD0F00              A  2923    	LD	(IY+0),BC
                           A  2924    ;  744		
                           A  2925    ;  745		free(p_line->p_data);
010B90 DD3106              A  2926    	LD	IY,(IX+6)
010B93 FD0706              A  2927    	LD	BC,(IY+6)
010B96 C5                  A  2928    	PUSH	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  58


PC     Object              I  Line    Source C:\proted\Debug\main.src
010B97 CD FB 22 01         A  2929    	CALL	_free
010B9B C1                  A  2930    	POP	BC
                           A  2931    ;  746		free(p_line);
010B9C DD0706              A  2932    	LD	BC,(IX+6)
010B9F C5                  A  2933    	PUSH	BC
010BA0 CD FB 22 01         A  2934    	CALL	_free
010BA4 C1                  A  2935    	POP	BC
                           A  2936    ;  747		
                           A  2937    ;  748		numlines--;
010BA5 ED4B 2A 55 01       A  2938    	LD	BC,(_numlines)
010BAA 0B                  A  2939    	DEC	BC
010BAB ED43 2A 55 01       A  2940    	LD	(_numlines),BC
                           A  2941    ;  749	}
010BB0 DDF9                A  2942    	LD	SP,IX
010BB2 DDE1                A  2943    	POP	IX
010BB4 C9                  A  2944    	RET	
                           A  2945    
                           A  2946    
                           A  2947    ;**************************** _tx_del *********
                           A  2948    ;Name                         Addr/Register   S
                           A  2949    ;_numlines                           STATIC    
                           A  2950    ;_free                               IMPORT  --
                           A  2951    ;_p_root                             STATIC    
                           A  2952    ;_as                                 IMPORT  --
                           A  2953    ;p_line                                IX+6    
                           A  2954    
                           A  2955    
                           A  2956    ; Stack Frame Size: 12 (bytes)
                           A  2957    ;       Spill Code: 0 (instruction)
                           A  2958    
                           A  2959    
                           A  2960    	SEGMENT STRSECT
0127D8                     A  2961    L__127:
0127D8 74785F64 656C3A20   A  2962    	DB	"tx_del: NULL."
0127E0 4E554C4C 2E 
0127E5 00                  A  2963    	DB	0
0127E6                     A  2964    L__131:
0127E6 74785F64 656C3A20   A  2965    	DB	"tx_del: Attempt to delete the root lin
0127EE 41747465 6D707420 
0127F6 746F2064 656C6574 
0127FE 65207468 6520726F 
012806 6F74206C 696E652E 
01280E 00                  A  2966    	DB	0
                           A  2967    	SEGMENT CODE
                           A  2968    ;  750	
                           A  2969    ;  751	/* Writes the contents of the line to t
                           A  2970    ;  752	/* padded array of MAXLNLEN characters.
                           A  2971    ;  753	void tx_get(p_line_t p_line)
                           A  2972    ;  754	{
010BB5                     A  2973    _tx_get:
010BB5 21FDFFFF            A  2974    	LD	HL,-3
010BB9 CD 39 25 01         A  2975    	CALL	__frameset
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  59


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  2976    ;  755		size_t len = strlen(p_line->p_data)
010BBD DD3106              A  2977    	LD	IY,(IX+6)
010BC0 FD0706              A  2978    	LD	BC,(IY+6)
010BC3 C5                  A  2979    	PUSH	BC
010BC4 CD F6 24 01         A  2980    	CALL	_strlen
010BC8 C1                  A  2981    	POP	BC
010BC9 DD2FFD              A  2982    	LD	(IX+-3),HL
                           A  2983    ;  756		
                           A  2984    ;  757		memset((void *)linbuf, ' ', MAXLNLE
010BCC 01500000            A  2985    	LD	BC,80
010BD0 C5                  A  2986    	PUSH	BC
010BD1 01200000            A  2987    	LD	BC,32
010BD5 C5                  A  2988    	PUSH	BC
010BD6 01 39 55 01         A  2989    	LD	BC,_linbuf
010BDA C5                  A  2990    	PUSH	BC
010BDB CD F7 25 01         A  2991    	CALL	_memset
010BDF C1                  A  2992    	POP	BC
010BE0 C1                  A  2993    	POP	BC
010BE1 C1                  A  2994    	POP	BC
                           A  2995    ;  758		
                           A  2996    ;  759		memmove((void *)linbuf, p_line->p_d
010BE2 DD07FD              A  2997    	LD	BC,(IX+-3)
010BE5 C5                  A  2998    	PUSH	BC
010BE6 DD3106              A  2999    	LD	IY,(IX+6)
010BE9 FD0706              A  3000    	LD	BC,(IY+6)
010BEC C5                  A  3001    	PUSH	BC
010BED 01 39 55 01         A  3002    	LD	BC,_linbuf
010BF1 C5                  A  3003    	PUSH	BC
010BF2 CD 18 26 01         A  3004    	CALL	_memmove
010BF6 C1                  A  3005    	POP	BC
010BF7 C1                  A  3006    	POP	BC
010BF8 C1                  A  3007    	POP	BC
                           A  3008    ;  760	}
010BF9 DDF9                A  3009    	LD	SP,IX
010BFB DDE1                A  3010    	POP	IX
010BFD C9                  A  3011    	RET	
                           A  3012    
                           A  3013    
                           A  3014    ;**************************** _tx_get *********
                           A  3015    ;Name                         Addr/Register   S
                           A  3016    ;_memmove                            IMPORT  --
                           A  3017    ;_linbuf                             STATIC    
                           A  3018    ;_memset                             IMPORT  --
                           A  3019    ;_strlen                             IMPORT  --
                           A  3020    ;len                                   IX-3    
                           A  3021    ;p_line                                IX+6    
                           A  3022    
                           A  3023    
                           A  3024    ; Stack Frame Size: 12 (bytes)
                           A  3025    ;       Spill Code: 0 (instruction)
                           A  3026    
                           A  3027    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  60


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3028    ;  761	
                           A  3029    ;  762	/* Sets the value of the specified line
                           A  3030    ;  763	void tx_put(p_line_t p_line)
                           A  3031    ;  764	{
010BFE                     A  3032    _tx_put:
010BFE CD 2C 25 01         A  3033    	CALL	__frameset0
                           A  3034    ;  765		linbuf[MAXLNLEN] = EOS;
010C02 21 89 55 01         A  3035    	LD	HL,_linbuf+80
                           A  3036    ;  766		
                           A  3037    ;  767		tx_set(p_line, linbuf);
010C06 01 39 55 01         A  3038    	LD	BC,_linbuf
010C0A C5                  A  3039    	PUSH	BC
010C0B 3600                A  3040    	LD	(HL),0
010C0D DD0706              A  3041    	LD	BC,(IX+6)
010C10 C5                  A  3042    	PUSH	BC
010C11 CD 11 0A 01         A  3043    	CALL	_tx_set
010C15 C1                  A  3044    	POP	BC
010C16 C1                  A  3045    	POP	BC
                           A  3046    ;  768	}
010C17 DDF9                A  3047    	LD	SP,IX
010C19 DDE1                A  3048    	POP	IX
010C1B C9                  A  3049    	RET	
                           A  3050    
                           A  3051    
                           A  3052    ;**************************** _tx_put *********
                           A  3053    ;Name                         Addr/Register   S
                           A  3054    ;_tx_set                             IMPORT  --
                           A  3055    ;_linbuf                             STATIC    
                           A  3056    ;p_line                                IX+6    
                           A  3057    
                           A  3058    
                           A  3059    ; Stack Frame Size: 9 (bytes)
                           A  3060    ;       Spill Code: 0 (instruction)
                           A  3061    
                           A  3062    
                           A  3063    ;  769	
                           A  3064    ;  770	/* Redraw the screen. */
                           A  3065    ;  771	void do_red(void)
                           A  3066    ;  772	{
010C1C                     A  3067    _do_red:
                           A  3068    ;  773		sc_fup();
010C1C CD C2 09 01         A  3069    	CALL	_sc_fup
                           A  3070    ;  774	}
010C20 C9                  A  3071    	RET	
                           A  3072    
                           A  3073    
                           A  3074    ;**************************** _do_red *********
                           A  3075    ;Name                         Addr/Register   S
                           A  3076    ;_sc_fup                             IMPORT  --
                           A  3077    
                           A  3078    
                           A  3079    ; Stack Frame Size: 6 (bytes)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  61


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3080    ;       Spill Code: 0 (instruction)
                           A  3081    
                           A  3082    
                           A  3083    ;  775	
                           A  3084    ;  776	/* Cursor up. */
                           A  3085    ;  777	void do_cup(void)
                           A  3086    ;  778	{
010C21                     A  3087    _do_cup:
010C21 21FFFFFF            A  3088    	LD	HL,-1
010C25 CD 39 25 01         A  3089    	CALL	__frameset
                           A  3090    ;  779		char ch;
                           A  3091    ;  780		
                           A  3092    ;  781		if (cur_line == 1)
010C29 01010000            A  3093    	LD	BC,1
010C2D 2A 2D 55 01         A  3094    	LD	HL,(_cur_line)
010C31 B7                  A  3095    	OR	A,A
010C32 ED42                A  3096    	SBC	HL,BC
010C34 20 06               A  3097    	JR	NZ,L_172
                           A  3098    ;  782		{
                           A  3099    ;  783			Show_Cursor();
010C36 CD 7D 18 01         A  3100    	CALL	_Show_Cursor
                           A  3101    ;  784			
                           A  3102    ;  785			return;
010C3A 18 6F               A  3103    	JR	L_176
                           A  3104    ;  786		}
010C3C                     A  3105    L_172:
                           A  3106    ;  787		
                           A  3107    ;  788		cur_line--;
010C3C ED4B 2D 55 01       A  3108    	LD	BC,(_cur_line)
010C41 0B                  A  3109    	DEC	BC
010C42 ED43 2D 55 01       A  3110    	LD	(_cur_line),BC
                           A  3111    ;  789		
                           A  3112    ;  790		p_curr = p_curr->p_prev;
010C47 FD2A 27 55 01       A  3113    	LD	IY,(_p_curr)
010C4C FD0700              A  3114    	LD	BC,(IY+0)
010C4F ED43 27 55 01       A  3115    	LD	(_p_curr),BC
                           A  3116    ;  791		
                           A  3117    ;  792		if (cur_row == 0)
010C54 2A 33 55 01         A  3118    	LD	HL,(_cur_row)
010C58 B7                  A  3119    	OR	A,A
010C59 01000000            A  3120    	LD	BC,0
010C5D ED42                A  3121    	SBC	HL,BC
010C5F 20 06               A  3122    	JR	NZ,L_175
                           A  3123    ;  793			paintall();
010C61 CD C2 16 01         A  3124    	CALL	_paintall
                           A  3125    ;  794		else
010C65 18 44               A  3126    	JR	L_176
010C67                     A  3127    L_175:
                           A  3128    ;  795		{
                           A  3129    ;  796			ch = scn_phys[cur_row][cur_col]
010C67 2A 33 55 01         A  3130    	LD	HL,(_cur_row)
010C6B 29                  A  3131    	ADD	HL,HL
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  62


PC     Object              I  Line    Source C:\proted\Debug\main.src
010C6C 29                  A  3132    	ADD	HL,HL
010C6D ED4B 33 55 01       A  3133    	LD	BC,(_cur_row)
010C72 09                  A  3134    	ADD	HL,BC
010C73 29                  A  3135    	ADD	HL,HL
010C74 29                  A  3136    	ADD	HL,HL
010C75 29                  A  3137    	ADD	HL,HL
010C76 29                  A  3138    	ADD	HL,HL
010C77 01 3B 44 01         A  3139    	LD	BC,_scn_phys
010C7B 09                  A  3140    	ADD	HL,BC
010C7C ED4B 36 55 01       A  3141    	LD	BC,(_cur_col)
010C81 09                  A  3142    	ADD	HL,BC
010C82 7E                  A  3143    	LD	A,(HL)
010C83 DD77FF              A  3144    	LD	(IX+-1),A
                           A  3145    ;  797			
                           A  3146    ;  798			cur_row--;
010C86 ED4B 33 55 01       A  3147    	LD	BC,(_cur_row)
010C8B 0B                  A  3148    	DEC	BC
010C8C ED43 33 55 01       A  3149    	LD	(_cur_row),BC
                           A  3150    ;  799			
                           A  3151    ;  800			plot_char(cur_col, cur_row + 1,
010C91 DD4EFF              A  3152    	LD	C,(IX+-1)
010C94 0600                A  3153    	LD	B,0
010C96 C5                  A  3154    	PUSH	BC
010C97 3A 33 55 01         A  3155    	LD	A,(_cur_row)
010C9B 3C                  A  3156    	INC	A
010C9C 4F                  A  3157    	LD	C,A
010C9D C5                  A  3158    	PUSH	BC
010C9E 3A 36 55 01         A  3159    	LD	A,(_cur_col)
010CA2 4F                  A  3160    	LD	C,A
010CA3 C5                  A  3161    	PUSH	BC
010CA4 CD A8 02 01         A  3162    	CALL	_plot_char
010CA8 C1                  A  3163    	POP	BC
010CA9 C1                  A  3164    	POP	BC
010CAA C1                  A  3165    	POP	BC
                           A  3166    ;  801		}
                           A  3167    ;  802	}
010CAB                     A  3168    L_176:
010CAB DDF9                A  3169    	LD	SP,IX
010CAD DDE1                A  3170    	POP	IX
010CAF C9                  A  3171    	RET	
                           A  3172    
                           A  3173    
                           A  3174    ;**************************** _do_cup *********
                           A  3175    ;Name                         Addr/Register   S
                           A  3176    ;_plot_char                          IMPORT  --
                           A  3177    ;_cur_col                            STATIC    
                           A  3178    ;_scn_phys                           STATIC   4
                           A  3179    ;_paintall                           IMPORT  --
                           A  3180    ;_cur_row                            STATIC    
                           A  3181    ;_p_curr                             STATIC    
                           A  3182    ;_Show_Cursor                        IMPORT  --
                           A  3183    ;_cur_line                           STATIC    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  63


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3184    ;ch                                    IX-1    
                           A  3185    
                           A  3186    
                           A  3187    ; Stack Frame Size: 7 (bytes)
                           A  3188    ;       Spill Code: 0 (instruction)
                           A  3189    
                           A  3190    
                           A  3191    ;  803	
                           A  3192    ;  804	/* Cursor down. */
                           A  3193    ;  805	void do_cdw(void)
                           A  3194    ;  806	{
010CB0                     A  3195    _do_cdw:
010CB0 21FCFFFF            A  3196    	LD	HL,-4
010CB4 CD 39 25 01         A  3197    	CALL	__frameset
                           A  3198    ;  807		char ch;
                           A  3199    ;  808		
                           A  3200    ;  809		if (p_curr->p_next == p_root)
010CB8 FD2A 27 55 01       A  3201    	LD	IY,(_p_curr)
010CBD FD0703              A  3202    	LD	BC,(IY+3)
010CC0 DD0FFC              A  3203    	LD	(IX+-4),BC
010CC3 2A 24 55 01         A  3204    	LD	HL,(_p_root)
010CC7 B7                  A  3205    	OR	A,A
010CC8 ED42                A  3206    	SBC	HL,BC
010CCA 20 06               A  3207    	JR	NZ,L_178
                           A  3208    ;  810		{
                           A  3209    ;  811			Show_Cursor();
010CCC CD 7D 18 01         A  3210    	CALL	_Show_Cursor
                           A  3211    ;  812			
                           A  3212    ;  813			return;
010CD0 18 6A               A  3213    	JR	L_183
                           A  3214    ;  814		}
010CD2                     A  3215    L_178:
                           A  3216    ;  815		
                           A  3217    ;  816		p_curr = p_curr->p_next;
010CD2 DD07FC              A  3218    	LD	BC,(IX+-4)
010CD5 ED43 27 55 01       A  3219    	LD	(_p_curr),BC
                           A  3220    ;  817		
                           A  3221    ;  818		cur_line++;
010CDA ED4B 2D 55 01       A  3222    	LD	BC,(_cur_line)
010CDF 03                  A  3223    	INC	BC
010CE0 ED43 2D 55 01       A  3224    	LD	(_cur_line),BC
                           A  3225    ;  819		
                           A  3226    ;  820		if (cur_row == SCNROWS - 1)
010CE5 2A 33 55 01         A  3227    	LD	HL,(_cur_row)
010CE9 B7                  A  3228    	OR	A,A
010CEA 01310000            A  3229    	LD	BC,49
010CEE ED42                A  3230    	SBC	HL,BC
010CF0 20 06               A  3231    	JR	NZ,L_182
                           A  3232    ;  821			paintall();	
010CF2 CD C2 16 01         A  3233    	CALL	_paintall
                           A  3234    ;  822		else
010CF6 18 44               A  3235    	JR	L_183
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  64


PC     Object              I  Line    Source C:\proted\Debug\main.src
010CF8                     A  3236    L_182:
                           A  3237    ;  823		{
                           A  3238    ;  824			ch = scn_phys[cur_row][cur_col]
010CF8 2A 33 55 01         A  3239    	LD	HL,(_cur_row)
010CFC 29                  A  3240    	ADD	HL,HL
010CFD 29                  A  3241    	ADD	HL,HL
010CFE ED4B 33 55 01       A  3242    	LD	BC,(_cur_row)
010D03 09                  A  3243    	ADD	HL,BC
010D04 29                  A  3244    	ADD	HL,HL
010D05 29                  A  3245    	ADD	HL,HL
010D06 29                  A  3246    	ADD	HL,HL
010D07 29                  A  3247    	ADD	HL,HL
010D08 01 3B 44 01         A  3248    	LD	BC,_scn_phys
010D0C 09                  A  3249    	ADD	HL,BC
010D0D ED4B 36 55 01       A  3250    	LD	BC,(_cur_col)
010D12 09                  A  3251    	ADD	HL,BC
010D13 7E                  A  3252    	LD	A,(HL)
010D14 DD77FF              A  3253    	LD	(IX+-1),A
                           A  3254    ;  825			
                           A  3255    ;  826			cur_row++;
010D17 ED4B 33 55 01       A  3256    	LD	BC,(_cur_row)
010D1C 03                  A  3257    	INC	BC
010D1D ED43 33 55 01       A  3258    	LD	(_cur_row),BC
                           A  3259    ;  827			
                           A  3260    ;  828			plot_char(cur_col, cur_row - 1,
010D22 DD4EFF              A  3261    	LD	C,(IX+-1)
010D25 0600                A  3262    	LD	B,0
010D27 C5                  A  3263    	PUSH	BC
010D28 3A 33 55 01         A  3264    	LD	A,(_cur_row)
010D2C 3D                  A  3265    	DEC	A
010D2D 4F                  A  3266    	LD	C,A
010D2E C5                  A  3267    	PUSH	BC
010D2F 3A 36 55 01         A  3268    	LD	A,(_cur_col)
010D33 4F                  A  3269    	LD	C,A
010D34 C5                  A  3270    	PUSH	BC
010D35 CD A8 02 01         A  3271    	CALL	_plot_char
010D39 C1                  A  3272    	POP	BC
010D3A C1                  A  3273    	POP	BC
010D3B C1                  A  3274    	POP	BC
                           A  3275    ;  829		}
                           A  3276    ;  830	}
010D3C                     A  3277    L_183:
010D3C DDF9                A  3278    	LD	SP,IX
010D3E DDE1                A  3279    	POP	IX
010D40 C9                  A  3280    	RET	
                           A  3281    
                           A  3282    
                           A  3283    ;**************************** _do_cdw *********
                           A  3284    ;Name                         Addr/Register   S
                           A  3285    ;_plot_char                          IMPORT  --
                           A  3286    ;_cur_col                            STATIC    
                           A  3287    ;_scn_phys                           STATIC   4
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  65


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3288    ;_paintall                           IMPORT  --
                           A  3289    ;_cur_row                            STATIC    
                           A  3290    ;_cur_line                           STATIC    
                           A  3291    ;_Show_Cursor                        IMPORT  --
                           A  3292    ;_p_root                             STATIC    
                           A  3293    ;_p_curr                             STATIC    
                           A  3294    ;G_5                                   IX-4    
                           A  3295    ;ch                                    IX-1    
                           A  3296    
                           A  3297    
                           A  3298    ; Stack Frame Size: 10 (bytes)
                           A  3299    ;       Spill Code: 0 (instruction)
                           A  3300    
                           A  3301    
                           A  3302    ;  831	
                           A  3303    ;  832	/* Cursor left. */
                           A  3304    ;  833	void do_clf(void)
                           A  3305    ;  834	{
010D41                     A  3306    _do_clf:
010D41 21FFFFFF            A  3307    	LD	HL,-1
010D45 CD 39 25 01         A  3308    	CALL	__frameset
                           A  3309    ;  835		char ch;
                           A  3310    ;  836		
                           A  3311    ;  837		if (cur_char == 1)
010D49 01010000            A  3312    	LD	BC,1
010D4D 2A 30 55 01         A  3313    	LD	HL,(_cur_char)
010D51 B7                  A  3314    	OR	A,A
010D52 ED42                A  3315    	SBC	HL,BC
010D54 20 06               A  3316    	JR	NZ,L_186
                           A  3317    ;  838		{
                           A  3318    ;  839			Show_Cursor();
010D56 CD 7D 18 01         A  3319    	CALL	_Show_Cursor
                           A  3320    ;  840			
                           A  3321    ;  841			return;
010D5A 18 62               A  3322    	JR	L_190
                           A  3323    ;  842		}
010D5C                     A  3324    L_186:
                           A  3325    ;  843		
                           A  3326    ;  844		cur_char--;
010D5C ED4B 30 55 01       A  3327    	LD	BC,(_cur_char)
010D61 0B                  A  3328    	DEC	BC
010D62 ED43 30 55 01       A  3329    	LD	(_cur_char),BC
                           A  3330    ;  845		
                           A  3331    ;  846		if (cur_col == 0)
010D67 2A 36 55 01         A  3332    	LD	HL,(_cur_col)
010D6B B7                  A  3333    	OR	A,A
010D6C 01000000            A  3334    	LD	BC,0
010D70 ED42                A  3335    	SBC	HL,BC
010D72 20 06               A  3336    	JR	NZ,L_189
                           A  3337    ;  847			paintall();
010D74 CD C2 16 01         A  3338    	CALL	_paintall
                           A  3339    ;  848		else
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  66


PC     Object              I  Line    Source C:\proted\Debug\main.src
010D78 18 44               A  3340    	JR	L_190
010D7A                     A  3341    L_189:
                           A  3342    ;  849		{
                           A  3343    ;  850			ch = scn_phys[cur_row][cur_col]
010D7A 2A 33 55 01         A  3344    	LD	HL,(_cur_row)
010D7E 29                  A  3345    	ADD	HL,HL
010D7F 29                  A  3346    	ADD	HL,HL
010D80 ED4B 33 55 01       A  3347    	LD	BC,(_cur_row)
010D85 09                  A  3348    	ADD	HL,BC
010D86 29                  A  3349    	ADD	HL,HL
010D87 29                  A  3350    	ADD	HL,HL
010D88 29                  A  3351    	ADD	HL,HL
010D89 29                  A  3352    	ADD	HL,HL
010D8A 01 3B 44 01         A  3353    	LD	BC,_scn_phys
010D8E 09                  A  3354    	ADD	HL,BC
010D8F ED4B 36 55 01       A  3355    	LD	BC,(_cur_col)
010D94 09                  A  3356    	ADD	HL,BC
010D95 7E                  A  3357    	LD	A,(HL)
010D96 DD77FF              A  3358    	LD	(IX+-1),A
                           A  3359    ;  851			
                           A  3360    ;  852			cur_col--;
010D99 ED4B 36 55 01       A  3361    	LD	BC,(_cur_col)
010D9E 0B                  A  3362    	DEC	BC
010D9F ED43 36 55 01       A  3363    	LD	(_cur_col),BC
                           A  3364    ;  853			
                           A  3365    ;  854			plot_char(cur_col + 1, cur_row,
010DA4 DD4EFF              A  3366    	LD	C,(IX+-1)
010DA7 3A 33 55 01         A  3367    	LD	A,(_cur_row)
010DAB 0600                A  3368    	LD	B,0
010DAD C5                  A  3369    	PUSH	BC
010DAE 4F                  A  3370    	LD	C,A
010DAF C5                  A  3371    	PUSH	BC
010DB0 3A 36 55 01         A  3372    	LD	A,(_cur_col)
010DB4 3C                  A  3373    	INC	A
010DB5 4F                  A  3374    	LD	C,A
010DB6 C5                  A  3375    	PUSH	BC
010DB7 CD A8 02 01         A  3376    	CALL	_plot_char
010DBB C1                  A  3377    	POP	BC
010DBC C1                  A  3378    	POP	BC
010DBD C1                  A  3379    	POP	BC
                           A  3380    ;  855		}
                           A  3381    ;  856	}
010DBE                     A  3382    L_190:
010DBE DDF9                A  3383    	LD	SP,IX
010DC0 DDE1                A  3384    	POP	IX
010DC2 C9                  A  3385    	RET	
                           A  3386    
                           A  3387    
                           A  3388    ;**************************** _do_clf *********
                           A  3389    ;Name                         Addr/Register   S
                           A  3390    ;_plot_char                          IMPORT  --
                           A  3391    ;_cur_row                            STATIC    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  67


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3392    ;_scn_phys                           STATIC   4
                           A  3393    ;_paintall                           IMPORT  --
                           A  3394    ;_cur_col                            STATIC    
                           A  3395    ;_Show_Cursor                        IMPORT  --
                           A  3396    ;_cur_char                           STATIC    
                           A  3397    ;ch                                    IX-1    
                           A  3398    
                           A  3399    
                           A  3400    ; Stack Frame Size: 7 (bytes)
                           A  3401    ;       Spill Code: 0 (instruction)
                           A  3402    
                           A  3403    
                           A  3404    ;  857	
                           A  3405    ;  858	/* Cursor right. */
                           A  3406    ;  859	void do_crt(void)
                           A  3407    ;  860	{
010DC3                     A  3408    _do_crt:
010DC3 21FFFFFF            A  3409    	LD	HL,-1
010DC7 CD 39 25 01         A  3410    	CALL	__frameset
                           A  3411    ;  861		char ch;
                           A  3412    ;  862		
                           A  3413    ;  863		if (cur_char == MAXLNLEN)
010DCB 01500000            A  3414    	LD	BC,80
010DCF 2A 30 55 01         A  3415    	LD	HL,(_cur_char)
010DD3 B7                  A  3416    	OR	A,A
010DD4 ED42                A  3417    	SBC	HL,BC
010DD6 20 06               A  3418    	JR	NZ,L_193
                           A  3419    ;  864		{
                           A  3420    ;  865			Show_Cursor();
010DD8 CD 7D 18 01         A  3421    	CALL	_Show_Cursor
                           A  3422    ;  866			
                           A  3423    ;  867			return;
010DDC 18 62               A  3424    	JR	L_197
                           A  3425    ;  868		}
010DDE                     A  3426    L_193:
                           A  3427    ;  869		
                           A  3428    ;  870		cur_char++;
010DDE ED4B 30 55 01       A  3429    	LD	BC,(_cur_char)
010DE3 03                  A  3430    	INC	BC
010DE4 ED43 30 55 01       A  3431    	LD	(_cur_char),BC
                           A  3432    ;  871		
                           A  3433    ;  872		if (cur_col == SCNCOLS - 1)
010DE9 2A 36 55 01         A  3434    	LD	HL,(_cur_col)
010DED B7                  A  3435    	OR	A,A
010DEE 014F0000            A  3436    	LD	BC,79
010DF2 ED42                A  3437    	SBC	HL,BC
010DF4 20 06               A  3438    	JR	NZ,L_196
                           A  3439    ;  873			paintall();
010DF6 CD C2 16 01         A  3440    	CALL	_paintall
                           A  3441    ;  874		else
010DFA 18 44               A  3442    	JR	L_197
010DFC                     A  3443    L_196:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  68


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3444    ;  875		{
                           A  3445    ;  876			ch = scn_phys[cur_row][cur_col]
010DFC 2A 33 55 01         A  3446    	LD	HL,(_cur_row)
010E00 29                  A  3447    	ADD	HL,HL
010E01 29                  A  3448    	ADD	HL,HL
010E02 ED4B 33 55 01       A  3449    	LD	BC,(_cur_row)
010E07 09                  A  3450    	ADD	HL,BC
010E08 29                  A  3451    	ADD	HL,HL
010E09 29                  A  3452    	ADD	HL,HL
010E0A 29                  A  3453    	ADD	HL,HL
010E0B 29                  A  3454    	ADD	HL,HL
010E0C 01 3B 44 01         A  3455    	LD	BC,_scn_phys
010E10 09                  A  3456    	ADD	HL,BC
010E11 ED4B 36 55 01       A  3457    	LD	BC,(_cur_col)
010E16 09                  A  3458    	ADD	HL,BC
010E17 7E                  A  3459    	LD	A,(HL)
010E18 DD77FF              A  3460    	LD	(IX+-1),A
                           A  3461    ;  877			
                           A  3462    ;  878			cur_col++;
010E1B ED4B 36 55 01       A  3463    	LD	BC,(_cur_col)
010E20 03                  A  3464    	INC	BC
010E21 ED43 36 55 01       A  3465    	LD	(_cur_col),BC
                           A  3466    ;  879			
                           A  3467    ;  880			plot_char(cur_col - 1, cur_row,
010E26 DD4EFF              A  3468    	LD	C,(IX+-1)
010E29 3A 33 55 01         A  3469    	LD	A,(_cur_row)
010E2D 0600                A  3470    	LD	B,0
010E2F C5                  A  3471    	PUSH	BC
010E30 4F                  A  3472    	LD	C,A
010E31 C5                  A  3473    	PUSH	BC
010E32 3A 36 55 01         A  3474    	LD	A,(_cur_col)
010E36 3D                  A  3475    	DEC	A
010E37 4F                  A  3476    	LD	C,A
010E38 C5                  A  3477    	PUSH	BC
010E39 CD A8 02 01         A  3478    	CALL	_plot_char
010E3D C1                  A  3479    	POP	BC
010E3E C1                  A  3480    	POP	BC
010E3F C1                  A  3481    	POP	BC
                           A  3482    ;  881		}
                           A  3483    ;  882	}
010E40                     A  3484    L_197:
010E40 DDF9                A  3485    	LD	SP,IX
010E42 DDE1                A  3486    	POP	IX
010E44 C9                  A  3487    	RET	
                           A  3488    
                           A  3489    
                           A  3490    ;**************************** _do_crt *********
                           A  3491    ;Name                         Addr/Register   S
                           A  3492    ;_plot_char                          IMPORT  --
                           A  3493    ;_cur_row                            STATIC    
                           A  3494    ;_scn_phys                           STATIC   4
                           A  3495    ;_paintall                           IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  69


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3496    ;_cur_col                            STATIC    
                           A  3497    ;_Show_Cursor                        IMPORT  --
                           A  3498    ;_cur_char                           STATIC    
                           A  3499    ;ch                                    IX-1    
                           A  3500    
                           A  3501    
                           A  3502    ; Stack Frame Size: 7 (bytes)
                           A  3503    ;       Spill Code: 0 (instruction)
                           A  3504    
                           A  3505    
                           A  3506    ;  883	
                           A  3507    ;  884	/* Page down. */
                           A  3508    ;  885	void do_pdw(void)
                           A  3509    ;  886	{
010E45                     A  3510    _do_pdw:
010E45 21FDFFFF            A  3511    	LD	HL,-3
010E49 CD 39 25 01         A  3512    	CALL	__frameset
                           A  3513    ;  887		register char i;
                           A  3514    ;  888		char ch, oldr = cur_row;
010E4D 3A 33 55 01         A  3515    	LD	A,(_cur_row)
010E51 DD77FE              A  3516    	LD	(IX+-2),A
010E54 DD36FF00            A  3517    	LD	(IX+-1),0
                           A  3518    ;  889		
                           A  3519    ;  890		for (i = 0; i < SCNROWS; i++)
010E58 18 35               A  3520    	JR	L_205
010E5A                     A  3521    L_203:
                           A  3522    ;  891		{
                           A  3523    ;  892			if (cur_line == numlines + 1)
010E5A 2A 2A 55 01         A  3524    	LD	HL,(_numlines)
010E5E 23                  A  3525    	INC	HL
010E5F B7                  A  3526    	OR	A,A
010E60 ED4B 2D 55 01       A  3527    	LD	BC,(_cur_line)
010E65 ED42                A  3528    	SBC	HL,BC
010E67 28 2F               A  3529    	JR	Z,L_207
                           A  3530    ;  893				break;
                           A  3531    ;  894			
                           A  3532    ;  895			p_curr = p_curr->p_next;
010E69 FD2A 27 55 01       A  3533    	LD	IY,(_p_curr)
010E6E FD0703              A  3534    	LD	BC,(IY+3)
010E71 ED43 27 55 01       A  3535    	LD	(_p_curr),BC
                           A  3536    ;  896			
                           A  3537    ;  897			cur_line++;
010E76 ED4B 2D 55 01       A  3538    	LD	BC,(_cur_line)
010E7B 03                  A  3539    	INC	BC
010E7C ED43 2D 55 01       A  3540    	LD	(_cur_line),BC
                           A  3541    ;  898			cur_row++;
010E81 ED4B 33 55 01       A  3542    	LD	BC,(_cur_row)
010E86 03                  A  3543    	INC	BC
010E87 ED43 33 55 01       A  3544    	LD	(_cur_row),BC
010E8C DD34FF              A  3545    	INC	(IX+-1)
                           A  3546    ;  899		}
010E8F                     A  3547    L_205:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  70


PC     Object              I  Line    Source C:\proted\Debug\main.src
010E8F DD7EFF              A  3548    	LD	A,(IX+-1)
010E92 FE32                A  3549    	CP	A,50
010E94 FA 5A 0E 01         A  3550    	JP	M,L_203
010E98                     A  3551    L_207:
                           A  3552    ;  900		
                           A  3553    ;  901		if (cur_row > SCNROWS - 1)
010E98 ED4B 33 55 01       A  3554    	LD	BC,(_cur_row)
010E9D 21310000            A  3555    	LD	HL,49
010EA1 B7                  A  3556    	OR	A,A
010EA2 ED42                A  3557    	SBC	HL,BC
010EA4 F2 AE 0E 01         A  3558    	JP	P,L__154
010EA8 EA BB 0E 01         A  3559    	JP	PE,L_208
010EAC 18 04               A  3560    	JR	L__155
010EAE                     A  3561    L__154:
010EAE E2 BB 0E 01         A  3562    	JP	PO,L_208
010EB2                     A  3563    L__155:
                           A  3564    ;  902			cur_row = SCNROWS - 1;
010EB2 01310000            A  3565    	LD	BC,49
010EB6 ED43 33 55 01       A  3566    	LD	(_cur_row),BC
010EBB                     A  3567    L_208:
                           A  3568    ;  903		
                           A  3569    ;  904		paintall();
010EBB CD C2 16 01         A  3570    	CALL	_paintall
                           A  3571    ;  905		
                           A  3572    ;  906		ch = scn_phys[oldr][cur_col];
010EBF DD7EFE              A  3573    	LD	A,(IX+-2)
010EC2 17ED62              A  3574    	SEXT	HL
010EC5 DD6EFE              A  3575    	LD	L,(IX+-2)
010EC8 E5C1                A  3576    	LD	BC,HL
010ECA C5E1                A  3577    	LD	HL,BC
010ECC 29                  A  3578    	ADD	HL,HL
010ECD 29                  A  3579    	ADD	HL,HL
010ECE 09                  A  3580    	ADD	HL,BC
010ECF 29                  A  3581    	ADD	HL,HL
010ED0 29                  A  3582    	ADD	HL,HL
010ED1 29                  A  3583    	ADD	HL,HL
010ED2 29                  A  3584    	ADD	HL,HL
010ED3 01 3B 44 01         A  3585    	LD	BC,_scn_phys
010ED7 09                  A  3586    	ADD	HL,BC
010ED8 ED4B 36 55 01       A  3587    	LD	BC,(_cur_col)
010EDD 09                  A  3588    	ADD	HL,BC
010EDE 7E                  A  3589    	LD	A,(HL)
010EDF DD77FD              A  3590    	LD	(IX+-3),A
                           A  3591    ;  907		
                           A  3592    ;  908		plot_char(cur_col, oldr, ch);
010EE2 DD4EFD              A  3593    	LD	C,(IX+-3)
010EE5 0600                A  3594    	LD	B,0
010EE7 C5                  A  3595    	PUSH	BC
010EE8 DD4EFE              A  3596    	LD	C,(IX+-2)
010EEB 3A 36 55 01         A  3597    	LD	A,(_cur_col)
010EEF C5                  A  3598    	PUSH	BC
010EF0 4F                  A  3599    	LD	C,A
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  71


PC     Object              I  Line    Source C:\proted\Debug\main.src
010EF1 C5                  A  3600    	PUSH	BC
010EF2 CD A8 02 01         A  3601    	CALL	_plot_char
010EF6 C1                  A  3602    	POP	BC
010EF7 C1                  A  3603    	POP	BC
010EF8 C1                  A  3604    	POP	BC
                           A  3605    ;  909		
                           A  3606    ;  910		Show_Cursor();
010EF9 CD 7D 18 01         A  3607    	CALL	_Show_Cursor
                           A  3608    ;  911	}
010EFD DDF9                A  3609    	LD	SP,IX
010EFF DDE1                A  3610    	POP	IX
010F01 C9                  A  3611    	RET	
                           A  3612    
                           A  3613    
                           A  3614    ;**************************** _do_pdw *********
                           A  3615    ;Name                         Addr/Register   S
                           A  3616    ;_Show_Cursor                        IMPORT  --
                           A  3617    ;_plot_char                          IMPORT  --
                           A  3618    ;_cur_col                            STATIC    
                           A  3619    ;_scn_phys                           STATIC   4
                           A  3620    ;_paintall                           IMPORT  --
                           A  3621    ;_p_curr                             STATIC    
                           A  3622    ;_cur_line                           STATIC    
                           A  3623    ;_numlines                           STATIC    
                           A  3624    ;_cur_row                            STATIC    
                           A  3625    ;ch                                    IX-3    
                           A  3626    ;oldr                                  IX-2    
                           A  3627    ;i                                     IX-1    
                           A  3628    
                           A  3629    
                           A  3630    ; Stack Frame Size: 9 (bytes)
                           A  3631    ;       Spill Code: 0 (instruction)
                           A  3632    
                           A  3633    
                           A  3634    ;  912	
                           A  3635    ;  913	/* Page up. */
                           A  3636    ;  914	void do_pup(void)
                           A  3637    ;  915	{
010F02                     A  3638    _do_pup:
010F02 21FDFFFF            A  3639    	LD	HL,-3
010F06 CD 39 25 01         A  3640    	CALL	__frameset
                           A  3641    ;  916		register char i;
                           A  3642    ;  917		char ch, oldr = cur_row;
010F0A 3A 33 55 01         A  3643    	LD	A,(_cur_row)
010F0E DD77FE              A  3644    	LD	(IX+-2),A
010F11 DD36FF00            A  3645    	LD	(IX+-1),0
                           A  3646    ;  918		
                           A  3647    ;  919		for (i = 0; i < SCNROWS; i++)
010F15 18 33               A  3648    	JR	L_217
010F17                     A  3649    L_215:
                           A  3650    ;  920		{
                           A  3651    ;  921			if (cur_line == 1)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  72


PC     Object              I  Line    Source C:\proted\Debug\main.src
010F17 01010000            A  3652    	LD	BC,1
010F1B 2A 2D 55 01         A  3653    	LD	HL,(_cur_line)
010F1F B7                  A  3654    	OR	A,A
010F20 ED42                A  3655    	SBC	HL,BC
010F22 28 39               A  3656    	JR	Z,L_219
                           A  3657    ;  922				break;
                           A  3658    ;  923			
                           A  3659    ;  924			p_curr = p_curr->p_prev;
010F24 FD2A 27 55 01       A  3660    	LD	IY,(_p_curr)
010F29 FD0700              A  3661    	LD	BC,(IY+0)
010F2C ED43 27 55 01       A  3662    	LD	(_p_curr),BC
                           A  3663    ;  925			
                           A  3664    ;  926			cur_line--;
010F31 ED4B 2D 55 01       A  3665    	LD	BC,(_cur_line)
010F36 0B                  A  3666    	DEC	BC
010F37 ED43 2D 55 01       A  3667    	LD	(_cur_line),BC
                           A  3668    ;  927			cur_row--;
010F3C ED4B 33 55 01       A  3669    	LD	BC,(_cur_row)
010F41 0B                  A  3670    	DEC	BC
010F42 ED43 33 55 01       A  3671    	LD	(_cur_row),BC
010F47 DD34FF              A  3672    	INC	(IX+-1)
                           A  3673    ;  928		}
010F4A                     A  3674    L_217:
010F4A DD7EFF              A  3675    	LD	A,(IX+-1)
010F4D FE32                A  3676    	CP	A,50
010F4F FA 59 0F 01         A  3677    	JP	M,L__160
010F53 EA 17 0F 01         A  3678    	JP	PE,L_215
010F57 18 04               A  3679    	JR	L__161
010F59                     A  3680    L__160:
010F59 E2 17 0F 01         A  3681    	JP	PO,L_215
010F5D                     A  3682    L__161:
010F5D                     A  3683    L_219:
                           A  3684    ;  929		
                           A  3685    ;  930		if (cur_row < 0)
010F5D 01000000            A  3686    	LD	BC,0
010F61 2A 33 55 01         A  3687    	LD	HL,(_cur_row)
010F65 B7                  A  3688    	OR	A,A
010F66 ED42                A  3689    	SBC	HL,BC
010F68 F2 72 0F 01         A  3690    	JP	P,L__162
010F6C EA 7F 0F 01         A  3691    	JP	PE,L_220
010F70 18 04               A  3692    	JR	L__163
010F72                     A  3693    L__162:
010F72 E2 7F 0F 01         A  3694    	JP	PO,L_220
010F76                     A  3695    L__163:
                           A  3696    ;  931			cur_row = 0;	
010F76 01000000            A  3697    	LD	BC,0
010F7A ED43 33 55 01       A  3698    	LD	(_cur_row),BC
010F7F                     A  3699    L_220:
                           A  3700    ;  932		
                           A  3701    ;  933		paintall();
010F7F CD C2 16 01         A  3702    	CALL	_paintall
                           A  3703    ;  934		
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  73


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3704    ;  935		ch = scn_phys[oldr][cur_col];
010F83 DD7EFE              A  3705    	LD	A,(IX+-2)
010F86 17ED62              A  3706    	SEXT	HL
010F89 DD6EFE              A  3707    	LD	L,(IX+-2)
010F8C E5C1                A  3708    	LD	BC,HL
010F8E C5E1                A  3709    	LD	HL,BC
010F90 29                  A  3710    	ADD	HL,HL
010F91 29                  A  3711    	ADD	HL,HL
010F92 09                  A  3712    	ADD	HL,BC
010F93 29                  A  3713    	ADD	HL,HL
010F94 29                  A  3714    	ADD	HL,HL
010F95 29                  A  3715    	ADD	HL,HL
010F96 29                  A  3716    	ADD	HL,HL
010F97 01 3B 44 01         A  3717    	LD	BC,_scn_phys
010F9B 09                  A  3718    	ADD	HL,BC
010F9C ED4B 36 55 01       A  3719    	LD	BC,(_cur_col)
010FA1 09                  A  3720    	ADD	HL,BC
010FA2 7E                  A  3721    	LD	A,(HL)
010FA3 DD77FD              A  3722    	LD	(IX+-3),A
                           A  3723    ;  936		
                           A  3724    ;  937		plot_char(cur_col, oldr, ch);
010FA6 DD4EFD              A  3725    	LD	C,(IX+-3)
010FA9 0600                A  3726    	LD	B,0
010FAB C5                  A  3727    	PUSH	BC
010FAC DD4EFE              A  3728    	LD	C,(IX+-2)
010FAF 3A 36 55 01         A  3729    	LD	A,(_cur_col)
010FB3 C5                  A  3730    	PUSH	BC
010FB4 4F                  A  3731    	LD	C,A
010FB5 C5                  A  3732    	PUSH	BC
010FB6 CD A8 02 01         A  3733    	CALL	_plot_char
010FBA C1                  A  3734    	POP	BC
010FBB C1                  A  3735    	POP	BC
010FBC C1                  A  3736    	POP	BC
                           A  3737    ;  938		
                           A  3738    ;  939		Show_Cursor();
010FBD CD 7D 18 01         A  3739    	CALL	_Show_Cursor
                           A  3740    ;  940	}
010FC1 DDF9                A  3741    	LD	SP,IX
010FC3 DDE1                A  3742    	POP	IX
010FC5 C9                  A  3743    	RET	
                           A  3744    
                           A  3745    
                           A  3746    ;**************************** _do_pup *********
                           A  3747    ;Name                         Addr/Register   S
                           A  3748    ;_Show_Cursor                        IMPORT  --
                           A  3749    ;_plot_char                          IMPORT  --
                           A  3750    ;_cur_col                            STATIC    
                           A  3751    ;_scn_phys                           STATIC   4
                           A  3752    ;_paintall                           IMPORT  --
                           A  3753    ;_p_curr                             STATIC    
                           A  3754    ;_cur_line                           STATIC    
                           A  3755    ;_cur_row                            STATIC    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  74


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3756    ;ch                                    IX-3    
                           A  3757    ;oldr                                  IX-2    
                           A  3758    ;i                                     IX-1    
                           A  3759    
                           A  3760    
                           A  3761    ; Stack Frame Size: 9 (bytes)
                           A  3762    ;       Spill Code: 0 (instruction)
                           A  3763    
                           A  3764    
                           A  3765    ;  941	
                           A  3766    ;  942	/* Return. */
                           A  3767    ;  943	void do_ret(void)
                           A  3768    ;  944	{
010FC6                     A  3769    _do_ret:
010FC6 21FCFFFF            A  3770    	LD	HL,-4
010FCA CD 39 25 01         A  3771    	CALL	__frameset
                           A  3772    ;  945		char len = strlen(p_curr->p_data);
010FCE FD2A 27 55 01       A  3773    	LD	IY,(_p_curr)
010FD3 FD0706              A  3774    	LD	BC,(IY+6)
010FD6 C5                  A  3775    	PUSH	BC
010FD7 CD F6 24 01         A  3776    	CALL	_strlen
010FDB C1                  A  3777    	POP	BC
010FDC DD75FC              A  3778    	LD	(IX+-4),L
                           A  3779    ;  946		char ch, oldr = cur_row, oldc = cur
010FDF 3A 33 55 01         A  3780    	LD	A,(_cur_row)
010FE3 DD77FF              A  3781    	LD	(IX+-1),A
010FE6 3A 36 55 01         A  3782    	LD	A,(_cur_col)
010FEA DD77FE              A  3783    	LD	(IX+-2),A
                           A  3784    ;  947		
                           A  3785    ;  948		gotoxy(len, cur_row);
010FED 3A 33 55 01         A  3786    	LD	A,(_cur_row)
010FF1 4F                  A  3787    	LD	C,A
010FF2 0600                A  3788    	LD	B,0
010FF4 C5                  A  3789    	PUSH	BC
010FF5 DD4EFC              A  3790    	LD	C,(IX+-4)
010FF8 C5                  A  3791    	PUSH	BC
010FF9 CD 23 03 01         A  3792    	CALL	_gotoxy
010FFD C1                  A  3793    	POP	BC
010FFE C1                  A  3794    	POP	BC
                           A  3795    ;  949		
                           A  3796    ;  950		clreol();
010FFF CD E0 02 01         A  3797    	CALL	_clreol
                           A  3798    ;  951		
                           A  3799    ;  952		ch = scn_phys[oldr][oldc];
011003 DD7EFF              A  3800    	LD	A,(IX+-1)
011006 17ED62              A  3801    	SEXT	HL
011009 DD6EFF              A  3802    	LD	L,(IX+-1)
01100C E5C1                A  3803    	LD	BC,HL
01100E C5E1                A  3804    	LD	HL,BC
011010 29                  A  3805    	ADD	HL,HL
011011 29                  A  3806    	ADD	HL,HL
011012 09                  A  3807    	ADD	HL,BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  75


PC     Object              I  Line    Source C:\proted\Debug\main.src
011013 29                  A  3808    	ADD	HL,HL
011014 29                  A  3809    	ADD	HL,HL
011015 29                  A  3810    	ADD	HL,HL
011016 29                  A  3811    	ADD	HL,HL
011017 DD7EFE              A  3812    	LD	A,(IX+-2)
01101A 01 3B 44 01         A  3813    	LD	BC,_scn_phys
01101E 09                  A  3814    	ADD	HL,BC
01101F E5C1                A  3815    	LD	BC,HL
011021 17ED62              A  3816    	SEXT	HL
011024 DD6EFE              A  3817    	LD	L,(IX+-2)
011027 09                  A  3818    	ADD	HL,BC
011028 7E                  A  3819    	LD	A,(HL)
011029 DD77FD              A  3820    	LD	(IX+-3),A
                           A  3821    ;  953		
                           A  3822    ;  954		plot_char(oldc, oldr, ch);
01102C DD4EFD              A  3823    	LD	C,(IX+-3)
01102F 0600                A  3824    	LD	B,0
011031 C5                  A  3825    	PUSH	BC
011032 DD4EFF              A  3826    	LD	C,(IX+-1)
011035 C5                  A  3827    	PUSH	BC
011036 DD4EFE              A  3828    	LD	C,(IX+-2)
011039 C5                  A  3829    	PUSH	BC
01103A CD A8 02 01         A  3830    	CALL	_plot_char
01103E C1                  A  3831    	POP	BC
01103F C1                  A  3832    	POP	BC
011040 C1                  A  3833    	POP	BC
                           A  3834    ;  955		
                           A  3835    ;  956		cur_char = 1;
011041 01010000            A  3836    	LD	BC,1
011045 ED43 30 55 01       A  3837    	LD	(_cur_char),BC
                           A  3838    ;  957		cur_col  = 0;
01104A 01000000            A  3839    	LD	BC,0
01104E ED43 36 55 01       A  3840    	LD	(_cur_col),BC
                           A  3841    ;  958		
                           A  3842    ;  959		ch = scn_phys[oldr][oldc];
011053 DD7EFF              A  3843    	LD	A,(IX+-1)
011056 17ED62              A  3844    	SEXT	HL
011059 DD6EFF              A  3845    	LD	L,(IX+-1)
01105C E5C1                A  3846    	LD	BC,HL
01105E C5E1                A  3847    	LD	HL,BC
011060 29                  A  3848    	ADD	HL,HL
011061 29                  A  3849    	ADD	HL,HL
011062 09                  A  3850    	ADD	HL,BC
011063 29                  A  3851    	ADD	HL,HL
011064 29                  A  3852    	ADD	HL,HL
011065 29                  A  3853    	ADD	HL,HL
011066 29                  A  3854    	ADD	HL,HL
011067 DD7EFE              A  3855    	LD	A,(IX+-2)
01106A 01 3B 44 01         A  3856    	LD	BC,_scn_phys
01106E 09                  A  3857    	ADD	HL,BC
01106F E5C1                A  3858    	LD	BC,HL
011071 17ED62              A  3859    	SEXT	HL
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  76


PC     Object              I  Line    Source C:\proted\Debug\main.src
011074 DD6EFE              A  3860    	LD	L,(IX+-2)
011077 09                  A  3861    	ADD	HL,BC
011078 7E                  A  3862    	LD	A,(HL)
011079 DD77FD              A  3863    	LD	(IX+-3),A
                           A  3864    ;  960		
                           A  3865    ;  961		plot_char(oldc, oldr, ch);
01107C DD4EFD              A  3866    	LD	C,(IX+-3)
01107F 0600                A  3867    	LD	B,0
011081 C5                  A  3868    	PUSH	BC
011082 DD4EFF              A  3869    	LD	C,(IX+-1)
011085 C5                  A  3870    	PUSH	BC
011086 DD4EFE              A  3871    	LD	C,(IX+-2)
011089 C5                  A  3872    	PUSH	BC
01108A CD A8 02 01         A  3873    	CALL	_plot_char
01108E C1                  A  3874    	POP	BC
01108F C1                  A  3875    	POP	BC
011090 C1                  A  3876    	POP	BC
                           A  3877    ;  962		
                           A  3878    ;  963		do_cdw();
011091 CD B0 0C 01         A  3879    	CALL	_do_cdw
                           A  3880    ;  964	}
011095 DDF9                A  3881    	LD	SP,IX
011097 DDE1                A  3882    	POP	IX
011099 C9                  A  3883    	RET	
                           A  3884    
                           A  3885    
                           A  3886    ;**************************** _do_ret *********
                           A  3887    ;Name                         Addr/Register   S
                           A  3888    ;_do_cdw                             IMPORT  --
                           A  3889    ;_cur_char                           STATIC    
                           A  3890    ;_plot_char                          IMPORT  --
                           A  3891    ;_scn_phys                           STATIC   4
                           A  3892    ;_clreol                             IMPORT  --
                           A  3893    ;_gotoxy                             IMPORT  --
                           A  3894    ;_cur_col                            STATIC    
                           A  3895    ;_cur_row                            STATIC    
                           A  3896    ;_p_curr                             STATIC    
                           A  3897    ;_strlen                             IMPORT  --
                           A  3898    ;len                                   IX-4    
                           A  3899    ;ch                                    IX-3    
                           A  3900    ;oldc                                  IX-2    
                           A  3901    ;oldr                                  IX-1    
                           A  3902    
                           A  3903    
                           A  3904    ; Stack Frame Size: 10 (bytes)
                           A  3905    ;       Spill Code: 0 (instruction)
                           A  3906    
                           A  3907    
                           A  3908    ;  965	
                           A  3909    ;  966	/* Enhanced Return. Break a line into t
                           A  3910    ;  967	void do_enhanced_ret(void)
                           A  3911    ;  968	{
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  77


PC     Object              I  Line    Source C:\proted\Debug\main.src
01109A                     A  3912    _do_enhanced_ret:
01109A 215FFFFF            A  3913    	LD	HL,-161
01109E CD 39 25 01         A  3914    	CALL	__frameset
                           A  3915    ;  969		char len = strlen(p_curr->p_data);
0110A2 FD2A 27 55 01       A  3916    	LD	IY,(_p_curr)
0110A7 FD0706              A  3917    	LD	BC,(IY+6)
0110AA C5                  A  3918    	PUSH	BC
0110AB CD F6 24 01         A  3919    	CALL	_strlen
0110AF C1                  A  3920    	POP	BC
0110B0 DD75FF              A  3921    	LD	(IX+-1),L
                           A  3922    ;  970		char app[MAXLNLEN], app2[MAXLNLEN];
                           A  3923    ;  971		
                           A  3924    ;  972		if (cur_col < len)
0110B3 DD7EFF              A  3925    	LD	A,(IX+-1)
0110B6 17ED62              A  3926    	SEXT	HL
0110B9 DD6EFF              A  3927    	LD	L,(IX+-1)
0110BC E5C1                A  3928    	LD	BC,HL
0110BE 2A 36 55 01         A  3929    	LD	HL,(_cur_col)
0110C2 B7                  A  3930    	OR	A,A
0110C3 ED42                A  3931    	SBC	HL,BC
0110C5 F2 CF 10 01         A  3932    	JP	P,L__167
0110C9 EA 84 11 01         A  3933    	JP	PE,L_224
0110CD 18 04               A  3934    	JR	L__168
0110CF                     A  3935    L__167:
0110CF E2 84 11 01         A  3936    	JP	PO,L_224
0110D3                     A  3937    L__168:
                           A  3938    ;  973		{
                           A  3939    ;  974			memset(app, 0, MAXLNLEN);
0110D3 01500000            A  3940    	LD	BC,80
0110D7 C5                  A  3941    	PUSH	BC
0110D8 01000000            A  3942    	LD	BC,0
0110DC C5                  A  3943    	PUSH	BC
0110DD ED65AF              A  3944    	PEA	IX+-81
0110E0 CD F7 25 01         A  3945    	CALL	_memset
0110E4 C1                  A  3946    	POP	BC
0110E5 C1                  A  3947    	POP	BC
0110E6 C1                  A  3948    	POP	BC
                           A  3949    ;  975			memset(app2, 0, MAXLNLEN);
0110E7 01500000            A  3950    	LD	BC,80
0110EB C5                  A  3951    	PUSH	BC
0110EC 01000000            A  3952    	LD	BC,0
0110F0 C5                  A  3953    	PUSH	BC
0110F1 DDE5E1              A  3954    	LD	HL,IX
0110F4 015FFFFF            A  3955    	LD	BC,-161
0110F8 09                  A  3956    	ADD	HL,BC
0110F9 E5C1                A  3957    	LD	BC,HL
0110FB C5                  A  3958    	PUSH	BC
0110FC CD F7 25 01         A  3959    	CALL	_memset
011100 C1                  A  3960    	POP	BC
011101 C1                  A  3961    	POP	BC
011102 C1                  A  3962    	POP	BC
                           A  3963    ;  976			
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  78


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  3964    ;  977			memmove(app, p_curr->p_data + c
011103 DD7EFF              A  3965    	LD	A,(IX+-1)
011106 17ED62              A  3966    	SEXT	HL
011109 DD6EFF              A  3967    	LD	L,(IX+-1)
01110C B7                  A  3968    	OR	A,A
01110D ED4B 36 55 01       A  3969    	LD	BC,(_cur_col)
011112 FD2A 27 55 01       A  3970    	LD	IY,(_p_curr)
011117 ED5B 36 55 01       A  3971    	LD	DE,(_cur_col)
01111C ED42                A  3972    	SBC	HL,BC
01111E E5                  A  3973    	PUSH	HL
01111F FD2706              A  3974    	LD	HL,(IY+6)
011122 19                  A  3975    	ADD	HL,DE
011123 E5                  A  3976    	PUSH	HL
011124 ED65AF              A  3977    	PEA	IX+-81
011127 CD 18 26 01         A  3978    	CALL	_memmove
01112B C1                  A  3979    	POP	BC
01112C C1                  A  3980    	POP	BC
01112D C1                  A  3981    	POP	BC
                           A  3982    ;  978			
                           A  3983    ;  979			memmove(app2, p_curr->p_data, c
01112E ED4B 36 55 01       A  3984    	LD	BC,(_cur_col)
011133 C5                  A  3985    	PUSH	BC
011134 FD2A 27 55 01       A  3986    	LD	IY,(_p_curr)
011139 FD0706              A  3987    	LD	BC,(IY+6)
01113C C5                  A  3988    	PUSH	BC
01113D DDE5E1              A  3989    	LD	HL,IX
011140 015FFFFF            A  3990    	LD	BC,-161
011144 09                  A  3991    	ADD	HL,BC
011145 E5C1                A  3992    	LD	BC,HL
011147 C5                  A  3993    	PUSH	BC
011148 CD 18 26 01         A  3994    	CALL	_memmove
01114C C1                  A  3995    	POP	BC
01114D C1                  A  3996    	POP	BC
01114E C1                  A  3997    	POP	BC
                           A  3998    ;  980			
                           A  3999    ;  981			do_iln();
01114F CD FB 13 01         A  4000    	CALL	_do_iln
                           A  4001    ;  982			
                           A  4002    ;  983			tx_set(p_curr, app);
011153 ED65AF              A  4003    	PEA	IX+-81
011156 ED4B 27 55 01       A  4004    	LD	BC,(_p_curr)
01115B C5                  A  4005    	PUSH	BC
01115C CD 11 0A 01         A  4006    	CALL	_tx_set
011160 C1                  A  4007    	POP	BC
011161 C1                  A  4008    	POP	BC
                           A  4009    ;  984			
                           A  4010    ;  985			tx_set(p_curr->p_prev, app2);
011162 DDE5E1              A  4011    	LD	HL,IX
011165 015FFFFF            A  4012    	LD	BC,-161
011169 09                  A  4013    	ADD	HL,BC
01116A E5C1                A  4014    	LD	BC,HL
01116C C5                  A  4015    	PUSH	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  79


PC     Object              I  Line    Source C:\proted\Debug\main.src
01116D FD2A 27 55 01       A  4016    	LD	IY,(_p_curr)
011172 FD0700              A  4017    	LD	BC,(IY+0)
011175 C5                  A  4018    	PUSH	BC
011176 CD 11 0A 01         A  4019    	CALL	_tx_set
01117A C1                  A  4020    	POP	BC
01117B C1                  A  4021    	POP	BC
                           A  4022    ;  986			
                           A  4023    ;  987			paintall();
01117C CD C2 16 01         A  4024    	CALL	_paintall
                           A  4025    ;  988			
                           A  4026    ;  989			do_cup();
011180 CD 21 0C 01         A  4027    	CALL	_do_cup
                           A  4028    ;  990		}
011184                     A  4029    L_224:
                           A  4030    ;  991		
                           A  4031    ;  992		do_ret();
011184 CD C6 0F 01         A  4032    	CALL	_do_ret
                           A  4033    ;  993	}
011188 DDF9                A  4034    	LD	SP,IX
01118A DDE1                A  4035    	POP	IX
01118C C9                  A  4036    	RET	
                           A  4037    
                           A  4038    
                           A  4039    ;**************************** _do_enhanced_ret 
                           A  4040    ;Name                         Addr/Register   S
                           A  4041    ;_do_ret                             IMPORT  --
                           A  4042    ;_do_cup                             IMPORT  --
                           A  4043    ;_paintall                           IMPORT  --
                           A  4044    ;_tx_set                             IMPORT  --
                           A  4045    ;_do_iln                             IMPORT  --
                           A  4046    ;_memmove                            IMPORT  --
                           A  4047    ;_memset                             IMPORT  --
                           A  4048    ;_cur_col                            STATIC    
                           A  4049    ;_p_curr                             STATIC    
                           A  4050    ;_strlen                             IMPORT  --
                           A  4051    ;app2                                IX-161    
                           A  4052    ;app                                  IX-81    
                           A  4053    ;len                                   IX-1    
                           A  4054    
                           A  4055    
                           A  4056    ; Stack Frame Size: 167 (bytes)
                           A  4057    ;       Spill Code: 0 (instruction)
                           A  4058    
                           A  4059    
                           A  4060    ;  994	
                           A  4061    ;  995	/* Tab. */
                           A  4062    ;  996	void do_tab(void)
                           A  4063    ;  997	{
01118D                     A  4064    _do_tab:
01118D 21FDFFFF            A  4065    	LD	HL,-3
011191 CD 39 25 01         A  4066    	CALL	__frameset
                           A  4067    ;  998		int x = cur_char;
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  80


PC     Object              I  Line    Source C:\proted\Debug\main.src
011195 ED4B 30 55 01       A  4068    	LD	BC,(_cur_char)
01119A DD0FFD              A  4069    	LD	(IX+-3),BC
                           A  4070    ;  999		
                           A  4071    ; 1000		do
01119D                     A  4072    L_227:
                           A  4073    ; 1001		{
                           A  4074    ; 1002			do_crt();
01119D CD C3 0D 01         A  4075    	CALL	_do_crt
                           A  4076    ; 1003			x++;
0111A1 DD07FD              A  4077    	LD	BC,(IX+-3)
0111A4 03                  A  4078    	INC	BC
0111A5 DD0FFD              A  4079    	LD	(IX+-3),BC
                           A  4080    ; 1004		} while (((x - 1) % 8) != 0);
0111A8 C5E1                A  4081    	LD	HL,BC
0111AA 2B                  A  4082    	DEC	HL
0111AB 01080000            A  4083    	LD	BC,8
0111AF CD B5 24 01         A  4084    	CALL	__irems
0111B3 B7                  A  4085    	OR	A,A
0111B4 01000000            A  4086    	LD	BC,0
0111B8 ED42                A  4087    	SBC	HL,BC
0111BA 20 E1               A  4088    	JR	NZ,L_227
                           A  4089    ; 1005	}
0111BC DDF9                A  4090    	LD	SP,IX
0111BE DDE1                A  4091    	POP	IX
0111C0 C9                  A  4092    	RET	
                           A  4093    
                           A  4094    
                           A  4095    ;**************************** _do_tab *********
                           A  4096    ;Name                         Addr/Register   S
                           A  4097    ;_do_crt                             IMPORT  --
                           A  4098    ;_cur_char                           STATIC    
                           A  4099    ;x                                     IX-3    
                           A  4100    
                           A  4101    
                           A  4102    ; Stack Frame Size: 9 (bytes)
                           A  4103    ;       Spill Code: 0 (instruction)
                           A  4104    
                           A  4105    
                           A  4106    ; 1006	
                           A  4107    ; 1007	/* Jump to top of document. */
                           A  4108    ; 1008	void do_top(void)
                           A  4109    ; 1009	{
0111C1                     A  4110    _do_top:
0111C1 21FEFFFF            A  4111    	LD	HL,-2
0111C5 CD 39 25 01         A  4112    	CALL	__frameset
                           A  4113    ; 1010		char oldr, oldc;
                           A  4114    ; 1011		
                           A  4115    ; 1012		oldr = cur_row;
0111C9 3A 33 55 01         A  4116    	LD	A,(_cur_row)
0111CD DD77FF              A  4117    	LD	(IX+-1),A
                           A  4118    ; 1013		oldc = cur_col;
0111D0 3A 36 55 01         A  4119    	LD	A,(_cur_col)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  81


PC     Object              I  Line    Source C:\proted\Debug\main.src
0111D4 DD77FE              A  4120    	LD	(IX+-2),A
                           A  4121    ; 1014		
                           A  4122    ; 1015		p_curr = p_root->p_next;
0111D7 FD2A 24 55 01       A  4123    	LD	IY,(_p_root)
0111DC FD0703              A  4124    	LD	BC,(IY+3)
0111DF ED43 27 55 01       A  4125    	LD	(_p_curr),BC
                           A  4126    ; 1016		
                           A  4127    ; 1017		cur_line = 1;
0111E4 01010000            A  4128    	LD	BC,1
0111E8 ED43 2D 55 01       A  4129    	LD	(_cur_line),BC
                           A  4130    ; 1018		cur_char = 1;
0111ED ED43 30 55 01       A  4131    	LD	(_cur_char),BC
                           A  4132    ; 1019		cur_row = 0;
0111F2 01000000            A  4133    	LD	BC,0
0111F6 ED43 33 55 01       A  4134    	LD	(_cur_row),BC
                           A  4135    ; 1020		cur_col = 0;
0111FB ED43 36 55 01       A  4136    	LD	(_cur_col),BC
                           A  4137    ; 1021		
                           A  4138    ; 1022		paintall();
011200 CD C2 16 01         A  4139    	CALL	_paintall
                           A  4140    ; 1023		
                           A  4141    ; 1024		plot_char(oldc, oldr, scn_phys[oldr
011204 DD7EFF              A  4142    	LD	A,(IX+-1)
011207 17ED62              A  4143    	SEXT	HL
01120A DD6EFF              A  4144    	LD	L,(IX+-1)
01120D E5C1                A  4145    	LD	BC,HL
01120F C5E1                A  4146    	LD	HL,BC
011211 29                  A  4147    	ADD	HL,HL
011212 29                  A  4148    	ADD	HL,HL
011213 09                  A  4149    	ADD	HL,BC
011214 29                  A  4150    	ADD	HL,HL
011215 29                  A  4151    	ADD	HL,HL
011216 29                  A  4152    	ADD	HL,HL
011217 29                  A  4153    	ADD	HL,HL
011218 01 3B 44 01         A  4154    	LD	BC,_scn_phys
01121C 09                  A  4155    	ADD	HL,BC
01121D E5C1                A  4156    	LD	BC,HL
01121F DD7EFE              A  4157    	LD	A,(IX+-2)
011222 17ED62              A  4158    	SEXT	HL
011225 DD6EFE              A  4159    	LD	L,(IX+-2)
011228 09                  A  4160    	ADD	HL,BC
011229 4E                  A  4161    	LD	C,(HL)
01122A 0600                A  4162    	LD	B,0
01122C C5                  A  4163    	PUSH	BC
01122D DD4EFF              A  4164    	LD	C,(IX+-1)
011230 C5                  A  4165    	PUSH	BC
011231 DD4EFE              A  4166    	LD	C,(IX+-2)
011234 C5                  A  4167    	PUSH	BC
011235 CD A8 02 01         A  4168    	CALL	_plot_char
011239 C1                  A  4169    	POP	BC
01123A C1                  A  4170    	POP	BC
01123B C1                  A  4171    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  82


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4172    ; 1025	}
01123C DDF9                A  4173    	LD	SP,IX
01123E DDE1                A  4174    	POP	IX
011240 C9                  A  4175    	RET	
                           A  4176    
                           A  4177    
                           A  4178    ;**************************** _do_top *********
                           A  4179    ;Name                         Addr/Register   S
                           A  4180    ;_scn_phys                           STATIC   4
                           A  4181    ;_plot_char                          IMPORT  --
                           A  4182    ;_paintall                           IMPORT  --
                           A  4183    ;_cur_char                           STATIC    
                           A  4184    ;_cur_line                           STATIC    
                           A  4185    ;_p_curr                             STATIC    
                           A  4186    ;_p_root                             STATIC    
                           A  4187    ;_cur_col                            STATIC    
                           A  4188    ;_cur_row                            STATIC    
                           A  4189    ;oldc                                  IX-2    
                           A  4190    ;oldr                                  IX-1    
                           A  4191    
                           A  4192    
                           A  4193    ; Stack Frame Size: 8 (bytes)
                           A  4194    ;       Spill Code: 0 (instruction)
                           A  4195    
                           A  4196    
                           A  4197    ; 1026	
                           A  4198    ; 1027	/* Jump to bottom of document. */
                           A  4199    ; 1028	void do_bot(char paint)
                           A  4200    ; 1029	{
011241                     A  4201    _do_bot:
011241 21FEFFFF            A  4202    	LD	HL,-2
011245 CD 39 25 01         A  4203    	CALL	__frameset
                           A  4204    ; 1030		char oldr, oldc;
                           A  4205    ; 1031		
                           A  4206    ; 1032		oldr = cur_row;
011249 3A 33 55 01         A  4207    	LD	A,(_cur_row)
01124D DD77FF              A  4208    	LD	(IX+-1),A
                           A  4209    ; 1033		oldc = cur_col;
011250 3A 36 55 01         A  4210    	LD	A,(_cur_col)
011254 DD77FE              A  4211    	LD	(IX+-2),A
                           A  4212    ; 1034		
                           A  4213    ; 1035		p_curr = p_root;
011257 ED4B 24 55 01       A  4214    	LD	BC,(_p_root)
01125C ED43 27 55 01       A  4215    	LD	(_p_curr),BC
                           A  4216    ; 1036		
                           A  4217    ; 1037		cur_line = numlines + 1;
011261 ED4B 2A 55 01       A  4218    	LD	BC,(_numlines)
011266 03                  A  4219    	INC	BC
011267 ED43 2D 55 01       A  4220    	LD	(_cur_line),BC
                           A  4221    ; 1038		cur_row = numlines;
01126C ED4B 2A 55 01       A  4222    	LD	BC,(_numlines)
011271 ED43 33 55 01       A  4223    	LD	(_cur_row),BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  83


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4224    ; 1039		cur_char = 1;
011276 01010000            A  4225    	LD	BC,1
01127A ED43 30 55 01       A  4226    	LD	(_cur_char),BC
                           A  4227    ; 1040		cur_col = 0;
01127F 01000000            A  4228    	LD	BC,0
011283 ED43 36 55 01       A  4229    	LD	(_cur_col),BC
                           A  4230    ; 1041		
                           A  4231    ; 1042		if (cur_row > SCNROWS - 1)
011288 ED4B 2A 55 01       A  4232    	LD	BC,(_numlines)
01128D B7                  A  4233    	OR	A,A
01128E 21310000            A  4234    	LD	HL,49
011292 ED42                A  4235    	SBC	HL,BC
011294 F2 9E 12 01         A  4236    	JP	P,L__175
011298 EA AB 12 01         A  4237    	JP	PE,L_233
01129C 18 04               A  4238    	JR	L__176
01129E                     A  4239    L__175:
01129E E2 AB 12 01         A  4240    	JP	PO,L_233
0112A2                     A  4241    L__176:
                           A  4242    ; 1043			cur_row = SCNROWS - 1;
0112A2 01310000            A  4243    	LD	BC,49
0112A6 ED43 33 55 01       A  4244    	LD	(_cur_row),BC
0112AB                     A  4245    L_233:
                           A  4246    ; 1044		
                           A  4247    ; 1045		if (paint)
0112AB DD7E06              A  4248    	LD	A,(IX+6)
0112AE B7                  A  4249    	OR	A,A
0112AF 28 04               A  4250    	JR	Z,L_234
                           A  4251    ; 1046			paintall();
0112B1 CD C2 16 01         A  4252    	CALL	_paintall
0112B5                     A  4253    L_234:
                           A  4254    ; 1047		
                           A  4255    ; 1048		plot_char(oldc, oldr, scn_phys[oldr
0112B5 DD7EFF              A  4256    	LD	A,(IX+-1)
0112B8 17ED62              A  4257    	SEXT	HL
0112BB DD6EFF              A  4258    	LD	L,(IX+-1)
0112BE E5C1                A  4259    	LD	BC,HL
0112C0 C5E1                A  4260    	LD	HL,BC
0112C2 29                  A  4261    	ADD	HL,HL
0112C3 29                  A  4262    	ADD	HL,HL
0112C4 09                  A  4263    	ADD	HL,BC
0112C5 29                  A  4264    	ADD	HL,HL
0112C6 29                  A  4265    	ADD	HL,HL
0112C7 29                  A  4266    	ADD	HL,HL
0112C8 29                  A  4267    	ADD	HL,HL
0112C9 01 3B 44 01         A  4268    	LD	BC,_scn_phys
0112CD 09                  A  4269    	ADD	HL,BC
0112CE E5C1                A  4270    	LD	BC,HL
0112D0 DD7EFE              A  4271    	LD	A,(IX+-2)
0112D3 17ED62              A  4272    	SEXT	HL
0112D6 DD6EFE              A  4273    	LD	L,(IX+-2)
0112D9 09                  A  4274    	ADD	HL,BC
0112DA 4E                  A  4275    	LD	C,(HL)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  84


PC     Object              I  Line    Source C:\proted\Debug\main.src
0112DB 0600                A  4276    	LD	B,0
0112DD C5                  A  4277    	PUSH	BC
0112DE DD4EFF              A  4278    	LD	C,(IX+-1)
0112E1 C5                  A  4279    	PUSH	BC
0112E2 DD4EFE              A  4280    	LD	C,(IX+-2)
0112E5 C5                  A  4281    	PUSH	BC
0112E6 CD A8 02 01         A  4282    	CALL	_plot_char
0112EA C1                  A  4283    	POP	BC
0112EB C1                  A  4284    	POP	BC
0112EC C1                  A  4285    	POP	BC
                           A  4286    ; 1049	}
0112ED DDF9                A  4287    	LD	SP,IX
0112EF DDE1                A  4288    	POP	IX
0112F1 C9                  A  4289    	RET	
                           A  4290    
                           A  4291    
                           A  4292    ;**************************** _do_bot *********
                           A  4293    ;Name                         Addr/Register   S
                           A  4294    ;_scn_phys                           STATIC   4
                           A  4295    ;_plot_char                          IMPORT  --
                           A  4296    ;_paintall                           IMPORT  --
                           A  4297    ;_cur_char                           STATIC    
                           A  4298    ;_cur_line                           STATIC    
                           A  4299    ;_numlines                           STATIC    
                           A  4300    ;_p_curr                             STATIC    
                           A  4301    ;_p_root                             STATIC    
                           A  4302    ;_cur_col                            STATIC    
                           A  4303    ;_cur_row                            STATIC    
                           A  4304    ;oldc                                  IX-2    
                           A  4305    ;oldr                                  IX-1    
                           A  4306    ;paint                                 IX+6    
                           A  4307    
                           A  4308    
                           A  4309    ; Stack Frame Size: 11 (bytes)
                           A  4310    ;       Spill Code: 0 (instruction)
                           A  4311    
                           A  4312    
                           A  4313    ; 1050	
                           A  4314    ; 1051	/* Type the specified character. */
                           A  4315    ; 1052	void do_chr(char ch)
                           A  4316    ; 1053	{
0112F2                     A  4317    _do_chr:
0112F2 21FDFFFF            A  4318    	LD	HL,-3
0112F6 CD 39 25 01         A  4319    	CALL	__frameset
                           A  4320    ; 1054		register int i;
                           A  4321    ; 1055		
                           A  4322    ; 1056		if (p_curr == p_root)
0112FA ED4B 24 55 01       A  4323    	LD	BC,(_p_root)
0112FF 2A 27 55 01         A  4324    	LD	HL,(_p_curr)
011303 B7                  A  4325    	OR	A,A
011304 ED42                A  4326    	SBC	HL,BC
011306 28 77               A  4327    	JR	Z,L_246
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  85


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4328    ; 1057			return;
                           A  4329    ; 1058	
                           A  4330    ; 1059		if (cur_char == MAXLNLEN + 1)
011308 01510000            A  4331    	LD	BC,81
01130C 2A 30 55 01         A  4332    	LD	HL,(_cur_char)
011310 B7                  A  4333    	OR	A,A
011311 ED42                A  4334    	SBC	HL,BC
011313 20 06               A  4335    	JR	NZ,L_239
                           A  4336    ; 1060		{
                           A  4337    ; 1061			Show_Cursor();
011315 CD 7D 18 01         A  4338    	CALL	_Show_Cursor
                           A  4339    ; 1062			
                           A  4340    ; 1063			return;
011319 18 64               A  4341    	JR	L_246
                           A  4342    ; 1064		}
01131B                     A  4343    L_239:
                           A  4344    ; 1065		
                           A  4345    ; 1066		tx_get(p_curr);	
01131B ED4B 27 55 01       A  4346    	LD	BC,(_p_curr)
011320 C5                  A  4347    	PUSH	BC
011321 CD B5 0B 01         A  4348    	CALL	_tx_get
011325 C1                  A  4349    	POP	BC
                           A  4350    ; 1067		
                           A  4351    ; 1068		if (InsertMode != 0)
011326 3A 98 55 01         A  4352    	LD	A,(_InsertMode)
01132A B7                  A  4353    	OR	A,A
01132B 28 31               A  4354    	JR	Z,L_245
01132D 014F0000            A  4355    	LD	BC,79
011331 DD0FFD              A  4356    	LD	(IX+-3),BC
                           A  4357    ; 1069		{
                           A  4358    ; 1070			for (i = MAXLNLEN - 1; i > cur_
011334 18 19               A  4359    	JR	L_243
011336                     A  4360    L_241:
                           A  4361    ; 1071				linbuf[i] = linbuf[i - 1];
011336 DD07FD              A  4362    	LD	BC,(IX+-3)
011339 0B                  A  4363    	DEC	BC
01133A C5E1                A  4364    	LD	HL,BC
01133C 11 39 55 01         A  4365    	LD	DE,_linbuf
011340 19                  A  4366    	ADD	HL,DE
011341 E5FDE1              A  4367    	LD	IY,HL
011344 DD27FD              A  4368    	LD	HL,(IX+-3)
011347 19                  A  4369    	ADD	HL,DE
011348 FD7E00              A  4370    	LD	A,(IY)
01134B 77                  A  4371    	LD	(HL),A
01134C DD0FFD              A  4372    	LD	(IX+-3),BC
01134F                     A  4373    L_243:
01134F 2A 30 55 01         A  4374    	LD	HL,(_cur_char)
011353 2B                  A  4375    	DEC	HL
011354 B7                  A  4376    	OR	A,A
011355 DD07FD              A  4377    	LD	BC,(IX+-3)
011358 ED42                A  4378    	SBC	HL,BC
01135A FA 36 13 01         A  4379    	JP	M,L_241
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  86


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4380    ; 1072		}	
01135E                     A  4381    L_245:
                           A  4382    ; 1073		
                           A  4383    ; 1074		linbuf[cur_char - 1] = (char)(ch);
01135E 2A 30 55 01         A  4384    	LD	HL,(_cur_char)
011362 2B                  A  4385    	DEC	HL
011363 01 39 55 01         A  4386    	LD	BC,_linbuf
011367 09                  A  4387    	ADD	HL,BC
011368 DD7E06              A  4388    	LD	A,(IX+6)
01136B 77                  A  4389    	LD	(HL),A
                           A  4390    ; 1075		
                           A  4391    ; 1076		tx_put(p_curr);
01136C ED4B 27 55 01       A  4392    	LD	BC,(_p_curr)
011371 C5                  A  4393    	PUSH	BC
011372 CD FE 0B 01         A  4394    	CALL	_tx_put
011376 C1                  A  4395    	POP	BC
                           A  4396    ; 1077		
                           A  4397    ; 1078		do_crt();
011377 CD C3 0D 01         A  4398    	CALL	_do_crt
                           A  4399    ; 1079		paintrow();
01137B CD D4 17 01         A  4400    	CALL	_paintrow
                           A  4401    ; 1080	}
01137F                     A  4402    L_246:
01137F DDF9                A  4403    	LD	SP,IX
011381 DDE1                A  4404    	POP	IX
011383 C9                  A  4405    	RET	
                           A  4406    
                           A  4407    
                           A  4408    ;**************************** _do_chr *********
                           A  4409    ;Name                         Addr/Register   S
                           A  4410    ;_paintrow                           IMPORT  --
                           A  4411    ;_do_crt                             IMPORT  --
                           A  4412    ;_tx_put                             IMPORT  --
                           A  4413    ;_linbuf                             STATIC    
                           A  4414    ;_InsertMode                         STATIC    
                           A  4415    ;_tx_get                             IMPORT  --
                           A  4416    ;_Show_Cursor                        IMPORT  --
                           A  4417    ;_cur_char                           STATIC    
                           A  4418    ;_p_root                             STATIC    
                           A  4419    ;_p_curr                             STATIC    
                           A  4420    ;i                                     IX-3    
                           A  4421    ;ch                                    IX+6    
                           A  4422    
                           A  4423    
                           A  4424    ; Stack Frame Size: 12 (bytes)
                           A  4425    ;       Spill Code: 0 (instruction)
                           A  4426    
                           A  4427    
                           A  4428    ; 1081	
                           A  4429    ; 1082	/* Delete character. */
                           A  4430    ; 1083	void do_dch(void)
                           A  4431    ; 1084	{
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  87


PC     Object              I  Line    Source C:\proted\Debug\main.src
011384                     A  4432    _do_dch:
011384 21FDFFFF            A  4433    	LD	HL,-3
011388 CD 39 25 01         A  4434    	CALL	__frameset
                           A  4435    ; 1085		register int i;
                           A  4436    ; 1086		
                           A  4437    ; 1087		if (p_curr == p_root)
01138C ED4B 24 55 01       A  4438    	LD	BC,(_p_root)
011391 2A 27 55 01         A  4439    	LD	HL,(_p_curr)
011395 B7                  A  4440    	OR	A,A
011396 ED42                A  4441    	SBC	HL,BC
011398 28 5C               A  4442    	JR	Z,L_254
                           A  4443    ; 1088			return;
                           A  4444    ; 1089		
                           A  4445    ; 1090		tx_get(p_curr);
01139A ED4B 27 55 01       A  4446    	LD	BC,(_p_curr)
01139F C5                  A  4447    	PUSH	BC
0113A0 CD B5 0B 01         A  4448    	CALL	_tx_get
0113A4 C1                  A  4449    	POP	BC
0113A5 ED4B 30 55 01       A  4450    	LD	BC,(_cur_char)
0113AA 0B                  A  4451    	DEC	BC
0113AB DD0FFD              A  4452    	LD	(IX+-3),BC
                           A  4453    ; 1091		
                           A  4454    ; 1092		for (i = cur_char - 1; i < MAXLNLEN
0113AE 18 19               A  4455    	JR	L_252
0113B0                     A  4456    L_250:
                           A  4457    ; 1093			linbuf[i] = linbuf[i + 1];
0113B0 DD07FD              A  4458    	LD	BC,(IX+-3)
0113B3 03                  A  4459    	INC	BC
0113B4 C5E1                A  4460    	LD	HL,BC
0113B6 11 39 55 01         A  4461    	LD	DE,_linbuf
0113BA 19                  A  4462    	ADD	HL,DE
0113BB E5FDE1              A  4463    	LD	IY,HL
0113BE DD27FD              A  4464    	LD	HL,(IX+-3)
0113C1 19                  A  4465    	ADD	HL,DE
0113C2 FD7E00              A  4466    	LD	A,(IY)
0113C5 77                  A  4467    	LD	(HL),A
0113C6 DD0FFD              A  4468    	LD	(IX+-3),BC
0113C9                     A  4469    L_252:
0113C9 014F0000            A  4470    	LD	BC,79
0113CD DD27FD              A  4471    	LD	HL,(IX+-3)
0113D0 B7                  A  4472    	OR	A,A
0113D1 ED42                A  4473    	SBC	HL,BC
0113D3 FA DD 13 01         A  4474    	JP	M,L__185
0113D7 EA B0 13 01         A  4475    	JP	PE,L_250
0113DB 18 04               A  4476    	JR	L__186
0113DD                     A  4477    L__185:
0113DD E2 B0 13 01         A  4478    	JP	PO,L_250
0113E1                     A  4479    L__186:
                           A  4480    ; 1094		
                           A  4481    ; 1095		linbuf[MAXLNLEN - 1] = ' ';
0113E1 21 88 55 01         A  4482    	LD	HL,_linbuf+79
0113E5 3620                A  4483    	LD	(HL),32
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  88


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4484    ; 1096		
                           A  4485    ; 1097		tx_put(p_curr);
0113E7 ED4B 27 55 01       A  4486    	LD	BC,(_p_curr)
0113EC C5                  A  4487    	PUSH	BC
0113ED CD FE 0B 01         A  4488    	CALL	_tx_put
0113F1 C1                  A  4489    	POP	BC
                           A  4490    ; 1098		
                           A  4491    ; 1099		paintrow();
0113F2 CD D4 17 01         A  4492    	CALL	_paintrow
                           A  4493    ; 1100	}
0113F6                     A  4494    L_254:
0113F6 DDF9                A  4495    	LD	SP,IX
0113F8 DDE1                A  4496    	POP	IX
0113FA C9                  A  4497    	RET	
                           A  4498    
                           A  4499    
                           A  4500    ;**************************** _do_dch *********
                           A  4501    ;Name                         Addr/Register   S
                           A  4502    ;_paintrow                           IMPORT  --
                           A  4503    ;_tx_put                             IMPORT  --
                           A  4504    ;_linbuf                             STATIC    
                           A  4505    ;_cur_char                           STATIC    
                           A  4506    ;_tx_get                             IMPORT  --
                           A  4507    ;_p_root                             STATIC    
                           A  4508    ;_p_curr                             STATIC    
                           A  4509    ;i                                     IX-3    
                           A  4510    
                           A  4511    
                           A  4512    ; Stack Frame Size: 9 (bytes)
                           A  4513    ;       Spill Code: 0 (instruction)
                           A  4514    
                           A  4515    
                           A  4516    ; 1101	
                           A  4517    ; 1102	/* Insert line. */
                           A  4518    ; 1103	void do_iln(void)
                           A  4519    ; 1104	{
0113FB                     A  4520    _do_iln:
                           A  4521    ; 1105		paintrow();
0113FB CD D4 17 01         A  4522    	CALL	_paintrow
                           A  4523    ; 1106		
                           A  4524    ; 1107		if (cur_line < numlines)
0113FF ED4B 2A 55 01       A  4525    	LD	BC,(_numlines)
011404 2A 2D 55 01         A  4526    	LD	HL,(_cur_line)
011408 B7                  A  4527    	OR	A,A
011409 ED42                A  4528    	SBC	HL,BC
01140B F2 15 14 01         A  4529    	JP	P,L__191
01140F EA 3D 14 01         A  4530    	JP	PE,L_256
011413 18 04               A  4531    	JR	L__192
011415                     A  4532    L__191:
011415 E2 3D 14 01         A  4533    	JP	PO,L_256
011419                     A  4534    L__192:
                           A  4535    ; 1108		{
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  89


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4536    ; 1109			do_cdw();
011419 CD B0 0C 01         A  4537    	CALL	_do_cdw
                           A  4538    ; 1110			
                           A  4539    ; 1111			tx_ins(p_curr, "");
01141D 01 0F 28 01         A  4540    	LD	BC,L__189
011421 C5                  A  4541    	PUSH	BC
011422 ED4B 27 55 01       A  4542    	LD	BC,(_p_curr)
011427 C5                  A  4543    	PUSH	BC
011428 CD C0 0A 01         A  4544    	CALL	_tx_ins
01142C C1                  A  4545    	POP	BC
01142D C1                  A  4546    	POP	BC
                           A  4547    ; 1112			
                           A  4548    ; 1113			p_curr = p_curr->p_prev;
01142E FD2A 27 55 01       A  4549    	LD	IY,(_p_curr)
011433 FD0700              A  4550    	LD	BC,(IY+0)
011436 ED43 27 55 01       A  4551    	LD	(_p_curr),BC
                           A  4552    ; 1114		}		
                           A  4553    ; 1115		else
01143B 18 1B               A  4554    	JR	L_257
01143D                     A  4555    L_256:
                           A  4556    ; 1116		{
                           A  4557    ; 1117			tx_ins(p_root, "");		
01143D 01 10 28 01         A  4558    	LD	BC,L__190
011441 C5                  A  4559    	PUSH	BC
011442 ED4B 24 55 01       A  4560    	LD	BC,(_p_root)
011447 C5                  A  4561    	PUSH	BC
011448 CD C0 0A 01         A  4562    	CALL	_tx_ins
01144C C1                  A  4563    	POP	BC
01144D C1                  A  4564    	POP	BC
                           A  4565    ; 1118			
                           A  4566    ; 1119			do_bot(0);
01144E 01000000            A  4567    	LD	BC,0
011452 C5                  A  4568    	PUSH	BC
011453 CD 41 12 01         A  4569    	CALL	_do_bot
011457 C1                  A  4570    	POP	BC
                           A  4571    ; 1120		}
011458                     A  4572    L_257:
                           A  4573    ; 1121		
                           A  4574    ; 1122		cur_char = 1;
011458 01010000            A  4575    	LD	BC,1
01145C ED43 30 55 01       A  4576    	LD	(_cur_char),BC
                           A  4577    ; 1123		cur_col = 0;
011461 01000000            A  4578    	LD	BC,0
011465 ED43 36 55 01       A  4579    	LD	(_cur_col),BC
                           A  4580    ; 1124		
                           A  4581    ; 1125		paintall();	
01146A CD C2 16 01         A  4582    	CALL	_paintall
                           A  4583    ; 1126	}
01146E C9                  A  4584    	RET	
                           A  4585    
                           A  4586    
                           A  4587    ;**************************** _do_iln *********
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  90


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4588    ;Name                         Addr/Register   S
                           A  4589    ;_paintall                           IMPORT  --
                           A  4590    ;_cur_col                            STATIC    
                           A  4591    ;_cur_char                           STATIC    
                           A  4592    ;_do_bot                             IMPORT  --
                           A  4593    ;_p_root                             STATIC    
                           A  4594    ;_p_curr                             STATIC    
                           A  4595    ;_tx_ins                             IMPORT  --
                           A  4596    ;_do_cdw                             IMPORT  --
                           A  4597    ;_numlines                           STATIC    
                           A  4598    ;_cur_line                           STATIC    
                           A  4599    ;_paintrow                           IMPORT  --
                           A  4600    
                           A  4601    
                           A  4602    ; Stack Frame Size: 6 (bytes)
                           A  4603    ;       Spill Code: 0 (instruction)
                           A  4604    
                           A  4605    
                           A  4606    	SEGMENT STRSECT
01280F                     A  4607    L__189:
01280F 00                  A  4608    	DB	0
012810                     A  4609    L__190:
012810 00                  A  4610    	DB	0
                           A  4611    	SEGMENT CODE
                           A  4612    ; 1127	
                           A  4613    ; 1128	/* Delete line. */
                           A  4614    ; 1129	void do_dln(void)
                           A  4615    ; 1130	{
01146F                     A  4616    _do_dln:
01146F 21FDFFFF            A  4617    	LD	HL,-3
011473 CD 39 25 01         A  4618    	CALL	__frameset
                           A  4619    ; 1131		p_line_t save = p_curr->p_next;
011477 FD2A 27 55 01       A  4620    	LD	IY,(_p_curr)
01147C FD0703              A  4621    	LD	BC,(IY+3)
01147F DD0FFD              A  4622    	LD	(IX+-3),BC
                           A  4623    ; 1132		
                           A  4624    ; 1133		if (p_curr == p_root)
011482 ED4B 24 55 01       A  4625    	LD	BC,(_p_root)
011487 2A 27 55 01         A  4626    	LD	HL,(_p_curr)
01148B B7                  A  4627    	OR	A,A
01148C ED42                A  4628    	SBC	HL,BC
01148E 28 17               A  4629    	JR	Z,L_261
                           A  4630    ; 1134			return;
                           A  4631    ; 1135		
                           A  4632    ; 1136		tx_del(p_curr);
011490 ED4B 27 55 01       A  4633    	LD	BC,(_p_curr)
011495 C5                  A  4634    	PUSH	BC
011496 CD 2A 0B 01         A  4635    	CALL	_tx_del
01149A C1                  A  4636    	POP	BC
                           A  4637    ; 1137		
                           A  4638    ; 1138		p_curr = save;
01149B DD07FD              A  4639    	LD	BC,(IX+-3)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  91


PC     Object              I  Line    Source C:\proted\Debug\main.src
01149E ED43 27 55 01       A  4640    	LD	(_p_curr),BC
                           A  4641    ; 1139		
                           A  4642    ; 1140		paintall();
0114A3 CD C2 16 01         A  4643    	CALL	_paintall
                           A  4644    ; 1141	}
0114A7                     A  4645    L_261:
0114A7 DDF9                A  4646    	LD	SP,IX
0114A9 DDE1                A  4647    	POP	IX
0114AB C9                  A  4648    	RET	
                           A  4649    
                           A  4650    
                           A  4651    ;**************************** _do_dln *********
                           A  4652    ;Name                         Addr/Register   S
                           A  4653    ;_paintall                           IMPORT  --
                           A  4654    ;_tx_del                             IMPORT  --
                           A  4655    ;_p_root                             STATIC    
                           A  4656    ;_p_curr                             STATIC    
                           A  4657    ;save                                  IX-3    
                           A  4658    
                           A  4659    
                           A  4660    ; Stack Frame Size: 9 (bytes)
                           A  4661    ;       Spill Code: 0 (instruction)
                           A  4662    
                           A  4663    
                           A  4664    ; 1142	
                           A  4665    ; 1143	/* Delete. */
                           A  4666    ; 1144	void do_del(void)
                           A  4667    ; 1145	{
0114AC                     A  4668    _do_del:
                           A  4669    ; 1146		if (cur_char == 1)
0114AC 01010000            A  4670    	LD	BC,1
0114B0 2A 30 55 01         A  4671    	LD	HL,(_cur_char)
0114B4 B7                  A  4672    	OR	A,A
0114B5 ED42                A  4673    	SBC	HL,BC
0114B7 20 1E               A  4674    	JR	NZ,L_265
                           A  4675    ; 1147			if (strlen(p_curr->p_data) <= 0
0114B9 FD2A 27 55 01       A  4676    	LD	IY,(_p_curr)
0114BE FD0706              A  4677    	LD	BC,(IY+6)
0114C1 C5                  A  4678    	PUSH	BC
0114C2 CD F6 24 01         A  4679    	CALL	_strlen
0114C6 C1                  A  4680    	POP	BC
0114C7 E5C1                A  4681    	LD	BC,HL
0114C9 B7                  A  4682    	OR	A,A
0114CA ED62                A  4683    	SBC	HL,HL
0114CC B7                  A  4684    	OR	A,A
0114CD ED42                A  4685    	SBC	HL,BC
0114CF 30 0E               A  4686    	JR	NC,L_266
                           A  4687    ; 1148				return;
                           A  4688    ; 1149			else
                           A  4689    ; 1150			{
                           A  4690    ; 1151				do_enhanced_del();
0114D1 CD E0 14 01         A  4691    	CALL	_do_enhanced_del
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  92


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4692    ; 1152				
                           A  4693    ; 1153				return;
0114D5 18 08               A  4694    	JR	L_266
                           A  4695    ; 1154			}
0114D7                     A  4696    L_265:
                           A  4697    ; 1155		
                           A  4698    ; 1156		do_clf();
0114D7 CD 41 0D 01         A  4699    	CALL	_do_clf
                           A  4700    ; 1157		
                           A  4701    ; 1158		do_dch();
0114DB CD 84 13 01         A  4702    	CALL	_do_dch
                           A  4703    ; 1159	}
0114DF                     A  4704    L_266:
0114DF C9                  A  4705    	RET	
                           A  4706    
                           A  4707    
                           A  4708    ;**************************** _do_del *********
                           A  4709    ;Name                         Addr/Register   S
                           A  4710    ;_do_dch                             IMPORT  --
                           A  4711    ;_do_clf                             IMPORT  --
                           A  4712    ;_do_enhanced_del                    IMPORT  --
                           A  4713    ;_p_curr                             STATIC    
                           A  4714    ;_strlen                             IMPORT  --
                           A  4715    ;_cur_char                           STATIC    
                           A  4716    
                           A  4717    
                           A  4718    ; Stack Frame Size: 6 (bytes)
                           A  4719    ;       Spill Code: 0 (instruction)
                           A  4720    
                           A  4721    
                           A  4722    ; 1160	
                           A  4723    ; 1161	/* Enhanced Delete. Can join current li
                           A  4724    ; 1162	void do_enhanced_del(void)
                           A  4725    ; 1163	{
0114E0                     A  4726    _do_enhanced_del:
0114E0 21AEFFFF            A  4727    	LD	HL,-82
0114E4 CD 39 25 01         A  4728    	CALL	__frameset
                           A  4729    ; 1164		char app[MAXLNLEN], i, oldPos;
                           A  4730    ; 1165		
                           A  4731    ; 1166		if (cur_line == 1)
0114E8 01010000            A  4732    	LD	BC,1
0114EC 2A 2D 55 01         A  4733    	LD	HL,(_cur_line)
0114F0 B7                  A  4734    	OR	A,A
0114F1 ED42                A  4735    	SBC	HL,BC
0114F3 20 08               A  4736    	JR	NZ,L_268
                           A  4737    ; 1167		{
                           A  4738    ; 1168			Show_Cursor();
0114F5 CD 7D 18 01         A  4739    	CALL	_Show_Cursor
                           A  4740    ; 1169			
                           A  4741    ; 1170			return;		
0114F9 C3 9E 15 01         A  4742    	JR	L_274
                           A  4743    ; 1171		}
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  93


PC     Object              I  Line    Source C:\proted\Debug\main.src
0114FD                     A  4744    L_268:
                           A  4745    ; 1172		
                           A  4746    ; 1173		memset(app, 0, MAXLNLEN);	
0114FD 01500000            A  4747    	LD	BC,80
011501 C5                  A  4748    	PUSH	BC
011502 01000000            A  4749    	LD	BC,0
011506 C5                  A  4750    	PUSH	BC
011507 ED65AE              A  4751    	PEA	IX+-82
01150A CD F7 25 01         A  4752    	CALL	_memset
01150E C1                  A  4753    	POP	BC
01150F C1                  A  4754    	POP	BC
011510 C1                  A  4755    	POP	BC
                           A  4756    ; 1174		
                           A  4757    ; 1175		memmove(app, p_curr->p_data, strlen
011511 FD2A 27 55 01       A  4758    	LD	IY,(_p_curr)
011516 FD0706              A  4759    	LD	BC,(IY+6)
011519 C5                  A  4760    	PUSH	BC
01151A CD F6 24 01         A  4761    	CALL	_strlen
01151E C1                  A  4762    	POP	BC
01151F E5                  A  4763    	PUSH	HL
011520 FD2A 27 55 01       A  4764    	LD	IY,(_p_curr)
011525 FD0706              A  4765    	LD	BC,(IY+6)
011528 C5                  A  4766    	PUSH	BC
011529 ED65AE              A  4767    	PEA	IX+-82
01152C CD 18 26 01         A  4768    	CALL	_memmove
011530 C1                  A  4769    	POP	BC
011531 C1                  A  4770    	POP	BC
011532 C1                  A  4771    	POP	BC
                           A  4772    ; 1176		
                           A  4773    ; 1177		do_dln();	
011533 CD 6F 14 01         A  4774    	CALL	_do_dln
                           A  4775    ; 1178		
                           A  4776    ; 1179		do_cup();
011537 CD 21 0C 01         A  4777    	CALL	_do_cup
                           A  4778    ; 1180		do_endline();
01153B CD 0D 16 01         A  4779    	CALL	_do_endline
                           A  4780    ; 1181		
                           A  4781    ; 1182		oldPos = cur_col;
01153F 3A 36 55 01         A  4782    	LD	A,(_cur_col)
011543 DD77FE              A  4783    	LD	(IX+-2),A
011546 DD36FF00            A  4784    	LD	(IX+-1),0
                           A  4785    ; 1183		
                           A  4786    ; 1184		for (i = 0; i < strlen(app); i++)
01154A 18 1B               A  4787    	JR	L_272
01154C                     A  4788    L_270:
                           A  4789    ; 1185			do_chr(app[i]);	
01154C DD7EFF              A  4790    	LD	A,(IX+-1)
01154F 17ED62              A  4791    	SEXT	HL
011552 DD6EFF              A  4792    	LD	L,(IX+-1)
011555 E5C1                A  4793    	LD	BC,HL
011557 ED22AE              A  4794    	LEA	HL,IX+-82
01155A 09                  A  4795    	ADD	HL,BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  94


PC     Object              I  Line    Source C:\proted\Debug\main.src
01155B 4E                  A  4796    	LD	C,(HL)
01155C 0600                A  4797    	LD	B,0
01155E C5                  A  4798    	PUSH	BC
01155F CD F2 12 01         A  4799    	CALL	_do_chr
011563 C1                  A  4800    	POP	BC
011564 DD34FF              A  4801    	INC	(IX+-1)
011567                     A  4802    L_272:
011567 ED65AE              A  4803    	PEA	IX+-82
01156A CD F6 24 01         A  4804    	CALL	_strlen
01156E C1                  A  4805    	POP	BC
01156F DD7EFF              A  4806    	LD	A,(IX+-1)
011572 E5C1                A  4807    	LD	BC,HL
011574 17ED62              A  4808    	SEXT	HL
011577 DD6EFF              A  4809    	LD	L,(IX+-1)
01157A B7                  A  4810    	OR	A,A
01157B ED42                A  4811    	SBC	HL,BC
01157D 38 CD               A  4812    	JR	C,L_270
                           A  4813    ; 1186		
                           A  4814    ; 1187		paintrow();
01157F CD D4 17 01         A  4815    	CALL	_paintrow
                           A  4816    ; 1188		
                           A  4817    ; 1189		cur_col = oldPos;
011583 DD7EFE              A  4818    	LD	A,(IX+-2)
011586 17ED62              A  4819    	SEXT	HL
011589 DD6EFE              A  4820    	LD	L,(IX+-2)
01158C 22 36 55 01         A  4821    	LD	(_cur_col),HL
                           A  4822    ; 1190		cur_char = cur_col + 1;
011590 DD7EFE              A  4823    	LD	A,(IX+-2)
011593 17ED62              A  4824    	SEXT	HL
011596 DD6EFE              A  4825    	LD	L,(IX+-2)
011599 23                  A  4826    	INC	HL
01159A 22 30 55 01         A  4827    	LD	(_cur_char),HL
                           A  4828    ; 1191	}
01159E                     A  4829    L_274:
01159E DDF9                A  4830    	LD	SP,IX
0115A0 DDE1                A  4831    	POP	IX
0115A2 C9                  A  4832    	RET	
                           A  4833    
                           A  4834    
                           A  4835    ;**************************** _do_enhanced_del 
                           A  4836    ;Name                         Addr/Register   S
                           A  4837    ;_cur_char                           STATIC    
                           A  4838    ;_paintrow                           IMPORT  --
                           A  4839    ;_do_chr                             IMPORT  --
                           A  4840    ;_cur_col                            STATIC    
                           A  4841    ;_do_endline                         IMPORT  --
                           A  4842    ;_do_cup                             IMPORT  --
                           A  4843    ;_do_dln                             IMPORT  --
                           A  4844    ;_p_curr                             STATIC    
                           A  4845    ;_strlen                             IMPORT  --
                           A  4846    ;_memmove                            IMPORT  --
                           A  4847    ;_memset                             IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  95


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  4848    ;_Show_Cursor                        IMPORT  --
                           A  4849    ;_cur_line                           STATIC    
                           A  4850    ;app                                  IX-82    
                           A  4851    ;oldPos                                IX-2    
                           A  4852    ;i                                     IX-1    
                           A  4853    
                           A  4854    
                           A  4855    ; Stack Frame Size: 88 (bytes)
                           A  4856    ;       Spill Code: 0 (instruction)
                           A  4857    
                           A  4858    
                           A  4859    ; 1192	
                           A  4860    ; 1193	/* Go to the start of current line. */
                           A  4861    ; 1194	void do_home(void)
                           A  4862    ; 1195	{
0115A3                     A  4863    _do_home:
0115A3 21FEFFFF            A  4864    	LD	HL,-2
0115A7 CD 39 25 01         A  4865    	CALL	__frameset
                           A  4866    ; 1196		char ch, oldcol;
                           A  4867    ; 1197		
                           A  4868    ; 1198		if (p_curr == p_root)
0115AB ED4B 24 55 01       A  4869    	LD	BC,(_p_root)
0115B0 2A 27 55 01         A  4870    	LD	HL,(_p_curr)
0115B4 B7                  A  4871    	OR	A,A
0115B5 ED42                A  4872    	SBC	HL,BC
0115B7 28 4F               A  4873    	JR	Z,L_277
                           A  4874    ; 1199			return;
                           A  4875    ; 1200		
                           A  4876    ; 1201		ch = scn_phys[cur_row][cur_col];
0115B9 2A 33 55 01         A  4877    	LD	HL,(_cur_row)
0115BD 29                  A  4878    	ADD	HL,HL
0115BE 29                  A  4879    	ADD	HL,HL
0115BF ED4B 33 55 01       A  4880    	LD	BC,(_cur_row)
0115C4 09                  A  4881    	ADD	HL,BC
0115C5 29                  A  4882    	ADD	HL,HL
0115C6 29                  A  4883    	ADD	HL,HL
0115C7 29                  A  4884    	ADD	HL,HL
0115C8 29                  A  4885    	ADD	HL,HL
0115C9 01 3B 44 01         A  4886    	LD	BC,_scn_phys
0115CD 09                  A  4887    	ADD	HL,BC
0115CE ED4B 36 55 01       A  4888    	LD	BC,(_cur_col)
0115D3 09                  A  4889    	ADD	HL,BC
0115D4 7E                  A  4890    	LD	A,(HL)
0115D5 DD77FF              A  4891    	LD	(IX+-1),A
                           A  4892    ; 1202		oldcol = cur_col;
0115D8 3A 36 55 01         A  4893    	LD	A,(_cur_col)
0115DC DD77FE              A  4894    	LD	(IX+-2),A
                           A  4895    ; 1203		
                           A  4896    ; 1204		cur_char = 1;
0115DF 01010000            A  4897    	LD	BC,1
0115E3 ED43 30 55 01       A  4898    	LD	(_cur_char),BC
                           A  4899    ; 1205		cur_col = 0;
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  96


PC     Object              I  Line    Source C:\proted\Debug\main.src
0115E8 01000000            A  4900    	LD	BC,0
0115EC ED43 36 55 01       A  4901    	LD	(_cur_col),BC
                           A  4902    ; 1206		
                           A  4903    ; 1207		plot_char(oldcol, cur_row, ch);
0115F1 DD4EFF              A  4904    	LD	C,(IX+-1)
0115F4 3A 33 55 01         A  4905    	LD	A,(_cur_row)
0115F8 0600                A  4906    	LD	B,0
0115FA C5                  A  4907    	PUSH	BC
0115FB 4F                  A  4908    	LD	C,A
0115FC C5                  A  4909    	PUSH	BC
0115FD DD4EFE              A  4910    	LD	C,(IX+-2)
011600 C5                  A  4911    	PUSH	BC
011601 CD A8 02 01         A  4912    	CALL	_plot_char
011605 C1                  A  4913    	POP	BC
011606 C1                  A  4914    	POP	BC
011607 C1                  A  4915    	POP	BC
                           A  4916    ; 1208	}
011608                     A  4917    L_277:
011608 DDF9                A  4918    	LD	SP,IX
01160A DDE1                A  4919    	POP	IX
01160C C9                  A  4920    	RET	
                           A  4921    
                           A  4922    
                           A  4923    ;**************************** _do_home ********
                           A  4924    ;Name                         Addr/Register   S
                           A  4925    ;_plot_char                          IMPORT  --
                           A  4926    ;_cur_char                           STATIC    
                           A  4927    ;_cur_col                            STATIC    
                           A  4928    ;_cur_row                            STATIC    
                           A  4929    ;_scn_phys                           STATIC   4
                           A  4930    ;_p_root                             STATIC    
                           A  4931    ;_p_curr                             STATIC    
                           A  4932    ;oldcol                                IX-2    
                           A  4933    ;ch                                    IX-1    
                           A  4934    
                           A  4935    
                           A  4936    ; Stack Frame Size: 8 (bytes)
                           A  4937    ;       Spill Code: 0 (instruction)
                           A  4938    
                           A  4939    
                           A  4940    ; 1209	
                           A  4941    ; 1210	/* Go to the end of current line. */
                           A  4942    ; 1211	void do_endline(void)
                           A  4943    ; 1212	{
01160D                     A  4944    _do_endline:
01160D 21FDFFFF            A  4945    	LD	HL,-3
011611 CD 39 25 01         A  4946    	CALL	__frameset
                           A  4947    ; 1213		char len, ch, oldcol;
                           A  4948    ; 1214		
                           A  4949    ; 1215		if (p_curr == p_root)
011615 ED4B 24 55 01       A  4950    	LD	BC,(_p_root)
01161A 2A 27 55 01         A  4951    	LD	HL,(_p_curr)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  97


PC     Object              I  Line    Source C:\proted\Debug\main.src
01161E B7                  A  4952    	OR	A,A
01161F ED42                A  4953    	SBC	HL,BC
011621 28 69               A  4954    	JR	Z,L_280
                           A  4955    ; 1216			return;
                           A  4956    ; 1217		
                           A  4957    ; 1218		len = strlen(p_curr->p_data);	
011623 FD2A 27 55 01       A  4958    	LD	IY,(_p_curr)
011628 FD0706              A  4959    	LD	BC,(IY+6)
01162B C5                  A  4960    	PUSH	BC
01162C CD F6 24 01         A  4961    	CALL	_strlen
011630 C1                  A  4962    	POP	BC
011631 DD75FF              A  4963    	LD	(IX+-1),L
                           A  4964    ; 1219		
                           A  4965    ; 1220		ch = scn_phys[cur_row][cur_col];
011634 2A 33 55 01         A  4966    	LD	HL,(_cur_row)
011638 29                  A  4967    	ADD	HL,HL
011639 29                  A  4968    	ADD	HL,HL
01163A ED4B 33 55 01       A  4969    	LD	BC,(_cur_row)
01163F 09                  A  4970    	ADD	HL,BC
011640 29                  A  4971    	ADD	HL,HL
011641 29                  A  4972    	ADD	HL,HL
011642 29                  A  4973    	ADD	HL,HL
011643 29                  A  4974    	ADD	HL,HL
011644 01 3B 44 01         A  4975    	LD	BC,_scn_phys
011648 09                  A  4976    	ADD	HL,BC
011649 ED4B 36 55 01       A  4977    	LD	BC,(_cur_col)
01164E 09                  A  4978    	ADD	HL,BC
01164F 7E                  A  4979    	LD	A,(HL)
011650 DD77FE              A  4980    	LD	(IX+-2),A
                           A  4981    ; 1221		oldcol = cur_col;
011653 3A 36 55 01         A  4982    	LD	A,(_cur_col)
011657 DD77FD              A  4983    	LD	(IX+-3),A
                           A  4984    ; 1222		
                           A  4985    ; 1223		cur_col = len;
01165A DD7EFF              A  4986    	LD	A,(IX+-1)
01165D 17ED62              A  4987    	SEXT	HL
011660 DD6EFF              A  4988    	LD	L,(IX+-1)
011663 22 36 55 01         A  4989    	LD	(_cur_col),HL
                           A  4990    ; 1224		cur_char = len + 1;
011667 DD7EFF              A  4991    	LD	A,(IX+-1)
01166A 17ED62              A  4992    	SEXT	HL
01166D DD6EFF              A  4993    	LD	L,(IX+-1)
011670 23                  A  4994    	INC	HL
011671 22 30 55 01         A  4995    	LD	(_cur_char),HL
                           A  4996    ; 1225		
                           A  4997    ; 1226		plot_char(oldcol, cur_row, ch);
011675 DD4EFE              A  4998    	LD	C,(IX+-2)
011678 3A 33 55 01         A  4999    	LD	A,(_cur_row)
01167C 0600                A  5000    	LD	B,0
01167E C5                  A  5001    	PUSH	BC
01167F 4F                  A  5002    	LD	C,A
011680 C5                  A  5003    	PUSH	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  98


PC     Object              I  Line    Source C:\proted\Debug\main.src
011681 DD4EFD              A  5004    	LD	C,(IX+-3)
011684 C5                  A  5005    	PUSH	BC
011685 CD A8 02 01         A  5006    	CALL	_plot_char
011689 C1                  A  5007    	POP	BC
01168A C1                  A  5008    	POP	BC
01168B C1                  A  5009    	POP	BC
                           A  5010    ; 1227	}
01168C                     A  5011    L_280:
01168C DDF9                A  5012    	LD	SP,IX
01168E DDE1                A  5013    	POP	IX
011690 C9                  A  5014    	RET	
                           A  5015    
                           A  5016    
                           A  5017    ;**************************** _do_endline *****
                           A  5018    ;Name                         Addr/Register   S
                           A  5019    ;_plot_char                          IMPORT  --
                           A  5020    ;_cur_char                           STATIC    
                           A  5021    ;_cur_col                            STATIC    
                           A  5022    ;_cur_row                            STATIC    
                           A  5023    ;_scn_phys                           STATIC   4
                           A  5024    ;_strlen                             IMPORT  --
                           A  5025    ;_p_root                             STATIC    
                           A  5026    ;_p_curr                             STATIC    
                           A  5027    ;oldcol                                IX-3    
                           A  5028    ;ch                                    IX-2    
                           A  5029    ;len                                   IX-1    
                           A  5030    
                           A  5031    
                           A  5032    ; Stack Frame Size: 9 (bytes)
                           A  5033    ;       Spill Code: 0 (instruction)
                           A  5034    
                           A  5035    
                           A  5036    ; 1228	
                           A  5037    ; 1229	/* Set insert or overwrite mode */
                           A  5038    ; 1230	void do_ins(void)
                           A  5039    ; 1231	{
011691                     A  5040    _do_ins:
                           A  5041    ; 1232		if (InsertMode != 0)
011691 3A 98 55 01         A  5042    	LD	A,(_InsertMode)
011695 B7                  A  5043    	OR	A,A
011696 28 07               A  5044    	JR	Z,L_282
                           A  5045    ; 1233			InsertMode = 0;
011698 AF                  A  5046    	XOR	A,A
011699 32 98 55 01         A  5047    	LD	(_InsertMode),A
                           A  5048    ; 1234		else
01169D 18 06               A  5049    	JR	L_283
01169F                     A  5050    L_282:
                           A  5051    ; 1235			InsertMode = 1;
01169F 3E01                A  5052    	LD	A,1
0116A1 32 98 55 01         A  5053    	LD	(_InsertMode),A
0116A5                     A  5054    L_283:
                           A  5055    ; 1236		
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page:  99


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5056    ; 1237		ShowInsertMode();
0116A5 CD FC 18 01         A  5057    	CALL	_ShowInsertMode
                           A  5058    ; 1238		
                           A  5059    ; 1239		gotoxy(cur_col, cur_row);
0116A9 3A 33 55 01         A  5060    	LD	A,(_cur_row)
0116AD 4F                  A  5061    	LD	C,A
0116AE 3A 36 55 01         A  5062    	LD	A,(_cur_col)
0116B2 0600                A  5063    	LD	B,0
0116B4 C5                  A  5064    	PUSH	BC
0116B5 4F                  A  5065    	LD	C,A
0116B6 C5                  A  5066    	PUSH	BC
0116B7 CD 23 03 01         A  5067    	CALL	_gotoxy
0116BB C1                  A  5068    	POP	BC
0116BC C1                  A  5069    	POP	BC
                           A  5070    ; 1240		
                           A  5071    ; 1241		Show_Cursor();
0116BD CD 7D 18 01         A  5072    	CALL	_Show_Cursor
                           A  5073    ; 1242	}
0116C1 C9                  A  5074    	RET	
                           A  5075    
                           A  5076    
                           A  5077    ;**************************** _do_ins *********
                           A  5078    ;Name                         Addr/Register   S
                           A  5079    ;_Show_Cursor                        IMPORT  --
                           A  5080    ;_cur_col                            STATIC    
                           A  5081    ;_cur_row                            STATIC    
                           A  5082    ;_gotoxy                             IMPORT  --
                           A  5083    ;_ShowInsertMode                     IMPORT  --
                           A  5084    ;_InsertMode                         STATIC    
                           A  5085    
                           A  5086    
                           A  5087    ; Stack Frame Size: 6 (bytes)
                           A  5088    ;       Spill Code: 0 (instruction)
                           A  5089    
                           A  5090    
                           A  5091    ; 1243	
                           A  5092    ; 1244	/* Redraws the virtual screen from scra
                           A  5093    ; 1245	void paintall(void)
                           A  5094    ; 1246	{
0116C2                     A  5095    _paintall:
0116C2 21F8FFFF            A  5096    	LD	HL,-8
0116C6 CD 39 25 01         A  5097    	CALL	__frameset
                           A  5098    ; 1247		register unsigned char r;
                           A  5099    ; 1248		p_line_t p = p_curr;
0116CA ED4B 27 55 01       A  5100    	LD	BC,(_p_curr)
0116CF DD0FFC              A  5101    	LD	(IX+-4),BC
                           A  5102    ; 1249		int left_pos = cur_char - cur_col;
0116D2 2A 30 55 01         A  5103    	LD	HL,(_cur_char)
0116D6 ED4B 36 55 01       A  5104    	LD	BC,(_cur_col)
0116DB B7                  A  5105    	OR	A,A
0116DC ED42                A  5106    	SBC	HL,BC
0116DE DD2FF8              A  5107    	LD	(IX+-8),HL
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 100


PC     Object              I  Line    Source C:\proted\Debug\main.src
0116E1 DD36FF00            A  5108    	LD	(IX+-1),0
                           A  5109    ; 1250		unsigned char len;
                           A  5110    ; 1251		
                           A  5111    ; 1252		for (r = 0; r < cur_row; r++)
0116E5 18 0C               A  5112    	JR	L_288
0116E7                     A  5113    L_286:
                           A  5114    ; 1253			p = p->p_prev;
0116E7 DD31FC              A  5115    	LD	IY,(IX+-4)
0116EA FD0700              A  5116    	LD	BC,(IY+0)
0116ED DD0FFC              A  5117    	LD	(IX+-4),BC
0116F0 DD34FF              A  5118    	INC	(IX+-1)
0116F3                     A  5119    L_288:
0116F3 DD7EFF              A  5120    	LD	A,(IX+-1)
0116F6 B7ED62              A  5121    	UEXT	HL
0116F9 6F                  A  5122    	LD	L,A
0116FA B7                  A  5123    	OR	A,A
0116FB ED4B 33 55 01       A  5124    	LD	BC,(_cur_row)
011700 ED42                A  5125    	SBC	HL,BC
011702 FA E7 16 01         A  5126    	JP	M,L_286
                           A  5127    ; 1254		
                           A  5128    ; 1255		sc_clr();
011706 CD 7B 07 01         A  5129    	CALL	_sc_clr
01170A DD36FF00            A  5130    	LD	(IX+-1),0
                           A  5131    ; 1256		
                           A  5132    ; 1257		for (r = 0; r < SCNROWS; r++)
01170E C3 AE 17 01         A  5133    	JR	L_299
011712                     A  5134    L_297:
                           A  5135    ; 1258		{
                           A  5136    ; 1259			if (p == p_root)
011712 DD07FC              A  5137    	LD	BC,(IX+-4)
011715 2A 24 55 01         A  5138    	LD	HL,(_p_root)
011719 B7                  A  5139    	OR	A,A
01171A ED42                A  5140    	SBC	HL,BC
01171C 20 1D               A  5141    	JR	NZ,L_292
                           A  5142    ; 1260			{
                           A  5143    ; 1261				sc_str(r, 0, "<eof>");
01171E 01 11 28 01         A  5144    	LD	BC,L__210
011722 C5                  A  5145    	PUSH	BC
011723 01000000            A  5146    	LD	BC,0
011727 C5                  A  5147    	PUSH	BC
011728 DD4EFF              A  5148    	LD	C,(IX+-1)
01172B 0600                A  5149    	LD	B,0
01172D C5                  A  5150    	PUSH	BC
01172E CD 3E 08 01         A  5151    	CALL	_sc_str
011732 C1                  A  5152    	POP	BC
011733 C1                  A  5153    	POP	BC
011734 C1                  A  5154    	POP	BC
                           A  5155    ; 1262				
                           A  5156    ; 1263				do_cup();
011735 CD 21 0C 01         A  5157    	CALL	_do_cup
                           A  5158    ; 1264				
                           A  5159    ; 1265				break;
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 101


PC     Object              I  Line    Source C:\proted\Debug\main.src
011739 18 7C               A  5160    	JR	L_300
                           A  5161    ; 1266			}
01173B                     A  5162    L_292:
                           A  5163    ; 1267			
                           A  5164    ; 1268			len = strlen(p->p_data);
01173B DD31FC              A  5165    	LD	IY,(IX+-4)
01173E FD0706              A  5166    	LD	BC,(IY+6)
011741 C5                  A  5167    	PUSH	BC
011742 CD F6 24 01         A  5168    	CALL	_strlen
011746 C1                  A  5169    	POP	BC
011747 DD75FB              A  5170    	LD	(IX+-5),L
                           A  5171    ; 1269			
                           A  5172    ; 1270			if (len >= left_pos)
01174A DD7EFB              A  5173    	LD	A,(IX+-5)
01174D B7ED62              A  5174    	UEXT	HL
011750 6F                  A  5175    	LD	L,A
011751 B7                  A  5176    	OR	A,A
011752 DD07F8              A  5177    	LD	BC,(IX+-8)
011755 ED42                A  5178    	SBC	HL,BC
011757 FA 61 17 01         A  5179    	JP	M,L__214
01175B EA 85 17 01         A  5180    	JP	PE,L_295
01175F 18 04               A  5181    	JR	L__215
011761                     A  5182    L__214:
011761 E2 85 17 01         A  5183    	JP	PO,L_295
011765                     A  5184    L__215:
                           A  5185    ; 1271				sc_str(r, 0, p->p_data + (l
011765 DD07F8              A  5186    	LD	BC,(IX+-8)
011768 DD31FC              A  5187    	LD	IY,(IX+-4)
01176B FD2706              A  5188    	LD	HL,(IY+6)
01176E 0B                  A  5189    	DEC	BC
01176F 09                  A  5190    	ADD	HL,BC
011770 E5                  A  5191    	PUSH	HL
011771 01000000            A  5192    	LD	BC,0
011775 C5                  A  5193    	PUSH	BC
011776 DD4EFF              A  5194    	LD	C,(IX+-1)
011779 0600                A  5195    	LD	B,0
01177B C5                  A  5196    	PUSH	BC
01177C CD 3E 08 01         A  5197    	CALL	_sc_str
011780 C1                  A  5198    	POP	BC
011781 C1                  A  5199    	POP	BC
011782 C1                  A  5200    	POP	BC
                           A  5201    ; 1272			else
011783 18 1D               A  5202    	JR	L_296
011785                     A  5203    L_295:
                           A  5204    ; 1273				if (len == 0)
011785 DD7EFB              A  5205    	LD	A,(IX+-5)
011788 B7                  A  5206    	OR	A,A
011789 20 17               A  5207    	JR	NZ,L_296
                           A  5208    ; 1274					plot_char(0, r, ' ');
01178B 01200000            A  5209    	LD	BC,32
01178F C5                  A  5210    	PUSH	BC
011790 DD4EFF              A  5211    	LD	C,(IX+-1)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 102


PC     Object              I  Line    Source C:\proted\Debug\main.src
011793 0600                A  5212    	LD	B,0
011795 C5                  A  5213    	PUSH	BC
011796 01000000            A  5214    	LD	BC,0
01179A C5                  A  5215    	PUSH	BC
01179B CD A8 02 01         A  5216    	CALL	_plot_char
01179F C1                  A  5217    	POP	BC
0117A0 C1                  A  5218    	POP	BC
0117A1 C1                  A  5219    	POP	BC
0117A2                     A  5220    L_296:
                           A  5221    ; 1275			
                           A  5222    ; 1276			p = p->p_next;
0117A2 DD31FC              A  5223    	LD	IY,(IX+-4)
0117A5 FD0703              A  5224    	LD	BC,(IY+3)
0117A8 DD0FFC              A  5225    	LD	(IX+-4),BC
0117AB DD34FF              A  5226    	INC	(IX+-1)
                           A  5227    ; 1277		}
0117AE                     A  5228    L_299:
0117AE DD7EFF              A  5229    	LD	A,(IX+-1)
0117B1 FE32                A  5230    	CP	A,50
0117B3 DA 12 17 01         A  5231    	JR	C,L_297
0117B7                     A  5232    L_300:
                           A  5233    ; 1278		
                           A  5234    ; 1279		te_mov(cur_row, cur_col);
0117B7 3A 36 55 01         A  5235    	LD	A,(_cur_col)
0117BB 4F                  A  5236    	LD	C,A
0117BC 3A 33 55 01         A  5237    	LD	A,(_cur_row)
0117C0 0600                A  5238    	LD	B,0
0117C2 C5                  A  5239    	PUSH	BC
0117C3 4F                  A  5240    	LD	C,A
0117C4 C5                  A  5241    	PUSH	BC
0117C5 CD 9D 06 01         A  5242    	CALL	_te_mov
0117C9 C1                  A  5243    	POP	BC
0117CA C1                  A  5244    	POP	BC
                           A  5245    ; 1280	
                           A  5246    ; 1281		Show_Cursor();
0117CB CD 7D 18 01         A  5247    	CALL	_Show_Cursor
                           A  5248    ; 1282	}
0117CF DDF9                A  5249    	LD	SP,IX
0117D1 DDE1                A  5250    	POP	IX
0117D3 C9                  A  5251    	RET	
                           A  5252    
                           A  5253    
                           A  5254    ;**************************** _paintall *******
                           A  5255    ;Name                         Addr/Register   S
                           A  5256    ;_Show_Cursor                        IMPORT  --
                           A  5257    ;_te_mov                             IMPORT  --
                           A  5258    ;_plot_char                          IMPORT  --
                           A  5259    ;_strlen                             IMPORT  --
                           A  5260    ;_do_cup                             IMPORT  --
                           A  5261    ;_sc_str                             IMPORT  --
                           A  5262    ;_p_root                             STATIC    
                           A  5263    ;_sc_clr                             IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 103


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5264    ;_cur_row                            STATIC    
                           A  5265    ;_cur_col                            STATIC    
                           A  5266    ;_cur_char                           STATIC    
                           A  5267    ;_p_curr                             STATIC    
                           A  5268    ;left_pos                              IX-8    
                           A  5269    ;len                                   IX-5    
                           A  5270    ;p                                     IX-4    
                           A  5271    ;r                                     IX-1    
                           A  5272    
                           A  5273    
                           A  5274    ; Stack Frame Size: 14 (bytes)
                           A  5275    ;       Spill Code: 0 (instruction)
                           A  5276    
                           A  5277    
                           A  5278    	SEGMENT STRSECT
012811                     A  5279    L__210:
012811 3C656F66 3E         A  5280    	DB	"<eof>"
012816 00                  A  5281    	DB	0
                           A  5282    	SEGMENT CODE
                           A  5283    ; 1283	
                           A  5284    ; 1284	/* Redraws the current row of the virtu
                           A  5285    ; 1285	/* from scratch from the current settin
                           A  5286    ; 1286	void paintrow(void)
                           A  5287    ; 1287	{
0117D4                     A  5288    _paintrow:
0117D4 21FEFFFF            A  5289    	LD	HL,-2
0117D8 CD 39 25 01         A  5290    	CALL	__frameset
                           A  5291    ; 1288		unsigned char left_pos = cur_char -
0117DC 3A 30 55 01         A  5292    	LD	A,(_cur_char)
0117E0 47                  A  5293    	LD	B,A
0117E1 3A 36 55 01         A  5294    	LD	A,(_cur_col)
0117E5 4F                  A  5295    	LD	C,A
0117E6 78                  A  5296    	LD	A,B
0117E7 91                  A  5297    	SUB	A,C
0117E8 DD77FF              A  5298    	LD	(IX+-1),A
                           A  5299    ; 1289		char len;
                           A  5300    ; 1290		
                           A  5301    ; 1291		len = strlen(p_curr->p_data);
0117EB FD2A 27 55 01       A  5302    	LD	IY,(_p_curr)
0117F0 FD0706              A  5303    	LD	BC,(IY+6)
0117F3 C5                  A  5304    	PUSH	BC
0117F4 CD F6 24 01         A  5305    	CALL	_strlen
0117F8 C1                  A  5306    	POP	BC
0117F9 DD75FE              A  5307    	LD	(IX+-2),L
                           A  5308    ; 1292		
                           A  5309    ; 1293		sc_crw(cur_row);
0117FC 3A 33 55 01         A  5310    	LD	A,(_cur_row)
011800 4F                  A  5311    	LD	C,A
011801 0600                A  5312    	LD	B,0
011803 C5                  A  5313    	PUSH	BC
011804 CD 92 07 01         A  5314    	CALL	_sc_crw
011808 C1                  A  5315    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 104


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5316    ; 1294		
                           A  5317    ; 1295		if (p_curr == p_root)
011809 ED4B 24 55 01       A  5318    	LD	BC,(_p_root)
01180E 2A 27 55 01         A  5319    	LD	HL,(_p_curr)
011812 B7                  A  5320    	OR	A,A
011813 ED42                A  5321    	SBC	HL,BC
011815 20 1B               A  5322    	JR	NZ,L_304
                           A  5323    ; 1296			sc_str(cur_row, 0, "<eof>");
011817 01 17 28 01         A  5324    	LD	BC,L__218
01181B C5                  A  5325    	PUSH	BC
01181C 3A 33 55 01         A  5326    	LD	A,(_cur_row)
011820 4F                  A  5327    	LD	C,A
011821 11000000            A  5328    	LD	DE,0
011825 D5                  A  5329    	PUSH	DE
011826 0600                A  5330    	LD	B,0
011828 C5                  A  5331    	PUSH	BC
011829 CD 3E 08 01         A  5332    	CALL	_sc_str
01182D C1                  A  5333    	POP	BC
01182E C1                  A  5334    	POP	BC
01182F C1                  A  5335    	POP	BC
                           A  5336    ; 1297		else
011830 18 46               A  5337    	JR	L_305
011832                     A  5338    L_304:
                           A  5339    ; 1298			if (len >= left_pos)
011832 DD7EFE              A  5340    	LD	A,(IX+-2)
011835 DDBEFF              A  5341    	CP	A,(IX+-1)
011838 38 3E               A  5342    	JR	C,L_305
                           A  5343    ; 1299			{
                           A  5344    ; 1300				sc_str(cur_row, 0, p_curr->
01183A DD7EFF              A  5345    	LD	A,(IX+-1)
01183D B7ED62              A  5346    	UEXT	HL
011840 6F                  A  5347    	LD	L,A
011841 E5C1                A  5348    	LD	BC,HL
011843 FD2A 27 55 01       A  5349    	LD	IY,(_p_curr)
011848 FD2706              A  5350    	LD	HL,(IY+6)
01184B 0B                  A  5351    	DEC	BC
01184C 09                  A  5352    	ADD	HL,BC
01184D E5                  A  5353    	PUSH	HL
01184E 3A 33 55 01         A  5354    	LD	A,(_cur_row)
011852 4F                  A  5355    	LD	C,A
011853 11000000            A  5356    	LD	DE,0
011857 D5                  A  5357    	PUSH	DE
011858 0600                A  5358    	LD	B,0
01185A C5                  A  5359    	PUSH	BC
01185B CD 3E 08 01         A  5360    	CALL	_sc_str
01185F C1                  A  5361    	POP	BC
011860 C1                  A  5362    	POP	BC
011861 C1                  A  5363    	POP	BC
                           A  5364    ; 1301		
                           A  5365    ; 1302				gotoxy(len, cur_row);
011862 3A 33 55 01         A  5366    	LD	A,(_cur_row)
011866 4F                  A  5367    	LD	C,A
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 105


PC     Object              I  Line    Source C:\proted\Debug\main.src
011867 0600                A  5368    	LD	B,0
011869 C5                  A  5369    	PUSH	BC
01186A DD4EFE              A  5370    	LD	C,(IX+-2)
01186D C5                  A  5371    	PUSH	BC
01186E CD 23 03 01         A  5372    	CALL	_gotoxy
011872 C1                  A  5373    	POP	BC
011873 C1                  A  5374    	POP	BC
                           A  5375    ; 1303				
                           A  5376    ; 1304				clreol();
011874 CD E0 02 01         A  5377    	CALL	_clreol
                           A  5378    ; 1305			}
                           A  5379    ; 1306	}
011878                     A  5380    L_305:
011878 DDF9                A  5381    	LD	SP,IX
01187A DDE1                A  5382    	POP	IX
01187C C9                  A  5383    	RET	
                           A  5384    
                           A  5385    
                           A  5386    ;**************************** _paintrow *******
                           A  5387    ;Name                         Addr/Register   S
                           A  5388    ;_clreol                             IMPORT  --
                           A  5389    ;_gotoxy                             IMPORT  --
                           A  5390    ;_sc_str                             IMPORT  --
                           A  5391    ;_p_root                             STATIC    
                           A  5392    ;_cur_row                            STATIC    
                           A  5393    ;_sc_crw                             IMPORT  --
                           A  5394    ;_p_curr                             STATIC    
                           A  5395    ;_strlen                             IMPORT  --
                           A  5396    ;_cur_col                            STATIC    
                           A  5397    ;_cur_char                           STATIC    
                           A  5398    ;len                                   IX-2    
                           A  5399    ;left_pos                              IX-1    
                           A  5400    
                           A  5401    
                           A  5402    ; Stack Frame Size: 8 (bytes)
                           A  5403    ;       Spill Code: 0 (instruction)
                           A  5404    
                           A  5405    
                           A  5406    	SEGMENT STRSECT
012817                     A  5407    L__218:
012817 3C656F66 3E         A  5408    	DB	"<eof>"
01281C 00                  A  5409    	DB	0
                           A  5410    	SEGMENT CODE
                           A  5411    ; 1307	
                           A  5412    ; 1308	/* Show curson on screen. */
                           A  5413    ; 1309	void Show_Cursor(void)
                           A  5414    ; 1310	{
01187D                     A  5415    _Show_Cursor:
                           A  5416    ; 1311		asm ("push ix");
01187D DDE5                A  5417    push ix
                           A  5418    ; 1312		asm ("ld a, kr_draw_cursor");
01187F 3E2C                A  5419    ld a, kr_draw_cursor
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 106


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5420    ; 1313		asm ("call.lil prose_kernal");
011881 5BCD200A 00         A  5421    call.lil prose_kernal
                           A  5422    ; 1314		asm ("pop ix");	
011886 DDE1                A  5423    pop ix
                           A  5424    ; 1315	}
011888 C9                  A  5425    	RET	
                           A  5426    
                           A  5427    
                           A  5428    ;**************************** _Show_Cursor ****
                           A  5429    ;Name                         Addr/Register   S
                           A  5430    
                           A  5431    
                           A  5432    ; Stack Frame Size: 6 (bytes)
                           A  5433    ;       Spill Code: 0 (instruction)
                           A  5434    
                           A  5435    
                           A  5436    ; 1316	
                           A  5437    ; 1317	/* Show PROTED men */
                           A  5438    ; 1318	void ShowMenu(void)
                           A  5439    ; 1319	{
011889                     A  5440    _ShowMenu:
                           A  5441    ; 1320		Enable_Back_Color();
011889 CD 56 19 01         A  5442    	CALL	_Enable_Back_Color
                           A  5443    ; 1321		
                           A  5444    ; 1322		gotoxy(0, 50);	
01188D 01320000            A  5445    	LD	BC,50
011891 C5                  A  5446    	PUSH	BC
011892 01000000            A  5447    	LD	BC,0
011896 C5                  A  5448    	PUSH	BC
011897 CD 23 03 01         A  5449    	CALL	_gotoxy
01189B C1                  A  5450    	POP	BC
01189C C1                  A  5451    	POP	BC
                           A  5452    ; 1323		print("+===========================
01189D 01 1D 28 01         A  5453    	LD	BC,L__222
0118A1 C5                  A  5454    	PUSH	BC
0118A2 CD 5A 02 01         A  5455    	CALL	_print
0118A6 C1                  A  5456    	POP	BC
                           A  5457    ; 1324		print("| Ln:       , Col:          
0118A7 01 6E 28 01         A  5458    	LD	BC,L__223
0118AB C5                  A  5459    	PUSH	BC
0118AC CD 5A 02 01         A  5460    	CALL	_print
0118B0 C1                  A  5461    	POP	BC
                           A  5462    ; 1325		print("|                           
0118B1 01 BF 28 01         A  5463    	LD	BC,L__224
0118B5 C5                  A  5464    	PUSH	BC
0118B6 CD 5A 02 01         A  5465    	CALL	_print
0118BA C1                  A  5466    	POP	BC
                           A  5467    ; 1326		print("| Command  shortcuts:       
0118BB 01 10 29 01         A  5468    	LD	BC,L__225
0118BF C5                  A  5469    	PUSH	BC
0118C0 CD 5A 02 01         A  5470    	CALL	_print
0118C4 C1                  A  5471    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 107


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5472    ; 1327		print("| Ctrl + L: insert a line.  
0118C5 01 61 29 01         A  5473    	LD	BC,L__226
0118C9 C5                  A  5474    	PUSH	BC
0118CA CD 5A 02 01         A  5475    	CALL	_print
0118CE C1                  A  5476    	POP	BC
                           A  5477    ; 1328		print("| Ctrl + N: redraw screen.  
0118CF 01 B2 29 01         A  5478    	LD	BC,L__227
0118D3 C5                  A  5479    	PUSH	BC
0118D4 CD 5A 02 01         A  5480    	CALL	_print
0118D8 C1                  A  5481    	POP	BC
                           A  5482    ; 1329		print("| Ctrl + B: break a line.   
0118D9 01 03 2A 01         A  5483    	LD	BC,L__228
0118DD C5                  A  5484    	PUSH	BC
0118DE CD 5A 02 01         A  5485    	CALL	_print
0118E2 C1                  A  5486    	POP	BC
                           A  5487    ; 1330		print("|      Key enabled: Tab, Cur
0118E3 01 54 2A 01         A  5488    	LD	BC,L__229
0118E7 C5                  A  5489    	PUSH	BC
0118E8 CD 5A 02 01         A  5490    	CALL	_print
0118EC C1                  A  5491    	POP	BC
                           A  5492    ; 1331		print("+===========================
0118ED 01 A5 2A 01         A  5493    	LD	BC,L__230
0118F1 C5                  A  5494    	PUSH	BC
0118F2 CD 5A 02 01         A  5495    	CALL	_print
0118F6 C1                  A  5496    	POP	BC
                           A  5497    ; 1332		
                           A  5498    ; 1333		Disable_Back_Color();
0118F7 CD 64 19 01         A  5499    	CALL	_Disable_Back_Color
                           A  5500    ; 1334	}
0118FB C9                  A  5501    	RET	
                           A  5502    
                           A  5503    
                           A  5504    ;**************************** _ShowMenu *******
                           A  5505    ;Name                         Addr/Register   S
                           A  5506    ;_Disable_Back_Color                 IMPORT  --
                           A  5507    ;_print                              IMPORT  --
                           A  5508    ;_gotoxy                             IMPORT  --
                           A  5509    ;_Enable_Back_Color                  IMPORT  --
                           A  5510    
                           A  5511    
                           A  5512    ; Stack Frame Size: 6 (bytes)
                           A  5513    ;       Spill Code: 0 (instruction)
                           A  5514    
                           A  5515    
                           A  5516    	SEGMENT STRSECT
01281D                     A  5517    L__222:
01281D 2B3D3D3D 3D3D3D3D   A  5518    	DB	"+==================================]PR
012825 3D3D3D3D 3D3D3D3D 
01282D 3D3D3D3D 3D3D3D3D 
012835 3D3D3D3D 3D3D3D3D 
01283D 3D3D3D5D 50524F54 
012845 45445B3D 3D3D3D3D 
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 108


PC     Object              I  Line    Source C:\proted\Debug\main.src
01284D 3D3D3D3D 3D3D3D3D 
012855 3D3D3D3D 3D3D3D3D 
01285D 3D3D3D3D 3D3D3D3D 
012865 3D3D3D3D 3D3D3D2B 
01286D 00                  A  5519    	DB	0
01286E                     A  5520    L__223:
01286E 7C204C6E 3A202020   A  5521    	DB	"| Ln:       , Col:                    
012876 20202020 2C20436F 
01287E 6C3A2020 20202020 
012886 20202020 20202020 
01288E 20202020 20202020 
012896 20202020 20202020 
01289E 20202020 20202020 
0128A6 20202020 20202020 
0128AE 20202020 20202020 
0128B6 20202020 2020207C 
0128BE 00                  A  5522    	DB	0
0128BF                     A  5523    L__224:
0128BF 7C202020 20202020   A  5524    	DB	"|                                     
0128C7 20202020 20202020 
0128CF 20202020 20202020 
0128D7 20202020 20202020 
0128DF 20202020 20202020 
0128E7 20202020 20202020 
0128EF 20202020 20202020 
0128F7 20202020 20202020 
0128FF 20202020 20202020 
012907 20202020 2020207C 
01290F 00                  A  5525    	DB	0
012910                     A  5526    L__225:
012910 7C20436F 6D6D616E   A  5527    	DB	"| Command  shortcuts:                 
012918 64202073 686F7274 
012920 63757473 3A202020 
012928 20202020 20202020 
012930 20202020 20202020 
012938 20202020 20202020 
012940 20202020 20202020 
012948 20202020 20202020 
012950 20202020 20202020 
012958 20202020 2020207C 
012960 00                  A  5528    	DB	0
012961                     A  5529    L__226:
012961 7C204374 726C202B   A  5530    	DB	"| Ctrl + L: insert a line.   Ctrl + E:
012969 204C3A20 696E7365 
012971 72742061 206C696E 
012979 652E2020 20437472 
012981 6C202B20 453A2065 
012989 6E64206F 66207465 
012991 78742E20 20204374 
012999 726C202B 204B3A20 
0129A1 64656C65 74652061 
0129A9 206C696E 652E207C 
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 109


PC     Object              I  Line    Source C:\proted\Debug\main.src
0129B1 00                  A  5531    	DB	0
0129B2                     A  5532    L__227:
0129B2 7C204374 726C202B   A  5533    	DB	"| Ctrl + N: redraw screen.   Ctrl + T:
0129BA 204E3A20 72656472 
0129C2 61772073 63726565 
0129CA 6E2E2020 20437472 
0129D2 6C202B20 543A2074 
0129DA 6F70206F 66206669 
0129E2 6C652E20 20204374 
0129EA 726C202B 20533A20 
0129F2 73617665 2066696C 
0129FA 652E2020 2020207C 
012A02 00                  A  5534    	DB	0
012A03                     A  5535    L__228:
012A03 7C204374 726C202B   A  5536    	DB	"| Ctrl + B: break a line.    Ctrl + R:
012A0B 20423A20 62726561 
012A13 6B206120 6C696E65 
012A1B 2E202020 20437472 
012A23 6C202B20 523A2072 
012A2B 656C6F61 64206669 
012A33 6C652E20 20204374 
012A3B 726C202B 20513A20 
012A43 71756974 20746F20 
012A4B 50524F53 452E207C 
012A53 00                  A  5537    	DB	0
012A54                     A  5538    L__229:
012A54 7C202020 2020204B   A  5539    	DB	"|      Key enabled: Tab, Cursor Keys, 
012A5C 65792065 6E61626C 
012A64 65643A20 5461622C 
012A6C 20437572 736F7220 
012A74 4B657973 2C205067 
012A7C 55702C20 5067446F 
012A84 776E2C20 486F6D65 
012A8C 2C20456E 642C2044 
012A94 656C2C20 496E732E 
012A9C 20202020 2020207C 
012AA4 00                  A  5540    	DB	0
012AA5                     A  5541    L__230:
012AA5 2B3D3D3D 3D3D3D3D   A  5542    	DB	"+=====================================
012AAD 3D3D3D3D 3D3D3D3D 
012AB5 3D3D3D3D 3D3D3D3D 
012ABD 3D3D3D3D 3D3D3D3D 
012AC5 3D3D3D3D 3D3D3D3D 
012ACD 3D3D3D3D 3D3D3D3D 
012AD5 3D3D3D3D 3D3D3D3D 
012ADD 3D3D3D3D 3D3D3D3D 
012AE5 3D3D3D3D 3D3D3D3D 
012AED 3D3D3D3D 3D3D3D2B 
012AF5 00                  A  5543    	DB	0
                           A  5544    	SEGMENT CODE
                           A  5545    ; 1335	
                           A  5546    ; 1336	/* Show Type Mode */
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 110


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5547    ; 1337	void ShowInsertMode(void)
                           A  5548    ; 1338	{
0118FC                     A  5549    _ShowInsertMode:
                           A  5550    ; 1339		Enable_Back_Color();
0118FC CD 56 19 01         A  5551    	CALL	_Enable_Back_Color
                           A  5552    ; 1340		
                           A  5553    ; 1341		gotoxy(54, 51);	
011900 01330000            A  5554    	LD	BC,51
011904 C5                  A  5555    	PUSH	BC
011905 01360000            A  5556    	LD	BC,54
011909 C5                  A  5557    	PUSH	BC
01190A CD 23 03 01         A  5558    	CALL	_gotoxy
01190E C1                  A  5559    	POP	BC
01190F C1                  A  5560    	POP	BC
                           A  5561    ; 1342		print("                     ");
011910 01 F6 2A 01         A  5562    	LD	BC,L__232
011914 C5                  A  5563    	PUSH	BC
011915 CD 5A 02 01         A  5564    	CALL	_print
011919 C1                  A  5565    	POP	BC
                           A  5566    ; 1343		
                           A  5567    ; 1344		gotoxy(54, 51);
01191A 01330000            A  5568    	LD	BC,51
01191E C5                  A  5569    	PUSH	BC
01191F 01360000            A  5570    	LD	BC,54
011923 C5                  A  5571    	PUSH	BC
011924 CD 23 03 01         A  5572    	CALL	_gotoxy
011928 C1                  A  5573    	POP	BC
011929 C1                  A  5574    	POP	BC
                           A  5575    ; 1345		print("Type mode: ");
01192A 01 0C 2B 01         A  5576    	LD	BC,L__233
01192E C5                  A  5577    	PUSH	BC
01192F CD 5A 02 01         A  5578    	CALL	_print
011933 C1                  A  5579    	POP	BC
                           A  5580    ; 1346		
                           A  5581    ; 1347		if (InsertMode)
011934 3A 98 55 01         A  5582    	LD	A,(_InsertMode)
011938 B7                  A  5583    	OR	A,A
011939 28 0C               A  5584    	JR	Z,L_309
                           A  5585    ; 1348			print("Insert");
01193B 01 18 2B 01         A  5586    	LD	BC,L__235
01193F C5                  A  5587    	PUSH	BC
011940 CD 5A 02 01         A  5588    	CALL	_print
011944 C1                  A  5589    	POP	BC
                           A  5590    ; 1349		else
011945 18 0A               A  5591    	JR	L_310
011947                     A  5592    L_309:
                           A  5593    ; 1350			print("Overwrite");
011947 01 1F 2B 01         A  5594    	LD	BC,L__236
01194B C5                  A  5595    	PUSH	BC
01194C CD 5A 02 01         A  5596    	CALL	_print
011950 C1                  A  5597    	POP	BC
011951                     A  5598    L_310:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 111


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5599    ; 1351		
                           A  5600    ; 1352		Disable_Back_Color();
011951 CD 64 19 01         A  5601    	CALL	_Disable_Back_Color
                           A  5602    ; 1353	}
011955 C9                  A  5603    	RET	
                           A  5604    
                           A  5605    
                           A  5606    ;**************************** _ShowInsertMode *
                           A  5607    ;Name                         Addr/Register   S
                           A  5608    ;_Disable_Back_Color                 IMPORT  --
                           A  5609    ;_InsertMode                         STATIC    
                           A  5610    ;_print                              IMPORT  --
                           A  5611    ;_gotoxy                             IMPORT  --
                           A  5612    ;_Enable_Back_Color                  IMPORT  --
                           A  5613    
                           A  5614    
                           A  5615    ; Stack Frame Size: 6 (bytes)
                           A  5616    ;       Spill Code: 0 (instruction)
                           A  5617    
                           A  5618    
                           A  5619    	SEGMENT STRSECT
012AF6                     A  5620    L__232:
012AF6 20202020 20202020   A  5621    	DB	"                     "
012AFE 20202020 20202020 
012B06 20202020 20 
012B0B 00                  A  5622    	DB	0
012B0C                     A  5623    L__233:
012B0C 54797065 206D6F64   A  5624    	DB	"Type mode: "
012B14 653A20 
012B17 00                  A  5625    	DB	0
012B18                     A  5626    L__235:
012B18 496E7365 7274       A  5627    	DB	"Insert"
012B1E 00                  A  5628    	DB	0
012B1F                     A  5629    L__236:
012B1F 4F766572 77726974   A  5630    	DB	"Overwrite"
012B27 65 
012B28 00                  A  5631    	DB	0
                           A  5632    	SEGMENT CODE
                           A  5633    ; 1354	
                           A  5634    ; 1355	/* Enable the background color for prin
                           A  5635    ; 1356	void Enable_Back_Color(void)
                           A  5636    ; 1357	{
011956                     A  5637    _Enable_Back_Color:
                           A  5638    ; 1358		asm ("push ix");
011956 DDE5                A  5639    push ix
                           A  5640    ; 1359		asm ("ld E, E7h");
011958 1EE7                A  5641    ld E, E7h
                           A  5642    ; 1360		asm ("ld a, kr_set_pen");
01195A 3E2A                A  5643    ld a, kr_set_pen
                           A  5644    ; 1361		asm ("call.lil prose_kernal");
01195C 5BCD200A 00         A  5645    call.lil prose_kernal
                           A  5646    ; 1362		asm ("pop ix");
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 112


PC     Object              I  Line    Source C:\proted\Debug\main.src
011961 DDE1                A  5647    pop ix
                           A  5648    ; 1363	}
011963 C9                  A  5649    	RET	
                           A  5650    
                           A  5651    
                           A  5652    ;**************************** _Enable_Back_Colo
                           A  5653    ;Name                         Addr/Register   S
                           A  5654    
                           A  5655    
                           A  5656    ; Stack Frame Size: 6 (bytes)
                           A  5657    ;       Spill Code: 0 (instruction)
                           A  5658    
                           A  5659    
                           A  5660    ; 1364	
                           A  5661    ; 1365	/* Disable the background color for pri
                           A  5662    ; 1366	void Disable_Back_Color(void)
                           A  5663    ; 1367	{
011964                     A  5664    _Disable_Back_Color:
                           A  5665    ; 1368		asm ("push ix");
011964 DDE5                A  5666    push ix
                           A  5667    ; 1369		asm ("ld E, 07h");
011966 1E07                A  5668    ld E, 07h
                           A  5669    ; 1370		asm ("ld a, kr_set_pen");
011968 3E2A                A  5670    ld a, kr_set_pen
                           A  5671    ; 1371		asm ("call.lil prose_kernal");
01196A 5BCD200A 00         A  5672    call.lil prose_kernal
                           A  5673    ; 1372		asm ("pop ix");
01196F DDE1                A  5674    pop ix
                           A  5675    ; 1373	}
011971 C9                  A  5676    	RET	
                           A  5677    
                           A  5678    
                           A  5679    ;**************************** _Disable_Back_Col
                           A  5680    ;Name                         Addr/Register   S
                           A  5681    
                           A  5682    
                           A  5683    ; Stack Frame Size: 6 (bytes)
                           A  5684    ;       Spill Code: 0 (instruction)
                           A  5685    
                           A  5686    
                           A  5687    ; 1374	
                           A  5688    ; 1375	/* Main edit loop */
                           A  5689    ; 1376	void edit(void)
                           A  5690    ; 1377	{
011972                     A  5691    _edit:
011972 21FFFFFF            A  5692    	LD	HL,-1
011976 CD 39 25 01         A  5693    	CALL	__frameset
                           A  5694    ; 1378		cur_row = 0;
01197A 01000000            A  5695    	LD	BC,0
01197E ED43 33 55 01       A  5696    	LD	(_cur_row),BC
                           A  5697    ; 1379		cur_col = 0;
011983 ED43 36 55 01       A  5698    	LD	(_cur_col),BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 113


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5699    ; 1380		cur_line = 1;
011988 01010000            A  5700    	LD	BC,1
01198C ED43 2D 55 01       A  5701    	LD	(_cur_line),BC
                           A  5702    ; 1381		cur_char = 1;
011991 ED43 30 55 01       A  5703    	LD	(_cur_char),BC
                           A  5704    ; 1382		InsertMode = 1;
011996 3E01                A  5705    	LD	A,1
011998 32 98 55 01         A  5706    	LD	(_InsertMode),A
                           A  5707    ; 1383		p_curr = p_root->p_next;	
01199C FD2A 24 55 01       A  5708    	LD	IY,(_p_root)
0119A1 FD0703              A  5709    	LD	BC,(IY+3)
0119A4 ED43 27 55 01       A  5710    	LD	(_p_curr),BC
                           A  5711    ; 1384		
                           A  5712    ; 1385		paintall();
0119A9 CD C2 16 01         A  5713    	CALL	_paintall
                           A  5714    ; 1386		
                           A  5715    ; 1387		sc_fup();
0119AD CD C2 09 01         A  5716    	CALL	_sc_fup
                           A  5717    ; 1388		
                           A  5718    ; 1389		ShowInsertMode();
0119B1 CD FC 18 01         A  5719    	CALL	_ShowInsertMode
                           A  5720    ; 1390		
                           A  5721    ; 1391		while (TRUE)
0119B5                     A  5722    L_346:
                           A  5723    ; 1392		{
                           A  5724    ; 1393			char ch;
                           A  5725    ; 1394			
                           A  5726    ; 1395			sc_upd();
0119B5 CD 87 08 01         A  5727    	CALL	_sc_upd
                           A  5728    ; 1396			
                           A  5729    ; 1397			Show_Cursor_Position();
0119B9 CD BF 1B 01         A  5730    	CALL	_Show_Cursor_Position
                           A  5731    ; 1398			
                           A  5732    ; 1399			te_mov(cur_row, cur_col);
0119BD 3A 36 55 01         A  5733    	LD	A,(_cur_col)
0119C1 4F                  A  5734    	LD	C,A
0119C2 3A 33 55 01         A  5735    	LD	A,(_cur_row)
0119C6 0600                A  5736    	LD	B,0
0119C8 C5                  A  5737    	PUSH	BC
0119C9 4F                  A  5738    	LD	C,A
0119CA C5                  A  5739    	PUSH	BC
0119CB CD 9D 06 01         A  5740    	CALL	_te_mov
0119CF C1                  A  5741    	POP	BC
0119D0 C1                  A  5742    	POP	BC
                           A  5743    ; 1400	
                           A  5744    ; 1401			Show_Cursor();		
0119D1 CD 7D 18 01         A  5745    	CALL	_Show_Cursor
                           A  5746    ; 1402			
                           A  5747    ; 1403			ch = te_gch();
0119D5 CD 33 06 01         A  5748    	CALL	_te_gch
0119D9 DD77FF              A  5749    	LD	(IX+-1),A
                           A  5750    ; 1404			
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 114


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5751    ; 1405			if ((' ' <= ch) && (ch <= '~'))
0119DC FE20                A  5752    	CP	A,32
0119DE FA 02 1A 01         A  5753    	JP	M,L_344
0119E2 3E7E                A  5754    	LD	A,126
0119E4 DDBEFF              A  5755    	CP	A,(IX+-1)
0119E7 FA F1 19 01         A  5756    	JP	M,L__258
0119EB EA 02 1A 01         A  5757    	JP	PE,L_344
0119EF 18 04               A  5758    	JR	L__259
0119F1                     A  5759    L__258:
0119F1 E2 02 1A 01         A  5760    	JP	PO,L_344
0119F5                     A  5761    L__259:
                           A  5762    ; 1406				do_chr(ch);
0119F5 DD4EFF              A  5763    	LD	C,(IX+-1)
0119F8 0600                A  5764    	LD	B,0
0119FA C5                  A  5765    	PUSH	BC
0119FB CD F2 12 01         A  5766    	CALL	_do_chr
0119FF C1                  A  5767    	POP	BC
                           A  5768    ; 1407			else
011A00 18 B3               A  5769    	JR	L_346
011A02                     A  5770    L_344:
                           A  5771    ; 1408				switch (ch)
011A02 DD7EFF              A  5772    	LD	A,(IX+-1)
011A05 17ED62              A  5773    	SEXT	HL
011A08 DD6EFF              A  5774    	LD	L,(IX+-1)
011A0B E5C1                A  5775    	LD	BC,HL
011A0D                     A  5776    L__243:
011A0D 11010000            A  5777    	LD	DE,1
011A11 B7                  A  5778    	OR	A,A
011A12 ED52                A  5779    	SBC	HL,DE
011A14 38 9F               A  5780    	JR	C,L_346
011A16 21140000            A  5781    	LD	HL,20
011A1A B7                  A  5782    	OR	A,A
011A1B ED42                A  5783    	SBC	HL,BC
011A1D 38 96               A  5784    	JR	C,L_346
011A1F C5E1                A  5785    	LD	HL,BC
011A21 29                  A  5786    	ADD	HL,HL
011A22 29                  A  5787    	ADD	HL,HL
011A23 B7                  A  5788    	OR	A,A
011A24 ED42                A  5789    	SBC	HL,BC
011A26 01 2B 1A 01         A  5790    	LD	BC,L__242-3
011A2A 09                  A  5791    	ADD	HL,BC
011A2B ED27                A  5792    	LD	HL,(HL)
011A2D E9                  A  5793    	JP	(HL)
011A2E                     A  5794    L__242:
011A2E 101B01              A  5795    	DW24	L_334	
                           A  5796    
011A31 6A1A01              A  5797    	DW24	L_315	
                           A  5798    
011A34 721A01              A  5799    	DW24	L_316	
                           A  5800    
011A37 7A1A01              A  5801    	DW24	L_317	
                           A  5802    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 115


PC     Object              I  Line    Source C:\proted\Debug\main.src
011A3A 821A01              A  5803    	DW24	L_318	
                           A  5804    
011A3D 901A01              A  5805    	DW24	L_319	
                           A  5806    
011A40 B51901              A  5807    	DW24	L_346	
                           A  5808    
011A43 981A01              A  5809    	DW24	L_320	
                           A  5810    
011A46 A01A01              A  5811    	DW24	L_321	
                           A  5812    
011A49 B51901              A  5813    	DW24	L_346	
                           A  5814    
011A4C A81A01              A  5815    	DW24	L_322	
                           A  5816    
011A4F B01A01              A  5817    	DW24	L_323	
                           A  5818    
011A52 B81A01              A  5819    	DW24	L_324	
                           A  5820    
011A55 C01A01              A  5821    	DW24	L_325	
                           A  5822    
011A58 B51901              A  5823    	DW24	L_346	
                           A  5824    
011A5B B51901              A  5825    	DW24	L_346	
                           A  5826    
011A5E E01A01              A  5827    	DW24	L_329	
                           A  5828    
011A61 C81A01              A  5829    	DW24	L_326	
                           A  5830    
011A64 D01A01              A  5831    	DW24	L_327	
                           A  5832    
011A67 D81A01              A  5833    	DW24	L_328	
                           A  5834    
                           A  5835    ; 1409				{
                           A  5836    ; 1410					case		2: do_enhan
011A6A                     A  5837    L_315:
011A6A CD 9A 10 01         A  5838    	CALL	_do_enhanced_ret
011A6E C3 B5 19 01         A  5839    	JR	L_346
                           A  5840    ; 1411					case		3: do_pup()
011A72                     A  5841    L_316:
011A72 CD 02 0F 01         A  5842    	CALL	_do_pup
011A76 C3 B5 19 01         A  5843    	JR	L_346
                           A  5844    ; 1412					case		4: do_dch()
011A7A                     A  5845    L_317:
011A7A CD 84 13 01         A  5846    	CALL	_do_dch
011A7E C3 B5 19 01         A  5847    	JR	L_346
                           A  5848    ; 1413					case		5: do_bot(1
011A82                     A  5849    L_318:
011A82 01010000            A  5850    	LD	BC,1
011A86 C5                  A  5851    	PUSH	BC
011A87 CD 41 12 01         A  5852    	CALL	_do_bot
011A8B C1                  A  5853    	POP	BC
011A8C C3 B5 19 01         A  5854    	JR	L_346
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 116


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5855    ; 1414					case 		6: do_pdw()
011A90                     A  5856    L_319:
011A90 CD 45 0E 01         A  5857    	CALL	_do_pdw
011A94 C3 B5 19 01         A  5858    	JR	L_346
                           A  5859    ; 1415					case 		8: do_del()
011A98                     A  5860    L_320:
011A98 CD AC 14 01         A  5861    	CALL	_do_del
011A9C C3 B5 19 01         A  5862    	JR	L_346
                           A  5863    ; 1416					case		9: do_tab()
011AA0                     A  5864    L_321:
011AA0 CD 8D 11 01         A  5865    	CALL	_do_tab
011AA4 C3 B5 19 01         A  5866    	JR	L_346
                           A  5867    ; 1417					case		11: do_dln(
011AA8                     A  5868    L_322:
011AA8 CD 6F 14 01         A  5869    	CALL	_do_dln
011AAC C3 B5 19 01         A  5870    	JR	L_346
                           A  5871    ; 1418					case		12: do_iln(
011AB0                     A  5872    L_323:
011AB0 CD FB 13 01         A  5873    	CALL	_do_iln
011AB4 C3 B5 19 01         A  5874    	JR	L_346
                           A  5875    ; 1419					case 		13: do_ret(
011AB8                     A  5876    L_324:
011AB8 CD C6 0F 01         A  5877    	CALL	_do_ret
011ABC C3 B5 19 01         A  5878    	JR	L_346
                           A  5879    ; 1420					case		14: do_red(
011AC0                     A  5880    L_325:
011AC0 CD 1C 0C 01         A  5881    	CALL	_do_red
011AC4 C3 B5 19 01         A  5882    	JR	L_346
                           A  5883    ; 1421					case		18: reload_
011AC8                     A  5884    L_326:
011AC8 CD AB 1F 01         A  5885    	CALL	_reload_file
011ACC C3 B5 19 01         A  5886    	JR	L_346
                           A  5887    ; 1422					case		19: save_fi
011AD0                     A  5888    L_327:
011AD0 CD 73 1E 01         A  5889    	CALL	_save_file
011AD4 C3 B5 19 01         A  5890    	JR	L_346
                           A  5891    ; 1423					case		20: do_top(
011AD8                     A  5892    L_328:
011AD8 CD C1 11 01         A  5893    	CALL	_do_top
011ADC C3 B5 19 01         A  5894    	JR	L_346
                           A  5895    ; 1424					
                           A  5896    ; 1425					case		17: msg_win
011AE0                     A  5897    L_329:
011AE0 01 29 2B 01         A  5898    	LD	BC,L__246
011AE4 C5                  A  5899    	PUSH	BC
011AE5 01 2D 2B 01         A  5900    	LD	BC,L__247
011AE9 C5                  A  5901    	PUSH	BC
011AEA CD 52 20 01         A  5902    	CALL	_msg_window
011AEE C1                  A  5903    	POP	BC
011AEF C1                  A  5904    	POP	BC
                           A  5905    ; 1426									getch()
011AF0 CD 4D 01 01         A  5906    	CALL	_getch
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 117


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5907    ; 1427									close_m
011AF4 CD 76 22 01         A  5908    	CALL	_close_msg_window
                           A  5909    ; 1428									
                           A  5910    ; 1429									if ((As
011AF8 3A 93 55 01         A  5911    	LD	A,(_Ascii)
011AFC FE59                A  5912    	CP	A,89
011AFE CA BA 1B 01         A  5913    	JR	Z,L_332
011B02 3A 93 55 01         A  5914    	LD	A,(_Ascii)
011B06 FE79                A  5915    	CP	A,121
011B08 C2 B5 19 01         A  5916    	JR	NZ,L_346
011B0C C3 BA 1B 01         A  5917    	JR	L_332
                           A  5918    ; 1430									 contin
                           A  5919    ; 1431									
                           A  5920    ; 1432									goto qu
                           A  5921    ; 1433						
                           A  5922    ; 1434					case		1:
011B10                     A  5923    L_334:
                           A  5924    ; 1435						switch (Scancode)
011B10 3A 94 55 01         A  5925    	LD	A,(_Scancode)
011B14 B7ED62              A  5926    	UEXT	HL
011B17 6F                  A  5927    	LD	L,A
011B18 E5C1                A  5928    	LD	BC,HL
011B1A                     A  5929    L__252:
011B1A 11700000            A  5930    	LD	DE,112
011B1E B7                  A  5931    	OR	A,A
011B1F ED52                A  5932    	SBC	HL,DE
011B21 38 2C               A  5933    	JR	C,L__253
011B23 21750000            A  5934    	LD	HL,117
011B27 B7                  A  5935    	OR	A,A
011B28 ED42                A  5936    	SBC	HL,BC
011B2A DA B5 19 01         A  5937    	JR	C,L_346
011B2E C5E1                A  5938    	LD	HL,BC
011B30 29                  A  5939    	ADD	HL,HL
011B31 29                  A  5940    	ADD	HL,HL
011B32 B7                  A  5941    	OR	A,A
011B33 ED42                A  5942    	SBC	HL,BC
011B35 11 ED 19 01         A  5943    	LD	DE,L__251-336
011B39 19                  A  5944    	ADD	HL,DE
011B3A ED27                A  5945    	LD	HL,(HL)
011B3C E9                  A  5946    	JP	(HL)
011B3D                     A  5947    L__251:
011B3D B21B01              A  5948    	DW24	L_341	
                           A  5949    
011B40 B51901              A  5950    	DW24	L_346	
                           A  5951    
011B43 9A1B01              A  5952    	DW24	L_338	
                           A  5953    
011B46 B51901              A  5954    	DW24	L_346	
                           A  5955    
011B49 821B01              A  5956    	DW24	L_335	
                           A  5957    
011B4C 921B01              A  5958    	DW24	L_337	
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 118


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  5959    
011B4F                     A  5960    L__253:
011B4F 11690000            A  5961    	LD	DE,105
011B53 C5E1                A  5962    	LD	HL,BC
011B55 B7                  A  5963    	OR	A,A
011B56 ED52                A  5964    	SBC	HL,DE
011B58 DA B5 19 01         A  5965    	JR	C,L_346
011B5C 216C0000            A  5966    	LD	HL,108
011B60 B7                  A  5967    	OR	A,A
011B61 ED42                A  5968    	SBC	HL,BC
011B63 DA B5 19 01         A  5969    	JR	C,L_346
011B67 C5E1                A  5970    	LD	HL,BC
011B69 29                  A  5971    	ADD	HL,HL
011B6A 29                  A  5972    	ADD	HL,HL
011B6B B7                  A  5973    	OR	A,A
011B6C ED42                A  5974    	SBC	HL,BC
011B6E 01 3B 1A 01         A  5975    	LD	BC,L__250-315
011B72 09                  A  5976    	ADD	HL,BC
011B73 ED27                A  5977    	LD	HL,(HL)
011B75 E9                  A  5978    	JP	(HL)
011B76                     A  5979    L__250:
011B76 AA1B01              A  5980    	DW24	L_340	
                           A  5981    
011B79 B51901              A  5982    	DW24	L_346	
                           A  5983    
011B7C 8A1B01              A  5984    	DW24	L_336	
                           A  5985    
011B7F A21B01              A  5986    	DW24	L_339	
                           A  5987    
                           A  5988    ; 1436						{
                           A  5989    ; 1437							case	0x74: d
011B82                     A  5990    L_335:
011B82 CD C3 0D 01         A  5991    	CALL	_do_crt
011B86 C3 B5 19 01         A  5992    	JR	L_346
                           A  5993    ; 1438							case	0x6B: d
011B8A                     A  5994    L_336:
011B8A CD 41 0D 01         A  5995    	CALL	_do_clf
011B8E C3 B5 19 01         A  5996    	JR	L_346
                           A  5997    ; 1439							case	0x75: d
011B92                     A  5998    L_337:
011B92 CD 21 0C 01         A  5999    	CALL	_do_cup
011B96 C3 B5 19 01         A  6000    	JR	L_346
                           A  6001    ; 1440							case	0x72: d
011B9A                     A  6002    L_338:
011B9A CD B0 0C 01         A  6003    	CALL	_do_cdw
011B9E C3 B5 19 01         A  6004    	JR	L_346
                           A  6005    ; 1441							case	0x6C: d
011BA2                     A  6006    L_339:
011BA2 CD A3 15 01         A  6007    	CALL	_do_home
011BA6 C3 B5 19 01         A  6008    	JR	L_346
                           A  6009    ; 1442							case	0x69: d
011BAA                     A  6010    L_340:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 119


PC     Object              I  Line    Source C:\proted\Debug\main.src
011BAA CD 0D 16 01         A  6011    	CALL	_do_endline
011BAE C3 B5 19 01         A  6012    	JR	L_346
                           A  6013    ; 1443							case	0x70: d
011BB2                     A  6014    L_341:
011BB2 CD 91 16 01         A  6015    	CALL	_do_ins
011BB6 C3 B5 19 01         A  6016    	JR	L_346
011BBA                     A  6017    L_332:
                           A  6018    ; 1444						}
                           A  6019    ; 1445						break;
                           A  6020    ; 1446				}
                           A  6021    ; 1447		}
                           A  6022    ; 1448		
                           A  6023    ; 1449		quit:;
                           A  6024    ; 1450	}
011BBA DDF9                A  6025    	LD	SP,IX
011BBC DDE1                A  6026    	POP	IX
011BBE C9                  A  6027    	RET	
                           A  6028    
                           A  6029    
                           A  6030    ;**************************** _edit ***********
                           A  6031    ;Name                         Addr/Register   S
                           A  6032    ;_do_ins                             IMPORT  --
                           A  6033    ;_do_endline                         IMPORT  --
                           A  6034    ;_do_home                            IMPORT  --
                           A  6035    ;_do_cdw                             IMPORT  --
                           A  6036    ;_do_cup                             IMPORT  --
                           A  6037    ;_do_clf                             IMPORT  --
                           A  6038    ;_do_crt                             IMPORT  --
                           A  6039    ;_Scancode                           STATIC    
                           A  6040    ;_Ascii                              STATIC    
                           A  6041    ;_close_msg_window                   IMPORT  --
                           A  6042    ;_getch                              IMPORT  --
                           A  6043    ;_msg_window                         IMPORT  --
                           A  6044    ;_do_top                             IMPORT  --
                           A  6045    ;_save_file                          IMPORT  --
                           A  6046    ;_reload_file                        IMPORT  --
                           A  6047    ;_do_red                             IMPORT  --
                           A  6048    ;_do_ret                             IMPORT  --
                           A  6049    ;_do_iln                             IMPORT  --
                           A  6050    ;_do_dln                             IMPORT  --
                           A  6051    ;_do_tab                             IMPORT  --
                           A  6052    ;_do_del                             IMPORT  --
                           A  6053    ;_do_pdw                             IMPORT  --
                           A  6054    ;_do_bot                             IMPORT  --
                           A  6055    ;_do_dch                             IMPORT  --
                           A  6056    ;_do_pup                             IMPORT  --
                           A  6057    ;_do_enhanced_ret                    IMPORT  --
                           A  6058    ;_do_chr                             IMPORT  --
                           A  6059    ;_te_gch                             IMPORT  --
                           A  6060    ;_Show_Cursor                        IMPORT  --
                           A  6061    ;_te_mov                             IMPORT  --
                           A  6062    ;_Show_Cursor_Position               IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 120


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  6063    ;_sc_upd                             IMPORT  --
                           A  6064    ;_ShowInsertMode                     IMPORT  --
                           A  6065    ;_sc_fup                             IMPORT  --
                           A  6066    ;_paintall                           IMPORT  --
                           A  6067    ;_p_curr                             STATIC    
                           A  6068    ;_p_root                             STATIC    
                           A  6069    ;_InsertMode                         STATIC    
                           A  6070    ;_cur_char                           STATIC    
                           A  6071    ;_cur_line                           STATIC    
                           A  6072    ;_cur_col                            STATIC    
                           A  6073    ;_cur_row                            STATIC    
                           A  6074    ;ch                                    IX-1    
                           A  6075    
                           A  6076    
                           A  6077    ; Stack Frame Size: 7 (bytes)
                           A  6078    ;       Spill Code: 0 (instruction)
                           A  6079    
                           A  6080    
                           A  6081    	SEGMENT STRSECT
012B29                     A  6082    L__246:
012B29 592F6E              A  6083    	DB	"Y/n"
012B2C 00                  A  6084    	DB	0
012B2D                     A  6085    L__247:
012B2D 51756974 20746F20   A  6086    	DB	"Quit to PROSE ?"
012B35 50524F53 45203F 
012B3C 00                  A  6087    	DB	0
                           A  6088    	SEGMENT CODE
                           A  6089    ; 1451	
                           A  6090    ; 1452	/* Draw on screen the cursor position *
                           A  6091    ; 1453	void Show_Cursor_Position(void)
                           A  6092    ; 1454	{
011BBF                     A  6093    _Show_Cursor_Position:
                           A  6094    ; 1455		Enable_Back_Color();
011BBF CD 56 19 01         A  6095    	CALL	_Enable_Back_Color
                           A  6096    ; 1456		
                           A  6097    ; 1457		uitoa(cur_line, convBuf);
011BC3 01 A6 55 01         A  6098    	LD	BC,_convBuf
011BC7 C5                  A  6099    	PUSH	BC
011BC8 ED4B 2D 55 01       A  6100    	LD	BC,(_cur_line)
011BCD C5                  A  6101    	PUSH	BC
011BCE CD C0 03 01         A  6102    	CALL	_uitoa
011BD2 C1                  A  6103    	POP	BC
011BD3 C1                  A  6104    	POP	BC
                           A  6105    ; 1458		
                           A  6106    ; 1459		gotoxy(5, 51);
011BD4 01330000            A  6107    	LD	BC,51
011BD8 C5                  A  6108    	PUSH	BC
011BD9 01050000            A  6109    	LD	BC,5
011BDD C5                  A  6110    	PUSH	BC
011BDE CD 23 03 01         A  6111    	CALL	_gotoxy
011BE2 C1                  A  6112    	POP	BC
011BE3 C1                  A  6113    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 121


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  6114    ; 1460		
                           A  6115    ; 1461		print("      ");
011BE4 01 3D 2B 01         A  6116    	LD	BC,L__261
011BE8 C5                  A  6117    	PUSH	BC
011BE9 CD 5A 02 01         A  6118    	CALL	_print
011BED C1                  A  6119    	POP	BC
                           A  6120    ; 1462		
                           A  6121    ; 1463		gotoxy(5, 51);
011BEE 01330000            A  6122    	LD	BC,51
011BF2 C5                  A  6123    	PUSH	BC
011BF3 01050000            A  6124    	LD	BC,5
011BF7 C5                  A  6125    	PUSH	BC
011BF8 CD 23 03 01         A  6126    	CALL	_gotoxy
011BFC C1                  A  6127    	POP	BC
011BFD C1                  A  6128    	POP	BC
                           A  6129    ; 1464		
                           A  6130    ; 1465		print(convBuf);	
011BFE 01 A6 55 01         A  6131    	LD	BC,_convBuf
011C02 C5                  A  6132    	PUSH	BC
011C03 CD 5A 02 01         A  6133    	CALL	_print
011C07 C1                  A  6134    	POP	BC
                           A  6135    ; 1466		
                           A  6136    ; 1467		uitoa(cur_col + 1, convBuf);
011C08 01 A6 55 01         A  6137    	LD	BC,_convBuf
011C0C C5                  A  6138    	PUSH	BC
011C0D ED4B 36 55 01       A  6139    	LD	BC,(_cur_col)
011C12 03                  A  6140    	INC	BC
011C13 C5                  A  6141    	PUSH	BC
011C14 CD C0 03 01         A  6142    	CALL	_uitoa
011C18 C1                  A  6143    	POP	BC
011C19 C1                  A  6144    	POP	BC
                           A  6145    ; 1468		
                           A  6146    ; 1469		gotoxy(18, 51);
011C1A 01330000            A  6147    	LD	BC,51
011C1E C5                  A  6148    	PUSH	BC
011C1F 01120000            A  6149    	LD	BC,18
011C23 C5                  A  6150    	PUSH	BC
011C24 CD 23 03 01         A  6151    	CALL	_gotoxy
011C28 C1                  A  6152    	POP	BC
011C29 C1                  A  6153    	POP	BC
                           A  6154    ; 1470		
                           A  6155    ; 1471		print("         ");
011C2A 01 44 2B 01         A  6156    	LD	BC,L__262
011C2E C5                  A  6157    	PUSH	BC
011C2F CD 5A 02 01         A  6158    	CALL	_print
011C33 C1                  A  6159    	POP	BC
                           A  6160    ; 1472		
                           A  6161    ; 1473		gotoxy(18, 51);
011C34 01330000            A  6162    	LD	BC,51
011C38 C5                  A  6163    	PUSH	BC
011C39 01120000            A  6164    	LD	BC,18
011C3D C5                  A  6165    	PUSH	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 122


PC     Object              I  Line    Source C:\proted\Debug\main.src
011C3E CD 23 03 01         A  6166    	CALL	_gotoxy
011C42 C1                  A  6167    	POP	BC
011C43 C1                  A  6168    	POP	BC
                           A  6169    ; 1474		
                           A  6170    ; 1475		print(convBuf);	
011C44 01 A6 55 01         A  6171    	LD	BC,_convBuf
011C48 C5                  A  6172    	PUSH	BC
011C49 CD 5A 02 01         A  6173    	CALL	_print
011C4D C1                  A  6174    	POP	BC
                           A  6175    ; 1476		
                           A  6176    ; 1477		Disable_Back_Color();
011C4E CD 64 19 01         A  6177    	CALL	_Disable_Back_Color
                           A  6178    ; 1478	}
011C52 C9                  A  6179    	RET	
                           A  6180    
                           A  6181    
                           A  6182    ;**************************** _Show_Cursor_Posi
                           A  6183    ;Name                         Addr/Register   S
                           A  6184    ;_Disable_Back_Color                 IMPORT  --
                           A  6185    ;_cur_col                            STATIC    
                           A  6186    ;_print                              IMPORT  --
                           A  6187    ;_gotoxy                             IMPORT  --
                           A  6188    ;_cur_line                           STATIC    
                           A  6189    ;_convBuf                            STATIC    
                           A  6190    ;_uitoa                              IMPORT  --
                           A  6191    ;_Enable_Back_Color                  IMPORT  --
                           A  6192    
                           A  6193    
                           A  6194    ; Stack Frame Size: 6 (bytes)
                           A  6195    ;       Spill Code: 0 (instruction)
                           A  6196    
                           A  6197    
                           A  6198    	SEGMENT STRSECT
012B3D                     A  6199    L__261:
012B3D 20202020 2020       A  6200    	DB	"      "
012B43 00                  A  6201    	DB	0
012B44                     A  6202    L__262:
012B44 20202020 20202020   A  6203    	DB	"         "
012B4C 20 
012B4D 00                  A  6204    	DB	0
                           A  6205    	SEGMENT CODE
                           A  6206    ; 1479	
                           A  6207    ; 1480	/* Return 1 if the filename passed as p
                           A  6208    ; 1481	char FileExists(void)
                           A  6209    ; 1482	{
011C53                     A  6210    _FileExists:
011C53 21FFFFFF            A  6211    	LD	HL,-1
011C57 CD 39 25 01         A  6212    	CALL	__frameset
                           A  6213    ; 1483		char ret;
                           A  6214    ; 1484		
                           A  6215    ; 1485		ret = 0;
011C5B DD36FF00            A  6216    	LD	(IX+-1),0
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 123


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  6217    ; 1486		
                           A  6218    ; 1487		asm ("push ix");
011C5F DDE5                A  6219    push ix
                           A  6220    ; 1488		asm ("ld hl, (_K_xHL)");
011C61 2A 99 55 01         A  6221    ld hl, (_K_xHL)
                           A  6222    ; 1489		asm ("ld a, kr_find_file");
011C65 3E0B                A  6223    ld a, kr_find_file
                           A  6224    ; 1490		asm ("call.lil prose_kernal");
011C67 5BCD200A 00         A  6225    call.lil prose_kernal
                           A  6226    ; 1491		asm ("pop ix");	
011C6C DDE1                A  6227    pop ix
                           A  6228    ; 1492		asm ("jr nz, FindError");
011C6E 20 04               A  6229    jr nz, FindError
                           A  6230    ; 1493		
                           A  6231    ; 1494		ret = 1;
011C70 DD36FF01            A  6232    	LD	(IX+-1),1
                           A  6233    ; 1495		
                           A  6234    ; 1496		asm ("FindError:");
011C74                     A  6235    FindError:
                           A  6236    ; 1497		
                           A  6237    ; 1498		return ret;
011C74 DD7EFF              A  6238    	LD	A,(IX+-1)
                           A  6239    ; 1499	}
011C77 DDF9                A  6240    	LD	SP,IX
011C79 DDE1                A  6241    	POP	IX
011C7B C9                  A  6242    	RET	
                           A  6243    
                           A  6244    
                           A  6245    ;**************************** _FileExists *****
                           A  6246    ;Name                         Addr/Register   S
                           A  6247    ;ret                                   IX-1    
                           A  6248    
                           A  6249    
                           A  6250    ; Stack Frame Size: 7 (bytes)
                           A  6251    ;       Spill Code: 0 (instruction)
                           A  6252    
                           A  6253    
                           A  6254    ; 1500	
                           A  6255    ; 1501	/* Load file into Video Ram B, after bu
                           A  6256    ; 1502	void load_file(void)
                           A  6257    ; 1503	{
011C7C                     A  6258    _load_file:
011C7C 21F8FFFF            A  6259    	LD	HL,-8
011C80 CD 39 25 01         A  6260    	CALL	__frameset
                           A  6261    ; 1504		register unsigned int i;
                           A  6262    ; 1505		char pos = 0, len;
011C84 DD36FF00            A  6263    	LD	(IX+-1),0
                           A  6264    ; 1506		
                           A  6265    ; 1507		msg_window("Loading file", "Please 
011C88 01 4E 2B 01         A  6266    	LD	BC,L__265
011C8C C5                  A  6267    	PUSH	BC
011C8D 01 5D 2B 01         A  6268    	LD	BC,L__266
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 124


PC     Object              I  Line    Source C:\proted\Debug\main.src
011C91 C5                  A  6269    	PUSH	BC
011C92 CD 52 20 01         A  6270    	CALL	_msg_window
011C96 C1                  A  6271    	POP	BC
011C97 C1                  A  6272    	POP	BC
                           A  6273    ; 1508		
                           A  6274    ; 1509		asm ("push ix");
011C98 DDE5                A  6275    push ix
                           A  6276    ; 1510		asm ("ld hl, (_K_xHL)");
011C9A 2A 99 55 01         A  6277    ld hl, (_K_xHL)
                           A  6278    ; 1511		asm ("ld a, kr_find_file");
011C9E 3E0B                A  6279    ld a, kr_find_file
                           A  6280    ; 1512		asm ("call.lil prose_kernal");
011CA0 5BCD200A 00         A  6281    call.lil prose_kernal
                           A  6282    ; 1513		asm ("pop ix");	
011CA5 DDE1                A  6283    pop ix
                           A  6284    ; 1514		asm ("jr nz, LoadError");
011CA7 C2 56 1E 01         A  6285    jr nz, LoadError
                           A  6286    ; 1515		asm ("ld (_filesize), de");
011CAB ED53 9F 55 01       A  6287    ld (_filesize), de
                           A  6288    ; 1516		
                           A  6289    ; 1517		asm ("push ix");
011CB0 DDE5                A  6290    push ix
                           A  6291    ; 1518		asm ("ld de, (_filesize)");
011CB2 ED5B 9F 55 01       A  6292    ld de, (_filesize)
                           A  6293    ; 1519		asm ("ld a, kr_set_load_length");
011CB7 3E0D                A  6294    ld a, kr_set_load_length
                           A  6295    ; 1520		asm ("call.lil prose_kernal");
011CB9 5BCD200A 00         A  6296    call.lil prose_kernal
                           A  6297    ; 1521		asm ("pop ix");
011CBE DDE1                A  6298    pop ix
                           A  6299    ; 1522		
                           A  6300    ; 1523		asm ("push ix");
011CC0 DDE5                A  6301    push ix
                           A  6302    ; 1524		asm ("ld hl, (_BufferFile)");
011CC2 2A B1 55 01         A  6303    ld hl, (_BufferFile)
                           A  6304    ; 1525		asm ("ld a, kr_read_file");
011CC6 3E0E                A  6305    ld a, kr_read_file
                           A  6306    ; 1526		asm ("call.lil prose_kernal");
011CC8 5BCD200A 00         A  6307    call.lil prose_kernal
                           A  6308    ; 1527		asm ("jr nz, LoadError");
011CCD C2 56 1E 01         A  6309    jr nz, LoadError
                           A  6310    ; 1528		asm ("pop ix");
011CD1 DDE1                A  6311    pop ix
                           A  6312    ; 1529		
                           A  6313    ; 1530		memset(linbuf, 0, sizeof(linbuf));
011CD3 015A0000            A  6314    	LD	BC,90
011CD7 C5                  A  6315    	PUSH	BC
011CD8 01000000            A  6316    	LD	BC,0
011CDC C5                  A  6317    	PUSH	BC
011CDD 01 39 55 01         A  6318    	LD	BC,_linbuf
011CE1 C5                  A  6319    	PUSH	BC
011CE2 CD F7 25 01         A  6320    	CALL	_memset
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 125


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  6321    ; 1531		
                           A  6322    ; 1532		linbuf[0] = EOS;
011CE6 AF                  A  6323    	XOR	A,A
011CE7 32 39 55 01         A  6324    	LD	(_linbuf),A
                           A  6325    ; 1533		i = 0;	
011CEB 11000000            A  6326    	LD	DE,0
011CEF C1                  A  6327    	POP	BC
011CF0 C1                  A  6328    	POP	BC
011CF1 C1                  A  6329    	POP	BC
011CF2 DD1FFC              A  6330    	LD	(IX+-4),DE
                           A  6331    ; 1534		
                           A  6332    ; 1535		while (i <= filesize)
011CF5 C3 44 1E 01         A  6333    	JR	L_364
011CF9                     A  6334    L_365:
                           A  6335    ; 1536		{
                           A  6336    ; 1537			if (pos < MAXLNLEN - 1)
011CF9 DD7EFF              A  6337    	LD	A,(IX+-1)
011CFC FE4F                A  6338    	CP	A,79
011CFE F2 08 1D 01         A  6339    	JP	P,L__276
011D02 EA D7 1D 01         A  6340    	JP	PE,L_363
011D06 18 04               A  6341    	JR	L__277
011D08                     A  6342    L__276:
011D08 E2 D7 1D 01         A  6343    	JP	PO,L_363
011D0C                     A  6344    L__277:
                           A  6345    ; 1538			{
                           A  6346    ; 1539				linbuf[pos] = BufferFile[i]
011D0C DD7EFF              A  6347    	LD	A,(IX+-1)
011D0F 17ED62              A  6348    	SEXT	HL
011D12 DD6EFF              A  6349    	LD	L,(IX+-1)
011D15 01 39 55 01         A  6350    	LD	BC,_linbuf
011D19 09                  A  6351    	ADD	HL,BC
011D1A DD2FF8              A  6352    	LD	(IX+-8),HL
011D1D DD07FC              A  6353    	LD	BC,(IX+-4)
011D20 2A B1 55 01         A  6354    	LD	HL,(_BufferFile)
011D24 09                  A  6355    	ADD	HL,BC
011D25 7E                  A  6356    	LD	A,(HL)
011D26 DD27F8              A  6357    	LD	HL,(IX+-8)
011D29 77                  A  6358    	LD	(HL),A
                           A  6359    ; 1540				
                           A  6360    ; 1541				if ((linbuf[pos] == EOL) ||
011D2A DD27F8              A  6361    	LD	HL,(IX+-8)
011D2D 7E                  A  6362    	LD	A,(HL)
011D2E 47                  A  6363    	LD	B,A
011D2F 17ED62              A  6364    	SEXT	HL
011D32 68                  A  6365    	LD	L,B
011D33 B7                  A  6366    	OR	A,A
011D34 010A0000            A  6367    	LD	BC,10
011D38 ED42                A  6368    	SBC	HL,BC
011D3A 28 0E               A  6369    	JR	Z,L_356
011D3C DD07FC              A  6370    	LD	BC,(IX+-4)
011D3F 2A 9F 55 01         A  6371    	LD	HL,(_filesize)
011D43 B7                  A  6372    	OR	A,A
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 126


PC     Object              I  Line    Source C:\proted\Debug\main.src
011D44 ED42                A  6373    	SBC	HL,BC
011D46 C2 CB 1D 01         A  6374    	JR	NZ,L_357
011D4A                     A  6375    L_356:
                           A  6376    ; 1542				{
                           A  6377    ; 1543					len = strlen(linbuf);
011D4A 01 39 55 01         A  6378    	LD	BC,_linbuf
011D4E C5                  A  6379    	PUSH	BC
011D4F CD F6 24 01         A  6380    	CALL	_strlen
011D53 C1                  A  6381    	POP	BC
011D54 DD75FB              A  6382    	LD	(IX+-5),L
                           A  6383    ; 1544					
                           A  6384    ; 1545					if (linbuf[pos] == EOL)
011D57 DD7EFF              A  6385    	LD	A,(IX+-1)
011D5A 17ED62              A  6386    	SEXT	HL
011D5D DD6EFF              A  6387    	LD	L,(IX+-1)
011D60 01 39 55 01         A  6388    	LD	BC,_linbuf
011D64 09                  A  6389    	ADD	HL,BC
011D65 7E                  A  6390    	LD	A,(HL)
011D66 47                  A  6391    	LD	B,A
011D67 17ED62              A  6392    	SEXT	HL
011D6A 68                  A  6393    	LD	L,B
011D6B B7                  A  6394    	OR	A,A
011D6C 010A0000            A  6395    	LD	BC,10
011D70 ED42                A  6396    	SBC	HL,BC
011D72 20 13               A  6397    	JR	NZ,L_353
                           A  6398    ; 1546						linbuf[len - 1] = E
011D74 DD7EFB              A  6399    	LD	A,(IX+-5)
011D77 17ED62              A  6400    	SEXT	HL
011D7A DD6EFB              A  6401    	LD	L,(IX+-5)
011D7D 2B                  A  6402    	DEC	HL
011D7E 01 39 55 01         A  6403    	LD	BC,_linbuf
011D82 09                  A  6404    	ADD	HL,BC
011D83 3600                A  6405    	LD	(HL),0
                           A  6406    ; 1547					else
011D85 18 11               A  6407    	JR	L_354
011D87                     A  6408    L_353:
                           A  6409    ; 1548						linbuf[pos + 1] = E
011D87 DD7EFF              A  6410    	LD	A,(IX+-1)
011D8A 17ED62              A  6411    	SEXT	HL
011D8D DD6EFF              A  6412    	LD	L,(IX+-1)
011D90 23                  A  6413    	INC	HL
011D91 01 39 55 01         A  6414    	LD	BC,_linbuf
011D95 09                  A  6415    	ADD	HL,BC
011D96 3600                A  6416    	LD	(HL),0
011D98                     A  6417    L_354:
                           A  6418    ; 1549					
                           A  6419    ; 1550					purify(linbuf);
011D98 C5                  A  6420    	PUSH	BC
011D99 CD 71 05 01         A  6421    	CALL	_purify
011D9D C1                  A  6422    	POP	BC
                           A  6423    ; 1551						
                           A  6424    ; 1552					tx_ins(p_root, linbuf);
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 127


PC     Object              I  Line    Source C:\proted\Debug\main.src
011D9E 01 39 55 01         A  6425    	LD	BC,_linbuf
011DA2 C5                  A  6426    	PUSH	BC
011DA3 ED4B 24 55 01       A  6427    	LD	BC,(_p_root)
011DA8 C5                  A  6428    	PUSH	BC
011DA9 CD C0 0A 01         A  6429    	CALL	_tx_ins
011DAD C1                  A  6430    	POP	BC
011DAE C1                  A  6431    	POP	BC
                           A  6432    ; 1553				
                           A  6433    ; 1554					pos = 0;
011DAF DD36FF00            A  6434    	LD	(IX+-1),0
                           A  6435    ; 1555					memset(linbuf, 0, sizeo
011DB3 015A0000            A  6436    	LD	BC,90
011DB7 C5                  A  6437    	PUSH	BC
011DB8 01000000            A  6438    	LD	BC,0
011DBC C5                  A  6439    	PUSH	BC
011DBD 01 39 55 01         A  6440    	LD	BC,_linbuf
011DC1 C5                  A  6441    	PUSH	BC
011DC2 CD F7 25 01         A  6442    	CALL	_memset
011DC6 C1                  A  6443    	POP	BC
011DC7 C1                  A  6444    	POP	BC
011DC8 C1                  A  6445    	POP	BC
                           A  6446    ; 1556				}
                           A  6447    ; 1557				else
011DC9 18 03               A  6448    	JR	L_359
011DCB                     A  6449    L_357:
                           A  6450    ; 1558					pos++;
011DCB DD34FF              A  6451    	INC	(IX+-1)
011DCE                     A  6452    L_359:
                           A  6453    ; 1559				
                           A  6454    ; 1560				i++;
011DCE DD07FC              A  6455    	LD	BC,(IX+-4)
011DD1 03                  A  6456    	INC	BC
011DD2 DD0FFC              A  6457    	LD	(IX+-4),BC
                           A  6458    ; 1561			}
                           A  6459    ; 1562			else
011DD5 18 6D               A  6460    	JR	L_364
011DD7                     A  6461    L_363:
                           A  6462    ; 1563			{
                           A  6463    ; 1564				purify(linbuf);
011DD7 01 39 55 01         A  6464    	LD	BC,_linbuf
011DDB C5                  A  6465    	PUSH	BC
011DDC CD 71 05 01         A  6466    	CALL	_purify
011DE0 C1                  A  6467    	POP	BC
                           A  6468    ; 1565				
                           A  6469    ; 1566				tx_ins(p_root, linbuf);
011DE1 01 39 55 01         A  6470    	LD	BC,_linbuf
011DE5 C5                  A  6471    	PUSH	BC
011DE6 ED4B 24 55 01       A  6472    	LD	BC,(_p_root)
011DEB C5                  A  6473    	PUSH	BC
011DEC CD C0 0A 01         A  6474    	CALL	_tx_ins
011DF0 C1                  A  6475    	POP	BC
011DF1 C1                  A  6476    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 128


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  6477    ; 1567				
                           A  6478    ; 1568				pos = 0;
011DF2 DD36FF00            A  6479    	LD	(IX+-1),0
                           A  6480    ; 1569				memset(linbuf, 0, sizeof(li
011DF6 015A0000            A  6481    	LD	BC,90
011DFA C5                  A  6482    	PUSH	BC
011DFB 01000000            A  6483    	LD	BC,0
011DFF C5                  A  6484    	PUSH	BC
011E00 01 39 55 01         A  6485    	LD	BC,_linbuf
011E04 C5                  A  6486    	PUSH	BC
011E05 CD F7 25 01         A  6487    	CALL	_memset
011E09 C1                  A  6488    	POP	BC
011E0A C1                  A  6489    	POP	BC
011E0B C1                  A  6490    	POP	BC
                           A  6491    ; 1570				
                           A  6492    ; 1571				if ((BufferFile[i] == 0x0D)
011E0C DD07FC              A  6493    	LD	BC,(IX+-4)
011E0F 2A B1 55 01         A  6494    	LD	HL,(_BufferFile)
011E13 09                  A  6495    	ADD	HL,BC
011E14 7E                  A  6496    	LD	A,(HL)
011E15 47                  A  6497    	LD	B,A
011E16 17ED62              A  6498    	SEXT	HL
011E19 68                  A  6499    	LD	L,B
011E1A B7                  A  6500    	OR	A,A
011E1B 010D0000            A  6501    	LD	BC,13
011E1F ED42                A  6502    	SBC	HL,BC
011E21 20 21               A  6503    	JR	NZ,L_364
011E23 DD07FC              A  6504    	LD	BC,(IX+-4)
011E26 03                  A  6505    	INC	BC
011E27 2A B1 55 01         A  6506    	LD	HL,(_BufferFile)
011E2B 09                  A  6507    	ADD	HL,BC
011E2C 7E                  A  6508    	LD	A,(HL)
011E2D 47                  A  6509    	LD	B,A
011E2E 17ED62              A  6510    	SEXT	HL
011E31 68                  A  6511    	LD	L,B
011E32 B7                  A  6512    	OR	A,A
011E33 010A0000            A  6513    	LD	BC,10
011E37 ED42                A  6514    	SBC	HL,BC
011E39 20 09               A  6515    	JR	NZ,L_364
                           A  6516    ; 1572					i += 2;
011E3B DD31FC              A  6517    	LD	IY,(IX+-4)
011E3E ED3302              A  6518    	LEA	IY,IY+2
011E41 DD3EFC              A  6519    	LD	(IX+-4),IY
                           A  6520    ; 1573			}
                           A  6521    ; 1574		}	
011E44                     A  6522    L_364:
011E44 DD07FC              A  6523    	LD	BC,(IX+-4)
011E47 2A 9F 55 01         A  6524    	LD	HL,(_filesize)
011E4B B7                  A  6525    	OR	A,A
011E4C ED42                A  6526    	SBC	HL,BC
011E4E D2 F9 1C 01         A  6527    	JR	NC,L_365
                           A  6528    ; 1575		
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 129


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  6529    ; 1576		asm ("jp f_end");
011E52 C3 6A 1E 01         A  6530    jp f_end
                           A  6531    ; 1577		
                           A  6532    ; 1578		asm ("LoadError:");
011E56                     A  6533    LoadError:
                           A  6534    ; 1579		msg_window("Loading file", "File er
011E56 01 6A 2B 01         A  6535    	LD	BC,L__274
011E5A C5                  A  6536    	PUSH	BC
011E5B 01 76 2B 01         A  6537    	LD	BC,L__275
011E5F C5                  A  6538    	PUSH	BC
011E60 CD 52 20 01         A  6539    	CALL	_msg_window
011E64 C1                  A  6540    	POP	BC
011E65 C1                  A  6541    	POP	BC
                           A  6542    ; 1580		getch();	
011E66 CD 4D 01 01         A  6543    	CALL	_getch
                           A  6544    ; 1581		
                           A  6545    ; 1582		asm ("f_end:");
011E6A                     A  6546    f_end:
                           A  6547    ; 1583		
                           A  6548    ; 1584		close_msg_window();
011E6A CD 76 22 01         A  6549    	CALL	_close_msg_window
                           A  6550    ; 1585	}
011E6E DDF9                A  6551    	LD	SP,IX
011E70 DDE1                A  6552    	POP	IX
011E72 C9                  A  6553    	RET	
                           A  6554    
                           A  6555    
                           A  6556    ;**************************** _load_file ******
                           A  6557    ;Name                         Addr/Register   S
                           A  6558    ;_close_msg_window                   IMPORT  --
                           A  6559    ;_getch                              IMPORT  --
                           A  6560    ;_p_root                             STATIC    
                           A  6561    ;_tx_ins                             IMPORT  --
                           A  6562    ;_purify                             IMPORT  --
                           A  6563    ;_strlen                             IMPORT  --
                           A  6564    ;_filesize                           STATIC    
                           A  6565    ;_BufferFile                         STATIC    
                           A  6566    ;_linbuf                             STATIC    
                           A  6567    ;_memset                             IMPORT  --
                           A  6568    ;_msg_window                         IMPORT  --
                           A  6569    ;len                                   IX-5    
                           A  6570    ;i                                     IX-4    
                           A  6571    ;pos                                   IX-1    
                           A  6572    
                           A  6573    
                           A  6574    ; Stack Frame Size: 14 (bytes)
                           A  6575    ;       Spill Code: 0 (instruction)
                           A  6576    
                           A  6577    
                           A  6578    	SEGMENT STRSECT
012B4E                     A  6579    L__265:
012B4E 506C6561 73652077   A  6580    	DB	"Please wait..."
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 130


PC     Object              I  Line    Source C:\proted\Debug\main.src
012B56 6169742E 2E2E 
012B5C 00                  A  6581    	DB	0
012B5D                     A  6582    L__266:
012B5D 4C6F6164 696E6720   A  6583    	DB	"Loading file"
012B65 66696C65 
012B69 00                  A  6584    	DB	0
012B6A                     A  6585    L__274:
012B6A 46696C65 20657272   A  6586    	DB	"File error!"
012B72 6F7221 
012B75 00                  A  6587    	DB	0
012B76                     A  6588    L__275:
012B76 4C6F6164 696E6720   A  6589    	DB	"Loading file"
012B7E 66696C65 
012B82 00                  A  6590    	DB	0
                           A  6591    	SEGMENT CODE
                           A  6592    ; 1586	
                           A  6593    ; 1587	/* From text list create the file into 
                           A  6594    ; 1588	void save_file(void)
                           A  6595    ; 1589	{
011E73                     A  6596    _save_file:
011E73 21FAFFFF            A  6597    	LD	HL,-6
011E77 CD 39 25 01         A  6598    	CALL	__frameset
                           A  6599    ; 1590		p_line_t p_line = p_root->p_next;
011E7B FD2A 24 55 01       A  6600    	LD	IY,(_p_root)
011E80 FD0703              A  6601    	LD	BC,(IY+3)
011E83 DD0FFD              A  6602    	LD	(IX+-3),BC
                           A  6603    ; 1591		int slen;	
                           A  6604    ; 1592		
                           A  6605    ; 1593		
                           A  6606    ; 1594		if (UseFile == 0)
011E86 3A A5 55 01         A  6607    	LD	A,(_UseFile)
011E8A B7                  A  6608    	OR	A,A
011E8B 20 1B               A  6609    	JR	NZ,L_369
                           A  6610    ; 1595		{
                           A  6611    ; 1596			asm ("ld hl, (_NonameFile)");
011E8D 2A B4 55 01         A  6612    ld hl, (_NonameFile)
                           A  6613    ; 1597			asm ("ld (_K_xHL), hl");
011E91 22 99 55 01         A  6614    ld (_K_xHL), hl
                           A  6615    ; 1598			
                           A  6616    ; 1599			msg_window("Please wait, saving
011E95 ED4B B4 55 01       A  6617    	LD	BC,(_NonameFile)
011E9A C5                  A  6618    	PUSH	BC
011E9B 01 83 2B 01         A  6619    	LD	BC,L__280
011E9F C5                  A  6620    	PUSH	BC
011EA0 CD 52 20 01         A  6621    	CALL	_msg_window
011EA4 C1                  A  6622    	POP	BC
011EA5 C1                  A  6623    	POP	BC
                           A  6624    ; 1600		}
                           A  6625    ; 1601		else
011EA6 18 10               A  6626    	JR	L_370
011EA8                     A  6627    L_369:
                           A  6628    ; 1602			msg_window("Saving file", "Plea
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 131


PC     Object              I  Line    Source C:\proted\Debug\main.src
011EA8 01 97 2B 01         A  6629    	LD	BC,L__281
011EAC C5                  A  6630    	PUSH	BC
011EAD 01 A6 2B 01         A  6631    	LD	BC,L__282
011EB1 C5                  A  6632    	PUSH	BC
011EB2 CD 52 20 01         A  6633    	CALL	_msg_window
011EB6 C1                  A  6634    	POP	BC
011EB7 C1                  A  6635    	POP	BC
011EB8                     A  6636    L_370:
                           A  6637    ; 1603		
                           A  6638    ; 1604		asm ("push ix");
011EB8 DDE5                A  6639    push ix
                           A  6640    ; 1605		asm ("ld hl, (_K_xHL)");
011EBA 2A 99 55 01         A  6641    ld hl, (_K_xHL)
                           A  6642    ; 1606		asm ("ld a, kr_erase_file");
011EBE 3E0F                A  6643    ld a, kr_erase_file
                           A  6644    ; 1607		asm ("call.lil prose_kernal");
011EC0 5BCD200A 00         A  6645    call.lil prose_kernal
                           A  6646    ; 1608		asm ("pop ix");	
011EC5 DDE1                A  6647    pop ix
                           A  6648    ; 1609		
                           A  6649    ; 1610		asm ("push ix");
011EC7 DDE5                A  6650    push ix
                           A  6651    ; 1611		asm ("ld hl, (_K_xHL)");
011EC9 2A 99 55 01         A  6652    ld hl, (_K_xHL)
                           A  6653    ; 1612		asm ("ld a, kr_create_file");
011ECD 3E11                A  6654    ld a, kr_create_file
                           A  6655    ; 1613		asm ("call.lil prose_kernal");
011ECF 5BCD200A 00         A  6656    call.lil prose_kernal
                           A  6657    ; 1614		asm ("pop ix");
011ED4 DDE1                A  6658    pop ix
                           A  6659    ; 1615		asm ("jr nz, SaveError");	
011ED6 C2 8E 1F 01         A  6660    jr nz, SaveError
                           A  6661    ; 1616		
                           A  6662    ; 1617		filesize = 0;	
011EDA 01000000            A  6663    	LD	BC,0
011EDE ED43 9F 55 01       A  6664    	LD	(_filesize),BC
                           A  6665    ; 1618		
                           A  6666    ; 1619		while (p_line != p_root)
011EE3 18 73               A  6667    	JR	L_373
011EE5                     A  6668    L_374:
                           A  6669    ; 1620		{
                           A  6670    ; 1621			slen = strlen(p_line->p_data);
011EE5 DD31FD              A  6671    	LD	IY,(IX+-3)
011EE8 FD0706              A  6672    	LD	BC,(IY+6)
011EEB C5                  A  6673    	PUSH	BC
011EEC CD F6 24 01         A  6674    	CALL	_strlen
011EF0 C1                  A  6675    	POP	BC
011EF1 DD2FFA              A  6676    	LD	(IX+-6),HL
                           A  6677    ; 1622			
                           A  6678    ; 1623			if (slen > 0)
011EF4 E5C1                A  6679    	LD	BC,HL
011EF6 B7                  A  6680    	OR	A,A
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 132


PC     Object              I  Line    Source C:\proted\Debug\main.src
011EF7 ED62                A  6681    	SBC	HL,HL
011EF9 B7                  A  6682    	OR	A,A
011EFA ED42                A  6683    	SBC	HL,BC
011EFC F2 1D 1F 01         A  6684    	JP	P,L_372
                           A  6685    ; 1624				memmove(BufferFile + filesi
011F00 DD07FA              A  6686    	LD	BC,(IX+-6)
011F03 C5                  A  6687    	PUSH	BC
011F04 DD31FD              A  6688    	LD	IY,(IX+-3)
011F07 FD0706              A  6689    	LD	BC,(IY+6)
011F0A C5                  A  6690    	PUSH	BC
011F0B ED4B 9F 55 01       A  6691    	LD	BC,(_filesize)
011F10 2A B1 55 01         A  6692    	LD	HL,(_BufferFile)
011F14 09                  A  6693    	ADD	HL,BC
011F15 E5                  A  6694    	PUSH	HL
011F16 CD 18 26 01         A  6695    	CALL	_memmove
011F1A C1                  A  6696    	POP	BC
011F1B C1                  A  6697    	POP	BC
011F1C C1                  A  6698    	POP	BC
011F1D                     A  6699    L_372:
                           A  6700    ; 1625			
                           A  6701    ; 1626			filesize += slen;
011F1D DD07FA              A  6702    	LD	BC,(IX+-6)
011F20 2A 9F 55 01         A  6703    	LD	HL,(_filesize)
011F24 09                  A  6704    	ADD	HL,BC
011F25 22 9F 55 01         A  6705    	LD	(_filesize),HL
                           A  6706    ; 1627			
                           A  6707    ; 1628			BufferFile[filesize] = 0x0D;
011F29 ED4B 9F 55 01       A  6708    	LD	BC,(_filesize)
011F2E 2A B1 55 01         A  6709    	LD	HL,(_BufferFile)
011F32 09                  A  6710    	ADD	HL,BC
011F33 360D                A  6711    	LD	(HL),13
                           A  6712    ; 1629			BufferFile[filesize + 1] = 0x0A
011F35 ED4B 9F 55 01       A  6713    	LD	BC,(_filesize)
011F3A 03                  A  6714    	INC	BC
011F3B 2A B1 55 01         A  6715    	LD	HL,(_BufferFile)
011F3F 09                  A  6716    	ADD	HL,BC
011F40 360A                A  6717    	LD	(HL),10
                           A  6718    ; 1630			
                           A  6719    ; 1631			filesize += 2;
011F42 FD2A 9F 55 01       A  6720    	LD	IY,(_filesize)
011F47 ED0302              A  6721    	LEA	BC,IY+2
011F4A ED43 9F 55 01       A  6722    	LD	(_filesize),BC
                           A  6723    ; 1632			
                           A  6724    ; 1633			p_line = p_line->p_next;
011F4F DD31FD              A  6725    	LD	IY,(IX+-3)
011F52 FD0703              A  6726    	LD	BC,(IY+3)
011F55 DD0FFD              A  6727    	LD	(IX+-3),BC
                           A  6728    ; 1634		}
011F58                     A  6729    L_373:
011F58 DD07FD              A  6730    	LD	BC,(IX+-3)
011F5B 2A 24 55 01         A  6731    	LD	HL,(_p_root)
011F5F B7                  A  6732    	OR	A,A
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 133


PC     Object              I  Line    Source C:\proted\Debug\main.src
011F60 ED42                A  6733    	SBC	HL,BC
011F62 20 81               A  6734    	JR	NZ,L_374
                           A  6735    ; 1635		
                           A  6736    ; 1636		filesize -= 2;
011F64 FD2A 9F 55 01       A  6737    	LD	IY,(_filesize)
011F69 ED03FE              A  6738    	LEA	BC,IY+-2
011F6C ED43 9F 55 01       A  6739    	LD	(_filesize),BC
                           A  6740    ; 1637		
                           A  6741    ; 1638		asm ("push ix");
011F71 DDE5                A  6742    push ix
                           A  6743    ; 1639		asm ("ld hl, (_K_xHL)");
011F73 2A 99 55 01         A  6744    ld hl, (_K_xHL)
                           A  6745    ; 1640		asm ("ld de, (_BufferFile)");
011F77 ED5B B1 55 01       A  6746    ld de, (_BufferFile)
                           A  6747    ; 1641		asm ("ld bc, (_filesize)");
011F7C ED4B 9F 55 01       A  6748    ld bc, (_filesize)
                           A  6749    ; 1642		asm ("ld a, kr_write_file");
011F81 3E12                A  6750    ld a, kr_write_file
                           A  6751    ; 1643		asm ("call.lil prose_kernal");
011F83 5BCD200A 00         A  6752    call.lil prose_kernal
                           A  6753    ; 1644		asm ("pop ix");	
011F88 DDE1                A  6754    pop ix
                           A  6755    ; 1645		
                           A  6756    ; 1646		asm ("jp s_end");
011F8A C3 A2 1F 01         A  6757    jp s_end
                           A  6758    ; 1647		
                           A  6759    ; 1648		asm ("SaveError:");
011F8E                     A  6760    SaveError:
                           A  6761    ; 1649		msg_window("Saving file", "File err
011F8E 01 B2 2B 01         A  6762    	LD	BC,L__285
011F92 C5                  A  6763    	PUSH	BC
011F93 01 BE 2B 01         A  6764    	LD	BC,L__286
011F97 C5                  A  6765    	PUSH	BC
011F98 CD 52 20 01         A  6766    	CALL	_msg_window
011F9C C1                  A  6767    	POP	BC
011F9D C1                  A  6768    	POP	BC
                           A  6769    ; 1650		getch();	
011F9E CD 4D 01 01         A  6770    	CALL	_getch
                           A  6771    ; 1651		
                           A  6772    ; 1652		asm ("s_end:");
011FA2                     A  6773    s_end:
                           A  6774    ; 1653		close_msg_window();
011FA2 CD 76 22 01         A  6775    	CALL	_close_msg_window
                           A  6776    ; 1654	}
011FA6 DDF9                A  6777    	LD	SP,IX
011FA8 DDE1                A  6778    	POP	IX
011FAA C9                  A  6779    	RET	
                           A  6780    
                           A  6781    
                           A  6782    ;**************************** _save_file ******
                           A  6783    ;Name                         Addr/Register   S
                           A  6784    ;_close_msg_window                   IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 134


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  6785    ;_getch                              IMPORT  --
                           A  6786    ;_BufferFile                         STATIC    
                           A  6787    ;_memmove                            IMPORT  --
                           A  6788    ;_strlen                             IMPORT  --
                           A  6789    ;_filesize                           STATIC    
                           A  6790    ;_NonameFile                         STATIC    
                           A  6791    ;_msg_window                         IMPORT  --
                           A  6792    ;_UseFile                            STATIC    
                           A  6793    ;_p_root                             STATIC    
                           A  6794    ;slen                                  IX-6    
                           A  6795    ;p_line                                IX-3    
                           A  6796    
                           A  6797    
                           A  6798    ; Stack Frame Size: 12 (bytes)
                           A  6799    ;       Spill Code: 0 (instruction)
                           A  6800    
                           A  6801    
                           A  6802    	SEGMENT STRSECT
012B83                     A  6803    L__280:
012B83 506C6561 73652077   A  6804    	DB	"Please wait, saving"
012B8B 6169742C 20736176 
012B93 696E67 
012B96 00                  A  6805    	DB	0
012B97                     A  6806    L__281:
012B97 506C6561 73652077   A  6807    	DB	"Please wait..."
012B9F 6169742E 2E2E 
012BA5 00                  A  6808    	DB	0
012BA6                     A  6809    L__282:
012BA6 53617669 6E672066   A  6810    	DB	"Saving file"
012BAE 696C65 
012BB1 00                  A  6811    	DB	0
012BB2                     A  6812    L__285:
012BB2 46696C65 20657272   A  6813    	DB	"File error!"
012BBA 6F7221 
012BBD 00                  A  6814    	DB	0
012BBE                     A  6815    L__286:
012BBE 53617669 6E672066   A  6816    	DB	"Saving file"
012BC6 696C65 
012BC9 00                  A  6817    	DB	0
                           A  6818    	SEGMENT CODE
                           A  6819    ; 1655	
                           A  6820    ; 1656	/* Reload the file if exist */
                           A  6821    ; 1657	void reload_file(void)
                           A  6822    ; 1658	{
011FAB                     A  6823    _reload_file:
                           A  6824    ; 1659		if (UseFile == 1)
011FAB 3A A5 55 01         A  6825    	LD	A,(_UseFile)
011FAF FE01                A  6826    	CP	A,1
011FB1 C2 51 20 01         A  6827    	JR	NZ,L_382
                           A  6828    ; 1660			if (FileExists() == 1)
011FB5 CD 53 1C 01         A  6829    	CALL	_FileExists
011FB9 47                  A  6830    	LD	B,A
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 135


PC     Object              I  Line    Source C:\proted\Debug\main.src
011FBA 17ED62              A  6831    	SEXT	HL
011FBD 68                  A  6832    	LD	L,B
011FBE B7                  A  6833    	OR	A,A
011FBF 01010000            A  6834    	LD	BC,1
011FC3 ED42                A  6835    	SBC	HL,BC
011FC5 C2 51 20 01         A  6836    	JR	NZ,L_382
                           A  6837    ; 1661			{
                           A  6838    ; 1662				msg_window("Reload file ?",
011FC9 01 CA 2B 01         A  6839    	LD	BC,L__290
011FCD C5                  A  6840    	PUSH	BC
011FCE 01 CE 2B 01         A  6841    	LD	BC,L__291
011FD2 C5                  A  6842    	PUSH	BC
011FD3 CD 52 20 01         A  6843    	CALL	_msg_window
011FD7 C1                  A  6844    	POP	BC
011FD8 C1                  A  6845    	POP	BC
                           A  6846    ; 1663				getch();
011FD9 CD 4D 01 01         A  6847    	CALL	_getch
                           A  6848    ; 1664				close_msg_window();
011FDD CD 76 22 01         A  6849    	CALL	_close_msg_window
                           A  6850    ; 1665				
                           A  6851    ; 1666				if ((Ascii != 89) && (Ascii
011FE1 3A 93 55 01         A  6852    	LD	A,(_Ascii)
011FE5 FE59                A  6853    	CP	A,89
011FE7 28 08               A  6854    	JR	Z,L_379
011FE9 3A 93 55 01         A  6855    	LD	A,(_Ascii)
011FED FE79                A  6856    	CP	A,121
011FEF 20 60               A  6857    	JR	NZ,L_382
                           A  6858    ; 1667					return;
011FF1                     A  6859    L_379:
                           A  6860    ; 1668				
                           A  6861    ; 1669				sc_fin();
011FF1 CD E6 09 01         A  6862    	CALL	_sc_fin
                           A  6863    ; 1670				te_fin();
011FF5 CD 76 07 01         A  6864    	CALL	_te_fin
                           A  6865    ; 1671				
                           A  6866    ; 1672				memset(BufferFile, 0, 1024 
011FF9 01000008            A  6867    	LD	BC,524288
011FFD C5                  A  6868    	PUSH	BC
011FFE 01000000            A  6869    	LD	BC,0
012002 C5                  A  6870    	PUSH	BC
012003 ED4B B1 55 01       A  6871    	LD	BC,(_BufferFile)
012008 C5                  A  6872    	PUSH	BC
012009 CD F7 25 01         A  6873    	CALL	_memset
01200D C1                  A  6874    	POP	BC
01200E C1                  A  6875    	POP	BC
01200F C1                  A  6876    	POP	BC
                           A  6877    ; 1673				
                           A  6878    ; 1674				te_ini();
012010 CD 6C 07 01         A  6879    	CALL	_te_ini
                           A  6880    ; 1675				sc_ini();
012014 CD DD 09 01         A  6881    	CALL	_sc_ini
                           A  6882    ; 1676				tx_ini();			
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 136


PC     Object              I  Line    Source C:\proted\Debug\main.src
012018 CD EF 09 01         A  6883    	CALL	_tx_ini
                           A  6884    ; 1677				
                           A  6885    ; 1678				load_file();
01201C CD 7C 1C 01         A  6886    	CALL	_load_file
                           A  6887    ; 1679				
                           A  6888    ; 1680				cur_row = 0;
012020 01000000            A  6889    	LD	BC,0
012024 ED43 33 55 01       A  6890    	LD	(_cur_row),BC
                           A  6891    ; 1681				cur_col = 0;
012029 ED43 36 55 01       A  6892    	LD	(_cur_col),BC
                           A  6893    ; 1682				cur_line = 1;
01202E 01010000            A  6894    	LD	BC,1
012032 ED43 2D 55 01       A  6895    	LD	(_cur_line),BC
                           A  6896    ; 1683				cur_char = 1;
012037 ED43 30 55 01       A  6897    	LD	(_cur_char),BC
                           A  6898    ; 1684				p_curr = p_root->p_next;	01203C FD2A 24 55 01       A  6899    	LD	IY,(_p_root)
012041 FD0703              A  6900    	LD	BC,(IY+3)
012044 ED43 27 55 01       A  6901    	LD	(_p_curr),BC
                           A  6902    ; 1685		
                           A  6903    ; 1686				paintall();
012049 CD C2 16 01         A  6904    	CALL	_paintall
                           A  6905    ; 1687		
                           A  6906    ; 1688				sc_fup();
01204D CD C2 09 01         A  6907    	CALL	_sc_fup
                           A  6908    ; 1689			}
                           A  6909    ; 1690	}
012051                     A  6910    L_382:
012051 C9                  A  6911    	RET	
                           A  6912    
                           A  6913    
                           A  6914    ;**************************** _reload_file ****
                           A  6915    ;Name                         Addr/Register   S
                           A  6916    ;_sc_fup                             IMPORT  --
                           A  6917    ;_paintall                           IMPORT  --
                           A  6918    ;_p_curr                             STATIC    
                           A  6919    ;_p_root                             STATIC    
                           A  6920    ;_cur_char                           STATIC    
                           A  6921    ;_cur_line                           STATIC    
                           A  6922    ;_cur_col                            STATIC    
                           A  6923    ;_cur_row                            STATIC    
                           A  6924    ;_load_file                          IMPORT  --
                           A  6925    ;_tx_ini                             IMPORT  --
                           A  6926    ;_sc_ini                             IMPORT  --
                           A  6927    ;_te_ini                             IMPORT  --
                           A  6928    ;_BufferFile                         STATIC    
                           A  6929    ;_memset                             IMPORT  --
                           A  6930    ;_te_fin                             IMPORT  --
                           A  6931    ;_sc_fin                             IMPORT  --
                           A  6932    ;_Ascii                              STATIC    
                           A  6933    ;_close_msg_window                   IMPORT  --
                           A  6934    ;_getch                              IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 137


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  6935    ;_msg_window                         IMPORT  --
                           A  6936    ;_FileExists                         IMPORT  --
                           A  6937    ;_UseFile                            STATIC    
                           A  6938    
                           A  6939    
                           A  6940    ; Stack Frame Size: 6 (bytes)
                           A  6941    ;       Spill Code: 0 (instruction)
                           A  6942    
                           A  6943    
                           A  6944    	SEGMENT STRSECT
012BCA                     A  6945    L__290:
012BCA 592F6E              A  6946    	DB	"Y/n"
012BCD 00                  A  6947    	DB	0
012BCE                     A  6948    L__291:
012BCE 52656C6F 61642066   A  6949    	DB	"Reload file ?"
012BD6 696C6520 3F 
012BDB 00                  A  6950    	DB	0
                           A  6951    	SEGMENT CODE
                           A  6952    ; 1691	
                           A  6953    ; 1692	/* Draw on screen the message box width
                           A  6954    ; 1693	void msg_window(char *msg1, char *msg2)
                           A  6955    ; 1694	{
012052                     A  6956    _msg_window:
012052 21FCFFFF            A  6957    	LD	HL,-4
012056 CD 39 25 01         A  6958    	CALL	__frameset
                           A  6959    ; 1695		char r, c, len, posx;
                           A  6960    ; 1696	
                           A  6961    ; 1697		memset(backbuffer, 0, sizeof(backbu
01205A 01400100            A  6962    	LD	BC,320
01205E C5                  A  6963    	PUSH	BC
01205F 01000000            A  6964    	LD	BC,0
012063 C5                  A  6965    	PUSH	BC
012064 01 DB 53 01         A  6966    	LD	BC,_backbuffer
012068 C5                  A  6967    	PUSH	BC
012069 CD F7 25 01         A  6968    	CALL	_memset
01206D C1                  A  6969    	POP	BC
01206E C1                  A  6970    	POP	BC
01206F C1                  A  6971    	POP	BC
012070 DD36FE00            A  6972    	LD	(IX+-2),0
                           A  6973    ; 1698		
                           A  6974    ; 1699		for (r = 0; r < 4; r++)
012074 18 74               A  6975    	JR	L_390
012076                     A  6976    L_388:
012076 DD36FF00            A  6977    	LD	(IX+-1),0
                           A  6978    ; 1700			for (c = 0; c < SCNCOLS; c++)
01207A 18 58               A  6979    	JR	L_387
01207C                     A  6980    L_385:
                           A  6981    ; 1701				backbuffer[r][c] = scn_phys
01207C DD7EFE              A  6982    	LD	A,(IX+-2)
01207F 17ED62              A  6983    	SEXT	HL
012082 DD6EFE              A  6984    	LD	L,(IX+-2)
012085 E5FDE1              A  6985    	LD	IY,HL
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 138


PC     Object              I  Line    Source C:\proted\Debug\main.src
012088 ED0317              A  6986    	LEA	BC,IY+23
01208B C5E1                A  6987    	LD	HL,BC
01208D 29                  A  6988    	ADD	HL,HL
01208E 29                  A  6989    	ADD	HL,HL
01208F 09                  A  6990    	ADD	HL,BC
012090 29                  A  6991    	ADD	HL,HL
012091 29                  A  6992    	ADD	HL,HL
012092 29                  A  6993    	ADD	HL,HL
012093 29                  A  6994    	ADD	HL,HL
012094 DD7EFF              A  6995    	LD	A,(IX+-1)
012097 01 3B 44 01         A  6996    	LD	BC,_scn_phys
01209B 09                  A  6997    	ADD	HL,BC
01209C E5C1                A  6998    	LD	BC,HL
01209E 17ED62              A  6999    	SEXT	HL
0120A1 DD6EFF              A  7000    	LD	L,(IX+-1)
0120A4 DD7EFE              A  7001    	LD	A,(IX+-2)
0120A7 09                  A  7002    	ADD	HL,BC
0120A8 E5FDE1              A  7003    	LD	IY,HL
0120AB 17ED62              A  7004    	SEXT	HL
0120AE DD6EFE              A  7005    	LD	L,(IX+-2)
0120B1 DD7EFF              A  7006    	LD	A,(IX+-1)
0120B4 E5C1                A  7007    	LD	BC,HL
0120B6 C5E1                A  7008    	LD	HL,BC
0120B8 29                  A  7009    	ADD	HL,HL
0120B9 29                  A  7010    	ADD	HL,HL
0120BA 09                  A  7011    	ADD	HL,BC
0120BB 29                  A  7012    	ADD	HL,HL
0120BC 29                  A  7013    	ADD	HL,HL
0120BD 29                  A  7014    	ADD	HL,HL
0120BE 29                  A  7015    	ADD	HL,HL
0120BF 01 DB 53 01         A  7016    	LD	BC,_backbuffer
0120C3 09                  A  7017    	ADD	HL,BC
0120C4 E5C1                A  7018    	LD	BC,HL
0120C6 17ED62              A  7019    	SEXT	HL
0120C9 DD6EFF              A  7020    	LD	L,(IX+-1)
0120CC FD7E00              A  7021    	LD	A,(IY)
0120CF 09                  A  7022    	ADD	HL,BC
0120D0 77                  A  7023    	LD	(HL),A
0120D1 DD34FF              A  7024    	INC	(IX+-1)
0120D4                     A  7025    L_387:
0120D4 DD7EFF              A  7026    	LD	A,(IX+-1)
0120D7 FE50                A  7027    	CP	A,80
0120D9 FA E3 20 01         A  7028    	JP	M,L__311
0120DD EA 7C 20 01         A  7029    	JP	PE,L_385
0120E1 18 04               A  7030    	JR	L__312
0120E3                     A  7031    L__311:
0120E3 E2 7C 20 01         A  7032    	JP	PO,L_385
0120E7                     A  7033    L__312:
0120E7 DD34FE              A  7034    	INC	(IX+-2)
0120EA                     A  7035    L_390:
0120EA DD7EFE              A  7036    	LD	A,(IX+-2)
0120ED FE04                A  7037    	CP	A,4
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 139


PC     Object              I  Line    Source C:\proted\Debug\main.src
0120EF FA F9 20 01         A  7038    	JP	M,L__313
0120F3 EA 76 20 01         A  7039    	JP	PE,L_388
0120F7 18 04               A  7040    	JR	L__314
0120F9                     A  7041    L__313:
0120F9 E2 76 20 01         A  7042    	JP	PO,L_388
0120FD                     A  7043    L__314:
                           A  7044    ; 1702		
                           A  7045    ; 1703		Enable_Back_Color();
0120FD CD 56 19 01         A  7046    	CALL	_Enable_Back_Color
                           A  7047    ; 1704		
                           A  7048    ; 1705		gotoxy(0, 23);
012101 01170000            A  7049    	LD	BC,23
012105 C5                  A  7050    	PUSH	BC
012106 01000000            A  7051    	LD	BC,0
01210A C5                  A  7052    	PUSH	BC
01210B CD 23 03 01         A  7053    	CALL	_gotoxy
01210F C1                  A  7054    	POP	BC
012110 C1                  A  7055    	POP	BC
                           A  7056    ; 1706			
                           A  7057    ; 1707		len = strlen(msg1);
012111 DD0706              A  7058    	LD	BC,(IX+6)
012114 C5                  A  7059    	PUSH	BC
012115 CD F6 24 01         A  7060    	CALL	_strlen
012119 C1                  A  7061    	POP	BC
01211A DD75FD              A  7062    	LD	(IX+-3),L
                           A  7063    ; 1708		posx = 40 - (len / 2);
01211D DD7EFD              A  7064    	LD	A,(IX+-3)
012120 17ED62              A  7065    	SEXT	HL
012123 DD6EFD              A  7066    	LD	L,(IX+-3)
012126 01020000            A  7067    	LD	BC,2
01212A CD A4 25 01         A  7068    	CALL	__idivs
01212E 3E28                A  7069    	LD	A,40
012130 95                  A  7070    	SUB	A,L
012131 DD77FC              A  7071    	LD	(IX+-4),A
                           A  7072    ; 1709		
                           A  7073    ; 1710		print("+===========================
012134 01 DC 2B 01         A  7074    	LD	BC,L__297
012138 C5                  A  7075    	PUSH	BC
012139 CD 5A 02 01         A  7076    	CALL	_print
01213D C1                  A  7077    	POP	BC
                           A  7078    ; 1711		print("|");
01213E 01 2D 2C 01         A  7079    	LD	BC,L__298
012142 C5                  A  7080    	PUSH	BC
012143 CD 5A 02 01         A  7081    	CALL	_print
012147 C1                  A  7082    	POP	BC
012148 DD36FF01            A  7083    	LD	(IX+-1),1
                           A  7084    ; 1712		
                           A  7085    ; 1713		for (c = 1; c < posx - 1; c++)
01214C 18 0D               A  7086    	JR	L_395
01214E                     A  7087    L_393:
                           A  7088    ; 1714			print(" ");
01214E 01 2F 2C 01         A  7089    	LD	BC,L__299
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 140


PC     Object              I  Line    Source C:\proted\Debug\main.src
012152 C5                  A  7090    	PUSH	BC
012153 CD 5A 02 01         A  7091    	CALL	_print
012157 C1                  A  7092    	POP	BC
012158 DD34FF              A  7093    	INC	(IX+-1)
01215B                     A  7094    L_395:
01215B DD7EFC              A  7095    	LD	A,(IX+-4)
01215E 17ED62              A  7096    	SEXT	HL
012161 DD6EFC              A  7097    	LD	L,(IX+-4)
012164 E5C1                A  7098    	LD	BC,HL
012166 0B                  A  7099    	DEC	BC
012167 DD7EFF              A  7100    	LD	A,(IX+-1)
01216A 17ED62              A  7101    	SEXT	HL
01216D DD6EFF              A  7102    	LD	L,(IX+-1)
012170 B7                  A  7103    	OR	A,A
012171 ED42                A  7104    	SBC	HL,BC
012173 FA 7D 21 01         A  7105    	JP	M,L__315
012177 EA 4E 21 01         A  7106    	JP	PE,L_393
01217B 18 04               A  7107    	JR	L__316
01217D                     A  7108    L__315:
01217D E2 4E 21 01         A  7109    	JP	PO,L_393
012181                     A  7110    L__316:
                           A  7111    ; 1715		
                           A  7112    ; 1716		print(msg1);
012181 DD0706              A  7113    	LD	BC,(IX+6)
012184 C5                  A  7114    	PUSH	BC
012185 CD 5A 02 01         A  7115    	CALL	_print
012189 C1                  A  7116    	POP	BC
01218A DD7EFF              A  7117    	LD	A,(IX+-1)
01218D DD86FD              A  7118    	ADD	A,(IX+-3)
012190 DD77FE              A  7119    	LD	(IX+-2),A
                           A  7120    ; 1717		
                           A  7121    ; 1718		for (r = c + len; r < SCNCOLS - 1; 
012193 18 0D               A  7122    	JR	L_400
012195                     A  7123    L_398:
                           A  7124    ; 1719			print(" ");
012195 01 31 2C 01         A  7125    	LD	BC,L__301
012199 C5                  A  7126    	PUSH	BC
01219A CD 5A 02 01         A  7127    	CALL	_print
01219E C1                  A  7128    	POP	BC
01219F DD34FE              A  7129    	INC	(IX+-2)
0121A2                     A  7130    L_400:
0121A2 DD7EFE              A  7131    	LD	A,(IX+-2)
0121A5 FE4F                A  7132    	CP	A,79
0121A7 FA B1 21 01         A  7133    	JP	M,L__317
0121AB EA 95 21 01         A  7134    	JP	PE,L_398
0121AF 18 04               A  7135    	JR	L__318
0121B1                     A  7136    L__317:
0121B1 E2 95 21 01         A  7137    	JP	PO,L_398
0121B5                     A  7138    L__318:
                           A  7139    ; 1720		
                           A  7140    ; 1721		print("|");
0121B5 01 33 2C 01         A  7141    	LD	BC,L__303
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 141


PC     Object              I  Line    Source C:\proted\Debug\main.src
0121B9 C5                  A  7142    	PUSH	BC
0121BA CD 5A 02 01         A  7143    	CALL	_print
0121BE C1                  A  7144    	POP	BC
                           A  7145    ; 1722		
                           A  7146    ; 1723		len = strlen(msg2);
0121BF DD0709              A  7147    	LD	BC,(IX+9)
0121C2 C5                  A  7148    	PUSH	BC
0121C3 CD F6 24 01         A  7149    	CALL	_strlen
0121C7 C1                  A  7150    	POP	BC
0121C8 DD75FD              A  7151    	LD	(IX+-3),L
                           A  7152    ; 1724		posx = 40 - (len / 2);
0121CB DD7EFD              A  7153    	LD	A,(IX+-3)
0121CE 17ED62              A  7154    	SEXT	HL
0121D1 DD6EFD              A  7155    	LD	L,(IX+-3)
0121D4 01020000            A  7156    	LD	BC,2
0121D8 CD A4 25 01         A  7157    	CALL	__idivs
0121DC 3E28                A  7158    	LD	A,40
0121DE 95                  A  7159    	SUB	A,L
0121DF DD77FC              A  7160    	LD	(IX+-4),A
                           A  7161    ; 1725		print("|");
0121E2 01 35 2C 01         A  7162    	LD	BC,L__304
0121E6 C5                  A  7163    	PUSH	BC
0121E7 CD 5A 02 01         A  7164    	CALL	_print
0121EB C1                  A  7165    	POP	BC
0121EC DD36FF01            A  7166    	LD	(IX+-1),1
                           A  7167    ; 1726		
                           A  7168    ; 1727		for (c = 1; c < posx - 1; c++)
0121F0 18 0D               A  7169    	JR	L_405
0121F2                     A  7170    L_403:
                           A  7171    ; 1728			print(" ");
0121F2 01 37 2C 01         A  7172    	LD	BC,L__305
0121F6 C5                  A  7173    	PUSH	BC
0121F7 CD 5A 02 01         A  7174    	CALL	_print
0121FB C1                  A  7175    	POP	BC
0121FC DD34FF              A  7176    	INC	(IX+-1)
0121FF                     A  7177    L_405:
0121FF DD7EFC              A  7178    	LD	A,(IX+-4)
012202 17ED62              A  7179    	SEXT	HL
012205 DD6EFC              A  7180    	LD	L,(IX+-4)
012208 E5C1                A  7181    	LD	BC,HL
01220A 0B                  A  7182    	DEC	BC
01220B DD7EFF              A  7183    	LD	A,(IX+-1)
01220E 17ED62              A  7184    	SEXT	HL
012211 DD6EFF              A  7185    	LD	L,(IX+-1)
012214 B7                  A  7186    	OR	A,A
012215 ED42                A  7187    	SBC	HL,BC
012217 FA 21 22 01         A  7188    	JP	M,L__319
01221B EA F2 21 01         A  7189    	JP	PE,L_403
01221F 18 04               A  7190    	JR	L__320
012221                     A  7191    L__319:
012221 E2 F2 21 01         A  7192    	JP	PO,L_403
012225                     A  7193    L__320:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 142


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  7194    ; 1729		
                           A  7195    ; 1730		print(msg2);
012225 DD0709              A  7196    	LD	BC,(IX+9)
012228 C5                  A  7197    	PUSH	BC
012229 CD 5A 02 01         A  7198    	CALL	_print
01222D C1                  A  7199    	POP	BC
01222E DD7EFF              A  7200    	LD	A,(IX+-1)
012231 DD86FD              A  7201    	ADD	A,(IX+-3)
012234 DD77FE              A  7202    	LD	(IX+-2),A
                           A  7203    ; 1731		
                           A  7204    ; 1732		for (r = c + len; r < SCNCOLS - 1; 
012237 18 0D               A  7205    	JR	L_410
012239                     A  7206    L_408:
                           A  7207    ; 1733			print(" ");
012239 01 39 2C 01         A  7208    	LD	BC,L__307
01223D C5                  A  7209    	PUSH	BC
01223E CD 5A 02 01         A  7210    	CALL	_print
012242 C1                  A  7211    	POP	BC
012243 DD34FE              A  7212    	INC	(IX+-2)
012246                     A  7213    L_410:
012246 DD7EFE              A  7214    	LD	A,(IX+-2)
012249 FE4F                A  7215    	CP	A,79
01224B FA 55 22 01         A  7216    	JP	M,L__321
01224F EA 39 22 01         A  7217    	JP	PE,L_408
012253 18 04               A  7218    	JR	L__322
012255                     A  7219    L__321:
012255 E2 39 22 01         A  7220    	JP	PO,L_408
012259                     A  7221    L__322:
                           A  7222    ; 1734		
                           A  7223    ; 1735		print("|");
012259 01 3B 2C 01         A  7224    	LD	BC,L__309
01225D C5                  A  7225    	PUSH	BC
01225E CD 5A 02 01         A  7226    	CALL	_print
012262 C1                  A  7227    	POP	BC
                           A  7228    ; 1736		
                           A  7229    ; 1737		print("+===========================
012263 01 3D 2C 01         A  7230    	LD	BC,L__310
012267 C5                  A  7231    	PUSH	BC
012268 CD 5A 02 01         A  7232    	CALL	_print
01226C C1                  A  7233    	POP	BC
                           A  7234    ; 1738		
                           A  7235    ; 1739		Disable_Back_Color();
01226D CD 64 19 01         A  7236    	CALL	_Disable_Back_Color
                           A  7237    ; 1740	}
012271 DDF9                A  7238    	LD	SP,IX
012273 DDE1                A  7239    	POP	IX
012275 C9                  A  7240    	RET	
                           A  7241    
                           A  7242    
                           A  7243    ;**************************** _msg_window *****
                           A  7244    ;Name                         Addr/Register   S
                           A  7245    ;_Disable_Back_Color                 IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 143


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  7246    ;_print                              IMPORT  --
                           A  7247    ;_strlen                             IMPORT  --
                           A  7248    ;_gotoxy                             IMPORT  --
                           A  7249    ;_Enable_Back_Color                  IMPORT  --
                           A  7250    ;_scn_phys                           STATIC   4
                           A  7251    ;_backbuffer                         STATIC    
                           A  7252    ;_memset                             IMPORT  --
                           A  7253    ;posx                                  IX-4    
                           A  7254    ;len                                   IX-3    
                           A  7255    ;r                                     IX-2    
                           A  7256    ;c                                     IX-1    
                           A  7257    ;msg2                                  IX+9    
                           A  7258    ;msg1                                  IX+6    
                           A  7259    
                           A  7260    
                           A  7261    ; Stack Frame Size: 16 (bytes)
                           A  7262    ;       Spill Code: 0 (instruction)
                           A  7263    
                           A  7264    
                           A  7265    	SEGMENT STRSECT
012BDC                     A  7266    L__297:
012BDC 2B3D3D3D 3D3D3D3D   A  7267    	DB	"+==================================]PR
012BE4 3D3D3D3D 3D3D3D3D 
012BEC 3D3D3D3D 3D3D3D3D 
012BF4 3D3D3D3D 3D3D3D3D 
012BFC 3D3D3D5D 50524F54 
012C04 45445B3D 3D3D3D3D 
012C0C 3D3D3D3D 3D3D3D3D 
012C14 3D3D3D3D 3D3D3D3D 
012C1C 3D3D3D3D 3D3D3D3D 
012C24 3D3D3D3D 3D3D3D2B 
012C2C 00                  A  7268    	DB	0
012C2D                     A  7269    L__298:
012C2D 7C                  A  7270    	DB	"|"
012C2E 00                  A  7271    	DB	0
012C2F                     A  7272    L__299:
012C2F 20                  A  7273    	DB	" "
012C30 00                  A  7274    	DB	0
012C31                     A  7275    L__301:
012C31 20                  A  7276    	DB	" "
012C32 00                  A  7277    	DB	0
012C33                     A  7278    L__303:
012C33 7C                  A  7279    	DB	"|"
012C34 00                  A  7280    	DB	0
012C35                     A  7281    L__304:
012C35 7C                  A  7282    	DB	"|"
012C36 00                  A  7283    	DB	0
012C37                     A  7284    L__305:
012C37 20                  A  7285    	DB	" "
012C38 00                  A  7286    	DB	0
012C39                     A  7287    L__307:
012C39 20                  A  7288    	DB	" "
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 144


PC     Object              I  Line    Source C:\proted\Debug\main.src
012C3A 00                  A  7289    	DB	0
012C3B                     A  7290    L__309:
012C3B 7C                  A  7291    	DB	"|"
012C3C 00                  A  7292    	DB	0
012C3D                     A  7293    L__310:
012C3D 2B3D3D3D 3D3D3D3D   A  7294    	DB	"+=====================================
012C45 3D3D3D3D 3D3D3D3D 
012C4D 3D3D3D3D 3D3D3D3D 
012C55 3D3D3D3D 3D3D3D3D 
012C5D 3D3D3D3D 3D3D3D3D 
012C65 3D3D3D3D 3D3D3D3D 
012C6D 3D3D3D3D 3D3D3D3D 
012C75 3D3D3D3D 3D3D3D3D 
012C7D 3D3D3D3D 3D3D3D3D 
012C85 3D3D3D3D 3D3D3D2B 
012C8D 00                  A  7295    	DB	0
                           A  7296    	SEGMENT CODE
                           A  7297    ; 1741	
                           A  7298    ; 1742	/* Close the message box */
                           A  7299    ; 1743	void close_msg_window(void)
                           A  7300    ; 1744	{
012276                     A  7301    _close_msg_window:
012276 21FEFFFF            A  7302    	LD	HL,-2
01227A CD 39 25 01         A  7303    	CALL	__frameset
                           A  7304    ; 1745		register char r, c;
                           A  7305    ; 1746		
                           A  7306    ; 1747		Disable_Back_Color();
01227E CD 64 19 01         A  7307    	CALL	_Disable_Back_Color
012282 DD36FF00            A  7308    	LD	(IX+-1),0
                           A  7309    ; 1748		
                           A  7310    ; 1749		for (r = 0; r < 4; r++)
012286 18 5A               A  7311    	JR	L_420
012288                     A  7312    L_418:
012288 DD36FE00            A  7313    	LD	(IX+-2),0
                           A  7314    ; 1750			for (c = 0; c < SCNCOLS; c++)
01228C 18 3E               A  7315    	JR	L_417
01228E                     A  7316    L_415:
                           A  7317    ; 1751				plot_char(c, r + 23, backbu
01228E DD7EFF              A  7318    	LD	A,(IX+-1)
012291 17ED62              A  7319    	SEXT	HL
012294 DD6EFF              A  7320    	LD	L,(IX+-1)
012297 E5C1                A  7321    	LD	BC,HL
012299 C5E1                A  7322    	LD	HL,BC
01229B 29                  A  7323    	ADD	HL,HL
01229C 29                  A  7324    	ADD	HL,HL
01229D 09                  A  7325    	ADD	HL,BC
01229E 29                  A  7326    	ADD	HL,HL
01229F 29                  A  7327    	ADD	HL,HL
0122A0 29                  A  7328    	ADD	HL,HL
0122A1 29                  A  7329    	ADD	HL,HL
0122A2 01 DB 53 01         A  7330    	LD	BC,_backbuffer
0122A6 09                  A  7331    	ADD	HL,BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 145


PC     Object              I  Line    Source C:\proted\Debug\main.src
0122A7 E5C1                A  7332    	LD	BC,HL
0122A9 DD7EFE              A  7333    	LD	A,(IX+-2)
0122AC 17ED62              A  7334    	SEXT	HL
0122AF DD6EFE              A  7335    	LD	L,(IX+-2)
0122B2 09                  A  7336    	ADD	HL,BC
0122B3 4E                  A  7337    	LD	C,(HL)
0122B4 0600                A  7338    	LD	B,0
0122B6 C5                  A  7339    	PUSH	BC
0122B7 DD7EFF              A  7340    	LD	A,(IX+-1)
0122BA C617                A  7341    	ADD	A,23
0122BC 4F                  A  7342    	LD	C,A
0122BD C5                  A  7343    	PUSH	BC
0122BE DD4EFE              A  7344    	LD	C,(IX+-2)
0122C1 C5                  A  7345    	PUSH	BC
0122C2 CD A8 02 01         A  7346    	CALL	_plot_char
0122C6 C1                  A  7347    	POP	BC
0122C7 C1                  A  7348    	POP	BC
0122C8 C1                  A  7349    	POP	BC
0122C9 DD34FE              A  7350    	INC	(IX+-2)
0122CC                     A  7351    L_417:
0122CC DD7EFE              A  7352    	LD	A,(IX+-2)
0122CF FE50                A  7353    	CP	A,80
0122D1 FA DB 22 01         A  7354    	JP	M,L__326
0122D5 EA 8E 22 01         A  7355    	JP	PE,L_415
0122D9 18 04               A  7356    	JR	L__327
0122DB                     A  7357    L__326:
0122DB E2 8E 22 01         A  7358    	JP	PO,L_415
0122DF                     A  7359    L__327:
0122DF DD34FF              A  7360    	INC	(IX+-1)
0122E2                     A  7361    L_420:
0122E2 DD7EFF              A  7362    	LD	A,(IX+-1)
0122E5 FE04                A  7363    	CP	A,4
0122E7 FA F1 22 01         A  7364    	JP	M,L__328
0122EB EA 88 22 01         A  7365    	JP	PE,L_418
0122EF 18 04               A  7366    	JR	L__329
0122F1                     A  7367    L__328:
0122F1 E2 88 22 01         A  7368    	JP	PO,L_418
0122F5                     A  7369    L__329:
0122F5 DDF9                A  7370    	LD	SP,IX
0122F7 DDE1                A  7371    	POP	IX
0122F9 C9                  A  7372    	RET	
                           A  7373    
                           A  7374    
                           A  7375    ;**************************** _close_msg_window
                           A  7376    ;Name                         Addr/Register   S
                           A  7377    ;_backbuffer                         STATIC    
                           A  7378    ;_plot_char                          IMPORT  --
                           A  7379    ;_Disable_Back_Color                 IMPORT  --
                           A  7380    ;c                                     IX-2    
                           A  7381    ;r                                     IX-1    
                           A  7382    
                           A  7383    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 146


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  7384    ; Stack Frame Size: 8 (bytes)
                           A  7385    ;       Spill Code: 0 (instruction)
                           A  7386    
                           A  7387    
                           A  7388    	XREF _strlen:ROM
                           A  7389    	XREF _memmove:ROM
                           A  7390    	XREF _memset:ROM
                           A  7391    	XREF _memcmp:ROM
                           A  7392    	XREF _strcpy:ROM
                           A  7393    	XREF _malloc:ROM
                           A  7394    	XREF _free:ROM
                           A  7395    	XREF __idivs:ROM
                           A  7396    	XREF __idivu:ROM
                           A  7397    	XREF __irems:ROM
                           A  7398    	XREF __iremu:ROM
                           A  7399    	XREF __frameset0:ROM
                           A  7400    	XREF __frameset:ROM
                           A  7401    	XDEF _close_msg_window
                           A  7402    	XDEF _msg_window
                           A  7403    	XDEF _reload_file
                           A  7404    	XDEF _save_file
                           A  7405    	XDEF _load_file
                           A  7406    	XDEF _FileExists
                           A  7407    	XDEF _Show_Cursor_Position
                           A  7408    	XDEF _edit
                           A  7409    	XDEF _Disable_Back_Color
                           A  7410    	XDEF _Enable_Back_Color
                           A  7411    	XDEF _ShowInsertMode
                           A  7412    	XDEF _ShowMenu
                           A  7413    	XDEF _Show_Cursor
                           A  7414    	XDEF _paintrow
                           A  7415    	XDEF _paintall
                           A  7416    	XDEF _do_ins
                           A  7417    	XDEF _do_endline
                           A  7418    	XDEF _do_home
                           A  7419    	XDEF _do_enhanced_del
                           A  7420    	XDEF _do_del
                           A  7421    	XDEF _do_dln
                           A  7422    	XDEF _do_iln
                           A  7423    	XDEF _do_dch
                           A  7424    	XDEF _do_chr
                           A  7425    	XDEF _do_bot
                           A  7426    	XDEF _do_top
                           A  7427    	XDEF _do_tab
                           A  7428    	XDEF _do_enhanced_ret
                           A  7429    	XDEF _do_ret
                           A  7430    	XDEF _do_pup
                           A  7431    	XDEF _do_pdw
                           A  7432    	XDEF _do_crt
                           A  7433    	XDEF _do_clf
                           A  7434    	XDEF _do_cdw
                           A  7435    	XDEF _do_cup
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 147


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  7436    	XDEF _do_red
                           A  7437    	XDEF _tx_put
                           A  7438    	XDEF _tx_get
                           A  7439    	XDEF _tx_del
                           A  7440    	XDEF _tx_ins
                           A  7441    	XDEF _tx_set
                           A  7442    	XDEF _tx_ini
                           A  7443    	XDEF _sc_fin
                           A  7444    	XDEF _sc_ini
                           A  7445    	XDEF _sc_fup
                           A  7446    	XDEF _sc_upd
                           A  7447    	XDEF _sc_str
                           A  7448    	XDEF _sc_chr
                           A  7449    	XDEF _sc_crw
                           A  7450    	XDEF _sc_clr
                           A  7451    	XDEF _te_fin
                           A  7452    	XDEF _te_ini
                           A  7453    	XDEF _te_clr
                           A  7454    	XDEF _te_cln
                           A  7455    	XDEF _te_mov
                           A  7456    	XDEF _te_str
                           A  7457    	XDEF _te_chr
                           A  7458    	XDEF _te_gch
                           A  7459    	XDEF _te_flu
                           A  7460    	XDEF _purify
                           A  7461    	XDEF _zap_trail
                           A  7462    	XDEF _blankrow
                           A  7463    	XDEF _mymalloc
                           A  7464    	XDEF _uitoa
                           A  7465    	XDEF _as
                           A  7466    	XDEF _bomb
                           A  7467    	XDEF _get_display_size
                           A  7468    	XDEF _get_prose_version
                           A  7469    	XDEF _gotoxy
                           A  7470    	XDEF _clreol
                           A  7471    	XDEF _plot_char
                           A  7472    	XDEF _get_cursor_position
                           A  7473    	XDEF _print
                           A  7474    	XDEF _getch
                           A  7475    	XDEF _GetCh
                           A  7476    	XDEF _main
                           A  7477    	XDEF _convBuf
                           A  7478    	XDEF _UseFile
                           A  7479    	XDEF _BufferFile
                           A  7480    	XDEF _filesize
                           A  7481    	XDEF _K_xBC
                           A  7482    	XDEF _K_xHL
                           A  7483    	XDEF _linbuf
                           A  7484    	XDEF _cur_col
                           A  7485    	XDEF _cur_row
                           A  7486    	XDEF _cur_char
                           A  7487    	XDEF _cur_line
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED21-Jul-11     13:54:37     page: 148


PC     Object              I  Line    Source C:\proted\Debug\main.src
                           A  7488    	XDEF _numlines
                           A  7489    	XDEF _p_curr
                           A  7490    	XDEF _p_root
                           A  7491    	XDEF _root
                           A  7492    	XDEF _backbuffer
                           A  7493    	XDEF _scn_phys
                           A  7494    	XDEF _scn_virt
                           A  7495    	XDEF _tebuflen
                           A  7496    	END


Errors: 0
Warnings: 0
Lines Assembled: 7497
