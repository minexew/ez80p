Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:   1


PC     Object              I  Line    Source 
                           A     1    ; Zilog eZ80 ANSI C Compiler Release 3.3
                           A     2    ; -nomodsect -optspeed -noreduceopt -peephole -
                           A     3    ; -localcse -const=ROM 
                           A     4    	FILE	"..\MAIN.C"
                           A     5    	.assume ADL=1
                           A     6    	SEGMENT BSS
012C7A                     A     7    _tebuflen:
012C7A                     A     8    	DS	3
012C7D                     A     9    _tebuf:
012C7D                     A    10    	DS	2058
013487                     A    11    _scn_virt:
013487                     A    12    	DS	4000
014427                     A    13    _scn_phys:
014427                     A    14    	DS	4000
0153C7                     A    15    _backbuffer:
0153C7                     A    16    	DS	320
015507                     A    17    _root:
015507                     A    18    	DS	9
015510                     A    19    _p_root:
015510                     A    20    	DS	3
015513                     A    21    _p_curr:
015513                     A    22    	DS	3
015516                     A    23    _numlines:
015516                     A    24    	DS	3
015519                     A    25    _cur_line:
015519                     A    26    	DS	3
01551C                     A    27    _cur_char:
01551C                     A    28    	DS	3
01551F                     A    29    _cur_row:
01551F                     A    30    	DS	3
015522                     A    31    _cur_col:
015522                     A    32    	DS	3
015525                     A    33    _linbuf:
015525                     A    34    	DS	90
01557F                     A    35    _Ascii:
01557F                     A    36    	DS	1
015580                     A    37    _Scancode:
015580                     A    38    	DS	1
015581                     A    39    _B:
015581                     A    40    	DS	1
015582                     A    41    _C:
015582                     A    42    	DS	1
015583                     A    43    _E:
015583                     A    44    	DS	1
015584                     A    45    _InsertMode:
015584                     A    46    	DS	1
015585                     A    47    _K_xHL:
015585                     A    48    	DS	3
015588                     A    49    _K_xBC:
015588                     A    50    	DS	3
01558B                     A    51    _filesize:
01558B                     A    52    	DS	3
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:   2


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01558E                     A    53    _mlen:
01558E                     A    54    	DS	3
                           A    55    	SEGMENT DATA
0155A3                     A    56    _BufferFile:
0155A3 0000C0              A    57    	DW24	12582912
                           A    58    	SEGMENT BSS
015591                     A    59    _TxtPnt:
015591                     A    60    	DS	3
015594                     A    61    _pMem:
015594                     A    62    	DS	3
                           A    63    	SEGMENT STRSECT
012664                     A    64    L__0:
012664 6E6F6E61 6D652E74   A    65    	DB	"noname.txt"
01266C 7874 
01266E 00                  A    66    	DB	0
                           A    67    	SEGMENT DATA
0155A6                     A    68    _NonameFile:
0155A6 642601              A    69    	DW24	L__0
                           A    70    	SEGMENT BSS
015597                     A    71    _UseFile:
015597                     A    72    	DS	1
015598                     A    73    _convBuf:
015598                     A    74    	DS	5
                           A    75    ;    1	/*
                           A    76    ;    2		PROTED: PROse Text eDitor
                           A    77    ;    3		
                           A    78    ;    4		coded by Calogiuri Enzo Antonio for
                           A    79    ;    5	*/
                           A    80    ;    6	
                           A    81    ;    7	#include <stdio.h>
                           A    82    ;    8	#include <stdlib.h>
                           A    83    ;    9	#include <string.h>
                           A    84    ;   10	#include <stddef.h>
                           A    85    ;   11	
                           A    86    ;   12	#include "PROSE_Header.h"
                           A    87    ;   13	
                           A    88    ;   14	#define TEBUFMAX		2048			                           A    89    ;   15	#define MAXLNLEN		80				                           A    90    ;   16	#define SCNROWS			50				                           A    91    ;   17	#define SCNCOLS			80				                           A    92    ;   18	#define VERSION			"1.2"			                           A    93    ;   19	#define FUDGE			10
                           A    94    ;   20	#define FALSE			0
                           A    95    ;   21	#define TRUE			1
                           A    96    ;   22	#define SCNSIZE 		(SCNROWS * SCNC
                           A    97    ;   23	
                           A    98    ;   24	#define EOS 			'\0'
                           A    99    ;   25	#define EOL 			'\n'
                           A   100    ;   26	#define CH_TAB 			9
                           A   101    ;   27	
                           A   102    ;   28	int tebuflen;
                           A   103    ;   29	static char tebuf[TEBUFMAX + FUDGE];
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:   3


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A   104    ;   30	char scn_virt[SCNROWS][SCNCOLS];
                           A   105    ;   31	char scn_phys[SCNROWS][SCNCOLS];
                           A   106    ;   32	char backbuffer[4][SCNCOLS];
                           A   107    ;   33	
                           A   108    ;   34	typedef struct line_t_ line_t;
                           A   109    ;   35	#define p_line_t line_t *
                           A   110    ;   36	struct line_t_
                           A   111    ;   37	 {
                           A   112    ;   38	   p_line_t 	p_prev;					                           A   113    ;   39	   p_line_t 	p_next;					                           A   114    ;   40	   char   		*p_data; 				                           A   115    ;   41	 };
                           A   116    ;   42	 
                           A   117    ;   43	line_t root;							                           A   118    ;   44	p_line_t p_root;						                           A   119    ;   45	p_line_t p_curr;						                           A   120    ;   46	int numlines, cur_line, cur_char, cur_r
                           A   121    ;   47	char linbuf[MAXLNLEN+FUDGE]; 
                           A   122    ;   48	
                           A   123    ;   49	static unsigned char Ascii, Scancode, B
                           A   124    ;   50	unsigned int K_xHL, K_xBC, filesize, ml
                           A   125    ;   51	char *BufferFile = (char *)0x0C00000;	                           A   126    ;   52	static char *TxtPnt, *pMem;
                           A   127    ;   53	static char *NonameFile = "noname.txt";
                           A   128    ;   54	char UseFile;
                           A   129    ;   55	
                           A   130    ;   56	void GetCh(void);
                           A   131    ;   57	unsigned char getch(void);
                           A   132    ;   58	void print(const char *Txt);
                           A   133    ;   59	void get_cursor_position(unsigned char 
                           A   134    ;   60	void plot_char(unsigned char x, unsigne
                           A   135    ;   61	void clreol(void);
                           A   136    ;   62	void gotoxy(unsigned char x, unsigned c
                           A   137    ;   63	int get_prose_version(void);
                           A   138    ;   64	void set_display_size(void);
                           A   139    ;   65	
                           A   140    ;   66	void uitoa(unsigned int val, char *stri
                           A   141    ;   67	char convBuf[5];
                           A   142    	SEGMENT CODE
                           A   143    ;   68	
                           A   144    ;   69	void ShowMenu(void);
                           A   145    ;   70	void ShowInsertMode(void);
                           A   146    ;   71	void Enable_Back_Color(void);
                           A   147    ;   72	void Disable_Back_Color(void);
                           A   148    ;   73	void Show_Cursor(void);
                           A   149    ;   74	void Show_Cursor_Position(void);
                           A   150    ;   75	
                           A   151    ;   76	char FileExists(void);
                           A   152    ;   77	void load_file(void);
                           A   153    ;   78	void save_file(void);
                           A   154    ;   79	void reload_file(void);
                           A   155    ;   80	
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:   4


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A   156    ;   81	void msg_window(char *msg1, char *msg2)
                           A   157    ;   82	void close_msg_window(void);
                           A   158    ;   83	
                           A   159    ;   84	/*-------------------------------------
                           A   160    ;   85	
                           A   161    ;   86	void bomb(char *txt);
                           A   162    ;   87	void as(char b, char *txt);
                           A   163    ;   88	void *mymalloc(size_t n);
                           A   164    ;   89	char blankrow(char *p);
                           A   165    ;   90	void zap_trail(char *s);
                           A   166    ;   91	void purify(char *st);
                           A   167    ;   92	void te_flu(void);
                           A   168    ;   93	unsigned char te_gch(void);
                           A   169    ;   94	void te_chr(char ch);
                           A   170    ;   95	void te_str(char *s);
                           A   171    ;   96	void te_mov(unsigned char r, unsigned c
                           A   172    ;   97	void te_cln(unsigned char row);
                           A   173    ;   98	void te_clr(void);
                           A   174    ;   99	void te_ini(void);
                           A   175    ;  100	void te_fin(void);
                           A   176    ;  101	
                           A   177    ;  102	void sc_clr(void);
                           A   178    ;  103	void sc_crw(unsigned char row);
                           A   179    ;  104	void sc_chr(unsigned char row, unsigned
                           A   180    ;  105	void sc_str(unsigned char row, unsigned
                           A   181    ;  106	void sc_upd(void);
                           A   182    ;  107	void sc_fup(void);
                           A   183    ;  108	void sc_ini(void);
                           A   184    ;  109	void sc_fin(void);
                           A   185    ;  110	
                           A   186    ;  111	void tx_ini(void);
                           A   187    ;  112	void tx_set(p_line_t p_line, char *s);
                           A   188    ;  113	void tx_ins(p_line_t p_line, char *s);
                           A   189    ;  114	void tx_del(p_line_t p_line);
                           A   190    ;  115	void tx_get(p_line_t p_line);
                           A   191    ;  116	void tx_put(p_line_t p_line);
                           A   192    ;  117	
                           A   193    ;  118	void do_red(void);
                           A   194    ;  119	void do_cup(void);
                           A   195    ;  120	void do_cdw(void);
                           A   196    ;  121	void do_clf(void);
                           A   197    ;  122	void do_crt(void);
                           A   198    ;  123	void do_pdw(void);
                           A   199    ;  124	void do_pup(void);
                           A   200    ;  125	void do_ret(void);
                           A   201    ;  126	void do_enhanced_ret(void);
                           A   202    ;  127	void do_tab(void);
                           A   203    ;  128	void do_top(void);
                           A   204    ;  129	void do_bot(char paint);
                           A   205    ;  130	void do_chr(char ch);
                           A   206    ;  131	void do_dch(void);
                           A   207    ;  132	void do_iln(void);
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:   5


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A   208    ;  133	void do_dln(void);
                           A   209    ;  134	void do_del(void);
                           A   210    ;  135	void do_enhanced_del(void);
                           A   211    ;  136	void do_home(void);
                           A   212    ;  137	void do_endline(void);
                           A   213    ;  138	void do_ins(void);
                           A   214    ;  139	
                           A   215    ;  140	void paintall(void);
                           A   216    ;  141	void paintrow(void);
                           A   217    ;  142	
                           A   218    ;  143	void edit(void);
                           A   219    ;  144	
                           A   220    ;  145	/*-------------------------------------
                           A   221    ;  146	void main(void)
                           A   222    ;  147	{
010000                     A   223    _main:
                           A   224    ;  148		INIT_HARDWARE;
       0000009A            A   225    PB_DR		equ 09Ah
       0000009B            A   226    PB_DDR		equ 09Bh
       0000009C            A   227    PB_ALT1		equ 09Ch
       0000009D            A   228    PB_ALT2		equ 09Dh
       0000009E            A   229    PC_DR		equ 09Eh
       0000009F            A   230    PC_DDR		equ 09Fh
       000000A0            A   231    PC_ALT1		equ 0A0h
       000000A1            A   232    PC_ALT2		equ 0A1h
       000000A2            A   233    PD_DR		equ 0A2h
       000000A3            A   234    PD_DDR		equ 0A3h
       000000A4            A   235    PD_ALT1		equ 0A4h
       000000A5            A   236    PD_ALT2		equ 0A5h
       000000C0            A   237    UART0_RBR	equ 0C0h
       000000C0            A   238    UART0_THR	equ 0C0h
       000000C0            A   239    UART0_BRG_L	equ 0C0h
       000000C1            A   240    UART0_BRG_H	equ 0C1h
       000000C1            A   241    UART0_IER	equ 0C1h
       000000C2            A   242    UART0_FCTL	equ 0C2h
       000000C3            A   243    UART0_LCTL	equ 0C3h
       000000C4            A   244    UART0_MCTL	equ 0C4h
       000000C5            A   245    UART0_LSR	equ 0C5h
       000000C6            A   246    UART0_MSR	equ 0C6h
       000000A8            A   247    CS0_LBR		equ 0A8h
       000000A9            A   248    CS0_UBR		equ 0A9h
       000000AA            A   249    CS0_CTL		equ 0AAh
       000000AB            A   250    CS1_LBR		equ 0ABh
       000000AC            A   251    CS1_UBR		equ 0ACh
       000000AD            A   252    CS1_CTL		equ 0ADh
       000000AE            A   253    CS2_LBR		equ 0AEh
       000000AF            A   254    CS2_UBR		equ 0AFh
       000000B0            A   255    CS2_CTL		equ 0B0h
       000000B1            A   256    CS3_LBR		equ 0B1h
       000000B2            A   257    CS3_UBR		equ 0B2h
       000000B3            A   258    CS3_CTL		equ 0B3h
       00000080            A   259    TMR0_CTL		equ 080h
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:   6


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
       00000081            A   260    TMR0_DR_L	equ 081h
       00000081            A   261    TMR0_RR_L	equ 081h
       00000082            A   262    TMR0_DR_H	equ 082h
       00000082            A   263    TMR0_RR_H	equ 082h
       00000092            A   264    TMR_ISS		equ 092h
       000000ED            A   265    RTC_CTRL		equ 0EDh
       000000EC            A   266    RTC_ACTRL	equ 0ECh
       000000E0            A   267    RTC_SEC		equ 0E0h
       000000E1            A   268    RTC_MIN		equ 0E1h
       000000E2            A   269    RTC_HRS		equ 0E2h
       000000E3            A   270    RTC_DOW		equ 0E3h
       000000E4            A   271    RTC_DOM		equ 0E4h
       000000E5            A   272    RTC_MON		equ 0E5h
       000000E6            A   273    RTC_YR		equ 0E6h
       000000E7            A   274    RTC_CEN		equ 0E7h
       00000000            A   275    port_pic_data		equ 000h
       00000001            A   276    port_pic_ctrl		equ 001h
       00000001            A   277    port_hw_flags		equ 001h
       00000002            A   278    port_sdc_ctrl		equ 002h
       00000002            A   279    port_keyboard_data	equ 002h
       00000003            A   280    port_sdc_data		equ 003h
       00000004            A   281    port_memory_paging	equ 004h
       00000005            A   282    port_irq_ctrl		equ 005h
       00000006            A   283    port_nmi_ack			equ 006h
       00000007            A   284    port_ps2_ctrl		equ 007h
       00000008            A   285    port_selector		equ 008h
       00000006            A   286    port_mouse_data		equ 006h
       00000009            A   287    port_clear_flags		equ 009h
       00000000            A   288    sdc_power			equ 0h
       00000001            A   289    sdc_cs				equ 1h
       00000002            A   290    sdc_speed			equ 2h
       00000004            A   291    sdc_serializer_busy	equ 4h
       00000005            A   292    vrt					equ 5h
       00000000            A   293    sysram_addr			equ 0000000h
       00800000            A   294    vram_a_addr			equ 0800000h
       00C00000            A   295    vram_b_addr			equ 0C00000h
       00FF0000            A   296    hw_palette			equ 0ff0000h
       00FF0800            A   297    hw_sprite_registers	equ 0ff0800h
       00FF1000            A   298    hw_video_parameters	equ 0ff1000h
       00FF1400            A   299    hw_audio_registers	equ 0ff1400h
       00FF1800            A   300    hw_video_settings	equ 0ff1800h
       00FF1000            A   301    tilemap_parameters	equ hw_video_parameters + 0
       00FF1020            A   302    bitmap_parameters	equ hw_video_parameters + 2
       00FF1800            A   303    video_control		equ hw_video_settings + 00h
       00FF1801            A   304    sprite_control		equ hw_video_settings + 01h
       00FF1802            A   305    bgnd_palette_select	equ hw_video_settings + 02h
       00FF1803            A   306    sprite_palette_select	equ hw_video_settings +
       00FF1804            A   307    right_border_position	equ hw_video_settings +
       00000A00            A   308    os_start			equ 0A00h
       00000A14            A   309    prose_return		equ os_start + 14h
       00000A20            A   310    prose_kernal		equ os_start + 20h
                           A   311    ;  149		INIT_KJT;
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:   7


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
       00000000            A   312    kr_mount_volumes			equ 00h
       00000001            A   313    kr_get_device_info		equ 01h
       00000002            A   314    kr_check_volume_format	equ 02h
       00000003            A   315    kr_change_volume			equ 03h
       00000004            A   316    kr_get_volume_info		equ 04h
       00000005            A   317    kr_format_device			equ 05h
       00000006            A   318    kr_make_dir				equ 06h
       00000007            A   319    kr_change_dir			equ 07h
       00000008            A   320    kr_parent_dir			equ 08h
       00000009            A   321    kr_root_dir				equ 09h
       0000000A            A   322    kr_delete_dir			equ 0Ah
       0000000B            A   323    kr_find_file				equ 0Bh
       0000000C            A   324    kr_set_file_pointer		equ 0Ch
       0000000D            A   325    kr_set_load_length		equ 0Dh
       0000000E            A   326    kr_read_file				equ 0Eh
       0000000F            A   327    kr_erase_file			equ 0Fh
       00000010            A   328    kr_rename_file			equ 10h
       00000011            A   329    kr_create_file			equ 11h
       00000012            A   330    kr_write_file			equ 12h
       00000013            A   331    kr_get_total_sectors		equ 13h
       00000014            A   332    kr_dir_list_first_entry	equ 14h
       00000015            A   333    kr_dir_list_get_entry	equ 15h
       00000016            A   334    kr_dir_list_next_entry	equ 16h
       00000017            A   335    kr_read_sector			equ 17h
       00000018            A   336    kr_write_sector			equ 18h
       00000019            A   337    kr_file_sector_list		equ 19h
       0000001A            A   338    kr_get_dir_cluster		equ 1Ah
       0000001B            A   339    kr_set_dir_cluster		equ 1Bh
       0000001C            A   340    kr_get_dir_name			equ 1Ch
       0000001D            A   341    kr_wait_key				equ 1Dh
       0000001E            A   342    kr_get_key				equ 1Eh
       0000001F            A   343    kr_get_key_mod_flags		equ 1Fh
       00000020            A   344    kr_serial_receive_header	equ 20h
       00000021            A   345    kr_serial_receive_file	equ 21h
       00000022            A   346    kr_serial_send_file		equ 22h
       00000023            A   347    kr_serial_tx_byte		equ 23h
       00000024            A   348    kr_serial_rx_byte		equ 24h
       00000025            A   349    kr_print_string			equ 25h
       00000026            A   350    kr_clear_screen			equ 26h
       00000027            A   351    kr_wait_vrt				equ 27h
       00000028            A   352    kr_set_cursor_position	equ 28h
       00000029            A   353    kr_plot_char				equ 29h
       0000002A            A   354    kr_set_pen				equ 2Ah
       0000002B            A   355    kr_background_colours	equ 2Bh
       0000002C            A   356    kr_draw_cursor			equ 2Ch
       0000002D            A   357    kr_get_pen				equ 2Dh
       0000002E            A   358    kr_scroll_up				equ 2Eh
       0000002F            A   359    kr_os_display			equ 2Fh
       00000030            A   360    kr_get_display_size		equ 30h
       00000031            A   361    kr_get_charmap_addr_xy	equ 31h
       00000032            A   362    kr_get_cursor_position	equ 32h
       00000033            A   363    kr_set_envar				equ 33h
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:   8


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
       00000034            A   364    kr_get_envar				equ 34h
       00000035            A   365    kr_delete_envar			equ 35h
       00000036            A   366    kr_set_mouse_window		equ 36h
       00000037            A   367    kr_get_mouse_position	equ 37h
       00000038            A   368    kr_get_mouse_motion		equ 38h
       00000039            A   369    kr_time_delay			equ 39h
       0000003A            A   370    kr_compare_strings		equ 3Ah
       0000003B            A   371    kr_hex_byte_to_ascii		equ 3Bh
       0000003C            A   372    kr_ascii_to_hex_word		equ 3Ch
       0000003D            A   373    kr_get_string			equ 3Dh
       0000003E            A   374    kr_get_version			equ 3Eh
       0000003F            A   375    kr_dont_store_registers	equ 3Fh
       00000040            A   376    kr_get_font_info			equ 40h
       00000041            A   377    kr_read_rtc				equ 41h
       00000042            A   378    kr_write_rtc				equ 42h
       00000043            A   379    kr_get_keymap_location	equ 43h
       00000048            A   380    kr_set_video_mode		equ 48h
       00000049            A   381    kr_set_cursor_image		equ 49h
                           A   382    ;  150		
                           A   383    ;  151		CREATE_HEADER;
010000 18 0E               A   384    jr skip_header
010002 50524F              A   385    db 'PRO'
010005 000001              A   386    mb_loc dw24 10000h
010008 000000              A   387    dw24 0
01000B 0000                A   388    dw 0
01000D 0000                A   389    dw 0
01000F 01                  A   390    db 1
010010                     A   391    skip_header
                           A   392    ;  152		
                           A   393    ;  153		UseFile = 0;	
010010 AF                  A   394    	XOR	A,A
010011 32 97 55 01         A   395    	LD	(_UseFile),A
                           A   396    ;  154		
                           A   397    ;  155		asm ("ld a, (hl)");
010015 7E                  A   398    ld a, (hl)
                           A   399    ;  156		asm ("or a");
010016 B7                  A   400    or a
                           A   401    ;  157		asm ("jr z, no_param");
010017 28 0A               A   402    jr z, no_param
                           A   403    ;  158		asm ("ld (_K_xHL), hl");	//If pa
010019 22 85 55 01         A   404    ld (_K_xHL), hl
                           A   405    ;  159		
                           A   406    ;  160		UseFile = 1;
01001D 3E01                A   407    	LD	A,1
01001F 32 97 55 01         A   408    	LD	(_UseFile),A
                           A   409    ;  161		
                           A   410    ;  162		asm ("no_param:");
010023                     A   411    no_param:
                           A   412    ;  163		
                           A   413    ;  164		if (get_prose_version() < 0x31)
010023 CD 2B 03 01         A   414    	CALL	_get_prose_version
010027 01310000            A   415    	LD	BC,49
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:   9


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01002B B7                  A   416    	OR	A,A
01002C ED42                A   417    	SBC	HL,BC
01002E F2 38 00 01         A   418    	JP	P,L__12
010032 EA 50 00 01         A   419    	JP	PE,L_1
010036 18 04               A   420    	JR	L__13
010038                     A   421    L__12:
010038 E2 50 00 01         A   422    	JP	PO,L_1
01003C                     A   423    L__13:
                           A   424    ;  165		{
                           A   425    ;  166			print("Proted require PROSE ver
01003C 01 6F 26 01         A   426    	LD	BC,L__2
010040 C5                  A   427    	PUSH	BC
010041 CD 36 02 01         A   428    	CALL	_print
010045 C1                  A   429    	POP	BC
                           A   430    ;  167			
                           A   431    ;  168			QUIT_TO_PROSE;
010046 AF                  A   432    xor a
010047 5BC3140A 00         A   433    jp.lil prose_return
                           A   434    ;  169			
                           A   435    ;  170			return;
01004C C3 07 01 01         A   436    	JR	L_5
                           A   437    ;  171		}
010050                     A   438    L_1:
                           A   439    ;  172		
                           A   440    ;  173		set_display_size();
010050 CD 43 03 01         A   441    	CALL	_set_display_size
                           A   442    ;  174		
                           A   443    ;  175		asm ("push ix");
010054 DDE5                A   444    push ix
                           A   445    ;  176		asm ("ld a, kr_clear_screen");
010056 3E26                A   446    ld a, kr_clear_screen
                           A   447    ;  177		asm ("call.lil prose_kernal");
010058 5BCD200A 00         A   448    call.lil prose_kernal
                           A   449    ;  178		asm ("pop ix");
01005D DDE1                A   450    pop ix
                           A   451    ;  179		
                           A   452    ;  180		memset(BufferFile, 0, 1024 * 512);	01005F 01000008            A   453    	LD	BC,524288
010063 C5                  A   454    	PUSH	BC
010064 01000000            A   455    	LD	BC,0
010068 C5                  A   456    	PUSH	BC
010069 ED4B A3 55 01       A   457    	LD	BC,(_BufferFile)
01006E C5                  A   458    	PUSH	BC
01006F CD 15 26 01         A   459    	CALL	_memset
010073 C1                  A   460    	POP	BC
010074 C1                  A   461    	POP	BC
010075 C1                  A   462    	POP	BC
                           A   463    ;  181		
                           A   464    ;  182		ShowMenu();
010076 CD A7 18 01         A   465    	CALL	_ShowMenu
                           A   466    ;  183		
                           A   467    ;  184		te_ini();
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  10


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01007A CD 40 07 01         A   468    	CALL	_te_ini
                           A   469    ;  185		sc_ini();
01007E CD B1 09 01         A   470    	CALL	_sc_ini
                           A   471    ;  186		tx_ini();
010082 CD C3 09 01         A   472    	CALL	_tx_ini
                           A   473    ;  187		
                           A   474    ;  188		if (UseFile == 1)
010086 3A 97 55 01         A   475    	LD	A,(_UseFile)
01008A FE01                A   476    	CP	A,1
01008C 20 16               A   477    	JR	NZ,L_4
                           A   478    ;  189			if (FileExists() == 1)
01008E CD 71 1C 01         A   479    	CALL	_FileExists
010092 47                  A   480    	LD	B,A
010093 17ED62              A   481    	SEXT	HL
010096 68                  A   482    	LD	L,B
010097 B7                  A   483    	OR	A,A
010098 01010000            A   484    	LD	BC,1
01009C ED42                A   485    	SBC	HL,BC
01009E 20 04               A   486    	JR	NZ,L_4
                           A   487    ;  190				load_file();		
0100A0 CD 9A 1C 01         A   488    	CALL	_load_file
0100A4                     A   489    L_4:
                           A   490    ;  191		
                           A   491    ;  192		edit();
0100A4 CD 90 19 01         A   492    	CALL	_edit
                           A   493    ;  193		
                           A   494    ;  194		sc_fin();
0100A8 CD BA 09 01         A   495    	CALL	_sc_fin
                           A   496    ;  195		te_fin();
0100AC CD 4A 07 01         A   497    	CALL	_te_fin
                           A   498    ;  196		
                           A   499    ;  197		asm ("proted_exit:");
0100B0                     A   500    proted_exit:
                           A   501    ;  198		asm ("push ix");
0100B0 DDE5                A   502    push ix
                           A   503    ;  199		asm ("ld a, kr_clear_screen");
0100B2 3E26                A   504    ld a, kr_clear_screen
                           A   505    ;  200		asm ("call.lil prose_kernal");
0100B4 5BCD200A 00         A   506    call.lil prose_kernal
                           A   507    ;  201		asm ("pop ix");
0100B9 DDE1                A   508    pop ix
                           A   509    ;  202		
                           A   510    ;  203		print("\n\r");
0100BB 01 97 26 01         A   511    	LD	BC,L__5
0100BF C5                  A   512    	PUSH	BC
0100C0 CD 36 02 01         A   513    	CALL	_print
0100C4 C1                  A   514    	POP	BC
                           A   515    ;  204		print("PROTED ver ");
0100C5 01 9A 26 01         A   516    	LD	BC,L__6
0100C9 C5                  A   517    	PUSH	BC
0100CA CD 36 02 01         A   518    	CALL	_print
0100CE C1                  A   519    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  11


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A   520    ;  205		print(VERSION);
0100CF 01 A6 26 01         A   521    	LD	BC,L__7
0100D3 C5                  A   522    	PUSH	BC
0100D4 CD 36 02 01         A   523    	CALL	_print
0100D8 C1                  A   524    	POP	BC
                           A   525    ;  206		print(" rel.: ");
0100D9 01 AA 26 01         A   526    	LD	BC,L__8
0100DD C5                  A   527    	PUSH	BC
0100DE CD 36 02 01         A   528    	CALL	_print
0100E2 C1                  A   529    	POP	BC
                           A   530    ;  207		print(__DATE__);
0100E3 01 B2 26 01         A   531    	LD	BC,L__9
0100E7 C5                  A   532    	PUSH	BC
0100E8 CD 36 02 01         A   533    	CALL	_print
0100EC C1                  A   534    	POP	BC
                           A   535    ;  208		print("\n\r");
0100ED 01 BE 26 01         A   536    	LD	BC,L__10
0100F1 C5                  A   537    	PUSH	BC
0100F2 CD 36 02 01         A   538    	CALL	_print
0100F6 C1                  A   539    	POP	BC
                           A   540    ;  209		print("Created by Calogiuri Enzo An
0100F7 01 C1 26 01         A   541    	LD	BC,L__11
0100FB C5                  A   542    	PUSH	BC
0100FC CD 36 02 01         A   543    	CALL	_print
010100 C1                  A   544    	POP	BC
                           A   545    ;  210		
                           A   546    ;  211		QUIT_TO_PROSE;
010101 AF                  A   547    xor a
010102 5BC3140A 00         A   548    jp.lil prose_return
                           A   549    ;  212	}
010107                     A   550    L_5:
010107 C9                  A   551    	RET	
                           A   552    
                           A   553    
                           A   554    ;**************************** _main ***********
                           A   555    ;Name                         Addr/Register   S
                           A   556    ;_te_fin                             IMPORT  --
                           A   557    ;_sc_fin                             IMPORT  --
                           A   558    ;_edit                               IMPORT  --
                           A   559    ;_load_file                          IMPORT  --
                           A   560    ;_FileExists                         IMPORT  --
                           A   561    ;_tx_ini                             IMPORT  --
                           A   562    ;_sc_ini                             IMPORT  --
                           A   563    ;_te_ini                             IMPORT  --
                           A   564    ;_ShowMenu                           IMPORT  --
                           A   565    ;_BufferFile                         STATIC    
                           A   566    ;_memset                             IMPORT  --
                           A   567    ;_set_display_size                   IMPORT  --
                           A   568    ;_print                              IMPORT  --
                           A   569    ;_get_prose_version                  IMPORT  --
                           A   570    ;_UseFile                            STATIC    
                           A   571    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  12


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A   572    
                           A   573    ; Stack Frame Size: 6 (bytes)
                           A   574    ;       Spill Code: 0 (instruction)
                           A   575    
                           A   576    
                           A   577    	SEGMENT STRSECT
01266F                     A   578    L__2:
01266F 50726F74 65642072   A   579    	DB	"Proted require PROSE ver 31 or later!"
012677 65717569 72652050 
01267F 524F5345 20766572 
012687 20333120 6F72206C 
01268F 61746572 21 
012694 0A0D00              A   580    	DB	10,13,0
012697                     A   581    L__5:
012697 0A0D00              A   582    	DB	10,13,0
01269A                     A   583    L__6:
01269A 50524F54 45442076   A   584    	DB	"PROTED ver "
0126A2 657220 
0126A5 00                  A   585    	DB	0
0126A6                     A   586    L__7:
0126A6 312E32              A   587    	DB	"1.2"
0126A9 00                  A   588    	DB	0
0126AA                     A   589    L__8:
0126AA 2072656C 2E3A20     A   590    	DB	" rel.: "
0126B1 00                  A   591    	DB	0
0126B2                     A   592    L__9:
0126B2 41756720 20312032   A   593    	DB	"Aug  1 2011"
0126BA 303131 
0126BD 00                  A   594    	DB	0
0126BE                     A   595    L__10:
0126BE 0A0D00              A   596    	DB	10,13,0
0126C1                     A   597    L__11:
0126C1 43726561 74656420   A   598    	DB	"Created by Calogiuri Enzo Antonio for 
0126C9 62792043 616C6F67 
0126D1 69757269 20456E7A 
0126D9 6F20416E 746F6E69 
0126E1 6F20666F 7220655A 
0126E9 38305020 66616E73 
0126F1 203A2D29 
0126F5 0A0D00              A   599    	DB	10,13,0
                           A   600    	SEGMENT CODE
                           A   601    ;  213	
                           A   602    ;  214	/* Get ascii and scancode value of key 
                           A   603    ;  215	void GetCh(void)
                           A   604    ;  216	{
010108                     A   605    _GetCh:
                           A   606    ;  217		Ascii = Scancode = 0;
010108 AF                  A   607    	XOR	A,A
010109 32 80 55 01         A   608    	LD	(_Scancode),A
01010D AF                  A   609    	XOR	A,A
01010E 32 7F 55 01         A   610    	LD	(_Ascii),A
                           A   611    ;  218		
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  13


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A   612    ;  219		asm ("push ix");
010112 DDE5                A   613    push ix
                           A   614    ;  220		asm ("ld a, kr_get_key");
010114 3E1E                A   615    ld a, kr_get_key
                           A   616    ;  221		asm ("call.lil prose_kernal");
010116 5BCD200A 00         A   617    call.lil prose_kernal
                           A   618    ;  222		asm ("jr nz, NoKeyInB");
01011B 20 09               A   619    jr nz, NoKeyInB
                           A   620    ;  223		asm ("ld (_Scancode), a");
01011D 32 80 55 01         A   621    ld (_Scancode), a
                           A   622    ;  224		asm ("ld a, b");
010121 78                  A   623    ld a, b
                           A   624    ;  225		asm ("ld (_Ascii), a");
010122 32 7F 55 01         A   625    ld (_Ascii), a
                           A   626    ;  226		asm ("NoKeyInB:");
010126                     A   627    NoKeyInB:
                           A   628    ;  227		asm ("pop ix");
010126 DDE1                A   629    pop ix
                           A   630    ;  228	}
010128 C9                  A   631    	RET	
                           A   632    
                           A   633    
                           A   634    ;**************************** _GetCh **********
                           A   635    ;Name                         Addr/Register   S
                           A   636    ;_Ascii                              STATIC    
                           A   637    ;_Scancode                           STATIC    
                           A   638    
                           A   639    
                           A   640    ; Stack Frame Size: 6 (bytes)
                           A   641    ;       Spill Code: 0 (instruction)
                           A   642    
                           A   643    
                           A   644    ;  229	
                           A   645    ;  230	/* Manage the input from keyboard */
                           A   646    ;  231	unsigned char getch(void)
                           A   647    ;  232	{
010129                     A   648    _getch:
                           A   649    ;  233		while (1)
010129                     A   650    L_27:
                           A   651    ;  234		{	
                           A   652    ;  235			GetCh();	
010129 CD 08 01 01         A   653    	CALL	_GetCh
                           A   654    ;  236			
                           A   655    ;  237			switch (Scancode)
01012D 3A 80 55 01         A   656    	LD	A,(_Scancode)
010131 B7ED62              A   657    	UEXT	HL
010134 6F                  A   658    	LD	L,A
010135 E5C1                A   659    	LD	BC,HL
010137                     A   660    L__17:
010137 115A0000            A   661    	LD	DE,90
01013B B7                  A   662    	OR	A,A
01013C ED52                A   663    	SBC	HL,DE
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  14


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01013E CA 0D 02 01         A   664    	JR	Z,L_12
010142 215A0000            A   665    	LD	HL,90
010146 B7                  A   666    	OR	A,A
010147 ED42                A   667    	SBC	HL,BC
010149 38 29               A   668    	JR	C,L__19
01014B 11120000            A   669    	LD	DE,18
01014F C5E1                A   670    	LD	HL,BC
010151 B7                  A   671    	OR	A,A
010152 ED52                A   672    	SBC	HL,DE
010154 CA 19 02 01         A   673    	JR	Z,L_14
010158 21120000            A   674    	LD	HL,18
01015C B7                  A   675    	OR	A,A
01015D ED42                A   676    	SBC	HL,BC
01015F DA 28 02 01         A   677    	JR	C,L_25
010163 110D0000            A   678    	LD	DE,13
010167 C5E1                A   679    	LD	HL,BC
010169 B7                  A   680    	OR	A,A
01016A ED52                A   681    	SBC	HL,DE
01016C CA 05 02 01         A   682    	JR	Z,L_11
010170 C3 28 02 01         A   683    	JR	L_25
010174                     A   684    L__19:
010174 11690000            A   685    	LD	DE,105
010178 C5E1                A   686    	LD	HL,BC
01017A B7                  A   687    	OR	A,A
01017B ED52                A   688    	SBC	HL,DE
01017D 38 59               A   689    	JR	C,L__23
01017F 217D0000            A   690    	LD	HL,125
010183 B7                  A   691    	OR	A,A
010184 ED42                A   692    	SBC	HL,BC
010186 DA 28 02 01         A   693    	JR	C,L_25
01018A C5E1                A   694    	LD	HL,BC
01018C 29                  A   695    	ADD	HL,HL
01018D 29                  A   696    	ADD	HL,HL
01018E B7                  A   697    	OR	A,A
01018F ED42                A   698    	SBC	HL,BC
010191 11 5E 00 01         A   699    	LD	DE,L__16-315
010195 19                  A   700    	ADD	HL,DE
010196 ED27                A   701    	LD	HL,(HL)
010198 E9                  A   702    	JP	(HL)
010199                     A   703    L__16:
010199 220201              A   704    	DW24	L_21	
                           A   705    
01019C 280201              A   706    	DW24	L_25	
                           A   707    
01019F 220201              A   708    	DW24	L_17	
                           A   709    
0101A2 220201              A   710    	DW24	L_20	
                           A   711    
0101A5 280201              A   712    	DW24	L_25	
                           A   713    
0101A8 280201              A   714    	DW24	L_25	
                           A   715    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  15


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0101AB 280201              A   716    	DW24	L_25	
                           A   717    
0101AE 220201              A   718    	DW24	L_22	
                           A   719    
0101B1 ED0101              A   720    	DW24	L_8	
                           A   721    
0101B4 220201              A   722    	DW24	L_19	
                           A   723    
0101B7 280201              A   724    	DW24	L_25	
                           A   725    
0101BA 220201              A   726    	DW24	L_23	
                           A   727    
0101BD 220201              A   728    	DW24	L_18	
                           A   729    
0101C0 280201              A   730    	DW24	L_25	
                           A   731    
0101C3 280201              A   732    	DW24	L_25	
                           A   733    
0101C6 280201              A   734    	DW24	L_25	
                           A   735    
0101C9 280201              A   736    	DW24	L_25	
                           A   737    
0101CC F50101              A   738    	DW24	L_9	
                           A   739    
0101CF 280201              A   740    	DW24	L_25	
                           A   741    
0101D2 280201              A   742    	DW24	L_25	
                           A   743    
0101D5 E50101              A   744    	DW24	L_7	
                           A   745    
0101D8                     A   746    L__23:
0101D8 11660000            A   747    	LD	DE,102
0101DC C5E1                A   748    	LD	HL,BC
0101DE B7                  A   749    	OR	A,A
0101DF ED52                A   750    	SBC	HL,DE
0101E1 28 1A               A   751    	JR	Z,L_10
0101E3 18 43               A   752    	JR	L_25
                           A   753    ;  238			{
                           A   754    ;  239				case 0x7D	: Ascii = 3; br
0101E5                     A   755    L_7:
0101E5 3E03                A   756    	LD	A,3
0101E7 32 7F 55 01         A   757    	LD	(_Ascii),A
0101EB 18 3B               A   758    	JR	L_25
                           A   759    ;  240				
                           A   760    ;  241				case 0x71	: Ascii = 4; br
0101ED                     A   761    L_8:
0101ED 3E04                A   762    	LD	A,4
0101EF 32 7F 55 01         A   763    	LD	(_Ascii),A
0101F3 18 33               A   764    	JR	L_25
                           A   765    ;  242	
                           A   766    ;  243				case 0x7A	: Ascii = 6; br
0101F5                     A   767    L_9:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  16


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0101F5 3E06                A   768    	LD	A,6
0101F7 32 7F 55 01         A   769    	LD	(_Ascii),A
0101FB 18 2B               A   770    	JR	L_25
                           A   771    ;  244				
                           A   772    ;  245				case 102	: Ascii = 8; br
0101FD                     A   773    L_10:
0101FD 3E08                A   774    	LD	A,8
0101FF 32 7F 55 01         A   775    	LD	(_Ascii),A
010203 18 23               A   776    	JR	L_25
                           A   777    ;  246				
                           A   778    ;  247				case 0xD	: Ascii = 9; br
010205                     A   779    L_11:
010205 3E09                A   780    	LD	A,9
010207 32 7F 55 01         A   781    	LD	(_Ascii),A
01020B 18 1B               A   782    	JR	L_25
                           A   783    ;  248				
                           A   784    ;  249				case 90		: Ascii = 13; b
01020D                     A   785    L_12:
01020D 3E0D                A   786    	LD	A,13
01020F 32 7F 55 01         A   787    	LD	(_Ascii),A
010213 18 13               A   788    	JR	L_25
                           A   789    ;  250				
                           A   790    ;  251				case 0x12	: while (Ascii 
010215                     A   791    L_15:
                           A   792    ;  252								GetCh();
010215 CD 08 01 01         A   793    	CALL	_GetCh
010219                     A   794    L_14:
010219 3A 7F 55 01         A   795    	LD	A,(_Ascii)
01021D B7                  A   796    	OR	A,A
01021E 28 F5               A   797    	JR	Z,L_15
                           A   798    ;  253								
                           A   799    ;  254							  break;
010220 18 06               A   800    	JR	L_25
                           A   801    ;  255				
                           A   802    ;  256				case 0x6B	:
010222                     A   803    L_17:
                           A   804    ;  257				case 0x75	:
010222                     A   805    L_18:
                           A   806    ;  258				case 0x72	:
010222                     A   807    L_19:
                           A   808    ;  259				case 0x6C	:
010222                     A   809    L_20:
                           A   810    ;  260				case 0x69	:
010222                     A   811    L_21:
                           A   812    ;  261				case 0x70	:
010222                     A   813    L_22:
                           A   814    ;  262				case 0x74	: Ascii = 1; br
010222                     A   815    L_23:
010222 3E01                A   816    	LD	A,1
010224 32 7F 55 01         A   817    	LD	(_Ascii),A
                           A   818    ;  263			}
010228                     A   819    L_25:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  17


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A   820    ;  264			
                           A   821    ;  265			if (Ascii != 0)
010228 3A 7F 55 01         A   822    	LD	A,(_Ascii)
01022C B7                  A   823    	OR	A,A
01022D CA 29 01 01         A   824    	JR	Z,L_27
                           A   825    ;  266				break;		
                           A   826    ;  267		}	
                           A   827    ;  268			
                           A   828    ;  269		return Ascii;
010231 3A 7F 55 01         A   829    	LD	A,(_Ascii)
                           A   830    ;  270	}
010235 C9                  A   831    	RET	
                           A   832    
                           A   833    
                           A   834    ;**************************** _getch **********
                           A   835    ;Name                         Addr/Register   S
                           A   836    ;_Ascii                              STATIC    
                           A   837    ;_Scancode                           STATIC    
                           A   838    ;_GetCh                              IMPORT  --
                           A   839    
                           A   840    
                           A   841    ; Stack Frame Size: 6 (bytes)
                           A   842    ;       Spill Code: 0 (instruction)
                           A   843    
                           A   844    
                           A   845    ;  271	
                           A   846    ;  272	/* Print on screen a text at current x,
                           A   847    ;  273	void print(const char *Txt)
                           A   848    ;  274	{
010236                     A   849    _print:
010236 CD 4A 25 01         A   850    	CALL	__frameset0
                           A   851    ;  275		TxtPnt = Txt;
01023A DD0706              A   852    	LD	BC,(IX+6)
01023D ED43 91 55 01       A   853    	LD	(_TxtPnt),BC
                           A   854    ;  276		
                           A   855    ;  277		asm ("push ix");
010242 DDE5                A   856    push ix
                           A   857    ;  278		asm ("ld hl, (_TxtPnt)");
010244 2A 91 55 01         A   858    ld hl, (_TxtPnt)
                           A   859    ;  279		asm ("ld a, kr_print_string");
010248 3E25                A   860    ld a, kr_print_string
                           A   861    ;  280		asm ("call.lil prose_kernal");
01024A 5BCD200A 00         A   862    call.lil prose_kernal
                           A   863    ;  281		asm ("pop ix");
01024F DDE1                A   864    pop ix
                           A   865    ;  282	}
010251 DDF9                A   866    	LD	SP,IX
010253 DDE1                A   867    	POP	IX
010255 C9                  A   868    	RET	
                           A   869    
                           A   870    
                           A   871    ;**************************** _print **********
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  18


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A   872    ;Name                         Addr/Register   S
                           A   873    ;_TxtPnt                             STATIC    
                           A   874    ;Txt                                   IX+6    
                           A   875    
                           A   876    
                           A   877    ; Stack Frame Size: 9 (bytes)
                           A   878    ;       Spill Code: 0 (instruction)
                           A   879    
                           A   880    
                           A   881    ;  283	
                           A   882    ;  284	/* Get the x and the y of screen cursor
                           A   883    ;  285	void get_cursor_position(unsigned char 
                           A   884    ;  286	{
010256                     A   885    _get_cursor_position:
010256 CD 4A 25 01         A   886    	CALL	__frameset0
                           A   887    ;  287		asm ("push ix");
01025A DDE5                A   888    push ix
                           A   889    ;  288		asm ("ld a, kr_get_cursor_position"
01025C 3E32                A   890    ld a, kr_get_cursor_position
                           A   891    ;  289		asm ("call.lil prose_kernal");
01025E 5BCD200A 00         A   892    call.lil prose_kernal
                           A   893    ;  290		asm ("ld a, b");
010263 78                  A   894    ld a, b
                           A   895    ;  291		asm ("ld (_B), a");
010264 32 81 55 01         A   896    ld (_B), a
                           A   897    ;  292		asm ("ld a, c");
010268 79                  A   898    ld a, c
                           A   899    ;  293		asm ("ld (_C), a");
010269 32 82 55 01         A   900    ld (_C), a
                           A   901    ;  294		asm ("pop ix");
01026D DDE1                A   902    pop ix
                           A   903    ;  295		
                           A   904    ;  296		*X = B;
01026F DD2706              A   905    	LD	HL,(IX+6)
010272 3A 81 55 01         A   906    	LD	A,(_B)
010276 77                  A   907    	LD	(HL),A
                           A   908    ;  297		*Y = C;
010277 DD2709              A   909    	LD	HL,(IX+9)
01027A 3A 82 55 01         A   910    	LD	A,(_C)
01027E 77                  A   911    	LD	(HL),A
                           A   912    ;  298	}
01027F DDF9                A   913    	LD	SP,IX
010281 DDE1                A   914    	POP	IX
010283 C9                  A   915    	RET	
                           A   916    
                           A   917    
                           A   918    ;**************************** _get_cursor_posit
                           A   919    ;Name                         Addr/Register   S
                           A   920    ;_C                                  STATIC    
                           A   921    ;_B                                  STATIC    
                           A   922    ;Y                                     IX+9    
                           A   923    ;X                                     IX+6    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  19


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A   924    
                           A   925    
                           A   926    ; Stack Frame Size: 12 (bytes)
                           A   927    ;       Spill Code: 0 (instruction)
                           A   928    
                           A   929    
                           A   930    ;  299	
                           A   931    ;  300	/* Draw a character at X, Y coordinates
                           A   932    ;  301	void plot_char(unsigned char x, unsigne
                           A   933    ;  302	{
010284                     A   934    _plot_char:
010284 CD 4A 25 01         A   935    	CALL	__frameset0
                           A   936    ;  303		B = x;
010288 DD7E06              A   937    	LD	A,(IX+6)
01028B 32 81 55 01         A   938    	LD	(_B),A
                           A   939    ;  304		C = y;
01028F DD7E09              A   940    	LD	A,(IX+9)
010292 32 82 55 01         A   941    	LD	(_C),A
                           A   942    ;  305		E = Ch;
010296 DD7E0C              A   943    	LD	A,(IX+12)
010299 32 83 55 01         A   944    	LD	(_E),A
                           A   945    ;  306		
                           A   946    ;  307		asm ("push ix");
01029D DDE5                A   947    push ix
                           A   948    ;  308		asm ("ld hl, _B");
01029F 21 81 55 01         A   949    ld hl, _B
                           A   950    ;  309		asm ("ld B, (hl)");
0102A3 46                  A   951    ld B, (hl)
                           A   952    ;  310		asm ("ld hl, _C");
0102A4 21 82 55 01         A   953    ld hl, _C
                           A   954    ;  311		asm ("ld C, (hl)");
0102A8 4E                  A   955    ld C, (hl)
                           A   956    ;  312		asm ("ld hl, _E");
0102A9 21 83 55 01         A   957    ld hl, _E
                           A   958    ;  313		asm ("ld E, (hl)");
0102AD 5E                  A   959    ld E, (hl)
                           A   960    ;  314		asm ("ld a, kr_plot_char");
0102AE 3E29                A   961    ld a, kr_plot_char
                           A   962    ;  315		asm ("call.lil prose_kernal");
0102B0 5BCD200A 00         A   963    call.lil prose_kernal
                           A   964    ;  316		asm ("pop ix");
0102B5 DDE1                A   965    pop ix
                           A   966    ;  317	}
0102B7 DDF9                A   967    	LD	SP,IX
0102B9 DDE1                A   968    	POP	IX
0102BB C9                  A   969    	RET	
                           A   970    
                           A   971    
                           A   972    ;**************************** _plot_char ******
                           A   973    ;Name                         Addr/Register   S
                           A   974    ;_E                                  STATIC    
                           A   975    ;_C                                  STATIC    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  20


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A   976    ;_B                                  STATIC    
                           A   977    ;Ch                                   IX+12    
                           A   978    ;y                                     IX+9    
                           A   979    ;x                                     IX+6    
                           A   980    
                           A   981    
                           A   982    ; Stack Frame Size: 15 (bytes)
                           A   983    ;       Spill Code: 0 (instruction)
                           A   984    
                           A   985    
                           A   986    ;  318	
                           A   987    ;  319	/* Clear the row on screen from current
                           A   988    ;  320	void clreol(void)
                           A   989    ;  321	{
0102BC                     A   990    _clreol:
0102BC 21FDFFFF            A   991    	LD	HL,-3
0102C0 CD 57 25 01         A   992    	CALL	__frameset
                           A   993    ;  322		unsigned char x, y;
                           A   994    ;  323		register char i;
                           A   995    ;  324		
                           A   996    ;  325		get_cursor_position(&x, &y);
0102C4 ED65FE              A   997    	PEA	IX+-2
0102C7 ED65FD              A   998    	PEA	IX+-3
0102CA CD 56 02 01         A   999    	CALL	_get_cursor_position
0102CE C1                  A  1000    	POP	BC
0102CF C1                  A  1001    	POP	BC
0102D0 DD7EFD              A  1002    	LD	A,(IX+-3)
0102D3 DD77FF              A  1003    	LD	(IX+-1),A
                           A  1004    ;  326		
                           A  1005    ;  327		for (i = x; i < 80; i++)
0102D6 18 19               A  1006    	JR	L_36
0102D8                     A  1007    L_34:
                           A  1008    ;  328			plot_char(i, y, ' ');		
0102D8 01200000            A  1009    	LD	BC,32
0102DC C5                  A  1010    	PUSH	BC
0102DD DD4EFE              A  1011    	LD	C,(IX+-2)
0102E0 0600                A  1012    	LD	B,0
0102E2 C5                  A  1013    	PUSH	BC
0102E3 DD4EFF              A  1014    	LD	C,(IX+-1)
0102E6 C5                  A  1015    	PUSH	BC
0102E7 CD 84 02 01         A  1016    	CALL	_plot_char
0102EB C1                  A  1017    	POP	BC
0102EC C1                  A  1018    	POP	BC
0102ED C1                  A  1019    	POP	BC
0102EE DD34FF              A  1020    	INC	(IX+-1)
0102F1                     A  1021    L_36:
0102F1 DD7EFF              A  1022    	LD	A,(IX+-1)
0102F4 FE50                A  1023    	CP	A,80
0102F6 FA D8 02 01         A  1024    	JP	M,L_34
                           A  1025    ;  329	}
0102FA DDF9                A  1026    	LD	SP,IX
0102FC DDE1                A  1027    	POP	IX
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  21


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0102FE C9                  A  1028    	RET	
                           A  1029    
                           A  1030    
                           A  1031    ;**************************** _clreol *********
                           A  1032    ;Name                         Addr/Register   S
                           A  1033    ;_plot_char                          IMPORT  --
                           A  1034    ;_get_cursor_position                IMPORT  --
                           A  1035    ;x                                     IX-3    
                           A  1036    ;y                                     IX-2    
                           A  1037    ;i                                     IX-1    
                           A  1038    
                           A  1039    
                           A  1040    ; Stack Frame Size: 9 (bytes)
                           A  1041    ;       Spill Code: 0 (instruction)
                           A  1042    
                           A  1043    
                           A  1044    ;  330	
                           A  1045    ;  331	/* Move screen cursor at x,y position *
                           A  1046    ;  332	void gotoxy(unsigned char x, unsigned c
                           A  1047    ;  333	{
0102FF                     A  1048    _gotoxy:
0102FF CD 4A 25 01         A  1049    	CALL	__frameset0
                           A  1050    ;  334		B = x;
010303 DD7E06              A  1051    	LD	A,(IX+6)
010306 32 81 55 01         A  1052    	LD	(_B),A
                           A  1053    ;  335		C = y;
01030A DD7E09              A  1054    	LD	A,(IX+9)
01030D 32 82 55 01         A  1055    	LD	(_C),A
                           A  1056    ;  336		
                           A  1057    ;  337		asm ("push ix");
010311 DDE5                A  1058    push ix
                           A  1059    ;  338		asm ("ld hl, _B");
010313 21 81 55 01         A  1060    ld hl, _B
                           A  1061    ;  339		asm ("ld B, (hl)");
010317 46                  A  1062    ld B, (hl)
                           A  1063    ;  340		asm ("ld hl, _C");
010318 21 82 55 01         A  1064    ld hl, _C
                           A  1065    ;  341		asm ("ld C, (hl)");
01031C 4E                  A  1066    ld C, (hl)
                           A  1067    ;  342		asm ("ld a, kr_set_cursor_position"
01031D 3E28                A  1068    ld a, kr_set_cursor_position
                           A  1069    ;  343		asm ("call.lil prose_kernal");
01031F 5BCD200A 00         A  1070    call.lil prose_kernal
                           A  1071    ;  344		asm ("pop ix");
010324 DDE1                A  1072    pop ix
                           A  1073    ;  345	}
010326 DDF9                A  1074    	LD	SP,IX
010328 DDE1                A  1075    	POP	IX
01032A C9                  A  1076    	RET	
                           A  1077    
                           A  1078    
                           A  1079    ;**************************** _gotoxy *********
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  22


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  1080    ;Name                         Addr/Register   S
                           A  1081    ;_C                                  STATIC    
                           A  1082    ;_B                                  STATIC    
                           A  1083    ;y                                     IX+9    
                           A  1084    ;x                                     IX+6    
                           A  1085    
                           A  1086    
                           A  1087    ; Stack Frame Size: 12 (bytes)
                           A  1088    ;       Spill Code: 0 (instruction)
                           A  1089    
                           A  1090    
                           A  1091    ;  346	
                           A  1092    ;  347	/* Return only PROSE version */
                           A  1093    ;  348	int get_prose_version(void)
                           A  1094    ;  349	{
01032B                     A  1095    _get_prose_version:
                           A  1096    ;  350		asm ("push ix");
01032B DDE5                A  1097    push ix
                           A  1098    ;  351		asm ("push de");
01032D D5                  A  1099    push de
                           A  1100    ;  352		asm ("push hl");
01032E E5                  A  1101    push hl
                           A  1102    ;  353		asm ("ld a, kr_get_version");
01032F 3E3E                A  1103    ld a, kr_get_version
                           A  1104    ;  354		asm ("call.lil prose_kernal");
010331 5BCD200A 00         A  1105    call.lil prose_kernal
                           A  1106    ;  355		asm ("ld (_K_xBC), hl");
010336 22 88 55 01         A  1107    ld (_K_xBC), hl
                           A  1108    ;  356		asm ("pop hl");
01033A E1                  A  1109    pop hl
                           A  1110    ;  357		asm ("pop de");
01033B D1                  A  1111    pop de
                           A  1112    ;  358		asm ("pop ix");
01033C DDE1                A  1113    pop ix
                           A  1114    ;  359		
                           A  1115    ;  360		return K_xBC;
01033E 2A 88 55 01         A  1116    	LD	HL,(_K_xBC)
                           A  1117    ;  361	}
010342 C9                  A  1118    	RET	
                           A  1119    
                           A  1120    
                           A  1121    ;**************************** _get_prose_versio
                           A  1122    ;Name                         Addr/Register   S
                           A  1123    ;_K_xBC                              STATIC    
                           A  1124    
                           A  1125    
                           A  1126    ; Stack Frame Size: 6 (bytes)
                           A  1127    ;       Spill Code: 0 (instruction)
                           A  1128    
                           A  1129    
                           A  1130    ;  362	
                           A  1131    ;  363	/* Setup PROSE screen dimension at 80x6
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  23


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  1132    ;  364	void set_display_size(void)
                           A  1133    ;  365	{
010343                     A  1134    _set_display_size:
                           A  1135    ;  366		asm ("push ix");
010343 DDE5                A  1136    push ix
                           A  1137    ;  367		asm ("ld e, 0h");
010345 1E00                A  1138    ld e, 0h
                           A  1139    ;  368		asm ("ld a, kr_set_video_mode");
010347 3E48                A  1140    ld a, kr_set_video_mode
                           A  1141    ;  369		asm ("call.lil prose_kernal");
010349 5BCD200A 00         A  1142    call.lil prose_kernal
                           A  1143    ;  370		asm ("pop ix");
01034E DDE1                A  1144    pop ix
                           A  1145    ;  371	}
010350 C9                  A  1146    	RET	
                           A  1147    
                           A  1148    
                           A  1149    ;**************************** _set_display_size
                           A  1150    ;Name                         Addr/Register   S
                           A  1151    
                           A  1152    
                           A  1153    ; Stack Frame Size: 6 (bytes)
                           A  1154    ;       Spill Code: 0 (instruction)
                           A  1155    
                           A  1156    
                           A  1157    ;  372	
                           A  1158    ;  373	/*-------------------------------------
                           A  1159    ;  374	
                           A  1160    ;  375	/* Writes out its argument string and t
                           A  1161    ;  376	void bomb(char *txt)
                           A  1162    ;  377	{
010351                     A  1163    _bomb:
010351 CD 4A 25 01         A  1164    	CALL	__frameset0
                           A  1165    ;  378		msg_window("Proted assertion failur
010355 DD0706              A  1166    	LD	BC,(IX+6)
010358 C5                  A  1167    	PUSH	BC
010359 01 F8 26 01         A  1168    	LD	BC,L__37
01035D C5                  A  1169    	PUSH	BC
01035E CD 70 20 01         A  1170    	CALL	_msg_window
010362 C1                  A  1171    	POP	BC
010363 C1                  A  1172    	POP	BC
                           A  1173    ;  379		
                           A  1174    ;  380		while (1)
010364                     A  1175    L_43:
                           A  1176    ;  381		{
                           A  1177    ;  382			getch();
010364 CD 29 01 01         A  1178    	CALL	_getch
                           A  1179    ;  383			
                           A  1180    ;  384			if (Ascii == 13)
010368 3A 7F 55 01         A  1181    	LD	A,(_Ascii)
01036C FE0D                A  1182    	CP	A,13
01036E 20 F4               A  1183    	JR	NZ,L_43
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  24


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  1184    ;  385				break;
                           A  1185    ;  386		}
                           A  1186    ;  387	
                           A  1187    ;  388		asm ("ld a, 0ffh");
010370 3EFF                A  1188    ld a, 0ffh
                           A  1189    ;  389		asm ("jp.lil prose_return");
010372 5BC3140A 00         A  1190    jp.lil prose_return
                           A  1191    ;  390	}
010377 DDF9                A  1192    	LD	SP,IX
010379 DDE1                A  1193    	POP	IX
01037B C9                  A  1194    	RET	
                           A  1195    
                           A  1196    
                           A  1197    ;**************************** _bomb ***********
                           A  1198    ;Name                         Addr/Register   S
                           A  1199    ;_Ascii                              STATIC    
                           A  1200    ;_getch                              IMPORT  --
                           A  1201    ;_msg_window                         IMPORT  --
                           A  1202    ;txt                                   IX+6    
                           A  1203    
                           A  1204    
                           A  1205    ; Stack Frame Size: 9 (bytes)
                           A  1206    ;       Spill Code: 0 (instruction)
                           A  1207    
                           A  1208    
                           A  1209    	SEGMENT STRSECT
0126F8                     A  1210    L__37:
0126F8 50726F74 65642061   A  1211    	DB	"Proted assertion failure. Press RETURN
012700 73736572 74696F6E 
012708 20666169 6C757265 
012710 2E205072 65737320 
012718 52455455 524E2074 
012720 6F206162 6F727421 
012728 00                  A  1212    	DB	0
                           A  1213    	SEGMENT CODE
                           A  1214    ;  391	
                           A  1215    ;  392	/* Bombs with an assertion failure if i
                           A  1216    ;  393	void as(char b, char *txt)
                           A  1217    ;  394	{
01037C                     A  1218    _as:
01037C CD 4A 25 01         A  1219    	CALL	__frameset0
                           A  1220    ;  395		if (!b)
010380 DD7E06              A  1221    	LD	A,(IX+6)
010383 B7                  A  1222    	OR	A,A
010384 20 09               A  1223    	JR	NZ,L_47
                           A  1224    ;  396			bomb(txt);
010386 DD0709              A  1225    	LD	BC,(IX+9)
010389 C5                  A  1226    	PUSH	BC
01038A CD 51 03 01         A  1227    	CALL	_bomb
01038E C1                  A  1228    	POP	BC
                           A  1229    ;  397	}
01038F                     A  1230    L_47:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  25


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01038F DDF9                A  1231    	LD	SP,IX
010391 DDE1                A  1232    	POP	IX
010393 C9                  A  1233    	RET	
                           A  1234    
                           A  1235    
                           A  1236    ;**************************** _as *************
                           A  1237    ;Name                         Addr/Register   S
                           A  1238    ;_bomb                               IMPORT  --
                           A  1239    ;txt                                   IX+9    
                           A  1240    ;b                                     IX+6    
                           A  1241    
                           A  1242    
                           A  1243    ; Stack Frame Size: 12 (bytes)
                           A  1244    ;       Spill Code: 0 (instruction)
                           A  1245    
                           A  1246    
                           A  1247    ;  398	
                           A  1248    ;  399	/* Convert an unsigned int into string 
                           A  1249    ;  400	void uitoa(unsigned int val, char *stri
                           A  1250    ;  401	{
010394                     A  1251    _uitoa:
010394 21FAFFFF            A  1252    	LD	HL,-6
010398 CD 57 25 01         A  1253    	CALL	__frameset
                           A  1254    ;  402		char index = 0, i = 0;
01039C DD36FF00            A  1255    	LD	(IX+-1),0
0103A0 DD36FE00            A  1256    	LD	(IX+-2),0
                           A  1257    ;  403		
                           A  1258    ;  404		do {
0103A4                     A  1259    L_50:
                           A  1260    ;  405			string[index] = '0' + (val % 10
0103A4 DD7EFF              A  1261    	LD	A,(IX+-1)
0103A7 17ED62              A  1262    	SEXT	HL
0103AA DD6EFF              A  1263    	LD	L,(IX+-1)
0103AD DD0709              A  1264    	LD	BC,(IX+9)
0103B0 09                  A  1265    	ADD	HL,BC
0103B1 DD2FFB              A  1266    	LD	(IX+-5),HL
0103B4 DD2706              A  1267    	LD	HL,(IX+6)
0103B7 010A0000            A  1268    	LD	BC,10
0103BB CD 0B 25 01         A  1269    	CALL	__iremu
0103BF 7D                  A  1270    	LD	A,L
0103C0 C630                A  1271    	ADD	A,48
0103C2 DD27FB              A  1272    	LD	HL,(IX+-5)
0103C5 77                  A  1273    	LD	(HL),A
                           A  1274    ;  406			
                           A  1275    ;  407			if (string[index] > '9')
0103C6 DD27FB              A  1276    	LD	HL,(IX+-5)
0103C9 7E                  A  1277    	LD	A,(HL)
0103CA 47                  A  1278    	LD	B,A
0103CB 17ED62              A  1279    	SEXT	HL
0103CE 68                  A  1280    	LD	L,B
0103CF E5C1                A  1281    	LD	BC,HL
0103D1 21390000            A  1282    	LD	HL,57
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  26


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0103D5 B7                  A  1283    	OR	A,A
0103D6 ED42                A  1284    	SBC	HL,BC
0103D8 F2 E6 03 01         A  1285    	JP	P,L_49
                           A  1286    ;  408				string[index] += 'A' - '9' 
0103DC DD27FB              A  1287    	LD	HL,(IX+-5)
0103DF 7E                  A  1288    	LD	A,(HL)
0103E0 C607                A  1289    	ADD	A,7
0103E2 DD27FB              A  1290    	LD	HL,(IX+-5)
0103E5 77                  A  1291    	LD	(HL),A
0103E6                     A  1292    L_49:
                           A  1293    ;  409			
                           A  1294    ;  410			val /= 10;
0103E6 010A0000            A  1295    	LD	BC,10
0103EA DD2706              A  1296    	LD	HL,(IX+6)
0103ED CD 29 25 01         A  1297    	CALL	__idivu
0103F1 DD2F06              A  1298    	LD	(IX+6),HL
                           A  1299    ;  411			++index;
0103F4 DD34FF              A  1300    	INC	(IX+-1)
                           A  1301    ;  412	  } while (val != 0);
0103F7 DD2706              A  1302    	LD	HL,(IX+6)
0103FA B7                  A  1303    	OR	A,A
0103FB 01000000            A  1304    	LD	BC,0
0103FF ED42                A  1305    	SBC	HL,BC
010401 20 A1               A  1306    	JR	NZ,L_50
                           A  1307    ;  413	  
                           A  1308    ;  414	  string[index--] = '\0'; 
010403 DD7EFF              A  1309    	LD	A,(IX+-1)
010406 17ED62              A  1310    	SEXT	HL
010409 DD6EFF              A  1311    	LD	L,(IX+-1)
01040C DD0709              A  1312    	LD	BC,(IX+9)
01040F 09                  A  1313    	ADD	HL,BC
010410 3600                A  1314    	LD	(HL),0
010412 DD35FF              A  1315    	DEC	(IX+-1)
                           A  1316    ;  415	  
                           A  1317    ;  416	  while (index > i)
010415 18 49               A  1318    	JR	L_54
010417                     A  1319    L_55:
                           A  1320    ;  417	  {
                           A  1321    ;  418	    char tmp = string[i];
010417 DD7EFE              A  1322    	LD	A,(IX+-2)
01041A 17ED62              A  1323    	SEXT	HL
01041D DD6EFE              A  1324    	LD	L,(IX+-2)
010420 DD0709              A  1325    	LD	BC,(IX+9)
010423 09                  A  1326    	ADD	HL,BC
010424 7E                  A  1327    	LD	A,(HL)
010425 DD77FA              A  1328    	LD	(IX+-6),A
                           A  1329    ;  419		  
                           A  1330    ;  420	    string[i] = string[index];
010428 DD7EFF              A  1331    	LD	A,(IX+-1)
01042B 17ED62              A  1332    	SEXT	HL
01042E DD6EFF              A  1333    	LD	L,(IX+-1)
010431 DD7EFE              A  1334    	LD	A,(IX+-2)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  27


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010434 DD0709              A  1335    	LD	BC,(IX+9)
010437 09                  A  1336    	ADD	HL,BC
010438 E5FDE1              A  1337    	LD	IY,HL
01043B 17ED62              A  1338    	SEXT	HL
01043E DD6EFE              A  1339    	LD	L,(IX+-2)
010441 FD7E00              A  1340    	LD	A,(IY)
010444 DD0709              A  1341    	LD	BC,(IX+9)
010447 09                  A  1342    	ADD	HL,BC
010448 77                  A  1343    	LD	(HL),A
                           A  1344    ;  421	    string[index] = tmp;
010449 DD7EFF              A  1345    	LD	A,(IX+-1)
01044C 17ED62              A  1346    	SEXT	HL
01044F DD6EFF              A  1347    	LD	L,(IX+-1)
010452 DD7EFA              A  1348    	LD	A,(IX+-6)
010455 DD0709              A  1349    	LD	BC,(IX+9)
010458 09                  A  1350    	ADD	HL,BC
010459 77                  A  1351    	LD	(HL),A
                           A  1352    ;  422	    ++i;
01045A DD34FE              A  1353    	INC	(IX+-2)
                           A  1354    ;  423	    --index;
01045D DD35FF              A  1355    	DEC	(IX+-1)
                           A  1356    ;  424	  }
010460                     A  1357    L_54:
010460 DD7EFE              A  1358    	LD	A,(IX+-2)
010463 DDBEFF              A  1359    	CP	A,(IX+-1)
010466 FA 70 04 01         A  1360    	JP	M,L__45
01046A EA 17 04 01         A  1361    	JP	PE,L_55
01046E 18 04               A  1362    	JR	L__46
010470                     A  1363    L__45:
010470 E2 17 04 01         A  1364    	JP	PO,L_55
010474                     A  1365    L__46:
                           A  1366    ;  425	}
010474 DDF9                A  1367    	LD	SP,IX
010476 DDE1                A  1368    	POP	IX
010478 C9                  A  1369    	RET	
                           A  1370    
                           A  1371    
                           A  1372    ;**************************** _uitoa **********
                           A  1373    ;Name                         Addr/Register   S
                           A  1374    ;tmp                                   IX-6    
                           A  1375    ;G_0                                   IX-5    
                           A  1376    ;i                                     IX-2    
                           A  1377    ;index                                 IX-1    
                           A  1378    ;string                                IX+9    
                           A  1379    ;val                                   IX+6    
                           A  1380    
                           A  1381    
                           A  1382    ; Stack Frame Size: 18 (bytes)
                           A  1383    ;       Spill Code: 0 (instruction)
                           A  1384    
                           A  1385    
                           A  1386    ;  426	
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  28


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  1387    ;  427	/* The same as malloc except it bombs i
                           A  1388    ;  428	void *mymalloc(size_t n)
                           A  1389    ;  429	{
010479                     A  1390    _mymalloc:
010479 21FDFFFF            A  1391    	LD	HL,-3
01047D CD 57 25 01         A  1392    	CALL	__frameset
                           A  1393    ;  430		void *p;
                           A  1394    ;  431		
                           A  1395    ;  432		if (n == 0)
010481 01000000            A  1396    	LD	BC,0
010485 DD2706              A  1397    	LD	HL,(IX+6)
010488 B7                  A  1398    	OR	A,A
010489 ED42                A  1399    	SBC	HL,BC
01048B 20 07               A  1400    	JR	NZ,L_59
                           A  1401    ;  433			n++;
01048D DD0706              A  1402    	LD	BC,(IX+6)
010490 03                  A  1403    	INC	BC
010491 DD0F06              A  1404    	LD	(IX+6),BC
010494                     A  1405    L_59:
                           A  1406    ;  434		
                           A  1407    ;  435		p = malloc(n);
010494 DD0706              A  1408    	LD	BC,(IX+6)
010497 C5                  A  1409    	PUSH	BC
010498 CD 3D 24 01         A  1410    	CALL	_malloc
01049C C1                  A  1411    	POP	BC
01049D DD2FFD              A  1412    	LD	(IX+-3),HL
                           A  1413    ;  436		
                           A  1414    ;  437		as(p != NULL, "out of memory!");
0104A0 01 29 27 01         A  1415    	LD	BC,L__49
0104A4 C5                  A  1416    	PUSH	BC
0104A5 DD27FD              A  1417    	LD	HL,(IX+-3)
0104A8 01000000            A  1418    	LD	BC,0
0104AC B7                  A  1419    	OR	A,A
0104AD ED42                A  1420    	SBC	HL,BC
0104AF 28 04               A  1421    	JR	Z,L__51
0104B1 3E01                A  1422    	LD	A,1
0104B3 18 01               A  1423    	JR	L__52
0104B5                     A  1424    L__51:
0104B5 AF                  A  1425    	XOR	A,A
0104B6                     A  1426    L__52:
0104B6 4F                  A  1427    	LD	C,A
0104B7 0600                A  1428    	LD	B,0
0104B9 C5                  A  1429    	PUSH	BC
0104BA CD 7C 03 01         A  1430    	CALL	_as
0104BE C1                  A  1431    	POP	BC
0104BF C1                  A  1432    	POP	BC
                           A  1433    ;  438		
                           A  1434    ;  439		return p;
0104C0 DD27FD              A  1435    	LD	HL,(IX+-3)
                           A  1436    ;  440	}
0104C3 DDF9                A  1437    	LD	SP,IX
0104C5 DDE1                A  1438    	POP	IX
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  29


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0104C7 C9                  A  1439    	RET	
                           A  1440    
                           A  1441    
                           A  1442    ;**************************** _mymalloc *******
                           A  1443    ;Name                         Addr/Register   S
                           A  1444    ;_as                                 IMPORT  --
                           A  1445    ;_malloc                             IMPORT  --
                           A  1446    ;p                                     IX-3    
                           A  1447    ;n                                     IX+6    
                           A  1448    
                           A  1449    
                           A  1450    ; Stack Frame Size: 12 (bytes)
                           A  1451    ;       Spill Code: 0 (instruction)
                           A  1452    
                           A  1453    
                           A  1454    	SEGMENT STRSECT
012729                     A  1455    L__49:
012729 6F757420 6F66206D   A  1456    	DB	"out of memory!"
012731 656D6F72 7921 
012737 00                  A  1457    	DB	0
                           A  1458    	SEGMENT CODE
                           A  1459    ;  441	
                           A  1460    ;  442	/* Returns TRUE if p[0..SCNCOLS - 1] ar
                           A  1461    ;  443	char blankrow(char *p)
                           A  1462    ;  444	{
0104C8                     A  1463    _blankrow:
0104C8 21FFFFFF            A  1464    	LD	HL,-1
0104CC CD 57 25 01         A  1465    	CALL	__frameset
0104D0 DD36FF00            A  1466    	LD	(IX+-1),0
                           A  1467    ;  445		register unsigned char i;
                           A  1468    ;  446		
                           A  1469    ;  447		for (i = 0; i < SCNCOLS; i++)
0104D4 18 20               A  1470    	JR	L_65
0104D6                     A  1471    L_63:
                           A  1472    ;  448			if (p[i] != ' ')
0104D6 DD7EFF              A  1473    	LD	A,(IX+-1)
0104D9 B7ED62              A  1474    	UEXT	HL
0104DC 6F                  A  1475    	LD	L,A
0104DD DD0706              A  1476    	LD	BC,(IX+6)
0104E0 09                  A  1477    	ADD	HL,BC
0104E1 7E                  A  1478    	LD	A,(HL)
0104E2 47                  A  1479    	LD	B,A
0104E3 17ED62              A  1480    	SEXT	HL
0104E6 68                  A  1481    	LD	L,B
0104E7 B7                  A  1482    	OR	A,A
0104E8 01200000            A  1483    	LD	BC,32
0104EC ED42                A  1484    	SBC	HL,BC
0104EE 28 03               A  1485    	JR	Z,L_64
                           A  1486    ;  449				return FALSE;
0104F0 AF                  A  1487    	XOR	A,A
0104F1 18 0C               A  1488    	JR	L_67
0104F3                     A  1489    L_64:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  30


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0104F3 DD34FF              A  1490    	INC	(IX+-1)
0104F6                     A  1491    L_65:
0104F6 DD7EFF              A  1492    	LD	A,(IX+-1)
0104F9 FE50                A  1493    	CP	A,80
0104FB 38 D9               A  1494    	JR	C,L_63
                           A  1495    ;  450			
                           A  1496    ;  451		return TRUE;
0104FD 3E01                A  1497    	LD	A,1
                           A  1498    ;  452	}
0104FF                     A  1499    L_67:
0104FF DDF9                A  1500    	LD	SP,IX
010501 DDE1                A  1501    	POP	IX
010503 C9                  A  1502    	RET	
                           A  1503    
                           A  1504    
                           A  1505    ;**************************** _blankrow *******
                           A  1506    ;Name                         Addr/Register   S
                           A  1507    ;i                                     IX-1    
                           A  1508    ;p                                     IX+6    
                           A  1509    
                           A  1510    
                           A  1511    ; Stack Frame Size: 10 (bytes)
                           A  1512    ;       Spill Code: 0 (instruction)
                           A  1513    
                           A  1514    
                           A  1515    ;  453	
                           A  1516    ;  454	/* Deletes trailing blanks from its arg
                           A  1517    ;  455	void zap_trail(char *s)
                           A  1518    ;  456	{
010504                     A  1519    _zap_trail:
010504 21FDFFFF            A  1520    	LD	HL,-3
010508 CD 57 25 01         A  1521    	CALL	__frameset
                           A  1522    ;  457		char *p = s;
01050C DD0706              A  1523    	LD	BC,(IX+6)
01050F DD0FFD              A  1524    	LD	(IX+-3),BC
                           A  1525    ;  458		
                           A  1526    ;  459		while (*s != EOS)
010512 18 20               A  1527    	JR	L_71
010514                     A  1528    L_72:
                           A  1529    ;  460		{
                           A  1530    ;  461			if (*s != ' ')
010514 DD2706              A  1531    	LD	HL,(IX+6)
010517 7E                  A  1532    	LD	A,(HL)
010518 47                  A  1533    	LD	B,A
010519 17ED62              A  1534    	SEXT	HL
01051C 68                  A  1535    	LD	L,B
01051D B7                  A  1536    	OR	A,A
01051E 01200000            A  1537    	LD	BC,32
010522 ED42                A  1538    	SBC	HL,BC
010524 28 07               A  1539    	JR	Z,L_70
                           A  1540    ;  462				p = s + 1;
010526 DD0706              A  1541    	LD	BC,(IX+6)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  31


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010529 03                  A  1542    	INC	BC
01052A DD0FFD              A  1543    	LD	(IX+-3),BC
01052D                     A  1544    L_70:
                           A  1545    ;  463			
                           A  1546    ;  464			s++;
01052D DD0706              A  1547    	LD	BC,(IX+6)
010530 03                  A  1548    	INC	BC
010531 DD0F06              A  1549    	LD	(IX+6),BC
                           A  1550    ;  465		}
010534                     A  1551    L_71:
010534 DD2706              A  1552    	LD	HL,(IX+6)
010537 7E                  A  1553    	LD	A,(HL)
010538 B7                  A  1554    	OR	A,A
010539 20 D9               A  1555    	JR	NZ,L_72
                           A  1556    ;  466		
                           A  1557    ;  467		*p = EOS;
01053B DD27FD              A  1558    	LD	HL,(IX+-3)
01053E 3600                A  1559    	LD	(HL),0
                           A  1560    ;  468	}
010540 DDF9                A  1561    	LD	SP,IX
010542 DDE1                A  1562    	POP	IX
010544 C9                  A  1563    	RET	
                           A  1564    
                           A  1565    
                           A  1566    ;**************************** _zap_trail ******
                           A  1567    ;Name                         Addr/Register   S
                           A  1568    ;p                                     IX-3    
                           A  1569    ;s                                     IX+6    
                           A  1570    
                           A  1571    
                           A  1572    ; Stack Frame Size: 12 (bytes)
                           A  1573    ;       Spill Code: 0 (instruction)
                           A  1574    
                           A  1575    
                           A  1576    ;  469	
                           A  1577    ;  470	/* Deletes all non-printables from the 
                           A  1578    ;  471	/* Replaces each TAB by a space.       
                           A  1579    ;  472	void purify(char *st)
                           A  1580    ;  473	{
010545                     A  1581    _purify:
010545 21F4FFFF            A  1582    	LD	HL,-12
010549 CD 57 25 01         A  1583    	CALL	__frameset
                           A  1584    ;  474		char *s = st;
01054D DD0706              A  1585    	LD	BC,(IX+6)
010550 DD0FFD              A  1586    	LD	(IX+-3),BC
                           A  1587    ;  475		char *d = st;
010553 DD0706              A  1588    	LD	BC,(IX+6)
010556 DD0FFA              A  1589    	LD	(IX+-6),BC
                           A  1590    ;  476		
                           A  1591    ;  477		while (*s)
010559 18 73               A  1592    	JR	L_83
01055B                     A  1593    L_84:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  32


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  1594    ;  478		{
                           A  1595    ;  479			if ((' ' <= *s) && (*s <= '~'))
01055B DD27FD              A  1596    	LD	HL,(IX+-3)
01055E 7E                  A  1597    	LD	A,(HL)
01055F 47                  A  1598    	LD	B,A
010560 17ED62              A  1599    	SEXT	HL
010563 68                  A  1600    	LD	L,B
010564 B7                  A  1601    	OR	A,A
010565 01200000            A  1602    	LD	BC,32
010569 ED42                A  1603    	SBC	HL,BC
01056B FA A4 05 01         A  1604    	JP	M,L_80
01056F DD27FD              A  1605    	LD	HL,(IX+-3)
010572 7E                  A  1606    	LD	A,(HL)
010573 47                  A  1607    	LD	B,A
010574 17ED62              A  1608    	SEXT	HL
010577 68                  A  1609    	LD	L,B
010578 E5C1                A  1610    	LD	BC,HL
01057A 217E0000            A  1611    	LD	HL,126
01057E B7                  A  1612    	OR	A,A
01057F ED42                A  1613    	SBC	HL,BC
010581 FA 8B 05 01         A  1614    	JP	M,L__64
010585 EA A4 05 01         A  1615    	JP	PE,L_80
010589 18 04               A  1616    	JR	L__65
01058B                     A  1617    L__64:
01058B E2 A4 05 01         A  1618    	JP	PO,L_80
01058F                     A  1619    L__65:
                           A  1620    ;  480				*d++ = *s;
01058F DD07FA              A  1621    	LD	BC,(IX+-6)
010592 DD0FF7              A  1622    	LD	(IX+-9),BC
010595 DD27FD              A  1623    	LD	HL,(IX+-3)
010598 7E                  A  1624    	LD	A,(HL)
010599 DD27F7              A  1625    	LD	HL,(IX+-9)
01059C 77                  A  1626    	LD	(HL),A
01059D DD07FA              A  1627    	LD	BC,(IX+-6)
0105A0 03                  A  1628    	INC	BC
0105A1 DD0FFA              A  1629    	LD	(IX+-6),BC
0105A4                     A  1630    L_80:
                           A  1631    ;  481			
                           A  1632    ;  482			if (*s == CH_TAB)		
0105A4 DD27FD              A  1633    	LD	HL,(IX+-3)
0105A7 7E                  A  1634    	LD	A,(HL)
0105A8 47                  A  1635    	LD	B,A
0105A9 17ED62              A  1636    	SEXT	HL
0105AC 68                  A  1637    	LD	L,B
0105AD B7                  A  1638    	OR	A,A
0105AE 01090000            A  1639    	LD	BC,9
0105B2 ED42                A  1640    	SBC	HL,BC
0105B4 20 11               A  1641    	JR	NZ,L_82
                           A  1642    ;  483				*d++ = ' ';
0105B6 DD07FA              A  1643    	LD	BC,(IX+-6)
0105B9 DD0FF4              A  1644    	LD	(IX+-12),BC
0105BC C5E1                A  1645    	LD	HL,BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  33


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0105BE 3620                A  1646    	LD	(HL),32
0105C0 DD07FA              A  1647    	LD	BC,(IX+-6)
0105C3 03                  A  1648    	INC	BC
0105C4 DD0FFA              A  1649    	LD	(IX+-6),BC
0105C7                     A  1650    L_82:
                           A  1651    ;  484			
                           A  1652    ;  485			s++;
0105C7 DD07FD              A  1653    	LD	BC,(IX+-3)
0105CA 03                  A  1654    	INC	BC
0105CB DD0FFD              A  1655    	LD	(IX+-3),BC
                           A  1656    ;  486		}
0105CE                     A  1657    L_83:
0105CE DD27FD              A  1658    	LD	HL,(IX+-3)
0105D1 7E                  A  1659    	LD	A,(HL)
0105D2 B7                  A  1660    	OR	A,A
0105D3 20 86               A  1661    	JR	NZ,L_84
                           A  1662    ;  487		
                           A  1663    ;  488		*d = EOS;
0105D5 DD27FA              A  1664    	LD	HL,(IX+-6)
0105D8 3600                A  1665    	LD	(HL),0
                           A  1666    ;  489	}
0105DA DDF9                A  1667    	LD	SP,IX
0105DC DDE1                A  1668    	POP	IX
0105DE C9                  A  1669    	RET	
                           A  1670    
                           A  1671    
                           A  1672    ;**************************** _purify *********
                           A  1673    ;Name                         Addr/Register   S
                           A  1674    ;d                                     IX-6    
                           A  1675    ;s                                     IX-3    
                           A  1676    ;st                                    IX+6    
                           A  1677    
                           A  1678    
                           A  1679    ; Stack Frame Size: 21 (bytes)
                           A  1680    ;       Spill Code: 0 (instruction)
                           A  1681    
                           A  1682    
                           A  1683    ;  490	
                           A  1684    ;  491	/* Flushes the terminal's output buffer
                           A  1685    ;  492	void te_flu(void)
                           A  1686    ;  493	{
0105DF                     A  1687    _te_flu:
                           A  1688    ;  494		if (tebuflen == 0)
0105DF 01000000            A  1689    	LD	BC,0
0105E3 2A 7A 2C 01         A  1690    	LD	HL,(_tebuflen)
0105E7 B7                  A  1691    	OR	A,A
0105E8 ED42                A  1692    	SBC	HL,BC
0105EA 28 1A               A  1693    	JR	Z,L_89
                           A  1694    ;  495			return;
                           A  1695    ;  496		
                           A  1696    ;  497		tebuf[tebuflen] = EOS;
                           A  1697    ;  498		
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  34


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  1698    ;  499		print(tebuf);
0105EC 01 7D 2C 01         A  1699    	LD	BC,_tebuf
0105F0 C5                  A  1700    	PUSH	BC
0105F1 2A 7A 2C 01         A  1701    	LD	HL,(_tebuflen)
0105F5 09                  A  1702    	ADD	HL,BC
0105F6 3600                A  1703    	LD	(HL),0
0105F8 CD 36 02 01         A  1704    	CALL	_print
0105FC C1                  A  1705    	POP	BC
                           A  1706    ;  500		
                           A  1707    ;  501		tebuflen = 0;
0105FD 01000000            A  1708    	LD	BC,0
010601 ED43 7A 2C 01       A  1709    	LD	(_tebuflen),BC
                           A  1710    ;  502	}
010606                     A  1711    L_89:
010606 C9                  A  1712    	RET	
                           A  1713    
                           A  1714    
                           A  1715    ;**************************** _te_flu *********
                           A  1716    ;Name                         Addr/Register   S
                           A  1717    ;_print                              IMPORT  --
                           A  1718    ;_tebuf                              STATIC   2
                           A  1719    ;_tebuflen                           STATIC    
                           A  1720    
                           A  1721    
                           A  1722    ; Stack Frame Size: 6 (bytes)
                           A  1723    ;       Spill Code: 0 (instruction)
                           A  1724    
                           A  1725    
                           A  1726    ;  503	
                           A  1727    ;  504	/* Get a character from the console. */
                           A  1728    ;  505	unsigned char te_gch(void)
                           A  1729    ;  506	{
010607                     A  1730    _te_gch:
                           A  1731    ;  507		te_flu();
010607 CD DF 05 01         A  1732    	CALL	_te_flu
                           A  1733    ;  508		
                           A  1734    ;  509		return getch();
01060B CD 29 01 01         A  1735    	CALL	_getch
                           A  1736    ;  510	}
01060F C9                  A  1737    	RET	
                           A  1738    
                           A  1739    
                           A  1740    ;**************************** _te_gch *********
                           A  1741    ;Name                         Addr/Register   S
                           A  1742    ;_getch                              IMPORT  --
                           A  1743    ;_te_flu                             IMPORT  --
                           A  1744    
                           A  1745    
                           A  1746    ; Stack Frame Size: 6 (bytes)
                           A  1747    ;       Spill Code: 0 (instruction)
                           A  1748    
                           A  1749    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  35


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  1750    ;  511	
                           A  1751    ;  512	/* Writes its argument character to the
                           A  1752    ;  513	void te_chr(char ch)
                           A  1753    ;  514	{
010610                     A  1754    _te_chr:
010610 CD 4A 25 01         A  1755    	CALL	__frameset0
                           A  1756    ;  515		tebuf[tebuflen++] = (char) ch;
010614 01 7D 2C 01         A  1757    	LD	BC,_tebuf
010618 2A 7A 2C 01         A  1758    	LD	HL,(_tebuflen)
01061C 09                  A  1759    	ADD	HL,BC
01061D DD7E06              A  1760    	LD	A,(IX+6)
010620 77                  A  1761    	LD	(HL),A
010621 ED4B 7A 2C 01       A  1762    	LD	BC,(_tebuflen)
010626 03                  A  1763    	INC	BC
010627 ED43 7A 2C 01       A  1764    	LD	(_tebuflen),BC
                           A  1765    ;  516		
                           A  1766    ;  517		if (tebuflen == TEBUFMAX)
01062C 2A 7A 2C 01         A  1767    	LD	HL,(_tebuflen)
010630 B7                  A  1768    	OR	A,A
010631 01000800            A  1769    	LD	BC,2048
010635 ED42                A  1770    	SBC	HL,BC
010637 20 04               A  1771    	JR	NZ,L_93
                           A  1772    ;  518			te_flu();
010639 CD DF 05 01         A  1773    	CALL	_te_flu
                           A  1774    ;  519	}
01063D                     A  1775    L_93:
01063D DDF9                A  1776    	LD	SP,IX
01063F DDE1                A  1777    	POP	IX
010641 C9                  A  1778    	RET	
                           A  1779    
                           A  1780    
                           A  1781    ;**************************** _te_chr *********
                           A  1782    ;Name                         Addr/Register   S
                           A  1783    ;_te_flu                             IMPORT  --
                           A  1784    ;_tebuflen                           STATIC    
                           A  1785    ;_tebuf                              STATIC   2
                           A  1786    ;ch                                    IX+6    
                           A  1787    
                           A  1788    
                           A  1789    ; Stack Frame Size: 9 (bytes)
                           A  1790    ;       Spill Code: 0 (instruction)
                           A  1791    
                           A  1792    
                           A  1793    ;  520	
                           A  1794    ;  521	/* Writes its argument string to the te
                           A  1795    ;  522	void te_str(char *s)
                           A  1796    ;  523	{
010642                     A  1797    _te_str:
010642 21FDFFFF            A  1798    	LD	HL,-3
010646 CD 57 25 01         A  1799    	CALL	__frameset
                           A  1800    ;  524		while (*s)
01064A 18 19               A  1801    	JR	L_95
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  36


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01064C                     A  1802    L_96:
                           A  1803    ;  525			te_chr((unsigned char)(*s++));
01064C DD0706              A  1804    	LD	BC,(IX+6)
01064F DD0FFD              A  1805    	LD	(IX+-3),BC
010652 DD0706              A  1806    	LD	BC,(IX+6)
010655 03                  A  1807    	INC	BC
010656 DD0F06              A  1808    	LD	(IX+6),BC
010659 DD27FD              A  1809    	LD	HL,(IX+-3)
01065C 4E                  A  1810    	LD	C,(HL)
01065D 0600                A  1811    	LD	B,0
01065F C5                  A  1812    	PUSH	BC
010660 CD 10 06 01         A  1813    	CALL	_te_chr
010664 C1                  A  1814    	POP	BC
010665                     A  1815    L_95:
010665 DD2706              A  1816    	LD	HL,(IX+6)
010668 7E                  A  1817    	LD	A,(HL)
010669 B7                  A  1818    	OR	A,A
01066A 20 E0               A  1819    	JR	NZ,L_96
                           A  1820    ;  526	}
01066C DDF9                A  1821    	LD	SP,IX
01066E DDE1                A  1822    	POP	IX
010670 C9                  A  1823    	RET	
                           A  1824    
                           A  1825    
                           A  1826    ;**************************** _te_str *********
                           A  1827    ;Name                         Addr/Register   S
                           A  1828    ;_te_chr                             IMPORT  --
                           A  1829    ;s                                     IX+6    
                           A  1830    
                           A  1831    
                           A  1832    ; Stack Frame Size: 12 (bytes)
                           A  1833    ;       Spill Code: 0 (instruction)
                           A  1834    
                           A  1835    
                           A  1836    ;  527	
                           A  1837    ;  528	/* Moves the cursor to the specified ro
                           A  1838    ;  529	void te_mov(unsigned char r, unsigned c
                           A  1839    ;  530	{
010671                     A  1840    _te_mov:
010671 21FAFFFF            A  1841    	LD	HL,-6
010675 CD 57 25 01         A  1842    	CALL	__frameset
                           A  1843    ;  531		as((0 <= r) && (r <= SCNROWS), "te_
010679 DD7E06              A  1844    	LD	A,(IX+6)
01067C B7                  A  1845    	OR	A,A
01067D 38 10               A  1846    	JR	C,L_100
01067F 3E32                A  1847    	LD	A,50
010681 DDBE06              A  1848    	CP	A,(IX+6)
010684 38 09               A  1849    	JR	C,L_100
010686 01010000            A  1850    	LD	BC,1
01068A DD0FFD              A  1851    	LD	(IX+-3),BC
01068D 18 07               A  1852    	JR	L_101
01068F                     A  1853    L_100:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  37


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01068F 01000000            A  1854    	LD	BC,0
010693 DD0FFD              A  1855    	LD	(IX+-3),BC
010696                     A  1856    L_101:
010696 01 38 27 01         A  1857    	LD	BC,L__76
01069A C5                  A  1858    	PUSH	BC
01069B DD4EFD              A  1859    	LD	C,(IX+-3)
01069E 0600                A  1860    	LD	B,0
0106A0 C5                  A  1861    	PUSH	BC
0106A1 CD 7C 03 01         A  1862    	CALL	_as
0106A5 C1                  A  1863    	POP	BC
0106A6 C1                  A  1864    	POP	BC
                           A  1865    ;  532		
                           A  1866    ;  533		as((0 <= c) && (c <= SCNCOLS), "te_
0106A7 DD7E09              A  1867    	LD	A,(IX+9)
0106AA B7                  A  1868    	OR	A,A
0106AB 38 10               A  1869    	JR	C,L_105
0106AD 3E50                A  1870    	LD	A,80
0106AF DDBE09              A  1871    	CP	A,(IX+9)
0106B2 38 09               A  1872    	JR	C,L_105
0106B4 01010000            A  1873    	LD	BC,1
0106B8 DD0FFA              A  1874    	LD	(IX+-6),BC
0106BB 18 07               A  1875    	JR	L_106
0106BD                     A  1876    L_105:
0106BD 01000000            A  1877    	LD	BC,0
0106C1 DD0FFA              A  1878    	LD	(IX+-6),BC
0106C4                     A  1879    L_106:
0106C4 01 49 27 01         A  1880    	LD	BC,L__79
0106C8 C5                  A  1881    	PUSH	BC
0106C9 DD4EFA              A  1882    	LD	C,(IX+-6)
0106CC 0600                A  1883    	LD	B,0
0106CE C5                  A  1884    	PUSH	BC
0106CF CD 7C 03 01         A  1885    	CALL	_as
0106D3 C1                  A  1886    	POP	BC
0106D4 C1                  A  1887    	POP	BC
                           A  1888    ;  534		
                           A  1889    ;  535		te_flu();
0106D5 CD DF 05 01         A  1890    	CALL	_te_flu
                           A  1891    ;  536		
                           A  1892    ;  537		gotoxy(c, r);
0106D9 DD4E06              A  1893    	LD	C,(IX+6)
0106DC 0600                A  1894    	LD	B,0
0106DE C5                  A  1895    	PUSH	BC
0106DF DD4E09              A  1896    	LD	C,(IX+9)
0106E2 C5                  A  1897    	PUSH	BC
0106E3 CD FF 02 01         A  1898    	CALL	_gotoxy
0106E7 C1                  A  1899    	POP	BC
0106E8 C1                  A  1900    	POP	BC
                           A  1901    ;  538	}
0106E9 DDF9                A  1902    	LD	SP,IX
0106EB DDE1                A  1903    	POP	IX
0106ED C9                  A  1904    	RET	
                           A  1905    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  38


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  1906    
                           A  1907    ;**************************** _te_mov *********
                           A  1908    ;Name                         Addr/Register   S
                           A  1909    ;_gotoxy                             IMPORT  --
                           A  1910    ;_te_flu                             IMPORT  --
                           A  1911    ;_as                                 IMPORT  --
                           A  1912    ;temp107                               IX-6    
                           A  1913    ;temp102                               IX-3    
                           A  1914    ;c                                     IX+9    
                           A  1915    ;r                                     IX+6    
                           A  1916    
                           A  1917    
                           A  1918    ; Stack Frame Size: 18 (bytes)
                           A  1919    ;       Spill Code: 0 (instruction)
                           A  1920    
                           A  1921    
                           A  1922    	SEGMENT STRSECT
012738                     A  1923    L__76:
012738 74655F6D 6F763A20   A  1924    	DB	"te_mov: Bad row."
012740 42616420 726F772E 
012748 00                  A  1925    	DB	0
012749                     A  1926    L__79:
012749 74655F6D 6F763A20   A  1927    	DB	"te_mov: Bad col."
012751 42616420 636F6C2E 
012759 00                  A  1928    	DB	0
                           A  1929    	SEGMENT CODE
                           A  1930    ;  539	
                           A  1931    ;  540	/* Sets the specified row of the termin
                           A  1932    ;  541	/* Leaves the cursor at the start of th
                           A  1933    ;  542	void te_cln(unsigned char row)
                           A  1934    ;  543	{
0106EE                     A  1935    _te_cln:
0106EE CD 4A 25 01         A  1936    	CALL	__frameset0
                           A  1937    ;  544		te_mov(row, 0);
0106F2 01000000            A  1938    	LD	BC,0
0106F6 C5                  A  1939    	PUSH	BC
0106F7 DD4E06              A  1940    	LD	C,(IX+6)
0106FA 0600                A  1941    	LD	B,0
0106FC C5                  A  1942    	PUSH	BC
0106FD CD 71 06 01         A  1943    	CALL	_te_mov
010701 C1                  A  1944    	POP	BC
010702 C1                  A  1945    	POP	BC
                           A  1946    ;  545		
                           A  1947    ;  546		clreol();
010703 CD BC 02 01         A  1948    	CALL	_clreol
                           A  1949    ;  547	}
010707 DDF9                A  1950    	LD	SP,IX
010709 DDE1                A  1951    	POP	IX
01070B C9                  A  1952    	RET	
                           A  1953    
                           A  1954    
                           A  1955    ;**************************** _te_cln *********
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  39


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  1956    ;Name                         Addr/Register   S
                           A  1957    ;_clreol                             IMPORT  --
                           A  1958    ;_te_mov                             IMPORT  --
                           A  1959    ;row                                   IX+6    
                           A  1960    
                           A  1961    
                           A  1962    ; Stack Frame Size: 9 (bytes)
                           A  1963    ;       Spill Code: 0 (instruction)
                           A  1964    
                           A  1965    
                           A  1966    ;  548	
                           A  1967    ;  549	/* Homes the cursor and clears the scre
                           A  1968    ;  550	void te_clr(void)
                           A  1969    ;  551	{
01070C                     A  1970    _te_clr:
01070C 21FFFFFF            A  1971    	LD	HL,-1
010710 CD 57 25 01         A  1972    	CALL	__frameset
010714 DD36FF00            A  1973    	LD	(IX+-1),0
                           A  1974    ;  552		register unsigned char r;
                           A  1975    ;  553		
                           A  1976    ;  554		for (r = 0; r < SCNROWS; r++)
010718 18 0E               A  1977    	JR	L_113
01071A                     A  1978    L_111:
                           A  1979    ;  555			te_cln(r);
01071A DD4EFF              A  1980    	LD	C,(IX+-1)
01071D 0600                A  1981    	LD	B,0
01071F C5                  A  1982    	PUSH	BC
010720 CD EE 06 01         A  1983    	CALL	_te_cln
010724 C1                  A  1984    	POP	BC
010725 DD34FF              A  1985    	INC	(IX+-1)
010728                     A  1986    L_113:
010728 DD7EFF              A  1987    	LD	A,(IX+-1)
01072B FE32                A  1988    	CP	A,50
01072D 38 EB               A  1989    	JR	C,L_111
                           A  1990    ;  556		
                           A  1991    ;  557		te_mov(0, 0);
01072F 01000000            A  1992    	LD	BC,0
010733 C5                  A  1993    	PUSH	BC
010734 C5                  A  1994    	PUSH	BC
010735 CD 71 06 01         A  1995    	CALL	_te_mov
010739 C1                  A  1996    	POP	BC
01073A C1                  A  1997    	POP	BC
                           A  1998    ;  558	}
01073B DDF9                A  1999    	LD	SP,IX
01073D DDE1                A  2000    	POP	IX
01073F C9                  A  2001    	RET	
                           A  2002    
                           A  2003    
                           A  2004    ;**************************** _te_clr *********
                           A  2005    ;Name                         Addr/Register   S
                           A  2006    ;_te_mov                             IMPORT  --
                           A  2007    ;_te_cln                             IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  40


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  2008    ;r                                     IX-1    
                           A  2009    
                           A  2010    
                           A  2011    ; Stack Frame Size: 7 (bytes)
                           A  2012    ;       Spill Code: 0 (instruction)
                           A  2013    
                           A  2014    
                           A  2015    ;  559	
                           A  2016    ;  560	/* Initializes the terminal package. */
                           A  2017    ;  561	void te_ini(void)
                           A  2018    ;  562	{
010740                     A  2019    _te_ini:
                           A  2020    ;  563		tebuflen = 0;
010740 01000000            A  2021    	LD	BC,0
010744 ED43 7A 2C 01       A  2022    	LD	(_tebuflen),BC
                           A  2023    ;  564	}
010749 C9                  A  2024    	RET	
                           A  2025    
                           A  2026    
                           A  2027    ;**************************** _te_ini *********
                           A  2028    ;Name                         Addr/Register   S
                           A  2029    ;_tebuflen                           STATIC    
                           A  2030    
                           A  2031    
                           A  2032    ; Stack Frame Size: 6 (bytes)
                           A  2033    ;       Spill Code: 0 (instruction)
                           A  2034    
                           A  2035    
                           A  2036    ;  565	
                           A  2037    ;  566	/* Finalize the terminal package. */
                           A  2038    ;  567	void te_fin(void)
                           A  2039    ;  568	{
01074A                     A  2040    _te_fin:
                           A  2041    ;  569		te_flu();
01074A CD DF 05 01         A  2042    	CALL	_te_flu
                           A  2043    ;  570	}
01074E C9                  A  2044    	RET	
                           A  2045    
                           A  2046    
                           A  2047    ;**************************** _te_fin *********
                           A  2048    ;Name                         Addr/Register   S
                           A  2049    ;_te_flu                             IMPORT  --
                           A  2050    
                           A  2051    
                           A  2052    ; Stack Frame Size: 6 (bytes)
                           A  2053    ;       Spill Code: 0 (instruction)
                           A  2054    
                           A  2055    
                           A  2056    ;  571	
                           A  2057    ;  572	/* Clear the virtual screen. */
                           A  2058    ;  573	void sc_clr(void)
                           A  2059    ;  574	{
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  41


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01074F                     A  2060    _sc_clr:
                           A  2061    ;  575		memset(&scn_virt[0][0], ' ', SCNSIZ
01074F 01A00F00            A  2062    	LD	BC,4000
010753 C5                  A  2063    	PUSH	BC
010754 01200000            A  2064    	LD	BC,32
010758 C5                  A  2065    	PUSH	BC
010759 01 87 34 01         A  2066    	LD	BC,_scn_virt
01075D C5                  A  2067    	PUSH	BC
01075E CD 15 26 01         A  2068    	CALL	_memset
010762 C1                  A  2069    	POP	BC
010763 C1                  A  2070    	POP	BC
010764 C1                  A  2071    	POP	BC
                           A  2072    ;  576	}
010765 C9                  A  2073    	RET	
                           A  2074    
                           A  2075    
                           A  2076    ;**************************** _sc_clr *********
                           A  2077    ;Name                         Addr/Register   S
                           A  2078    ;_scn_virt                           STATIC   4
                           A  2079    ;_memset                             IMPORT  --
                           A  2080    
                           A  2081    
                           A  2082    ; Stack Frame Size: 6 (bytes)
                           A  2083    ;       Spill Code: 0 (instruction)
                           A  2084    
                           A  2085    
                           A  2086    ;  577	
                           A  2087    ;  578	/* Clear the specified row of the virtu
                           A  2088    ;  579	void sc_crw(unsigned char row)
                           A  2089    ;  580	{
010766                     A  2090    _sc_crw:
010766 21FDFFFF            A  2091    	LD	HL,-3
01076A CD 57 25 01         A  2092    	CALL	__frameset
                           A  2093    ;  581		as((0 <= row) && (row <= SCNROWS), 
01076E DD7E06              A  2094    	LD	A,(IX+6)
010771 B7                  A  2095    	OR	A,A
010772 38 10               A  2096    	JR	C,L_121
010774 3E32                A  2097    	LD	A,50
010776 DDBE06              A  2098    	CP	A,(IX+6)
010779 38 09               A  2099    	JR	C,L_121
01077B 01010000            A  2100    	LD	BC,1
01077F DD0FFD              A  2101    	LD	(IX+-3),BC
010782 18 07               A  2102    	JR	L_122
010784                     A  2103    L_121:
010784 01000000            A  2104    	LD	BC,0
010788 DD0FFD              A  2105    	LD	(IX+-3),BC
01078B                     A  2106    L_122:
01078B 01 5A 27 01         A  2107    	LD	BC,L__89
01078F C5                  A  2108    	PUSH	BC
010790 DD4EFD              A  2109    	LD	C,(IX+-3)
010793 0600                A  2110    	LD	B,0
010795 C5                  A  2111    	PUSH	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  42


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010796 CD 7C 03 01         A  2112    	CALL	_as
01079A C1                  A  2113    	POP	BC
01079B C1                  A  2114    	POP	BC
                           A  2115    ;  582		
                           A  2116    ;  583		memset(&scn_virt[row][0], ' ', SCNC
01079C 01500000            A  2117    	LD	BC,80
0107A0 C5                  A  2118    	PUSH	BC
0107A1 01200000            A  2119    	LD	BC,32
0107A5 C5                  A  2120    	PUSH	BC
0107A6 DD7E06              A  2121    	LD	A,(IX+6)
0107A9 B7ED62              A  2122    	UEXT	HL
0107AC 6F                  A  2123    	LD	L,A
0107AD E5C1                A  2124    	LD	BC,HL
0107AF C5E1                A  2125    	LD	HL,BC
0107B1 29                  A  2126    	ADD	HL,HL
0107B2 29                  A  2127    	ADD	HL,HL
0107B3 09                  A  2128    	ADD	HL,BC
0107B4 29                  A  2129    	ADD	HL,HL
0107B5 29                  A  2130    	ADD	HL,HL
0107B6 29                  A  2131    	ADD	HL,HL
0107B7 29                  A  2132    	ADD	HL,HL
0107B8 01 87 34 01         A  2133    	LD	BC,_scn_virt
0107BC 09                  A  2134    	ADD	HL,BC
0107BD E5                  A  2135    	PUSH	HL
0107BE CD 15 26 01         A  2136    	CALL	_memset
0107C2 C1                  A  2137    	POP	BC
0107C3 C1                  A  2138    	POP	BC
0107C4 C1                  A  2139    	POP	BC
                           A  2140    ;  584	}
0107C5 DDF9                A  2141    	LD	SP,IX
0107C7 DDE1                A  2142    	POP	IX
0107C9 C9                  A  2143    	RET	
                           A  2144    
                           A  2145    
                           A  2146    ;**************************** _sc_crw *********
                           A  2147    ;Name                         Addr/Register   S
                           A  2148    ;_scn_virt                           STATIC   4
                           A  2149    ;_memset                             IMPORT  --
                           A  2150    ;_as                                 IMPORT  --
                           A  2151    ;temp123                               IX-3    
                           A  2152    ;row                                   IX+6    
                           A  2153    
                           A  2154    
                           A  2155    ; Stack Frame Size: 12 (bytes)
                           A  2156    ;       Spill Code: 0 (instruction)
                           A  2157    
                           A  2158    
                           A  2159    	SEGMENT STRSECT
01275A                     A  2160    L__89:
01275A 73635F63 72773A20   A  2161    	DB	"sc_crw: Bad row number."
012762 42616420 726F7720 
01276A 6E756D62 65722E 
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  43


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
012771 00                  A  2162    	DB	0
                           A  2163    	SEGMENT CODE
                           A  2164    ;  585	
                           A  2165    ;  586	/* Places the specified character at th
                           A  2166    ;  587	/* screen. If the row and column are of
                           A  2167    ;  588	void sc_chr(unsigned char row, unsigned
                           A  2168    ;  589	{
0107CA                     A  2169    _sc_chr:
0107CA CD 4A 25 01         A  2170    	CALL	__frameset0
                           A  2171    ;  590		if (((0 <= row) && (row < SCNROWS))
0107CE DD7E06              A  2172    	LD	A,(IX+6)
0107D1 B7                  A  2173    	OR	A,A
0107D2 38 39               A  2174    	JR	C,L_129
0107D4 DD7E06              A  2175    	LD	A,(IX+6)
0107D7 FE32                A  2176    	CP	A,50
0107D9 30 32               A  2177    	JR	NC,L_129
0107DB DD7E09              A  2178    	LD	A,(IX+9)
0107DE B7                  A  2179    	OR	A,A
0107DF 38 2C               A  2180    	JR	C,L_129
0107E1 DD7E09              A  2181    	LD	A,(IX+9)
0107E4 FE50                A  2182    	CP	A,80
0107E6 30 25               A  2183    	JR	NC,L_129
                           A  2184    ;  591			scn_virt[row - 0][col - 0] = (c
0107E8 DD7E06              A  2185    	LD	A,(IX+6)
0107EB B7ED62              A  2186    	UEXT	HL
0107EE 6F                  A  2187    	LD	L,A
0107EF E5C1                A  2188    	LD	BC,HL
0107F1 C5E1                A  2189    	LD	HL,BC
0107F3 DD7E09              A  2190    	LD	A,(IX+9)
0107F6 29                  A  2191    	ADD	HL,HL
0107F7 29                  A  2192    	ADD	HL,HL
0107F8 09                  A  2193    	ADD	HL,BC
0107F9 29                  A  2194    	ADD	HL,HL
0107FA 29                  A  2195    	ADD	HL,HL
0107FB 29                  A  2196    	ADD	HL,HL
0107FC 29                  A  2197    	ADD	HL,HL
0107FD 01 87 34 01         A  2198    	LD	BC,_scn_virt
010801 09                  A  2199    	ADD	HL,BC
010802 E5C1                A  2200    	LD	BC,HL
010804 B7ED62              A  2201    	UEXT	HL
010807 6F                  A  2202    	LD	L,A
010808 DD7E0C              A  2203    	LD	A,(IX+12)
01080B 09                  A  2204    	ADD	HL,BC
01080C 77                  A  2205    	LD	(HL),A
                           A  2206    ;  592	}
01080D                     A  2207    L_129:
01080D DDF9                A  2208    	LD	SP,IX
01080F DDE1                A  2209    	POP	IX
010811 C9                  A  2210    	RET	
                           A  2211    
                           A  2212    
                           A  2213    ;**************************** _sc_chr *********
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  44


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  2214    ;Name                         Addr/Register   S
                           A  2215    ;_scn_virt                           STATIC   4
                           A  2216    ;ch                                   IX+12    
                           A  2217    ;col                                   IX+9    
                           A  2218    ;row                                   IX+6    
                           A  2219    
                           A  2220    
                           A  2221    ; Stack Frame Size: 15 (bytes)
                           A  2222    ;       Spill Code: 0 (instruction)
                           A  2223    
                           A  2224    
                           A  2225    ;  593	
                           A  2226    ;  594	/* Writes the specified string on the v
                           A  2227    ;  595	/* The function ignores any part of the
                           A  2228    ;  596	void sc_str(unsigned char row, unsigned
                           A  2229    ;  597	{
010812                     A  2230    _sc_str:
010812 21F9FFFF            A  2231    	LD	HL,-7
010816 CD 57 25 01         A  2232    	CALL	__frameset
                           A  2233    ;  598		unsigned char c = col;
01081A DD7E09              A  2234    	LD	A,(IX+9)
01081D DD77FF              A  2235    	LD	(IX+-1),A
                           A  2236    ;  599		char *t = s;
010820 DD070C              A  2237    	LD	BC,(IX+12)
010823 DD0FFC              A  2238    	LD	(IX+-4),BC
                           A  2239    ;  600		
                           A  2240    ;  601		while (*t)
010826 18 27               A  2241    	JR	L_132
010828                     A  2242    L_133:
                           A  2243    ;  602			sc_chr(row, c++, (unsigned char
010828 DD7EFF              A  2244    	LD	A,(IX+-1)
01082B DD07FC              A  2245    	LD	BC,(IX+-4)
01082E DD0FF9              A  2246    	LD	(IX+-7),BC
010831 DD34FF              A  2247    	INC	(IX+-1)
010834 DD07FC              A  2248    	LD	BC,(IX+-4)
010837 03                  A  2249    	INC	BC
010838 DD0FFC              A  2250    	LD	(IX+-4),BC
01083B DD27F9              A  2251    	LD	HL,(IX+-7)
01083E 4E                  A  2252    	LD	C,(HL)
01083F 0600                A  2253    	LD	B,0
010841 C5                  A  2254    	PUSH	BC
010842 4F                  A  2255    	LD	C,A
010843 C5                  A  2256    	PUSH	BC
010844 DD4E06              A  2257    	LD	C,(IX+6)
010847 C5                  A  2258    	PUSH	BC
010848 CD CA 07 01         A  2259    	CALL	_sc_chr
01084C C1                  A  2260    	POP	BC
01084D C1                  A  2261    	POP	BC
01084E C1                  A  2262    	POP	BC
01084F                     A  2263    L_132:
01084F DD27FC              A  2264    	LD	HL,(IX+-4)
010852 7E                  A  2265    	LD	A,(HL)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  45


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010853 B7                  A  2266    	OR	A,A
010854 20 D2               A  2267    	JR	NZ,L_133
                           A  2268    ;  603	}
010856 DDF9                A  2269    	LD	SP,IX
010858 DDE1                A  2270    	POP	IX
01085A C9                  A  2271    	RET	
                           A  2272    
                           A  2273    
                           A  2274    ;**************************** _sc_str *********
                           A  2275    ;Name                         Addr/Register   S
                           A  2276    ;_sc_chr                             IMPORT  --
                           A  2277    ;t                                     IX-4    
                           A  2278    ;c                                     IX-1    
                           A  2279    ;s                                    IX+12    
                           A  2280    ;col                                   IX+9    
                           A  2281    ;row                                   IX+6    
                           A  2282    
                           A  2283    
                           A  2284    ; Stack Frame Size: 22 (bytes)
                           A  2285    ;       Spill Code: 0 (instruction)
                           A  2286    
                           A  2287    
                           A  2288    ;  604	
                           A  2289    ;  605	/* Updates the physical screen from the
                           A  2290    ;  606	/* - Identifying the differences betwee
                           A  2291    ;  607	/* - Sending characters to the terminal
                           A  2292    ;  608	/* - Setting the physical screen to the
                           A  2293    ;  609	void sc_upd(void)
                           A  2294    ;  610	{
01085B                     A  2295    _sc_upd:
01085B 21F3FFFF            A  2296    	LD	HL,-13
01085F CD 57 25 01         A  2297    	CALL	__frameset
010863 DD36FC00            A  2298    	LD	(IX+-4),0
                           A  2299    ;  611		register unsigned char r, c;
                           A  2300    ;  612		
                           A  2301    ;  613		for (r = 0; r < SCNROWS; r++)
010867 C3 84 09 01         A  2302    	JR	L_152
01086B                     A  2303    L_150:
                           A  2304    ;  614		{
                           A  2305    ;  615			if (memcmp(&scn_virt[r - 0][0],
01086B DD7EFC              A  2306    	LD	A,(IX+-4)
01086E B7ED62              A  2307    	UEXT	HL
010871 6F                  A  2308    	LD	L,A
010872 E5C1                A  2309    	LD	BC,HL
010874 C5E1                A  2310    	LD	HL,BC
010876 29                  A  2311    	ADD	HL,HL
010877 29                  A  2312    	ADD	HL,HL
010878 09                  A  2313    	ADD	HL,BC
010879 29                  A  2314    	ADD	HL,HL
01087A 29                  A  2315    	ADD	HL,HL
01087B 29                  A  2316    	ADD	HL,HL
01087C 29                  A  2317    	ADD	HL,HL
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  46


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01087D DD2FFD              A  2318    	LD	(IX+-3),HL
010880 01500000            A  2319    	LD	BC,80
010884 C5                  A  2320    	PUSH	BC
010885 DD27FD              A  2321    	LD	HL,(IX+-3)
010888 01 27 44 01         A  2322    	LD	BC,_scn_phys
01088C 09                  A  2323    	ADD	HL,BC
01088D E5                  A  2324    	PUSH	HL
01088E DD27FD              A  2325    	LD	HL,(IX+-3)
010891 01 87 34 01         A  2326    	LD	BC,_scn_virt
010895 09                  A  2327    	ADD	HL,BC
010896 E5                  A  2328    	PUSH	HL
010897 CD 67 25 01         A  2329    	CALL	_memcmp
01089B C1                  A  2330    	POP	BC
01089C C1                  A  2331    	POP	BC
01089D C1                  A  2332    	POP	BC
01089E 01000000            A  2333    	LD	BC,0
0108A2 B7                  A  2334    	OR	A,A
0108A3 ED42                A  2335    	SBC	HL,BC
0108A5 CA 81 09 01         A  2336    	JR	Z,L_151
                           A  2337    ;  616				continue;
                           A  2338    ;  617			
                           A  2339    ;  618			if ((blankrow(&scn_virt[r - 0][
0108A9 DD07FD              A  2340    	LD	BC,(IX+-3)
0108AC DD0FF3              A  2341    	LD	(IX+-13),BC
0108AF DD07FD              A  2342    	LD	BC,(IX+-3)
0108B2 DD0FF8              A  2343    	LD	(IX+-8),BC
0108B5 DD27FD              A  2344    	LD	HL,(IX+-3)
0108B8 01 87 34 01         A  2345    	LD	BC,_scn_virt
0108BC 09                  A  2346    	ADD	HL,BC
0108BD E5                  A  2347    	PUSH	HL
0108BE CD C8 04 01         A  2348    	CALL	_blankrow
0108C2 C1                  A  2349    	POP	BC
0108C3 B7                  A  2350    	OR	A,A
0108C4 28 2A               A  2351    	JR	Z,L_147
0108C6 DD07FD              A  2352    	LD	BC,(IX+-3)
0108C9 DD0FF3              A  2353    	LD	(IX+-13),BC
0108CC DD07FD              A  2354    	LD	BC,(IX+-3)
0108CF DD0FF8              A  2355    	LD	(IX+-8),BC
0108D2 DD27FD              A  2356    	LD	HL,(IX+-3)
0108D5 01 27 44 01         A  2357    	LD	BC,_scn_phys
0108D9 09                  A  2358    	ADD	HL,BC
0108DA E5                  A  2359    	PUSH	HL
0108DB CD C8 04 01         A  2360    	CALL	_blankrow
0108DF C1                  A  2361    	POP	BC
0108E0 B7                  A  2362    	OR	A,A
0108E1 20 0D               A  2363    	JR	NZ,L_147
                           A  2364    ;  619				te_cln(r);
0108E3 DD4EFC              A  2365    	LD	C,(IX+-4)
0108E6 0600                A  2366    	LD	B,0
0108E8 C5                  A  2367    	PUSH	BC
0108E9 CD EE 06 01         A  2368    	CALL	_te_cln
0108ED C1                  A  2369    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  47


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  2370    ;  620			else
0108EE 18 72               A  2371    	JR	L_149
0108F0                     A  2372    L_147:
                           A  2373    ;  621			{
                           A  2374    ;  622				char there = FALSE;
0108F0 DD36F700            A  2375    	LD	(IX+-9),0
0108F4 DD36FB00            A  2376    	LD	(IX+-5),0
                           A  2377    ;  623				
                           A  2378    ;  624				for (c = 0; c < SCNCOLS; c+
0108F8 18 61               A  2379    	JR	L_145
0108FA                     A  2380    L_143:
                           A  2381    ;  625				{
                           A  2382    ;  626					char ch = scn_virt[r - 
0108FA DD07F3              A  2383    	LD	BC,(IX+-13)
0108FD DD0FF8              A  2384    	LD	(IX+-8),BC
010900 C5E1                A  2385    	LD	HL,BC
010902 01 87 34 01         A  2386    	LD	BC,_scn_virt
010906 09                  A  2387    	ADD	HL,BC
010907 E5C1                A  2388    	LD	BC,HL
010909 DD7EFB              A  2389    	LD	A,(IX+-5)
01090C B7ED62              A  2390    	UEXT	HL
01090F 6F                  A  2391    	LD	L,A
010910 09                  A  2392    	ADD	HL,BC
010911 7E                  A  2393    	LD	A,(HL)
010912 DD77F6              A  2394    	LD	(IX+-10),A
                           A  2395    ;  627					
                           A  2396    ;  628					if (ch != scn_phys[r - 
010915 DD27F8              A  2397    	LD	HL,(IX+-8)
010918 01 27 44 01         A  2398    	LD	BC,_scn_phys
01091C 09                  A  2399    	ADD	HL,BC
01091D E5C1                A  2400    	LD	BC,HL
01091F DD7EFB              A  2401    	LD	A,(IX+-5)
010922 B7ED62              A  2402    	UEXT	HL
010925 6F                  A  2403    	LD	L,A
010926 09                  A  2404    	ADD	HL,BC
010927 7E                  A  2405    	LD	A,(HL)
010928 DDBEF6              A  2406    	CP	A,(IX+-10)
01092B 28 27               A  2407    	JR	Z,L_142
                           A  2408    ;  629					{
                           A  2409    ;  630						if (!there)
01092D DD7EF7              A  2410    	LD	A,(IX+-9)
010930 B7                  A  2411    	OR	A,A
010931 20 10               A  2412    	JR	NZ,L_140
                           A  2413    ;  631							te_mov(r, c);
010933 DD4EFB              A  2414    	LD	C,(IX+-5)
010936 0600                A  2415    	LD	B,0
010938 C5                  A  2416    	PUSH	BC
010939 DD4EFC              A  2417    	LD	C,(IX+-4)
01093C C5                  A  2418    	PUSH	BC
01093D CD 71 06 01         A  2419    	CALL	_te_mov
010941 C1                  A  2420    	POP	BC
010942 C1                  A  2421    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  48


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010943                     A  2422    L_140:
                           A  2423    ;  632						
                           A  2424    ;  633						te_chr((unsigned ch
010943 DD4EF6              A  2425    	LD	C,(IX+-10)
010946 0600                A  2426    	LD	B,0
010948 C5                  A  2427    	PUSH	BC
010949 CD 10 06 01         A  2428    	CALL	_te_chr
01094D C1                  A  2429    	POP	BC
                           A  2430    ;  634						
                           A  2431    ;  635						there = TRUE;
01094E DD36F701            A  2432    	LD	(IX+-9),1
                           A  2433    ;  636					}
                           A  2434    ;  637					else
010952 18 04               A  2435    	JR	L_144
010954                     A  2436    L_142:
                           A  2437    ;  638						there = FALSE;
010954 DD36F700            A  2438    	LD	(IX+-9),0
                           A  2439    ;  639				}
010958                     A  2440    L_144:
010958 DD34FB              A  2441    	INC	(IX+-5)
01095B                     A  2442    L_145:
01095B DD7EFB              A  2443    	LD	A,(IX+-5)
01095E FE50                A  2444    	CP	A,80
010960 38 98               A  2445    	JR	C,L_143
                           A  2446    ;  640			}
010962                     A  2447    L_149:
                           A  2448    ;  641			
                           A  2449    ;  642			memmove(&scn_phys[r - 0][0], &s
010962 DD07F8              A  2450    	LD	BC,(IX+-8)
010965 C5E1                A  2451    	LD	HL,BC
010967 11500000            A  2452    	LD	DE,80
01096B D5                  A  2453    	PUSH	DE
01096C 11 87 34 01         A  2454    	LD	DE,_scn_virt
010970 19                  A  2455    	ADD	HL,DE
010971 E5                  A  2456    	PUSH	HL
010972 C5E1                A  2457    	LD	HL,BC
010974 01 27 44 01         A  2458    	LD	BC,_scn_phys
010978 09                  A  2459    	ADD	HL,BC
010979 E5                  A  2460    	PUSH	HL
01097A CD 36 26 01         A  2461    	CALL	_memmove
01097E C1                  A  2462    	POP	BC
01097F C1                  A  2463    	POP	BC
010980 C1                  A  2464    	POP	BC
                           A  2465    ;  643		}	
010981                     A  2466    L_151:
010981 DD34FC              A  2467    	INC	(IX+-4)
010984                     A  2468    L_152:
010984 DD7EFC              A  2469    	LD	A,(IX+-4)
010987 FE32                A  2470    	CP	A,50
010989 DA 6B 08 01         A  2471    	JR	C,L_150
                           A  2472    ;  644		
                           A  2473    ;  645		te_flu();	
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  49


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01098D CD DF 05 01         A  2474    	CALL	_te_flu
                           A  2475    ;  646	}
010991 DDF9                A  2476    	LD	SP,IX
010993 DDE1                A  2477    	POP	IX
010995 C9                  A  2478    	RET	
                           A  2479    
                           A  2480    
                           A  2481    ;**************************** _sc_upd *********
                           A  2482    ;Name                         Addr/Register   S
                           A  2483    ;_te_flu                             IMPORT  --
                           A  2484    ;_memmove                            IMPORT  --
                           A  2485    ;_te_chr                             IMPORT  --
                           A  2486    ;_te_mov                             IMPORT  --
                           A  2487    ;_te_cln                             IMPORT  --
                           A  2488    ;_blankrow                           IMPORT  --
                           A  2489    ;_scn_virt                           STATIC   4
                           A  2490    ;_scn_phys                           STATIC   4
                           A  2491    ;_memcmp                             IMPORT  --
                           A  2492    ;G_3                                  IX-13    
                           A  2493    ;ch                                   IX-10    
                           A  2494    ;there                                 IX-9    
                           A  2495    ;G_4                                   IX-8    
                           A  2496    ;c                                     IX-5    
                           A  2497    ;r                                     IX-4    
                           A  2498    ;G_1                                   IX-3    
                           A  2499    
                           A  2500    
                           A  2501    ; Stack Frame Size: 19 (bytes)
                           A  2502    ;       Spill Code: 0 (instruction)
                           A  2503    
                           A  2504    
                           A  2505    ;  647	
                           A  2506    ;  648	/* Forced update. Forces the terminals 
                           A  2507    ;  649	/* the virtual screen.                 
                           A  2508    ;  650	void sc_fup(void)
                           A  2509    ;  651	{
010996                     A  2510    _sc_fup:
                           A  2511    ;  652		memset(&scn_phys[0][0], 0, SCNSIZE)
010996 01A00F00            A  2512    	LD	BC,4000
01099A C5                  A  2513    	PUSH	BC
01099B 01000000            A  2514    	LD	BC,0
01099F C5                  A  2515    	PUSH	BC
0109A0 01 27 44 01         A  2516    	LD	BC,_scn_phys
0109A4 C5                  A  2517    	PUSH	BC
0109A5 CD 15 26 01         A  2518    	CALL	_memset
0109A9 C1                  A  2519    	POP	BC
0109AA C1                  A  2520    	POP	BC
0109AB C1                  A  2521    	POP	BC
                           A  2522    ;  653		
                           A  2523    ;  654		sc_upd();
0109AC CD 5B 08 01         A  2524    	CALL	_sc_upd
                           A  2525    ;  655	}
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  50


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0109B0 C9                  A  2526    	RET	
                           A  2527    
                           A  2528    
                           A  2529    ;**************************** _sc_fup *********
                           A  2530    ;Name                         Addr/Register   S
                           A  2531    ;_sc_upd                             IMPORT  --
                           A  2532    ;_scn_phys                           STATIC   4
                           A  2533    ;_memset                             IMPORT  --
                           A  2534    
                           A  2535    
                           A  2536    ; Stack Frame Size: 6 (bytes)
                           A  2537    ;       Spill Code: 0 (instruction)
                           A  2538    
                           A  2539    
                           A  2540    ;  656	
                           A  2541    ;  657	/* Initializes the screen package, clea
                           A  2542    ;  658	void sc_ini(void)
                           A  2543    ;  659	{
0109B1                     A  2544    _sc_ini:
                           A  2545    ;  660		sc_clr();
0109B1 CD 4F 07 01         A  2546    	CALL	_sc_clr
                           A  2547    ;  661		
                           A  2548    ;  662		sc_fup();
0109B5 CD 96 09 01         A  2549    	CALL	_sc_fup
                           A  2550    ;  663	}
0109B9 C9                  A  2551    	RET	
                           A  2552    
                           A  2553    
                           A  2554    ;**************************** _sc_ini *********
                           A  2555    ;Name                         Addr/Register   S
                           A  2556    ;_sc_fup                             IMPORT  --
                           A  2557    ;_sc_clr                             IMPORT  --
                           A  2558    
                           A  2559    
                           A  2560    ; Stack Frame Size: 6 (bytes)
                           A  2561    ;       Spill Code: 0 (instruction)
                           A  2562    
                           A  2563    
                           A  2564    ;  664	
                           A  2565    ;  665	/* Finalizes the screen package, cleari
                           A  2566    ;  666	void sc_fin(void)
                           A  2567    ;  667	{
0109BA                     A  2568    _sc_fin:
                           A  2569    ;  668		sc_clr();
0109BA CD 4F 07 01         A  2570    	CALL	_sc_clr
                           A  2571    ;  669		
                           A  2572    ;  670		sc_fup();
0109BE CD 96 09 01         A  2573    	CALL	_sc_fup
                           A  2574    ;  671	}
0109C2 C9                  A  2575    	RET	
                           A  2576    
                           A  2577    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  51


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  2578    ;**************************** _sc_fin *********
                           A  2579    ;Name                         Addr/Register   S
                           A  2580    ;_sc_fup                             IMPORT  --
                           A  2581    ;_sc_clr                             IMPORT  --
                           A  2582    
                           A  2583    
                           A  2584    ; Stack Frame Size: 6 (bytes)
                           A  2585    ;       Spill Code: 0 (instruction)
                           A  2586    
                           A  2587    
                           A  2588    ;  672	
                           A  2589    ;  673	/* Initialize the text data structure t
                           A  2590    ;  674	void tx_ini(void)
                           A  2591    ;  675	{
0109C3                     A  2592    _tx_ini:
                           A  2593    ;  676		p_root = &root;
0109C3 01 07 55 01         A  2594    	LD	BC,_root
0109C7 ED43 10 55 01       A  2595    	LD	(_p_root),BC
                           A  2596    ;  677		p_root->p_next = p_root;
0109CC ED43 0A 55 01       A  2597    	LD	(_root+3),BC
                           A  2598    ;  678		p_root->p_prev = p_root;
0109D1 ED43 07 55 01       A  2599    	LD	(_root),BC
                           A  2600    ;  679		p_root->p_data = NULL;
0109D6 01000000            A  2601    	LD	BC,0
0109DA ED43 0D 55 01       A  2602    	LD	(_root+6),BC
                           A  2603    ;  680		
                           A  2604    ;  681		numlines = 0;
0109DF ED43 16 55 01       A  2605    	LD	(_numlines),BC
                           A  2606    ;  682	}
0109E4 C9                  A  2607    	RET	
                           A  2608    
                           A  2609    
                           A  2610    ;**************************** _tx_ini *********
                           A  2611    ;Name                         Addr/Register   S
                           A  2612    ;_numlines                           STATIC    
                           A  2613    ;_p_root                             STATIC    
                           A  2614    ;_root                               STATIC    
                           A  2615    
                           A  2616    
                           A  2617    ; Stack Frame Size: 6 (bytes)
                           A  2618    ;       Spill Code: 0 (instruction)
                           A  2619    
                           A  2620    
                           A  2621    ;  683	
                           A  2622    ;  684	/* Sets the specified line to the speci
                           A  2623    ;  685	/* Deletes trailing spaces from the arg
                           A  2624    ;  686	void tx_set(p_line_t p_line, char *s)
                           A  2625    ;  687	{
0109E5                     A  2626    _tx_set:
0109E5 21FDFFFF            A  2627    	LD	HL,-3
0109E9 CD 57 25 01         A  2628    	CALL	__frameset
                           A  2629    ;  688		size_t len;
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  52


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  2630    ;  689		
                           A  2631    ;  690		zap_trail(s);
0109ED DD0709              A  2632    	LD	BC,(IX+9)
0109F0 C5                  A  2633    	PUSH	BC
0109F1 CD 04 05 01         A  2634    	CALL	_zap_trail
0109F5 C1                  A  2635    	POP	BC
                           A  2636    ;  691		
                           A  2637    ;  692		len = strlen(s);
0109F6 DD0709              A  2638    	LD	BC,(IX+9)
0109F9 C5                  A  2639    	PUSH	BC
0109FA CD 14 25 01         A  2640    	CALL	_strlen
0109FE C1                  A  2641    	POP	BC
0109FF DD2FFD              A  2642    	LD	(IX+-3),HL
                           A  2643    ;  693		
                           A  2644    ;  694		as(len <= MAXLNLEN, "tx_set: Line t
010A02 01 72 27 01         A  2645    	LD	BC,L__110
010A06 C5                  A  2646    	PUSH	BC
010A07 DD07FD              A  2647    	LD	BC,(IX+-3)
010A0A 21500000            A  2648    	LD	HL,80
010A0E B7                  A  2649    	OR	A,A
010A0F ED42                A  2650    	SBC	HL,BC
010A11 38 04               A  2651    	JR	C,L__112
010A13 3E01                A  2652    	LD	A,1
010A15 18 01               A  2653    	JR	L__113
010A17                     A  2654    L__112:
010A17 AF                  A  2655    	XOR	A,A
010A18                     A  2656    L__113:
010A18 4F                  A  2657    	LD	C,A
010A19 0600                A  2658    	LD	B,0
010A1B C5                  A  2659    	PUSH	BC
010A1C CD 7C 03 01         A  2660    	CALL	_as
010A20 C1                  A  2661    	POP	BC
010A21 C1                  A  2662    	POP	BC
                           A  2663    ;  695		as(p_line != p_root, "tx_set: Attem
010A22 01 89 27 01         A  2664    	LD	BC,L__114
010A26 C5                  A  2665    	PUSH	BC
010A27 DD0706              A  2666    	LD	BC,(IX+6)
010A2A 2A 10 55 01         A  2667    	LD	HL,(_p_root)
010A2E B7                  A  2668    	OR	A,A
010A2F ED42                A  2669    	SBC	HL,BC
010A31 28 04               A  2670    	JR	Z,L__116
010A33 3E01                A  2671    	LD	A,1
010A35 18 01               A  2672    	JR	L__117
010A37                     A  2673    L__116:
010A37 AF                  A  2674    	XOR	A,A
010A38                     A  2675    L__117:
010A38 4F                  A  2676    	LD	C,A
010A39 0600                A  2677    	LD	B,0
010A3B C5                  A  2678    	PUSH	BC
010A3C CD 7C 03 01         A  2679    	CALL	_as
010A40 C1                  A  2680    	POP	BC
010A41 C1                  A  2681    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  53


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  2682    ;  696		as(p_line->p_data != NULL, "tx_set:
010A42 01 AF 27 01         A  2683    	LD	BC,L__118
010A46 C5                  A  2684    	PUSH	BC
010A47 DD3106              A  2685    	LD	IY,(IX+6)
010A4A FD2706              A  2686    	LD	HL,(IY+6)
010A4D 01000000            A  2687    	LD	BC,0
010A51 B7                  A  2688    	OR	A,A
010A52 ED42                A  2689    	SBC	HL,BC
010A54 28 04               A  2690    	JR	Z,L__120
010A56 3E01                A  2691    	LD	A,1
010A58 18 01               A  2692    	JR	L__121
010A5A                     A  2693    L__120:
010A5A AF                  A  2694    	XOR	A,A
010A5B                     A  2695    L__121:
010A5B 4F                  A  2696    	LD	C,A
010A5C 0600                A  2697    	LD	B,0
010A5E C5                  A  2698    	PUSH	BC
010A5F CD 7C 03 01         A  2699    	CALL	_as
010A63 C1                  A  2700    	POP	BC
010A64 C1                  A  2701    	POP	BC
                           A  2702    ;  697		
                           A  2703    ;  698		free(p_line->p_data);
010A65 DD3106              A  2704    	LD	IY,(IX+6)
010A68 FD0706              A  2705    	LD	BC,(IY+6)
010A6B C5                  A  2706    	PUSH	BC
010A6C CD 19 23 01         A  2707    	CALL	_free
010A70 C1                  A  2708    	POP	BC
                           A  2709    ;  699		
                           A  2710    ;  700		p_line->p_data = mymalloc(len + 1);
010A71 DD07FD              A  2711    	LD	BC,(IX+-3)
010A74 03                  A  2712    	INC	BC
010A75 C5                  A  2713    	PUSH	BC
010A76 CD 79 04 01         A  2714    	CALL	_mymalloc
010A7A C1                  A  2715    	POP	BC
010A7B DD3106              A  2716    	LD	IY,(IX+6)
010A7E FD2F06              A  2717    	LD	(IY+6),HL
                           A  2718    ;  701		
                           A  2719    ;  702		strcpy(p_line->p_data, s);
010A81 DD0709              A  2720    	LD	BC,(IX+9)
010A84 C5                  A  2721    	PUSH	BC
010A85 FD0706              A  2722    	LD	BC,(IY+6)
010A88 C5                  A  2723    	PUSH	BC
010A89 CD FB 25 01         A  2724    	CALL	_strcpy
010A8D C1                  A  2725    	POP	BC
010A8E C1                  A  2726    	POP	BC
                           A  2727    ;  703	}
010A8F DDF9                A  2728    	LD	SP,IX
010A91 DDE1                A  2729    	POP	IX
010A93 C9                  A  2730    	RET	
                           A  2731    
                           A  2732    
                           A  2733    ;**************************** _tx_set *********
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  54


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  2734    ;Name                         Addr/Register   S
                           A  2735    ;_strcpy                             IMPORT  --
                           A  2736    ;_mymalloc                           IMPORT  --
                           A  2737    ;_free                               IMPORT  --
                           A  2738    ;_p_root                             STATIC    
                           A  2739    ;_as                                 IMPORT  --
                           A  2740    ;_strlen                             IMPORT  --
                           A  2741    ;_zap_trail                          IMPORT  --
                           A  2742    ;len                                   IX-3    
                           A  2743    ;s                                     IX+9    
                           A  2744    ;p_line                                IX+6    
                           A  2745    
                           A  2746    
                           A  2747    ; Stack Frame Size: 15 (bytes)
                           A  2748    ;       Spill Code: 0 (instruction)
                           A  2749    
                           A  2750    
                           A  2751    	SEGMENT STRSECT
012772                     A  2752    L__110:
012772 74785F73 65743A20   A  2753    	DB	"tx_set: Line too long."
01277A 4C696E65 20746F6F 
012782 206C6F6E 672E 
012788 00                  A  2754    	DB	0
012789                     A  2755    L__114:
012789 74785F73 65743A20   A  2756    	DB	"tx_set: Attempt to set the root line."
012791 41747465 6D707420 
012799 746F2073 65742074 
0127A1 68652072 6F6F7420 
0127A9 6C696E65 2E 
0127AE 00                  A  2757    	DB	0
0127AF                     A  2758    L__118:
0127AF 74785F73 65743A20   A  2759    	DB	"tx_set: p_data=NULL."
0127B7 705F6461 74613D4E 
0127BF 554C4C2E 
0127C3 00                  A  2760    	DB	0
                           A  2761    	SEGMENT CODE
                           A  2762    ;  704	
                           A  2763    ;  705	/* Insert a line containing the specifi
                           A  2764    ;  706	/* just before the specified line.     
                           A  2765    ;  707	void tx_ins(p_line_t p_line, char *s)
                           A  2766    ;  708	{
010A94                     A  2767    _tx_ins:
010A94 21FDFFFF            A  2768    	LD	HL,-3
010A98 CD 57 25 01         A  2769    	CALL	__frameset
                           A  2770    ;  709		p_line_t p_new = mymalloc(sizeof(li
010A9C 01090000            A  2771    	LD	BC,9
010AA0 C5                  A  2772    	PUSH	BC
010AA1 CD 79 04 01         A  2773    	CALL	_mymalloc
010AA5 C1                  A  2774    	POP	BC
010AA6 DD2FFD              A  2775    	LD	(IX+-3),HL
                           A  2776    ;  710		
                           A  2777    ;  711		p_new->p_prev = p_line->p_prev;
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  55


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010AA9 DD3106              A  2778    	LD	IY,(IX+6)
010AAC FD0700              A  2779    	LD	BC,(IY+0)
010AAF DD31FD              A  2780    	LD	IY,(IX+-3)
010AB2 FD0F00              A  2781    	LD	(IY+0),BC
                           A  2782    ;  712		p_new->p_next = p_line;
010AB5 DD0706              A  2783    	LD	BC,(IX+6)
010AB8 FD0F03              A  2784    	LD	(IY+3),BC
                           A  2785    ;  713		
                           A  2786    ;  714		p_line->p_prev = p_new;
010ABB DD07FD              A  2787    	LD	BC,(IX+-3)
010ABE DD3106              A  2788    	LD	IY,(IX+6)
010AC1 FD0F00              A  2789    	LD	(IY+0),BC
                           A  2790    ;  715		p_new->p_prev->p_next = p_new;
010AC4 DD31FD              A  2791    	LD	IY,(IX+-3)
010AC7 FD3700              A  2792    	LD	IY,(IY+0)
010ACA DD07FD              A  2793    	LD	BC,(IX+-3)
                           A  2794    ;  716		
                           A  2795    ;  717		p_new->p_data = mymalloc(0);
010ACD 11000000            A  2796    	LD	DE,0
010AD1 D5                  A  2797    	PUSH	DE
010AD2 FD0F03              A  2798    	LD	(IY+3),BC
010AD5 CD 79 04 01         A  2799    	CALL	_mymalloc
010AD9 C1                  A  2800    	POP	BC
010ADA DD31FD              A  2801    	LD	IY,(IX+-3)
010ADD FD2F06              A  2802    	LD	(IY+6),HL
                           A  2803    ;  718		
                           A  2804    ;  719		tx_set(p_new, s);
010AE0 DD0709              A  2805    	LD	BC,(IX+9)
010AE3 C5                  A  2806    	PUSH	BC
010AE4 DD07FD              A  2807    	LD	BC,(IX+-3)
010AE7 C5                  A  2808    	PUSH	BC
010AE8 CD E5 09 01         A  2809    	CALL	_tx_set
010AEC C1                  A  2810    	POP	BC
010AED C1                  A  2811    	POP	BC
                           A  2812    ;  720		
                           A  2813    ;  721		numlines++;
010AEE ED4B 16 55 01       A  2814    	LD	BC,(_numlines)
010AF3 03                  A  2815    	INC	BC
010AF4 ED43 16 55 01       A  2816    	LD	(_numlines),BC
                           A  2817    ;  722	}
010AF9 DDF9                A  2818    	LD	SP,IX
010AFB DDE1                A  2819    	POP	IX
010AFD C9                  A  2820    	RET	
                           A  2821    
                           A  2822    
                           A  2823    ;**************************** _tx_ins *********
                           A  2824    ;Name                         Addr/Register   S
                           A  2825    ;_numlines                           STATIC    
                           A  2826    ;_tx_set                             IMPORT  --
                           A  2827    ;_mymalloc                           IMPORT  --
                           A  2828    ;p_new                                 IX-3    
                           A  2829    ;s                                     IX+9    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  56


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  2830    ;p_line                                IX+6    
                           A  2831    
                           A  2832    
                           A  2833    ; Stack Frame Size: 15 (bytes)
                           A  2834    ;       Spill Code: 0 (instruction)
                           A  2835    
                           A  2836    
                           A  2837    ;  723	
                           A  2838    ;  724	/* Deletes the specified line. */
                           A  2839    ;  725	void tx_del(p_line_t p_line)
                           A  2840    ;  726	{
010AFE                     A  2841    _tx_del:
010AFE 21FDFFFF            A  2842    	LD	HL,-3
010B02 CD 57 25 01         A  2843    	CALL	__frameset
                           A  2844    ;  727		as(p_line != NULL, "tx_del: NULL.")
010B06 01 C4 27 01         A  2845    	LD	BC,L__124
010B0A C5                  A  2846    	PUSH	BC
010B0B DD2706              A  2847    	LD	HL,(IX+6)
010B0E 01000000            A  2848    	LD	BC,0
010B12 B7                  A  2849    	OR	A,A
010B13 ED42                A  2850    	SBC	HL,BC
010B15 28 04               A  2851    	JR	Z,L__126
010B17 3E01                A  2852    	LD	A,1
010B19 18 01               A  2853    	JR	L__127
010B1B                     A  2854    L__126:
010B1B AF                  A  2855    	XOR	A,A
010B1C                     A  2856    L__127:
010B1C 4F                  A  2857    	LD	C,A
010B1D 0600                A  2858    	LD	B,0
010B1F C5                  A  2859    	PUSH	BC
010B20 CD 7C 03 01         A  2860    	CALL	_as
010B24 C1                  A  2861    	POP	BC
010B25 C1                  A  2862    	POP	BC
                           A  2863    ;  728		as(p_line != p_root, "tx_del: Attem
010B26 01 D2 27 01         A  2864    	LD	BC,L__128
010B2A C5                  A  2865    	PUSH	BC
010B2B DD0706              A  2866    	LD	BC,(IX+6)
010B2E 2A 10 55 01         A  2867    	LD	HL,(_p_root)
010B32 B7                  A  2868    	OR	A,A
010B33 ED42                A  2869    	SBC	HL,BC
010B35 28 04               A  2870    	JR	Z,L__130
010B37 3E01                A  2871    	LD	A,1
010B39 18 01               A  2872    	JR	L__131
010B3B                     A  2873    L__130:
010B3B AF                  A  2874    	XOR	A,A
010B3C                     A  2875    L__131:
010B3C 4F                  A  2876    	LD	C,A
010B3D 0600                A  2877    	LD	B,0
010B3F C5                  A  2878    	PUSH	BC
010B40 CD 7C 03 01         A  2879    	CALL	_as
010B44 C1                  A  2880    	POP	BC
010B45 C1                  A  2881    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  57


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  2882    ;  729		
                           A  2883    ;  730		p_line->p_prev->p_next = p_line->p_
010B46 DD3106              A  2884    	LD	IY,(IX+6)
010B49 FD0700              A  2885    	LD	BC,(IY+0)
010B4C DD0FFD              A  2886    	LD	(IX+-3),BC
010B4F FD0703              A  2887    	LD	BC,(IY+3)
010B52 DD31FD              A  2888    	LD	IY,(IX+-3)
010B55 FD0F03              A  2889    	LD	(IY+3),BC
                           A  2890    ;  731		p_line->p_next->p_prev = p_line->p_
010B58 DD3106              A  2891    	LD	IY,(IX+6)
010B5B FD3703              A  2892    	LD	IY,(IY+3)
010B5E DD07FD              A  2893    	LD	BC,(IX+-3)
010B61 FD0F00              A  2894    	LD	(IY+0),BC
                           A  2895    ;  732		
                           A  2896    ;  733		free(p_line->p_data);
010B64 DD3106              A  2897    	LD	IY,(IX+6)
010B67 FD0706              A  2898    	LD	BC,(IY+6)
010B6A C5                  A  2899    	PUSH	BC
010B6B CD 19 23 01         A  2900    	CALL	_free
010B6F C1                  A  2901    	POP	BC
                           A  2902    ;  734		free(p_line);
010B70 DD0706              A  2903    	LD	BC,(IX+6)
010B73 C5                  A  2904    	PUSH	BC
010B74 CD 19 23 01         A  2905    	CALL	_free
010B78 C1                  A  2906    	POP	BC
                           A  2907    ;  735		
                           A  2908    ;  736		numlines--;
010B79 ED4B 16 55 01       A  2909    	LD	BC,(_numlines)
010B7E 0B                  A  2910    	DEC	BC
010B7F ED43 16 55 01       A  2911    	LD	(_numlines),BC
                           A  2912    ;  737	}
010B84 DDF9                A  2913    	LD	SP,IX
010B86 DDE1                A  2914    	POP	IX
010B88 C9                  A  2915    	RET	
                           A  2916    
                           A  2917    
                           A  2918    ;**************************** _tx_del *********
                           A  2919    ;Name                         Addr/Register   S
                           A  2920    ;_numlines                           STATIC    
                           A  2921    ;_free                               IMPORT  --
                           A  2922    ;_p_root                             STATIC    
                           A  2923    ;_as                                 IMPORT  --
                           A  2924    ;p_line                                IX+6    
                           A  2925    
                           A  2926    
                           A  2927    ; Stack Frame Size: 12 (bytes)
                           A  2928    ;       Spill Code: 0 (instruction)
                           A  2929    
                           A  2930    
                           A  2931    	SEGMENT STRSECT
0127C4                     A  2932    L__124:
0127C4 74785F64 656C3A20   A  2933    	DB	"tx_del: NULL."
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  58


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0127CC 4E554C4C 2E 
0127D1 00                  A  2934    	DB	0
0127D2                     A  2935    L__128:
0127D2 74785F64 656C3A20   A  2936    	DB	"tx_del: Attempt to delete the root lin
0127DA 41747465 6D707420 
0127E2 746F2064 656C6574 
0127EA 65207468 6520726F 
0127F2 6F74206C 696E652E 
0127FA 00                  A  2937    	DB	0
                           A  2938    	SEGMENT CODE
                           A  2939    ;  738	
                           A  2940    ;  739	/* Writes the contents of the line to t
                           A  2941    ;  740	/* padded array of MAXLNLEN characters.
                           A  2942    ;  741	void tx_get(p_line_t p_line)
                           A  2943    ;  742	{
010B89                     A  2944    _tx_get:
010B89 21FDFFFF            A  2945    	LD	HL,-3
010B8D CD 57 25 01         A  2946    	CALL	__frameset
                           A  2947    ;  743		size_t len = strlen(p_line->p_data)
010B91 DD3106              A  2948    	LD	IY,(IX+6)
010B94 FD0706              A  2949    	LD	BC,(IY+6)
010B97 C5                  A  2950    	PUSH	BC
010B98 CD 14 25 01         A  2951    	CALL	_strlen
010B9C C1                  A  2952    	POP	BC
010B9D DD2FFD              A  2953    	LD	(IX+-3),HL
                           A  2954    ;  744		
                           A  2955    ;  745		memset((void *)linbuf, ' ', MAXLNLE
010BA0 01500000            A  2956    	LD	BC,80
010BA4 C5                  A  2957    	PUSH	BC
010BA5 01200000            A  2958    	LD	BC,32
010BA9 C5                  A  2959    	PUSH	BC
010BAA 01 25 55 01         A  2960    	LD	BC,_linbuf
010BAE C5                  A  2961    	PUSH	BC
010BAF CD 15 26 01         A  2962    	CALL	_memset
010BB3 C1                  A  2963    	POP	BC
010BB4 C1                  A  2964    	POP	BC
010BB5 C1                  A  2965    	POP	BC
                           A  2966    ;  746		
                           A  2967    ;  747		memmove((void *)linbuf, p_line->p_d
010BB6 DD07FD              A  2968    	LD	BC,(IX+-3)
010BB9 C5                  A  2969    	PUSH	BC
010BBA DD3106              A  2970    	LD	IY,(IX+6)
010BBD FD0706              A  2971    	LD	BC,(IY+6)
010BC0 C5                  A  2972    	PUSH	BC
010BC1 01 25 55 01         A  2973    	LD	BC,_linbuf
010BC5 C5                  A  2974    	PUSH	BC
010BC6 CD 36 26 01         A  2975    	CALL	_memmove
010BCA C1                  A  2976    	POP	BC
010BCB C1                  A  2977    	POP	BC
010BCC C1                  A  2978    	POP	BC
                           A  2979    ;  748	}
010BCD DDF9                A  2980    	LD	SP,IX
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  59


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010BCF DDE1                A  2981    	POP	IX
010BD1 C9                  A  2982    	RET	
                           A  2983    
                           A  2984    
                           A  2985    ;**************************** _tx_get *********
                           A  2986    ;Name                         Addr/Register   S
                           A  2987    ;_memmove                            IMPORT  --
                           A  2988    ;_linbuf                             STATIC    
                           A  2989    ;_memset                             IMPORT  --
                           A  2990    ;_strlen                             IMPORT  --
                           A  2991    ;len                                   IX-3    
                           A  2992    ;p_line                                IX+6    
                           A  2993    
                           A  2994    
                           A  2995    ; Stack Frame Size: 12 (bytes)
                           A  2996    ;       Spill Code: 0 (instruction)
                           A  2997    
                           A  2998    
                           A  2999    ;  749	
                           A  3000    ;  750	/* Sets the value of the specified line
                           A  3001    ;  751	void tx_put(p_line_t p_line)
                           A  3002    ;  752	{
010BD2                     A  3003    _tx_put:
010BD2 CD 4A 25 01         A  3004    	CALL	__frameset0
                           A  3005    ;  753		linbuf[MAXLNLEN] = EOS;
010BD6 21 75 55 01         A  3006    	LD	HL,_linbuf+80
                           A  3007    ;  754		
                           A  3008    ;  755		tx_set(p_line, linbuf);
010BDA 01 25 55 01         A  3009    	LD	BC,_linbuf
010BDE C5                  A  3010    	PUSH	BC
010BDF 3600                A  3011    	LD	(HL),0
010BE1 DD0706              A  3012    	LD	BC,(IX+6)
010BE4 C5                  A  3013    	PUSH	BC
010BE5 CD E5 09 01         A  3014    	CALL	_tx_set
010BE9 C1                  A  3015    	POP	BC
010BEA C1                  A  3016    	POP	BC
                           A  3017    ;  756	}
010BEB DDF9                A  3018    	LD	SP,IX
010BED DDE1                A  3019    	POP	IX
010BEF C9                  A  3020    	RET	
                           A  3021    
                           A  3022    
                           A  3023    ;**************************** _tx_put *********
                           A  3024    ;Name                         Addr/Register   S
                           A  3025    ;_tx_set                             IMPORT  --
                           A  3026    ;_linbuf                             STATIC    
                           A  3027    ;p_line                                IX+6    
                           A  3028    
                           A  3029    
                           A  3030    ; Stack Frame Size: 9 (bytes)
                           A  3031    ;       Spill Code: 0 (instruction)
                           A  3032    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  60


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  3033    
                           A  3034    ;  757	
                           A  3035    ;  758	/* Redraw the screen. */
                           A  3036    ;  759	void do_red(void)
                           A  3037    ;  760	{
010BF0                     A  3038    _do_red:
                           A  3039    ;  761		sc_fup();
010BF0 CD 96 09 01         A  3040    	CALL	_sc_fup
                           A  3041    ;  762	}
010BF4 C9                  A  3042    	RET	
                           A  3043    
                           A  3044    
                           A  3045    ;**************************** _do_red *********
                           A  3046    ;Name                         Addr/Register   S
                           A  3047    ;_sc_fup                             IMPORT  --
                           A  3048    
                           A  3049    
                           A  3050    ; Stack Frame Size: 6 (bytes)
                           A  3051    ;       Spill Code: 0 (instruction)
                           A  3052    
                           A  3053    
                           A  3054    ;  763	
                           A  3055    ;  764	/* Cursor up. */
                           A  3056    ;  765	void do_cup(void)
                           A  3057    ;  766	{
010BF5                     A  3058    _do_cup:
010BF5 21FFFFFF            A  3059    	LD	HL,-1
010BF9 CD 57 25 01         A  3060    	CALL	__frameset
                           A  3061    ;  767		char ch;
                           A  3062    ;  768		
                           A  3063    ;  769		if (cur_line == 1)
010BFD 01010000            A  3064    	LD	BC,1
010C01 2A 19 55 01         A  3065    	LD	HL,(_cur_line)
010C05 B7                  A  3066    	OR	A,A
010C06 ED42                A  3067    	SBC	HL,BC
010C08 20 06               A  3068    	JR	NZ,L_169
                           A  3069    ;  770		{
                           A  3070    ;  771			Show_Cursor();
010C0A CD 51 18 01         A  3071    	CALL	_Show_Cursor
                           A  3072    ;  772			
                           A  3073    ;  773			return;
010C0E 18 6F               A  3074    	JR	L_173
                           A  3075    ;  774		}
010C10                     A  3076    L_169:
                           A  3077    ;  775		
                           A  3078    ;  776		cur_line--;
010C10 ED4B 19 55 01       A  3079    	LD	BC,(_cur_line)
010C15 0B                  A  3080    	DEC	BC
010C16 ED43 19 55 01       A  3081    	LD	(_cur_line),BC
                           A  3082    ;  777		
                           A  3083    ;  778		p_curr = p_curr->p_prev;
010C1B FD2A 13 55 01       A  3084    	LD	IY,(_p_curr)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  61


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010C20 FD0700              A  3085    	LD	BC,(IY+0)
010C23 ED43 13 55 01       A  3086    	LD	(_p_curr),BC
                           A  3087    ;  779		
                           A  3088    ;  780		if (cur_row == 0)
010C28 2A 1F 55 01         A  3089    	LD	HL,(_cur_row)
010C2C B7                  A  3090    	OR	A,A
010C2D 01000000            A  3091    	LD	BC,0
010C31 ED42                A  3092    	SBC	HL,BC
010C33 20 06               A  3093    	JR	NZ,L_172
                           A  3094    ;  781			paintall();
010C35 CD 96 16 01         A  3095    	CALL	_paintall
                           A  3096    ;  782		else
010C39 18 44               A  3097    	JR	L_173
010C3B                     A  3098    L_172:
                           A  3099    ;  783		{
                           A  3100    ;  784			ch = scn_phys[cur_row][cur_col]
010C3B 2A 1F 55 01         A  3101    	LD	HL,(_cur_row)
010C3F 29                  A  3102    	ADD	HL,HL
010C40 29                  A  3103    	ADD	HL,HL
010C41 ED4B 1F 55 01       A  3104    	LD	BC,(_cur_row)
010C46 09                  A  3105    	ADD	HL,BC
010C47 29                  A  3106    	ADD	HL,HL
010C48 29                  A  3107    	ADD	HL,HL
010C49 29                  A  3108    	ADD	HL,HL
010C4A 29                  A  3109    	ADD	HL,HL
010C4B 01 27 44 01         A  3110    	LD	BC,_scn_phys
010C4F 09                  A  3111    	ADD	HL,BC
010C50 ED4B 22 55 01       A  3112    	LD	BC,(_cur_col)
010C55 09                  A  3113    	ADD	HL,BC
010C56 7E                  A  3114    	LD	A,(HL)
010C57 DD77FF              A  3115    	LD	(IX+-1),A
                           A  3116    ;  785			
                           A  3117    ;  786			cur_row--;
010C5A ED4B 1F 55 01       A  3118    	LD	BC,(_cur_row)
010C5F 0B                  A  3119    	DEC	BC
010C60 ED43 1F 55 01       A  3120    	LD	(_cur_row),BC
                           A  3121    ;  787			
                           A  3122    ;  788			plot_char(cur_col, cur_row + 1,
010C65 DD4EFF              A  3123    	LD	C,(IX+-1)
010C68 0600                A  3124    	LD	B,0
010C6A C5                  A  3125    	PUSH	BC
010C6B 3A 1F 55 01         A  3126    	LD	A,(_cur_row)
010C6F 3C                  A  3127    	INC	A
010C70 4F                  A  3128    	LD	C,A
010C71 C5                  A  3129    	PUSH	BC
010C72 3A 22 55 01         A  3130    	LD	A,(_cur_col)
010C76 4F                  A  3131    	LD	C,A
010C77 C5                  A  3132    	PUSH	BC
010C78 CD 84 02 01         A  3133    	CALL	_plot_char
010C7C C1                  A  3134    	POP	BC
010C7D C1                  A  3135    	POP	BC
010C7E C1                  A  3136    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  62


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  3137    ;  789		}
                           A  3138    ;  790	}
010C7F                     A  3139    L_173:
010C7F DDF9                A  3140    	LD	SP,IX
010C81 DDE1                A  3141    	POP	IX
010C83 C9                  A  3142    	RET	
                           A  3143    
                           A  3144    
                           A  3145    ;**************************** _do_cup *********
                           A  3146    ;Name                         Addr/Register   S
                           A  3147    ;_plot_char                          IMPORT  --
                           A  3148    ;_cur_col                            STATIC    
                           A  3149    ;_scn_phys                           STATIC   4
                           A  3150    ;_paintall                           IMPORT  --
                           A  3151    ;_cur_row                            STATIC    
                           A  3152    ;_p_curr                             STATIC    
                           A  3153    ;_Show_Cursor                        IMPORT  --
                           A  3154    ;_cur_line                           STATIC    
                           A  3155    ;ch                                    IX-1    
                           A  3156    
                           A  3157    
                           A  3158    ; Stack Frame Size: 7 (bytes)
                           A  3159    ;       Spill Code: 0 (instruction)
                           A  3160    
                           A  3161    
                           A  3162    ;  791	
                           A  3163    ;  792	/* Cursor down. */
                           A  3164    ;  793	void do_cdw(void)
                           A  3165    ;  794	{
010C84                     A  3166    _do_cdw:
010C84 21FCFFFF            A  3167    	LD	HL,-4
010C88 CD 57 25 01         A  3168    	CALL	__frameset
                           A  3169    ;  795		char ch;
                           A  3170    ;  796		
                           A  3171    ;  797		if (p_curr->p_next == p_root)
010C8C FD2A 13 55 01       A  3172    	LD	IY,(_p_curr)
010C91 FD0703              A  3173    	LD	BC,(IY+3)
010C94 DD0FFC              A  3174    	LD	(IX+-4),BC
010C97 2A 10 55 01         A  3175    	LD	HL,(_p_root)
010C9B B7                  A  3176    	OR	A,A
010C9C ED42                A  3177    	SBC	HL,BC
010C9E 20 06               A  3178    	JR	NZ,L_175
                           A  3179    ;  798		{
                           A  3180    ;  799			Show_Cursor();
010CA0 CD 51 18 01         A  3181    	CALL	_Show_Cursor
                           A  3182    ;  800			
                           A  3183    ;  801			return;
010CA4 18 6A               A  3184    	JR	L_180
                           A  3185    ;  802		}
010CA6                     A  3186    L_175:
                           A  3187    ;  803		
                           A  3188    ;  804		p_curr = p_curr->p_next;
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  63


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010CA6 DD07FC              A  3189    	LD	BC,(IX+-4)
010CA9 ED43 13 55 01       A  3190    	LD	(_p_curr),BC
                           A  3191    ;  805		
                           A  3192    ;  806		cur_line++;
010CAE ED4B 19 55 01       A  3193    	LD	BC,(_cur_line)
010CB3 03                  A  3194    	INC	BC
010CB4 ED43 19 55 01       A  3195    	LD	(_cur_line),BC
                           A  3196    ;  807		
                           A  3197    ;  808		if (cur_row == SCNROWS - 1)
010CB9 2A 1F 55 01         A  3198    	LD	HL,(_cur_row)
010CBD B7                  A  3199    	OR	A,A
010CBE 01310000            A  3200    	LD	BC,49
010CC2 ED42                A  3201    	SBC	HL,BC
010CC4 20 06               A  3202    	JR	NZ,L_179
                           A  3203    ;  809			paintall();	
010CC6 CD 96 16 01         A  3204    	CALL	_paintall
                           A  3205    ;  810		else
010CCA 18 44               A  3206    	JR	L_180
010CCC                     A  3207    L_179:
                           A  3208    ;  811		{
                           A  3209    ;  812			ch = scn_phys[cur_row][cur_col]
010CCC 2A 1F 55 01         A  3210    	LD	HL,(_cur_row)
010CD0 29                  A  3211    	ADD	HL,HL
010CD1 29                  A  3212    	ADD	HL,HL
010CD2 ED4B 1F 55 01       A  3213    	LD	BC,(_cur_row)
010CD7 09                  A  3214    	ADD	HL,BC
010CD8 29                  A  3215    	ADD	HL,HL
010CD9 29                  A  3216    	ADD	HL,HL
010CDA 29                  A  3217    	ADD	HL,HL
010CDB 29                  A  3218    	ADD	HL,HL
010CDC 01 27 44 01         A  3219    	LD	BC,_scn_phys
010CE0 09                  A  3220    	ADD	HL,BC
010CE1 ED4B 22 55 01       A  3221    	LD	BC,(_cur_col)
010CE6 09                  A  3222    	ADD	HL,BC
010CE7 7E                  A  3223    	LD	A,(HL)
010CE8 DD77FF              A  3224    	LD	(IX+-1),A
                           A  3225    ;  813			
                           A  3226    ;  814			cur_row++;
010CEB ED4B 1F 55 01       A  3227    	LD	BC,(_cur_row)
010CF0 03                  A  3228    	INC	BC
010CF1 ED43 1F 55 01       A  3229    	LD	(_cur_row),BC
                           A  3230    ;  815			
                           A  3231    ;  816			plot_char(cur_col, cur_row - 1,
010CF6 DD4EFF              A  3232    	LD	C,(IX+-1)
010CF9 0600                A  3233    	LD	B,0
010CFB C5                  A  3234    	PUSH	BC
010CFC 3A 1F 55 01         A  3235    	LD	A,(_cur_row)
010D00 3D                  A  3236    	DEC	A
010D01 4F                  A  3237    	LD	C,A
010D02 C5                  A  3238    	PUSH	BC
010D03 3A 22 55 01         A  3239    	LD	A,(_cur_col)
010D07 4F                  A  3240    	LD	C,A
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  64


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010D08 C5                  A  3241    	PUSH	BC
010D09 CD 84 02 01         A  3242    	CALL	_plot_char
010D0D C1                  A  3243    	POP	BC
010D0E C1                  A  3244    	POP	BC
010D0F C1                  A  3245    	POP	BC
                           A  3246    ;  817		}
                           A  3247    ;  818	}
010D10                     A  3248    L_180:
010D10 DDF9                A  3249    	LD	SP,IX
010D12 DDE1                A  3250    	POP	IX
010D14 C9                  A  3251    	RET	
                           A  3252    
                           A  3253    
                           A  3254    ;**************************** _do_cdw *********
                           A  3255    ;Name                         Addr/Register   S
                           A  3256    ;_plot_char                          IMPORT  --
                           A  3257    ;_cur_col                            STATIC    
                           A  3258    ;_scn_phys                           STATIC   4
                           A  3259    ;_paintall                           IMPORT  --
                           A  3260    ;_cur_row                            STATIC    
                           A  3261    ;_cur_line                           STATIC    
                           A  3262    ;_Show_Cursor                        IMPORT  --
                           A  3263    ;_p_root                             STATIC    
                           A  3264    ;_p_curr                             STATIC    
                           A  3265    ;G_5                                   IX-4    
                           A  3266    ;ch                                    IX-1    
                           A  3267    
                           A  3268    
                           A  3269    ; Stack Frame Size: 10 (bytes)
                           A  3270    ;       Spill Code: 0 (instruction)
                           A  3271    
                           A  3272    
                           A  3273    ;  819	
                           A  3274    ;  820	/* Cursor left. */
                           A  3275    ;  821	void do_clf(void)
                           A  3276    ;  822	{
010D15                     A  3277    _do_clf:
010D15 21FFFFFF            A  3278    	LD	HL,-1
010D19 CD 57 25 01         A  3279    	CALL	__frameset
                           A  3280    ;  823		char ch;
                           A  3281    ;  824		
                           A  3282    ;  825		if (cur_char == 1)
010D1D 01010000            A  3283    	LD	BC,1
010D21 2A 1C 55 01         A  3284    	LD	HL,(_cur_char)
010D25 B7                  A  3285    	OR	A,A
010D26 ED42                A  3286    	SBC	HL,BC
010D28 20 06               A  3287    	JR	NZ,L_183
                           A  3288    ;  826		{
                           A  3289    ;  827			Show_Cursor();
010D2A CD 51 18 01         A  3290    	CALL	_Show_Cursor
                           A  3291    ;  828			
                           A  3292    ;  829			return;
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  65


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010D2E 18 62               A  3293    	JR	L_187
                           A  3294    ;  830		}
010D30                     A  3295    L_183:
                           A  3296    ;  831		
                           A  3297    ;  832		cur_char--;
010D30 ED4B 1C 55 01       A  3298    	LD	BC,(_cur_char)
010D35 0B                  A  3299    	DEC	BC
010D36 ED43 1C 55 01       A  3300    	LD	(_cur_char),BC
                           A  3301    ;  833		
                           A  3302    ;  834		if (cur_col == 0)
010D3B 2A 22 55 01         A  3303    	LD	HL,(_cur_col)
010D3F B7                  A  3304    	OR	A,A
010D40 01000000            A  3305    	LD	BC,0
010D44 ED42                A  3306    	SBC	HL,BC
010D46 20 06               A  3307    	JR	NZ,L_186
                           A  3308    ;  835			paintall();
010D48 CD 96 16 01         A  3309    	CALL	_paintall
                           A  3310    ;  836		else
010D4C 18 44               A  3311    	JR	L_187
010D4E                     A  3312    L_186:
                           A  3313    ;  837		{
                           A  3314    ;  838			ch = scn_phys[cur_row][cur_col]
010D4E 2A 1F 55 01         A  3315    	LD	HL,(_cur_row)
010D52 29                  A  3316    	ADD	HL,HL
010D53 29                  A  3317    	ADD	HL,HL
010D54 ED4B 1F 55 01       A  3318    	LD	BC,(_cur_row)
010D59 09                  A  3319    	ADD	HL,BC
010D5A 29                  A  3320    	ADD	HL,HL
010D5B 29                  A  3321    	ADD	HL,HL
010D5C 29                  A  3322    	ADD	HL,HL
010D5D 29                  A  3323    	ADD	HL,HL
010D5E 01 27 44 01         A  3324    	LD	BC,_scn_phys
010D62 09                  A  3325    	ADD	HL,BC
010D63 ED4B 22 55 01       A  3326    	LD	BC,(_cur_col)
010D68 09                  A  3327    	ADD	HL,BC
010D69 7E                  A  3328    	LD	A,(HL)
010D6A DD77FF              A  3329    	LD	(IX+-1),A
                           A  3330    ;  839			
                           A  3331    ;  840			cur_col--;
010D6D ED4B 22 55 01       A  3332    	LD	BC,(_cur_col)
010D72 0B                  A  3333    	DEC	BC
010D73 ED43 22 55 01       A  3334    	LD	(_cur_col),BC
                           A  3335    ;  841			
                           A  3336    ;  842			plot_char(cur_col + 1, cur_row,
010D78 DD4EFF              A  3337    	LD	C,(IX+-1)
010D7B 3A 1F 55 01         A  3338    	LD	A,(_cur_row)
010D7F 0600                A  3339    	LD	B,0
010D81 C5                  A  3340    	PUSH	BC
010D82 4F                  A  3341    	LD	C,A
010D83 C5                  A  3342    	PUSH	BC
010D84 3A 22 55 01         A  3343    	LD	A,(_cur_col)
010D88 3C                  A  3344    	INC	A
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  66


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010D89 4F                  A  3345    	LD	C,A
010D8A C5                  A  3346    	PUSH	BC
010D8B CD 84 02 01         A  3347    	CALL	_plot_char
010D8F C1                  A  3348    	POP	BC
010D90 C1                  A  3349    	POP	BC
010D91 C1                  A  3350    	POP	BC
                           A  3351    ;  843		}
                           A  3352    ;  844	}
010D92                     A  3353    L_187:
010D92 DDF9                A  3354    	LD	SP,IX
010D94 DDE1                A  3355    	POP	IX
010D96 C9                  A  3356    	RET	
                           A  3357    
                           A  3358    
                           A  3359    ;**************************** _do_clf *********
                           A  3360    ;Name                         Addr/Register   S
                           A  3361    ;_plot_char                          IMPORT  --
                           A  3362    ;_cur_row                            STATIC    
                           A  3363    ;_scn_phys                           STATIC   4
                           A  3364    ;_paintall                           IMPORT  --
                           A  3365    ;_cur_col                            STATIC    
                           A  3366    ;_Show_Cursor                        IMPORT  --
                           A  3367    ;_cur_char                           STATIC    
                           A  3368    ;ch                                    IX-1    
                           A  3369    
                           A  3370    
                           A  3371    ; Stack Frame Size: 7 (bytes)
                           A  3372    ;       Spill Code: 0 (instruction)
                           A  3373    
                           A  3374    
                           A  3375    ;  845	
                           A  3376    ;  846	/* Cursor right. */
                           A  3377    ;  847	void do_crt(void)
                           A  3378    ;  848	{
010D97                     A  3379    _do_crt:
010D97 21FFFFFF            A  3380    	LD	HL,-1
010D9B CD 57 25 01         A  3381    	CALL	__frameset
                           A  3382    ;  849		char ch;
                           A  3383    ;  850		
                           A  3384    ;  851		if (cur_char == MAXLNLEN)
010D9F 01500000            A  3385    	LD	BC,80
010DA3 2A 1C 55 01         A  3386    	LD	HL,(_cur_char)
010DA7 B7                  A  3387    	OR	A,A
010DA8 ED42                A  3388    	SBC	HL,BC
010DAA 20 06               A  3389    	JR	NZ,L_190
                           A  3390    ;  852		{
                           A  3391    ;  853			Show_Cursor();
010DAC CD 51 18 01         A  3392    	CALL	_Show_Cursor
                           A  3393    ;  854			
                           A  3394    ;  855			return;
010DB0 18 62               A  3395    	JR	L_194
                           A  3396    ;  856		}
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  67


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010DB2                     A  3397    L_190:
                           A  3398    ;  857		
                           A  3399    ;  858		cur_char++;
010DB2 ED4B 1C 55 01       A  3400    	LD	BC,(_cur_char)
010DB7 03                  A  3401    	INC	BC
010DB8 ED43 1C 55 01       A  3402    	LD	(_cur_char),BC
                           A  3403    ;  859		
                           A  3404    ;  860		if (cur_col == SCNCOLS - 1)
010DBD 2A 22 55 01         A  3405    	LD	HL,(_cur_col)
010DC1 B7                  A  3406    	OR	A,A
010DC2 014F0000            A  3407    	LD	BC,79
010DC6 ED42                A  3408    	SBC	HL,BC
010DC8 20 06               A  3409    	JR	NZ,L_193
                           A  3410    ;  861			paintall();
010DCA CD 96 16 01         A  3411    	CALL	_paintall
                           A  3412    ;  862		else
010DCE 18 44               A  3413    	JR	L_194
010DD0                     A  3414    L_193:
                           A  3415    ;  863		{
                           A  3416    ;  864			ch = scn_phys[cur_row][cur_col]
010DD0 2A 1F 55 01         A  3417    	LD	HL,(_cur_row)
010DD4 29                  A  3418    	ADD	HL,HL
010DD5 29                  A  3419    	ADD	HL,HL
010DD6 ED4B 1F 55 01       A  3420    	LD	BC,(_cur_row)
010DDB 09                  A  3421    	ADD	HL,BC
010DDC 29                  A  3422    	ADD	HL,HL
010DDD 29                  A  3423    	ADD	HL,HL
010DDE 29                  A  3424    	ADD	HL,HL
010DDF 29                  A  3425    	ADD	HL,HL
010DE0 01 27 44 01         A  3426    	LD	BC,_scn_phys
010DE4 09                  A  3427    	ADD	HL,BC
010DE5 ED4B 22 55 01       A  3428    	LD	BC,(_cur_col)
010DEA 09                  A  3429    	ADD	HL,BC
010DEB 7E                  A  3430    	LD	A,(HL)
010DEC DD77FF              A  3431    	LD	(IX+-1),A
                           A  3432    ;  865			
                           A  3433    ;  866			cur_col++;
010DEF ED4B 22 55 01       A  3434    	LD	BC,(_cur_col)
010DF4 03                  A  3435    	INC	BC
010DF5 ED43 22 55 01       A  3436    	LD	(_cur_col),BC
                           A  3437    ;  867			
                           A  3438    ;  868			plot_char(cur_col - 1, cur_row,
010DFA DD4EFF              A  3439    	LD	C,(IX+-1)
010DFD 3A 1F 55 01         A  3440    	LD	A,(_cur_row)
010E01 0600                A  3441    	LD	B,0
010E03 C5                  A  3442    	PUSH	BC
010E04 4F                  A  3443    	LD	C,A
010E05 C5                  A  3444    	PUSH	BC
010E06 3A 22 55 01         A  3445    	LD	A,(_cur_col)
010E0A 3D                  A  3446    	DEC	A
010E0B 4F                  A  3447    	LD	C,A
010E0C C5                  A  3448    	PUSH	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  68


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010E0D CD 84 02 01         A  3449    	CALL	_plot_char
010E11 C1                  A  3450    	POP	BC
010E12 C1                  A  3451    	POP	BC
010E13 C1                  A  3452    	POP	BC
                           A  3453    ;  869		}
                           A  3454    ;  870	}
010E14                     A  3455    L_194:
010E14 DDF9                A  3456    	LD	SP,IX
010E16 DDE1                A  3457    	POP	IX
010E18 C9                  A  3458    	RET	
                           A  3459    
                           A  3460    
                           A  3461    ;**************************** _do_crt *********
                           A  3462    ;Name                         Addr/Register   S
                           A  3463    ;_plot_char                          IMPORT  --
                           A  3464    ;_cur_row                            STATIC    
                           A  3465    ;_scn_phys                           STATIC   4
                           A  3466    ;_paintall                           IMPORT  --
                           A  3467    ;_cur_col                            STATIC    
                           A  3468    ;_Show_Cursor                        IMPORT  --
                           A  3469    ;_cur_char                           STATIC    
                           A  3470    ;ch                                    IX-1    
                           A  3471    
                           A  3472    
                           A  3473    ; Stack Frame Size: 7 (bytes)
                           A  3474    ;       Spill Code: 0 (instruction)
                           A  3475    
                           A  3476    
                           A  3477    ;  871	
                           A  3478    ;  872	/* Page down. */
                           A  3479    ;  873	void do_pdw(void)
                           A  3480    ;  874	{
010E19                     A  3481    _do_pdw:
010E19 21FDFFFF            A  3482    	LD	HL,-3
010E1D CD 57 25 01         A  3483    	CALL	__frameset
                           A  3484    ;  875		register char i;
                           A  3485    ;  876		char ch, oldr = cur_row;
010E21 3A 1F 55 01         A  3486    	LD	A,(_cur_row)
010E25 DD77FE              A  3487    	LD	(IX+-2),A
010E28 DD36FF00            A  3488    	LD	(IX+-1),0
                           A  3489    ;  877		
                           A  3490    ;  878		for (i = 0; i < SCNROWS; i++)
010E2C 18 35               A  3491    	JR	L_202
010E2E                     A  3492    L_200:
                           A  3493    ;  879		{
                           A  3494    ;  880			if (cur_line == numlines + 1)
010E2E 2A 16 55 01         A  3495    	LD	HL,(_numlines)
010E32 23                  A  3496    	INC	HL
010E33 B7                  A  3497    	OR	A,A
010E34 ED4B 19 55 01       A  3498    	LD	BC,(_cur_line)
010E39 ED42                A  3499    	SBC	HL,BC
010E3B 28 2F               A  3500    	JR	Z,L_204
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  69


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  3501    ;  881				break;
                           A  3502    ;  882			
                           A  3503    ;  883			p_curr = p_curr->p_next;
010E3D FD2A 13 55 01       A  3504    	LD	IY,(_p_curr)
010E42 FD0703              A  3505    	LD	BC,(IY+3)
010E45 ED43 13 55 01       A  3506    	LD	(_p_curr),BC
                           A  3507    ;  884			
                           A  3508    ;  885			cur_line++;
010E4A ED4B 19 55 01       A  3509    	LD	BC,(_cur_line)
010E4F 03                  A  3510    	INC	BC
010E50 ED43 19 55 01       A  3511    	LD	(_cur_line),BC
                           A  3512    ;  886			cur_row++;
010E55 ED4B 1F 55 01       A  3513    	LD	BC,(_cur_row)
010E5A 03                  A  3514    	INC	BC
010E5B ED43 1F 55 01       A  3515    	LD	(_cur_row),BC
010E60 DD34FF              A  3516    	INC	(IX+-1)
                           A  3517    ;  887		}
010E63                     A  3518    L_202:
010E63 DD7EFF              A  3519    	LD	A,(IX+-1)
010E66 FE32                A  3520    	CP	A,50
010E68 FA 2E 0E 01         A  3521    	JP	M,L_200
010E6C                     A  3522    L_204:
                           A  3523    ;  888		
                           A  3524    ;  889		if (cur_row > SCNROWS - 1)
010E6C ED4B 1F 55 01       A  3525    	LD	BC,(_cur_row)
010E71 21310000            A  3526    	LD	HL,49
010E75 B7                  A  3527    	OR	A,A
010E76 ED42                A  3528    	SBC	HL,BC
010E78 F2 82 0E 01         A  3529    	JP	P,L__151
010E7C EA 8F 0E 01         A  3530    	JP	PE,L_205
010E80 18 04               A  3531    	JR	L__152
010E82                     A  3532    L__151:
010E82 E2 8F 0E 01         A  3533    	JP	PO,L_205
010E86                     A  3534    L__152:
                           A  3535    ;  890			cur_row = SCNROWS - 1;
010E86 01310000            A  3536    	LD	BC,49
010E8A ED43 1F 55 01       A  3537    	LD	(_cur_row),BC
010E8F                     A  3538    L_205:
                           A  3539    ;  891		
                           A  3540    ;  892		paintall();
010E8F CD 96 16 01         A  3541    	CALL	_paintall
                           A  3542    ;  893		
                           A  3543    ;  894		ch = scn_phys[oldr][cur_col];
010E93 DD7EFE              A  3544    	LD	A,(IX+-2)
010E96 17ED62              A  3545    	SEXT	HL
010E99 DD6EFE              A  3546    	LD	L,(IX+-2)
010E9C E5C1                A  3547    	LD	BC,HL
010E9E C5E1                A  3548    	LD	HL,BC
010EA0 29                  A  3549    	ADD	HL,HL
010EA1 29                  A  3550    	ADD	HL,HL
010EA2 09                  A  3551    	ADD	HL,BC
010EA3 29                  A  3552    	ADD	HL,HL
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  70


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010EA4 29                  A  3553    	ADD	HL,HL
010EA5 29                  A  3554    	ADD	HL,HL
010EA6 29                  A  3555    	ADD	HL,HL
010EA7 01 27 44 01         A  3556    	LD	BC,_scn_phys
010EAB 09                  A  3557    	ADD	HL,BC
010EAC ED4B 22 55 01       A  3558    	LD	BC,(_cur_col)
010EB1 09                  A  3559    	ADD	HL,BC
010EB2 7E                  A  3560    	LD	A,(HL)
010EB3 DD77FD              A  3561    	LD	(IX+-3),A
                           A  3562    ;  895		
                           A  3563    ;  896		plot_char(cur_col, oldr, ch);
010EB6 DD4EFD              A  3564    	LD	C,(IX+-3)
010EB9 0600                A  3565    	LD	B,0
010EBB C5                  A  3566    	PUSH	BC
010EBC DD4EFE              A  3567    	LD	C,(IX+-2)
010EBF 3A 22 55 01         A  3568    	LD	A,(_cur_col)
010EC3 C5                  A  3569    	PUSH	BC
010EC4 4F                  A  3570    	LD	C,A
010EC5 C5                  A  3571    	PUSH	BC
010EC6 CD 84 02 01         A  3572    	CALL	_plot_char
010ECA C1                  A  3573    	POP	BC
010ECB C1                  A  3574    	POP	BC
010ECC C1                  A  3575    	POP	BC
                           A  3576    ;  897		
                           A  3577    ;  898		Show_Cursor();
010ECD CD 51 18 01         A  3578    	CALL	_Show_Cursor
                           A  3579    ;  899	}
010ED1 DDF9                A  3580    	LD	SP,IX
010ED3 DDE1                A  3581    	POP	IX
010ED5 C9                  A  3582    	RET	
                           A  3583    
                           A  3584    
                           A  3585    ;**************************** _do_pdw *********
                           A  3586    ;Name                         Addr/Register   S
                           A  3587    ;_Show_Cursor                        IMPORT  --
                           A  3588    ;_plot_char                          IMPORT  --
                           A  3589    ;_cur_col                            STATIC    
                           A  3590    ;_scn_phys                           STATIC   4
                           A  3591    ;_paintall                           IMPORT  --
                           A  3592    ;_p_curr                             STATIC    
                           A  3593    ;_cur_line                           STATIC    
                           A  3594    ;_numlines                           STATIC    
                           A  3595    ;_cur_row                            STATIC    
                           A  3596    ;ch                                    IX-3    
                           A  3597    ;oldr                                  IX-2    
                           A  3598    ;i                                     IX-1    
                           A  3599    
                           A  3600    
                           A  3601    ; Stack Frame Size: 9 (bytes)
                           A  3602    ;       Spill Code: 0 (instruction)
                           A  3603    
                           A  3604    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  71


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  3605    ;  900	
                           A  3606    ;  901	/* Page up. */
                           A  3607    ;  902	void do_pup(void)
                           A  3608    ;  903	{
010ED6                     A  3609    _do_pup:
010ED6 21FDFFFF            A  3610    	LD	HL,-3
010EDA CD 57 25 01         A  3611    	CALL	__frameset
                           A  3612    ;  904		register char i;
                           A  3613    ;  905		char ch, oldr = cur_row;
010EDE 3A 1F 55 01         A  3614    	LD	A,(_cur_row)
010EE2 DD77FE              A  3615    	LD	(IX+-2),A
010EE5 DD36FF00            A  3616    	LD	(IX+-1),0
                           A  3617    ;  906		
                           A  3618    ;  907		for (i = 0; i < SCNROWS; i++)
010EE9 18 33               A  3619    	JR	L_214
010EEB                     A  3620    L_212:
                           A  3621    ;  908		{
                           A  3622    ;  909			if (cur_line == 1)
010EEB 01010000            A  3623    	LD	BC,1
010EEF 2A 19 55 01         A  3624    	LD	HL,(_cur_line)
010EF3 B7                  A  3625    	OR	A,A
010EF4 ED42                A  3626    	SBC	HL,BC
010EF6 28 39               A  3627    	JR	Z,L_216
                           A  3628    ;  910				break;
                           A  3629    ;  911			
                           A  3630    ;  912			p_curr = p_curr->p_prev;
010EF8 FD2A 13 55 01       A  3631    	LD	IY,(_p_curr)
010EFD FD0700              A  3632    	LD	BC,(IY+0)
010F00 ED43 13 55 01       A  3633    	LD	(_p_curr),BC
                           A  3634    ;  913			
                           A  3635    ;  914			cur_line--;
010F05 ED4B 19 55 01       A  3636    	LD	BC,(_cur_line)
010F0A 0B                  A  3637    	DEC	BC
010F0B ED43 19 55 01       A  3638    	LD	(_cur_line),BC
                           A  3639    ;  915			cur_row--;
010F10 ED4B 1F 55 01       A  3640    	LD	BC,(_cur_row)
010F15 0B                  A  3641    	DEC	BC
010F16 ED43 1F 55 01       A  3642    	LD	(_cur_row),BC
010F1B DD34FF              A  3643    	INC	(IX+-1)
                           A  3644    ;  916		}
010F1E                     A  3645    L_214:
010F1E DD7EFF              A  3646    	LD	A,(IX+-1)
010F21 FE32                A  3647    	CP	A,50
010F23 FA 2D 0F 01         A  3648    	JP	M,L__157
010F27 EA EB 0E 01         A  3649    	JP	PE,L_212
010F2B 18 04               A  3650    	JR	L__158
010F2D                     A  3651    L__157:
010F2D E2 EB 0E 01         A  3652    	JP	PO,L_212
010F31                     A  3653    L__158:
010F31                     A  3654    L_216:
                           A  3655    ;  917		
                           A  3656    ;  918		if (cur_row < 0)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  72


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010F31 01000000            A  3657    	LD	BC,0
010F35 2A 1F 55 01         A  3658    	LD	HL,(_cur_row)
010F39 B7                  A  3659    	OR	A,A
010F3A ED42                A  3660    	SBC	HL,BC
010F3C F2 46 0F 01         A  3661    	JP	P,L__159
010F40 EA 53 0F 01         A  3662    	JP	PE,L_217
010F44 18 04               A  3663    	JR	L__160
010F46                     A  3664    L__159:
010F46 E2 53 0F 01         A  3665    	JP	PO,L_217
010F4A                     A  3666    L__160:
                           A  3667    ;  919			cur_row = 0;	
010F4A 01000000            A  3668    	LD	BC,0
010F4E ED43 1F 55 01       A  3669    	LD	(_cur_row),BC
010F53                     A  3670    L_217:
                           A  3671    ;  920		
                           A  3672    ;  921		paintall();
010F53 CD 96 16 01         A  3673    	CALL	_paintall
                           A  3674    ;  922		
                           A  3675    ;  923		ch = scn_phys[oldr][cur_col];
010F57 DD7EFE              A  3676    	LD	A,(IX+-2)
010F5A 17ED62              A  3677    	SEXT	HL
010F5D DD6EFE              A  3678    	LD	L,(IX+-2)
010F60 E5C1                A  3679    	LD	BC,HL
010F62 C5E1                A  3680    	LD	HL,BC
010F64 29                  A  3681    	ADD	HL,HL
010F65 29                  A  3682    	ADD	HL,HL
010F66 09                  A  3683    	ADD	HL,BC
010F67 29                  A  3684    	ADD	HL,HL
010F68 29                  A  3685    	ADD	HL,HL
010F69 29                  A  3686    	ADD	HL,HL
010F6A 29                  A  3687    	ADD	HL,HL
010F6B 01 27 44 01         A  3688    	LD	BC,_scn_phys
010F6F 09                  A  3689    	ADD	HL,BC
010F70 ED4B 22 55 01       A  3690    	LD	BC,(_cur_col)
010F75 09                  A  3691    	ADD	HL,BC
010F76 7E                  A  3692    	LD	A,(HL)
010F77 DD77FD              A  3693    	LD	(IX+-3),A
                           A  3694    ;  924		
                           A  3695    ;  925		plot_char(cur_col, oldr, ch);
010F7A DD4EFD              A  3696    	LD	C,(IX+-3)
010F7D 0600                A  3697    	LD	B,0
010F7F C5                  A  3698    	PUSH	BC
010F80 DD4EFE              A  3699    	LD	C,(IX+-2)
010F83 3A 22 55 01         A  3700    	LD	A,(_cur_col)
010F87 C5                  A  3701    	PUSH	BC
010F88 4F                  A  3702    	LD	C,A
010F89 C5                  A  3703    	PUSH	BC
010F8A CD 84 02 01         A  3704    	CALL	_plot_char
010F8E C1                  A  3705    	POP	BC
010F8F C1                  A  3706    	POP	BC
010F90 C1                  A  3707    	POP	BC
                           A  3708    ;  926		
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  73


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  3709    ;  927		Show_Cursor();
010F91 CD 51 18 01         A  3710    	CALL	_Show_Cursor
                           A  3711    ;  928	}
010F95 DDF9                A  3712    	LD	SP,IX
010F97 DDE1                A  3713    	POP	IX
010F99 C9                  A  3714    	RET	
                           A  3715    
                           A  3716    
                           A  3717    ;**************************** _do_pup *********
                           A  3718    ;Name                         Addr/Register   S
                           A  3719    ;_Show_Cursor                        IMPORT  --
                           A  3720    ;_plot_char                          IMPORT  --
                           A  3721    ;_cur_col                            STATIC    
                           A  3722    ;_scn_phys                           STATIC   4
                           A  3723    ;_paintall                           IMPORT  --
                           A  3724    ;_p_curr                             STATIC    
                           A  3725    ;_cur_line                           STATIC    
                           A  3726    ;_cur_row                            STATIC    
                           A  3727    ;ch                                    IX-3    
                           A  3728    ;oldr                                  IX-2    
                           A  3729    ;i                                     IX-1    
                           A  3730    
                           A  3731    
                           A  3732    ; Stack Frame Size: 9 (bytes)
                           A  3733    ;       Spill Code: 0 (instruction)
                           A  3734    
                           A  3735    
                           A  3736    ;  929	
                           A  3737    ;  930	/* Return. */
                           A  3738    ;  931	void do_ret(void)
                           A  3739    ;  932	{
010F9A                     A  3740    _do_ret:
010F9A 21FCFFFF            A  3741    	LD	HL,-4
010F9E CD 57 25 01         A  3742    	CALL	__frameset
                           A  3743    ;  933		char len = strlen(p_curr->p_data);
010FA2 FD2A 13 55 01       A  3744    	LD	IY,(_p_curr)
010FA7 FD0706              A  3745    	LD	BC,(IY+6)
010FAA C5                  A  3746    	PUSH	BC
010FAB CD 14 25 01         A  3747    	CALL	_strlen
010FAF C1                  A  3748    	POP	BC
010FB0 DD75FC              A  3749    	LD	(IX+-4),L
                           A  3750    ;  934		char ch, oldr = cur_row, oldc = cur
010FB3 3A 1F 55 01         A  3751    	LD	A,(_cur_row)
010FB7 DD77FF              A  3752    	LD	(IX+-1),A
010FBA 3A 22 55 01         A  3753    	LD	A,(_cur_col)
010FBE DD77FE              A  3754    	LD	(IX+-2),A
                           A  3755    ;  935		
                           A  3756    ;  936		gotoxy(len, cur_row);
010FC1 3A 1F 55 01         A  3757    	LD	A,(_cur_row)
010FC5 4F                  A  3758    	LD	C,A
010FC6 0600                A  3759    	LD	B,0
010FC8 C5                  A  3760    	PUSH	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  74


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
010FC9 DD4EFC              A  3761    	LD	C,(IX+-4)
010FCC C5                  A  3762    	PUSH	BC
010FCD CD FF 02 01         A  3763    	CALL	_gotoxy
010FD1 C1                  A  3764    	POP	BC
010FD2 C1                  A  3765    	POP	BC
                           A  3766    ;  937		
                           A  3767    ;  938		clreol();
010FD3 CD BC 02 01         A  3768    	CALL	_clreol
                           A  3769    ;  939		
                           A  3770    ;  940		ch = scn_phys[oldr][oldc];
010FD7 DD7EFF              A  3771    	LD	A,(IX+-1)
010FDA 17ED62              A  3772    	SEXT	HL
010FDD DD6EFF              A  3773    	LD	L,(IX+-1)
010FE0 E5C1                A  3774    	LD	BC,HL
010FE2 C5E1                A  3775    	LD	HL,BC
010FE4 29                  A  3776    	ADD	HL,HL
010FE5 29                  A  3777    	ADD	HL,HL
010FE6 09                  A  3778    	ADD	HL,BC
010FE7 29                  A  3779    	ADD	HL,HL
010FE8 29                  A  3780    	ADD	HL,HL
010FE9 29                  A  3781    	ADD	HL,HL
010FEA 29                  A  3782    	ADD	HL,HL
010FEB DD7EFE              A  3783    	LD	A,(IX+-2)
010FEE 01 27 44 01         A  3784    	LD	BC,_scn_phys
010FF2 09                  A  3785    	ADD	HL,BC
010FF3 E5C1                A  3786    	LD	BC,HL
010FF5 17ED62              A  3787    	SEXT	HL
010FF8 DD6EFE              A  3788    	LD	L,(IX+-2)
010FFB 09                  A  3789    	ADD	HL,BC
010FFC 7E                  A  3790    	LD	A,(HL)
010FFD DD77FD              A  3791    	LD	(IX+-3),A
                           A  3792    ;  941		
                           A  3793    ;  942		plot_char(oldc, oldr, ch);
011000 DD4EFD              A  3794    	LD	C,(IX+-3)
011003 0600                A  3795    	LD	B,0
011005 C5                  A  3796    	PUSH	BC
011006 DD4EFF              A  3797    	LD	C,(IX+-1)
011009 C5                  A  3798    	PUSH	BC
01100A DD4EFE              A  3799    	LD	C,(IX+-2)
01100D C5                  A  3800    	PUSH	BC
01100E CD 84 02 01         A  3801    	CALL	_plot_char
011012 C1                  A  3802    	POP	BC
011013 C1                  A  3803    	POP	BC
011014 C1                  A  3804    	POP	BC
                           A  3805    ;  943		
                           A  3806    ;  944		cur_char = 1;
011015 01010000            A  3807    	LD	BC,1
011019 ED43 1C 55 01       A  3808    	LD	(_cur_char),BC
                           A  3809    ;  945		cur_col  = 0;
01101E 01000000            A  3810    	LD	BC,0
011022 ED43 22 55 01       A  3811    	LD	(_cur_col),BC
                           A  3812    ;  946		
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  75


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  3813    ;  947		ch = scn_phys[oldr][oldc];
011027 DD7EFF              A  3814    	LD	A,(IX+-1)
01102A 17ED62              A  3815    	SEXT	HL
01102D DD6EFF              A  3816    	LD	L,(IX+-1)
011030 E5C1                A  3817    	LD	BC,HL
011032 C5E1                A  3818    	LD	HL,BC
011034 29                  A  3819    	ADD	HL,HL
011035 29                  A  3820    	ADD	HL,HL
011036 09                  A  3821    	ADD	HL,BC
011037 29                  A  3822    	ADD	HL,HL
011038 29                  A  3823    	ADD	HL,HL
011039 29                  A  3824    	ADD	HL,HL
01103A 29                  A  3825    	ADD	HL,HL
01103B DD7EFE              A  3826    	LD	A,(IX+-2)
01103E 01 27 44 01         A  3827    	LD	BC,_scn_phys
011042 09                  A  3828    	ADD	HL,BC
011043 E5C1                A  3829    	LD	BC,HL
011045 17ED62              A  3830    	SEXT	HL
011048 DD6EFE              A  3831    	LD	L,(IX+-2)
01104B 09                  A  3832    	ADD	HL,BC
01104C 7E                  A  3833    	LD	A,(HL)
01104D DD77FD              A  3834    	LD	(IX+-3),A
                           A  3835    ;  948		
                           A  3836    ;  949		plot_char(oldc, oldr, ch);
011050 DD4EFD              A  3837    	LD	C,(IX+-3)
011053 0600                A  3838    	LD	B,0
011055 C5                  A  3839    	PUSH	BC
011056 DD4EFF              A  3840    	LD	C,(IX+-1)
011059 C5                  A  3841    	PUSH	BC
01105A DD4EFE              A  3842    	LD	C,(IX+-2)
01105D C5                  A  3843    	PUSH	BC
01105E CD 84 02 01         A  3844    	CALL	_plot_char
011062 C1                  A  3845    	POP	BC
011063 C1                  A  3846    	POP	BC
011064 C1                  A  3847    	POP	BC
                           A  3848    ;  950		
                           A  3849    ;  951		do_cdw();
011065 CD 84 0C 01         A  3850    	CALL	_do_cdw
                           A  3851    ;  952	}
011069 DDF9                A  3852    	LD	SP,IX
01106B DDE1                A  3853    	POP	IX
01106D C9                  A  3854    	RET	
                           A  3855    
                           A  3856    
                           A  3857    ;**************************** _do_ret *********
                           A  3858    ;Name                         Addr/Register   S
                           A  3859    ;_do_cdw                             IMPORT  --
                           A  3860    ;_cur_char                           STATIC    
                           A  3861    ;_plot_char                          IMPORT  --
                           A  3862    ;_scn_phys                           STATIC   4
                           A  3863    ;_clreol                             IMPORT  --
                           A  3864    ;_gotoxy                             IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  76


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  3865    ;_cur_col                            STATIC    
                           A  3866    ;_cur_row                            STATIC    
                           A  3867    ;_p_curr                             STATIC    
                           A  3868    ;_strlen                             IMPORT  --
                           A  3869    ;len                                   IX-4    
                           A  3870    ;ch                                    IX-3    
                           A  3871    ;oldc                                  IX-2    
                           A  3872    ;oldr                                  IX-1    
                           A  3873    
                           A  3874    
                           A  3875    ; Stack Frame Size: 10 (bytes)
                           A  3876    ;       Spill Code: 0 (instruction)
                           A  3877    
                           A  3878    
                           A  3879    ;  953	
                           A  3880    ;  954	/* Enhanced Return. Break a line into t
                           A  3881    ;  955	void do_enhanced_ret(void)
                           A  3882    ;  956	{
01106E                     A  3883    _do_enhanced_ret:
01106E 215FFFFF            A  3884    	LD	HL,-161
011072 CD 57 25 01         A  3885    	CALL	__frameset
                           A  3886    ;  957		char len = strlen(p_curr->p_data);
011076 FD2A 13 55 01       A  3887    	LD	IY,(_p_curr)
01107B FD0706              A  3888    	LD	BC,(IY+6)
01107E C5                  A  3889    	PUSH	BC
01107F CD 14 25 01         A  3890    	CALL	_strlen
011083 C1                  A  3891    	POP	BC
011084 DD75FF              A  3892    	LD	(IX+-1),L
                           A  3893    ;  958		char app[MAXLNLEN], app2[MAXLNLEN];
                           A  3894    ;  959		
                           A  3895    ;  960		if (cur_col < len)
011087 DD7EFF              A  3896    	LD	A,(IX+-1)
01108A 17ED62              A  3897    	SEXT	HL
01108D DD6EFF              A  3898    	LD	L,(IX+-1)
011090 E5C1                A  3899    	LD	BC,HL
011092 2A 22 55 01         A  3900    	LD	HL,(_cur_col)
011096 B7                  A  3901    	OR	A,A
011097 ED42                A  3902    	SBC	HL,BC
011099 F2 A3 10 01         A  3903    	JP	P,L__164
01109D EA 58 11 01         A  3904    	JP	PE,L_221
0110A1 18 04               A  3905    	JR	L__165
0110A3                     A  3906    L__164:
0110A3 E2 58 11 01         A  3907    	JP	PO,L_221
0110A7                     A  3908    L__165:
                           A  3909    ;  961		{
                           A  3910    ;  962			memset(app, 0, MAXLNLEN);
0110A7 01500000            A  3911    	LD	BC,80
0110AB C5                  A  3912    	PUSH	BC
0110AC 01000000            A  3913    	LD	BC,0
0110B0 C5                  A  3914    	PUSH	BC
0110B1 ED65AF              A  3915    	PEA	IX+-81
0110B4 CD 15 26 01         A  3916    	CALL	_memset
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  77


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0110B8 C1                  A  3917    	POP	BC
0110B9 C1                  A  3918    	POP	BC
0110BA C1                  A  3919    	POP	BC
                           A  3920    ;  963			memset(app2, 0, MAXLNLEN);
0110BB 01500000            A  3921    	LD	BC,80
0110BF C5                  A  3922    	PUSH	BC
0110C0 01000000            A  3923    	LD	BC,0
0110C4 C5                  A  3924    	PUSH	BC
0110C5 DDE5E1              A  3925    	LD	HL,IX
0110C8 015FFFFF            A  3926    	LD	BC,-161
0110CC 09                  A  3927    	ADD	HL,BC
0110CD E5C1                A  3928    	LD	BC,HL
0110CF C5                  A  3929    	PUSH	BC
0110D0 CD 15 26 01         A  3930    	CALL	_memset
0110D4 C1                  A  3931    	POP	BC
0110D5 C1                  A  3932    	POP	BC
0110D6 C1                  A  3933    	POP	BC
                           A  3934    ;  964			
                           A  3935    ;  965			memmove(app, p_curr->p_data + c
0110D7 DD7EFF              A  3936    	LD	A,(IX+-1)
0110DA 17ED62              A  3937    	SEXT	HL
0110DD DD6EFF              A  3938    	LD	L,(IX+-1)
0110E0 B7                  A  3939    	OR	A,A
0110E1 ED4B 22 55 01       A  3940    	LD	BC,(_cur_col)
0110E6 FD2A 13 55 01       A  3941    	LD	IY,(_p_curr)
0110EB ED5B 22 55 01       A  3942    	LD	DE,(_cur_col)
0110F0 ED42                A  3943    	SBC	HL,BC
0110F2 E5                  A  3944    	PUSH	HL
0110F3 FD2706              A  3945    	LD	HL,(IY+6)
0110F6 19                  A  3946    	ADD	HL,DE
0110F7 E5                  A  3947    	PUSH	HL
0110F8 ED65AF              A  3948    	PEA	IX+-81
0110FB CD 36 26 01         A  3949    	CALL	_memmove
0110FF C1                  A  3950    	POP	BC
011100 C1                  A  3951    	POP	BC
011101 C1                  A  3952    	POP	BC
                           A  3953    ;  966			
                           A  3954    ;  967			memmove(app2, p_curr->p_data, c
011102 ED4B 22 55 01       A  3955    	LD	BC,(_cur_col)
011107 C5                  A  3956    	PUSH	BC
011108 FD2A 13 55 01       A  3957    	LD	IY,(_p_curr)
01110D FD0706              A  3958    	LD	BC,(IY+6)
011110 C5                  A  3959    	PUSH	BC
011111 DDE5E1              A  3960    	LD	HL,IX
011114 015FFFFF            A  3961    	LD	BC,-161
011118 09                  A  3962    	ADD	HL,BC
011119 E5C1                A  3963    	LD	BC,HL
01111B C5                  A  3964    	PUSH	BC
01111C CD 36 26 01         A  3965    	CALL	_memmove
011120 C1                  A  3966    	POP	BC
011121 C1                  A  3967    	POP	BC
011122 C1                  A  3968    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  78


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  3969    ;  968			
                           A  3970    ;  969			do_iln();
011123 CD CF 13 01         A  3971    	CALL	_do_iln
                           A  3972    ;  970			
                           A  3973    ;  971			tx_set(p_curr, app);
011127 ED65AF              A  3974    	PEA	IX+-81
01112A ED4B 13 55 01       A  3975    	LD	BC,(_p_curr)
01112F C5                  A  3976    	PUSH	BC
011130 CD E5 09 01         A  3977    	CALL	_tx_set
011134 C1                  A  3978    	POP	BC
011135 C1                  A  3979    	POP	BC
                           A  3980    ;  972			
                           A  3981    ;  973			tx_set(p_curr->p_prev, app2);
011136 DDE5E1              A  3982    	LD	HL,IX
011139 015FFFFF            A  3983    	LD	BC,-161
01113D 09                  A  3984    	ADD	HL,BC
01113E E5C1                A  3985    	LD	BC,HL
011140 C5                  A  3986    	PUSH	BC
011141 FD2A 13 55 01       A  3987    	LD	IY,(_p_curr)
011146 FD0700              A  3988    	LD	BC,(IY+0)
011149 C5                  A  3989    	PUSH	BC
01114A CD E5 09 01         A  3990    	CALL	_tx_set
01114E C1                  A  3991    	POP	BC
01114F C1                  A  3992    	POP	BC
                           A  3993    ;  974			
                           A  3994    ;  975			paintall();
011150 CD 96 16 01         A  3995    	CALL	_paintall
                           A  3996    ;  976			
                           A  3997    ;  977			do_cup();
011154 CD F5 0B 01         A  3998    	CALL	_do_cup
                           A  3999    ;  978		}
011158                     A  4000    L_221:
                           A  4001    ;  979		
                           A  4002    ;  980		do_ret();
011158 CD 9A 0F 01         A  4003    	CALL	_do_ret
                           A  4004    ;  981	}
01115C DDF9                A  4005    	LD	SP,IX
01115E DDE1                A  4006    	POP	IX
011160 C9                  A  4007    	RET	
                           A  4008    
                           A  4009    
                           A  4010    ;**************************** _do_enhanced_ret 
                           A  4011    ;Name                         Addr/Register   S
                           A  4012    ;_do_ret                             IMPORT  --
                           A  4013    ;_do_cup                             IMPORT  --
                           A  4014    ;_paintall                           IMPORT  --
                           A  4015    ;_tx_set                             IMPORT  --
                           A  4016    ;_do_iln                             IMPORT  --
                           A  4017    ;_memmove                            IMPORT  --
                           A  4018    ;_memset                             IMPORT  --
                           A  4019    ;_cur_col                            STATIC    
                           A  4020    ;_p_curr                             STATIC    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  79


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  4021    ;_strlen                             IMPORT  --
                           A  4022    ;app2                                IX-161    
                           A  4023    ;app                                  IX-81    
                           A  4024    ;len                                   IX-1    
                           A  4025    
                           A  4026    
                           A  4027    ; Stack Frame Size: 167 (bytes)
                           A  4028    ;       Spill Code: 0 (instruction)
                           A  4029    
                           A  4030    
                           A  4031    ;  982	
                           A  4032    ;  983	/* Tab. */
                           A  4033    ;  984	void do_tab(void)
                           A  4034    ;  985	{
011161                     A  4035    _do_tab:
011161 21FDFFFF            A  4036    	LD	HL,-3
011165 CD 57 25 01         A  4037    	CALL	__frameset
                           A  4038    ;  986		int x = cur_char;
011169 ED4B 1C 55 01       A  4039    	LD	BC,(_cur_char)
01116E DD0FFD              A  4040    	LD	(IX+-3),BC
                           A  4041    ;  987		
                           A  4042    ;  988		do
011171                     A  4043    L_224:
                           A  4044    ;  989		{
                           A  4045    ;  990			do_crt();
011171 CD 97 0D 01         A  4046    	CALL	_do_crt
                           A  4047    ;  991			x++;
011175 DD07FD              A  4048    	LD	BC,(IX+-3)
011178 03                  A  4049    	INC	BC
011179 DD0FFD              A  4050    	LD	(IX+-3),BC
                           A  4051    ;  992		} while (((x - 1) % 8) != 0);
01117C C5E1                A  4052    	LD	HL,BC
01117E 2B                  A  4053    	DEC	HL
01117F 01080000            A  4054    	LD	BC,8
011183 CD D3 24 01         A  4055    	CALL	__irems
011187 B7                  A  4056    	OR	A,A
011188 01000000            A  4057    	LD	BC,0
01118C ED42                A  4058    	SBC	HL,BC
01118E 20 E1               A  4059    	JR	NZ,L_224
                           A  4060    ;  993	}
011190 DDF9                A  4061    	LD	SP,IX
011192 DDE1                A  4062    	POP	IX
011194 C9                  A  4063    	RET	
                           A  4064    
                           A  4065    
                           A  4066    ;**************************** _do_tab *********
                           A  4067    ;Name                         Addr/Register   S
                           A  4068    ;_do_crt                             IMPORT  --
                           A  4069    ;_cur_char                           STATIC    
                           A  4070    ;x                                     IX-3    
                           A  4071    
                           A  4072    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  80


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  4073    ; Stack Frame Size: 9 (bytes)
                           A  4074    ;       Spill Code: 0 (instruction)
                           A  4075    
                           A  4076    
                           A  4077    ;  994	
                           A  4078    ;  995	/* Jump to top of document. */
                           A  4079    ;  996	void do_top(void)
                           A  4080    ;  997	{
011195                     A  4081    _do_top:
011195 21FEFFFF            A  4082    	LD	HL,-2
011199 CD 57 25 01         A  4083    	CALL	__frameset
                           A  4084    ;  998		char oldr, oldc;
                           A  4085    ;  999		
                           A  4086    ; 1000		oldr = cur_row;
01119D 3A 1F 55 01         A  4087    	LD	A,(_cur_row)
0111A1 DD77FF              A  4088    	LD	(IX+-1),A
                           A  4089    ; 1001		oldc = cur_col;
0111A4 3A 22 55 01         A  4090    	LD	A,(_cur_col)
0111A8 DD77FE              A  4091    	LD	(IX+-2),A
                           A  4092    ; 1002		
                           A  4093    ; 1003		p_curr = p_root->p_next;
0111AB FD2A 10 55 01       A  4094    	LD	IY,(_p_root)
0111B0 FD0703              A  4095    	LD	BC,(IY+3)
0111B3 ED43 13 55 01       A  4096    	LD	(_p_curr),BC
                           A  4097    ; 1004		
                           A  4098    ; 1005		cur_line = 1;
0111B8 01010000            A  4099    	LD	BC,1
0111BC ED43 19 55 01       A  4100    	LD	(_cur_line),BC
                           A  4101    ; 1006		cur_char = 1;
0111C1 ED43 1C 55 01       A  4102    	LD	(_cur_char),BC
                           A  4103    ; 1007		cur_row = 0;
0111C6 01000000            A  4104    	LD	BC,0
0111CA ED43 1F 55 01       A  4105    	LD	(_cur_row),BC
                           A  4106    ; 1008		cur_col = 0;
0111CF ED43 22 55 01       A  4107    	LD	(_cur_col),BC
                           A  4108    ; 1009		
                           A  4109    ; 1010		paintall();
0111D4 CD 96 16 01         A  4110    	CALL	_paintall
                           A  4111    ; 1011		
                           A  4112    ; 1012		plot_char(oldc, oldr, scn_phys[oldr
0111D8 DD7EFF              A  4113    	LD	A,(IX+-1)
0111DB 17ED62              A  4114    	SEXT	HL
0111DE DD6EFF              A  4115    	LD	L,(IX+-1)
0111E1 E5C1                A  4116    	LD	BC,HL
0111E3 C5E1                A  4117    	LD	HL,BC
0111E5 29                  A  4118    	ADD	HL,HL
0111E6 29                  A  4119    	ADD	HL,HL
0111E7 09                  A  4120    	ADD	HL,BC
0111E8 29                  A  4121    	ADD	HL,HL
0111E9 29                  A  4122    	ADD	HL,HL
0111EA 29                  A  4123    	ADD	HL,HL
0111EB 29                  A  4124    	ADD	HL,HL
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  81


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0111EC 01 27 44 01         A  4125    	LD	BC,_scn_phys
0111F0 09                  A  4126    	ADD	HL,BC
0111F1 E5C1                A  4127    	LD	BC,HL
0111F3 DD7EFE              A  4128    	LD	A,(IX+-2)
0111F6 17ED62              A  4129    	SEXT	HL
0111F9 DD6EFE              A  4130    	LD	L,(IX+-2)
0111FC 09                  A  4131    	ADD	HL,BC
0111FD 4E                  A  4132    	LD	C,(HL)
0111FE 0600                A  4133    	LD	B,0
011200 C5                  A  4134    	PUSH	BC
011201 DD4EFF              A  4135    	LD	C,(IX+-1)
011204 C5                  A  4136    	PUSH	BC
011205 DD4EFE              A  4137    	LD	C,(IX+-2)
011208 C5                  A  4138    	PUSH	BC
011209 CD 84 02 01         A  4139    	CALL	_plot_char
01120D C1                  A  4140    	POP	BC
01120E C1                  A  4141    	POP	BC
01120F C1                  A  4142    	POP	BC
                           A  4143    ; 1013	}
011210 DDF9                A  4144    	LD	SP,IX
011212 DDE1                A  4145    	POP	IX
011214 C9                  A  4146    	RET	
                           A  4147    
                           A  4148    
                           A  4149    ;**************************** _do_top *********
                           A  4150    ;Name                         Addr/Register   S
                           A  4151    ;_scn_phys                           STATIC   4
                           A  4152    ;_plot_char                          IMPORT  --
                           A  4153    ;_paintall                           IMPORT  --
                           A  4154    ;_cur_char                           STATIC    
                           A  4155    ;_cur_line                           STATIC    
                           A  4156    ;_p_curr                             STATIC    
                           A  4157    ;_p_root                             STATIC    
                           A  4158    ;_cur_col                            STATIC    
                           A  4159    ;_cur_row                            STATIC    
                           A  4160    ;oldc                                  IX-2    
                           A  4161    ;oldr                                  IX-1    
                           A  4162    
                           A  4163    
                           A  4164    ; Stack Frame Size: 8 (bytes)
                           A  4165    ;       Spill Code: 0 (instruction)
                           A  4166    
                           A  4167    
                           A  4168    ; 1014	
                           A  4169    ; 1015	/* Jump to bottom of document. */
                           A  4170    ; 1016	void do_bot(char paint)
                           A  4171    ; 1017	{
011215                     A  4172    _do_bot:
011215 21FEFFFF            A  4173    	LD	HL,-2
011219 CD 57 25 01         A  4174    	CALL	__frameset
                           A  4175    ; 1018		char oldr, oldc;
                           A  4176    ; 1019		
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  82


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  4177    ; 1020		oldr = cur_row;
01121D 3A 1F 55 01         A  4178    	LD	A,(_cur_row)
011221 DD77FF              A  4179    	LD	(IX+-1),A
                           A  4180    ; 1021		oldc = cur_col;
011224 3A 22 55 01         A  4181    	LD	A,(_cur_col)
011228 DD77FE              A  4182    	LD	(IX+-2),A
                           A  4183    ; 1022		
                           A  4184    ; 1023		p_curr = p_root;
01122B ED4B 10 55 01       A  4185    	LD	BC,(_p_root)
011230 ED43 13 55 01       A  4186    	LD	(_p_curr),BC
                           A  4187    ; 1024		
                           A  4188    ; 1025		cur_line = numlines + 1;
011235 ED4B 16 55 01       A  4189    	LD	BC,(_numlines)
01123A 03                  A  4190    	INC	BC
01123B ED43 19 55 01       A  4191    	LD	(_cur_line),BC
                           A  4192    ; 1026		cur_row = numlines;
011240 ED4B 16 55 01       A  4193    	LD	BC,(_numlines)
011245 ED43 1F 55 01       A  4194    	LD	(_cur_row),BC
                           A  4195    ; 1027		cur_char = 1;
01124A 01010000            A  4196    	LD	BC,1
01124E ED43 1C 55 01       A  4197    	LD	(_cur_char),BC
                           A  4198    ; 1028		cur_col = 0;
011253 01000000            A  4199    	LD	BC,0
011257 ED43 22 55 01       A  4200    	LD	(_cur_col),BC
                           A  4201    ; 1029		
                           A  4202    ; 1030		if (cur_row > SCNROWS - 1)
01125C ED4B 16 55 01       A  4203    	LD	BC,(_numlines)
011261 B7                  A  4204    	OR	A,A
011262 21310000            A  4205    	LD	HL,49
011266 ED42                A  4206    	SBC	HL,BC
011268 F2 72 12 01         A  4207    	JP	P,L__172
01126C EA 7F 12 01         A  4208    	JP	PE,L_230
011270 18 04               A  4209    	JR	L__173
011272                     A  4210    L__172:
011272 E2 7F 12 01         A  4211    	JP	PO,L_230
011276                     A  4212    L__173:
                           A  4213    ; 1031			cur_row = SCNROWS - 1;
011276 01310000            A  4214    	LD	BC,49
01127A ED43 1F 55 01       A  4215    	LD	(_cur_row),BC
01127F                     A  4216    L_230:
                           A  4217    ; 1032		
                           A  4218    ; 1033		if (paint)
01127F DD7E06              A  4219    	LD	A,(IX+6)
011282 B7                  A  4220    	OR	A,A
011283 28 04               A  4221    	JR	Z,L_231
                           A  4222    ; 1034			paintall();
011285 CD 96 16 01         A  4223    	CALL	_paintall
011289                     A  4224    L_231:
                           A  4225    ; 1035		
                           A  4226    ; 1036		plot_char(oldc, oldr, scn_phys[oldr
011289 DD7EFF              A  4227    	LD	A,(IX+-1)
01128C 17ED62              A  4228    	SEXT	HL
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  83


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01128F DD6EFF              A  4229    	LD	L,(IX+-1)
011292 E5C1                A  4230    	LD	BC,HL
011294 C5E1                A  4231    	LD	HL,BC
011296 29                  A  4232    	ADD	HL,HL
011297 29                  A  4233    	ADD	HL,HL
011298 09                  A  4234    	ADD	HL,BC
011299 29                  A  4235    	ADD	HL,HL
01129A 29                  A  4236    	ADD	HL,HL
01129B 29                  A  4237    	ADD	HL,HL
01129C 29                  A  4238    	ADD	HL,HL
01129D 01 27 44 01         A  4239    	LD	BC,_scn_phys
0112A1 09                  A  4240    	ADD	HL,BC
0112A2 E5C1                A  4241    	LD	BC,HL
0112A4 DD7EFE              A  4242    	LD	A,(IX+-2)
0112A7 17ED62              A  4243    	SEXT	HL
0112AA DD6EFE              A  4244    	LD	L,(IX+-2)
0112AD 09                  A  4245    	ADD	HL,BC
0112AE 4E                  A  4246    	LD	C,(HL)
0112AF 0600                A  4247    	LD	B,0
0112B1 C5                  A  4248    	PUSH	BC
0112B2 DD4EFF              A  4249    	LD	C,(IX+-1)
0112B5 C5                  A  4250    	PUSH	BC
0112B6 DD4EFE              A  4251    	LD	C,(IX+-2)
0112B9 C5                  A  4252    	PUSH	BC
0112BA CD 84 02 01         A  4253    	CALL	_plot_char
0112BE C1                  A  4254    	POP	BC
0112BF C1                  A  4255    	POP	BC
0112C0 C1                  A  4256    	POP	BC
                           A  4257    ; 1037	}
0112C1 DDF9                A  4258    	LD	SP,IX
0112C3 DDE1                A  4259    	POP	IX
0112C5 C9                  A  4260    	RET	
                           A  4261    
                           A  4262    
                           A  4263    ;**************************** _do_bot *********
                           A  4264    ;Name                         Addr/Register   S
                           A  4265    ;_scn_phys                           STATIC   4
                           A  4266    ;_plot_char                          IMPORT  --
                           A  4267    ;_paintall                           IMPORT  --
                           A  4268    ;_cur_char                           STATIC    
                           A  4269    ;_cur_line                           STATIC    
                           A  4270    ;_numlines                           STATIC    
                           A  4271    ;_p_curr                             STATIC    
                           A  4272    ;_p_root                             STATIC    
                           A  4273    ;_cur_col                            STATIC    
                           A  4274    ;_cur_row                            STATIC    
                           A  4275    ;oldc                                  IX-2    
                           A  4276    ;oldr                                  IX-1    
                           A  4277    ;paint                                 IX+6    
                           A  4278    
                           A  4279    
                           A  4280    ; Stack Frame Size: 11 (bytes)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  84


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  4281    ;       Spill Code: 0 (instruction)
                           A  4282    
                           A  4283    
                           A  4284    ; 1038	
                           A  4285    ; 1039	/* Type the specified character. */
                           A  4286    ; 1040	void do_chr(char ch)
                           A  4287    ; 1041	{
0112C6                     A  4288    _do_chr:
0112C6 21FDFFFF            A  4289    	LD	HL,-3
0112CA CD 57 25 01         A  4290    	CALL	__frameset
                           A  4291    ; 1042		register int i;
                           A  4292    ; 1043		
                           A  4293    ; 1044		if (p_curr == p_root)
0112CE ED4B 10 55 01       A  4294    	LD	BC,(_p_root)
0112D3 2A 13 55 01         A  4295    	LD	HL,(_p_curr)
0112D7 B7                  A  4296    	OR	A,A
0112D8 ED42                A  4297    	SBC	HL,BC
0112DA 28 77               A  4298    	JR	Z,L_243
                           A  4299    ; 1045			return;
                           A  4300    ; 1046	
                           A  4301    ; 1047		if (cur_char == MAXLNLEN + 1)
0112DC 01510000            A  4302    	LD	BC,81
0112E0 2A 1C 55 01         A  4303    	LD	HL,(_cur_char)
0112E4 B7                  A  4304    	OR	A,A
0112E5 ED42                A  4305    	SBC	HL,BC
0112E7 20 06               A  4306    	JR	NZ,L_236
                           A  4307    ; 1048		{
                           A  4308    ; 1049			Show_Cursor();
0112E9 CD 51 18 01         A  4309    	CALL	_Show_Cursor
                           A  4310    ; 1050			
                           A  4311    ; 1051			return;
0112ED 18 64               A  4312    	JR	L_243
                           A  4313    ; 1052		}
0112EF                     A  4314    L_236:
                           A  4315    ; 1053		
                           A  4316    ; 1054		tx_get(p_curr);	
0112EF ED4B 13 55 01       A  4317    	LD	BC,(_p_curr)
0112F4 C5                  A  4318    	PUSH	BC
0112F5 CD 89 0B 01         A  4319    	CALL	_tx_get
0112F9 C1                  A  4320    	POP	BC
                           A  4321    ; 1055		
                           A  4322    ; 1056		if (InsertMode != 0)
0112FA 3A 84 55 01         A  4323    	LD	A,(_InsertMode)
0112FE B7                  A  4324    	OR	A,A
0112FF 28 31               A  4325    	JR	Z,L_242
011301 014F0000            A  4326    	LD	BC,79
011305 DD0FFD              A  4327    	LD	(IX+-3),BC
                           A  4328    ; 1057		{
                           A  4329    ; 1058			for (i = MAXLNLEN - 1; i > cur_
011308 18 19               A  4330    	JR	L_240
01130A                     A  4331    L_238:
                           A  4332    ; 1059				linbuf[i] = linbuf[i - 1];
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  85


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01130A DD07FD              A  4333    	LD	BC,(IX+-3)
01130D 0B                  A  4334    	DEC	BC
01130E C5E1                A  4335    	LD	HL,BC
011310 11 25 55 01         A  4336    	LD	DE,_linbuf
011314 19                  A  4337    	ADD	HL,DE
011315 E5FDE1              A  4338    	LD	IY,HL
011318 DD27FD              A  4339    	LD	HL,(IX+-3)
01131B 19                  A  4340    	ADD	HL,DE
01131C FD7E00              A  4341    	LD	A,(IY)
01131F 77                  A  4342    	LD	(HL),A
011320 DD0FFD              A  4343    	LD	(IX+-3),BC
011323                     A  4344    L_240:
011323 2A 1C 55 01         A  4345    	LD	HL,(_cur_char)
011327 2B                  A  4346    	DEC	HL
011328 B7                  A  4347    	OR	A,A
011329 DD07FD              A  4348    	LD	BC,(IX+-3)
01132C ED42                A  4349    	SBC	HL,BC
01132E FA 0A 13 01         A  4350    	JP	M,L_238
                           A  4351    ; 1060		}	
011332                     A  4352    L_242:
                           A  4353    ; 1061		
                           A  4354    ; 1062		linbuf[cur_char - 1] = (char)(ch);
011332 2A 1C 55 01         A  4355    	LD	HL,(_cur_char)
011336 2B                  A  4356    	DEC	HL
011337 01 25 55 01         A  4357    	LD	BC,_linbuf
01133B 09                  A  4358    	ADD	HL,BC
01133C DD7E06              A  4359    	LD	A,(IX+6)
01133F 77                  A  4360    	LD	(HL),A
                           A  4361    ; 1063		
                           A  4362    ; 1064		tx_put(p_curr);
011340 ED4B 13 55 01       A  4363    	LD	BC,(_p_curr)
011345 C5                  A  4364    	PUSH	BC
011346 CD D2 0B 01         A  4365    	CALL	_tx_put
01134A C1                  A  4366    	POP	BC
                           A  4367    ; 1065		
                           A  4368    ; 1066		do_crt();
01134B CD 97 0D 01         A  4369    	CALL	_do_crt
                           A  4370    ; 1067		paintrow();
01134F CD A8 17 01         A  4371    	CALL	_paintrow
                           A  4372    ; 1068	}
011353                     A  4373    L_243:
011353 DDF9                A  4374    	LD	SP,IX
011355 DDE1                A  4375    	POP	IX
011357 C9                  A  4376    	RET	
                           A  4377    
                           A  4378    
                           A  4379    ;**************************** _do_chr *********
                           A  4380    ;Name                         Addr/Register   S
                           A  4381    ;_paintrow                           IMPORT  --
                           A  4382    ;_do_crt                             IMPORT  --
                           A  4383    ;_tx_put                             IMPORT  --
                           A  4384    ;_linbuf                             STATIC    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  86


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  4385    ;_InsertMode                         STATIC    
                           A  4386    ;_tx_get                             IMPORT  --
                           A  4387    ;_Show_Cursor                        IMPORT  --
                           A  4388    ;_cur_char                           STATIC    
                           A  4389    ;_p_root                             STATIC    
                           A  4390    ;_p_curr                             STATIC    
                           A  4391    ;i                                     IX-3    
                           A  4392    ;ch                                    IX+6    
                           A  4393    
                           A  4394    
                           A  4395    ; Stack Frame Size: 12 (bytes)
                           A  4396    ;       Spill Code: 0 (instruction)
                           A  4397    
                           A  4398    
                           A  4399    ; 1069	
                           A  4400    ; 1070	/* Delete character. */
                           A  4401    ; 1071	void do_dch(void)
                           A  4402    ; 1072	{
011358                     A  4403    _do_dch:
011358 21FDFFFF            A  4404    	LD	HL,-3
01135C CD 57 25 01         A  4405    	CALL	__frameset
                           A  4406    ; 1073		register int i;
                           A  4407    ; 1074		
                           A  4408    ; 1075		if (p_curr == p_root)
011360 ED4B 10 55 01       A  4409    	LD	BC,(_p_root)
011365 2A 13 55 01         A  4410    	LD	HL,(_p_curr)
011369 B7                  A  4411    	OR	A,A
01136A ED42                A  4412    	SBC	HL,BC
01136C 28 5C               A  4413    	JR	Z,L_251
                           A  4414    ; 1076			return;
                           A  4415    ; 1077		
                           A  4416    ; 1078		tx_get(p_curr);
01136E ED4B 13 55 01       A  4417    	LD	BC,(_p_curr)
011373 C5                  A  4418    	PUSH	BC
011374 CD 89 0B 01         A  4419    	CALL	_tx_get
011378 C1                  A  4420    	POP	BC
011379 ED4B 1C 55 01       A  4421    	LD	BC,(_cur_char)
01137E 0B                  A  4422    	DEC	BC
01137F DD0FFD              A  4423    	LD	(IX+-3),BC
                           A  4424    ; 1079		
                           A  4425    ; 1080		for (i = cur_char - 1; i < MAXLNLEN
011382 18 19               A  4426    	JR	L_249
011384                     A  4427    L_247:
                           A  4428    ; 1081			linbuf[i] = linbuf[i + 1];
011384 DD07FD              A  4429    	LD	BC,(IX+-3)
011387 03                  A  4430    	INC	BC
011388 C5E1                A  4431    	LD	HL,BC
01138A 11 25 55 01         A  4432    	LD	DE,_linbuf
01138E 19                  A  4433    	ADD	HL,DE
01138F E5FDE1              A  4434    	LD	IY,HL
011392 DD27FD              A  4435    	LD	HL,(IX+-3)
011395 19                  A  4436    	ADD	HL,DE
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  87


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011396 FD7E00              A  4437    	LD	A,(IY)
011399 77                  A  4438    	LD	(HL),A
01139A DD0FFD              A  4439    	LD	(IX+-3),BC
01139D                     A  4440    L_249:
01139D 014F0000            A  4441    	LD	BC,79
0113A1 DD27FD              A  4442    	LD	HL,(IX+-3)
0113A4 B7                  A  4443    	OR	A,A
0113A5 ED42                A  4444    	SBC	HL,BC
0113A7 FA B1 13 01         A  4445    	JP	M,L__182
0113AB EA 84 13 01         A  4446    	JP	PE,L_247
0113AF 18 04               A  4447    	JR	L__183
0113B1                     A  4448    L__182:
0113B1 E2 84 13 01         A  4449    	JP	PO,L_247
0113B5                     A  4450    L__183:
                           A  4451    ; 1082		
                           A  4452    ; 1083		linbuf[MAXLNLEN - 1] = ' ';
0113B5 21 74 55 01         A  4453    	LD	HL,_linbuf+79
0113B9 3620                A  4454    	LD	(HL),32
                           A  4455    ; 1084		
                           A  4456    ; 1085		tx_put(p_curr);
0113BB ED4B 13 55 01       A  4457    	LD	BC,(_p_curr)
0113C0 C5                  A  4458    	PUSH	BC
0113C1 CD D2 0B 01         A  4459    	CALL	_tx_put
0113C5 C1                  A  4460    	POP	BC
                           A  4461    ; 1086		
                           A  4462    ; 1087		paintrow();
0113C6 CD A8 17 01         A  4463    	CALL	_paintrow
                           A  4464    ; 1088	}
0113CA                     A  4465    L_251:
0113CA DDF9                A  4466    	LD	SP,IX
0113CC DDE1                A  4467    	POP	IX
0113CE C9                  A  4468    	RET	
                           A  4469    
                           A  4470    
                           A  4471    ;**************************** _do_dch *********
                           A  4472    ;Name                         Addr/Register   S
                           A  4473    ;_paintrow                           IMPORT  --
                           A  4474    ;_tx_put                             IMPORT  --
                           A  4475    ;_linbuf                             STATIC    
                           A  4476    ;_cur_char                           STATIC    
                           A  4477    ;_tx_get                             IMPORT  --
                           A  4478    ;_p_root                             STATIC    
                           A  4479    ;_p_curr                             STATIC    
                           A  4480    ;i                                     IX-3    
                           A  4481    
                           A  4482    
                           A  4483    ; Stack Frame Size: 9 (bytes)
                           A  4484    ;       Spill Code: 0 (instruction)
                           A  4485    
                           A  4486    
                           A  4487    ; 1089	
                           A  4488    ; 1090	/* Insert line. */
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  88


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  4489    ; 1091	void do_iln(void)
                           A  4490    ; 1092	{
0113CF                     A  4491    _do_iln:
                           A  4492    ; 1093		paintrow();
0113CF CD A8 17 01         A  4493    	CALL	_paintrow
                           A  4494    ; 1094		
                           A  4495    ; 1095		if (cur_line < numlines)
0113D3 ED4B 16 55 01       A  4496    	LD	BC,(_numlines)
0113D8 2A 19 55 01         A  4497    	LD	HL,(_cur_line)
0113DC B7                  A  4498    	OR	A,A
0113DD ED42                A  4499    	SBC	HL,BC
0113DF F2 E9 13 01         A  4500    	JP	P,L__188
0113E3 EA 11 14 01         A  4501    	JP	PE,L_253
0113E7 18 04               A  4502    	JR	L__189
0113E9                     A  4503    L__188:
0113E9 E2 11 14 01         A  4504    	JP	PO,L_253
0113ED                     A  4505    L__189:
                           A  4506    ; 1096		{
                           A  4507    ; 1097			do_cdw();
0113ED CD 84 0C 01         A  4508    	CALL	_do_cdw
                           A  4509    ; 1098			
                           A  4510    ; 1099			tx_ins(p_curr, "");
0113F1 01 FB 27 01         A  4511    	LD	BC,L__186
0113F5 C5                  A  4512    	PUSH	BC
0113F6 ED4B 13 55 01       A  4513    	LD	BC,(_p_curr)
0113FB C5                  A  4514    	PUSH	BC
0113FC CD 94 0A 01         A  4515    	CALL	_tx_ins
011400 C1                  A  4516    	POP	BC
011401 C1                  A  4517    	POP	BC
                           A  4518    ; 1100			
                           A  4519    ; 1101			p_curr = p_curr->p_prev;
011402 FD2A 13 55 01       A  4520    	LD	IY,(_p_curr)
011407 FD0700              A  4521    	LD	BC,(IY+0)
01140A ED43 13 55 01       A  4522    	LD	(_p_curr),BC
                           A  4523    ; 1102		}		
                           A  4524    ; 1103		else
01140F 18 1B               A  4525    	JR	L_254
011411                     A  4526    L_253:
                           A  4527    ; 1104		{
                           A  4528    ; 1105			tx_ins(p_root, "");		
011411 01 FC 27 01         A  4529    	LD	BC,L__187
011415 C5                  A  4530    	PUSH	BC
011416 ED4B 10 55 01       A  4531    	LD	BC,(_p_root)
01141B C5                  A  4532    	PUSH	BC
01141C CD 94 0A 01         A  4533    	CALL	_tx_ins
011420 C1                  A  4534    	POP	BC
011421 C1                  A  4535    	POP	BC
                           A  4536    ; 1106			
                           A  4537    ; 1107			do_bot(0);
011422 01000000            A  4538    	LD	BC,0
011426 C5                  A  4539    	PUSH	BC
011427 CD 15 12 01         A  4540    	CALL	_do_bot
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  89


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01142B C1                  A  4541    	POP	BC
                           A  4542    ; 1108		}
01142C                     A  4543    L_254:
                           A  4544    ; 1109		
                           A  4545    ; 1110		cur_char = 1;
01142C 01010000            A  4546    	LD	BC,1
011430 ED43 1C 55 01       A  4547    	LD	(_cur_char),BC
                           A  4548    ; 1111		cur_col = 0;
011435 01000000            A  4549    	LD	BC,0
011439 ED43 22 55 01       A  4550    	LD	(_cur_col),BC
                           A  4551    ; 1112		
                           A  4552    ; 1113		paintall();	
01143E CD 96 16 01         A  4553    	CALL	_paintall
                           A  4554    ; 1114	}
011442 C9                  A  4555    	RET	
                           A  4556    
                           A  4557    
                           A  4558    ;**************************** _do_iln *********
                           A  4559    ;Name                         Addr/Register   S
                           A  4560    ;_paintall                           IMPORT  --
                           A  4561    ;_cur_col                            STATIC    
                           A  4562    ;_cur_char                           STATIC    
                           A  4563    ;_do_bot                             IMPORT  --
                           A  4564    ;_p_root                             STATIC    
                           A  4565    ;_p_curr                             STATIC    
                           A  4566    ;_tx_ins                             IMPORT  --
                           A  4567    ;_do_cdw                             IMPORT  --
                           A  4568    ;_numlines                           STATIC    
                           A  4569    ;_cur_line                           STATIC    
                           A  4570    ;_paintrow                           IMPORT  --
                           A  4571    
                           A  4572    
                           A  4573    ; Stack Frame Size: 6 (bytes)
                           A  4574    ;       Spill Code: 0 (instruction)
                           A  4575    
                           A  4576    
                           A  4577    	SEGMENT STRSECT
0127FB                     A  4578    L__186:
0127FB 00                  A  4579    	DB	0
0127FC                     A  4580    L__187:
0127FC 00                  A  4581    	DB	0
                           A  4582    	SEGMENT CODE
                           A  4583    ; 1115	
                           A  4584    ; 1116	/* Delete line. */
                           A  4585    ; 1117	void do_dln(void)
                           A  4586    ; 1118	{
011443                     A  4587    _do_dln:
011443 21FDFFFF            A  4588    	LD	HL,-3
011447 CD 57 25 01         A  4589    	CALL	__frameset
                           A  4590    ; 1119		p_line_t save = p_curr->p_next;
01144B FD2A 13 55 01       A  4591    	LD	IY,(_p_curr)
011450 FD0703              A  4592    	LD	BC,(IY+3)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  90


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011453 DD0FFD              A  4593    	LD	(IX+-3),BC
                           A  4594    ; 1120		
                           A  4595    ; 1121		if (p_curr == p_root)
011456 ED4B 10 55 01       A  4596    	LD	BC,(_p_root)
01145B 2A 13 55 01         A  4597    	LD	HL,(_p_curr)
01145F B7                  A  4598    	OR	A,A
011460 ED42                A  4599    	SBC	HL,BC
011462 28 17               A  4600    	JR	Z,L_258
                           A  4601    ; 1122			return;
                           A  4602    ; 1123		
                           A  4603    ; 1124		tx_del(p_curr);
011464 ED4B 13 55 01       A  4604    	LD	BC,(_p_curr)
011469 C5                  A  4605    	PUSH	BC
01146A CD FE 0A 01         A  4606    	CALL	_tx_del
01146E C1                  A  4607    	POP	BC
                           A  4608    ; 1125		
                           A  4609    ; 1126		p_curr = save;
01146F DD07FD              A  4610    	LD	BC,(IX+-3)
011472 ED43 13 55 01       A  4611    	LD	(_p_curr),BC
                           A  4612    ; 1127		
                           A  4613    ; 1128		paintall();
011477 CD 96 16 01         A  4614    	CALL	_paintall
                           A  4615    ; 1129	}
01147B                     A  4616    L_258:
01147B DDF9                A  4617    	LD	SP,IX
01147D DDE1                A  4618    	POP	IX
01147F C9                  A  4619    	RET	
                           A  4620    
                           A  4621    
                           A  4622    ;**************************** _do_dln *********
                           A  4623    ;Name                         Addr/Register   S
                           A  4624    ;_paintall                           IMPORT  --
                           A  4625    ;_tx_del                             IMPORT  --
                           A  4626    ;_p_root                             STATIC    
                           A  4627    ;_p_curr                             STATIC    
                           A  4628    ;save                                  IX-3    
                           A  4629    
                           A  4630    
                           A  4631    ; Stack Frame Size: 9 (bytes)
                           A  4632    ;       Spill Code: 0 (instruction)
                           A  4633    
                           A  4634    
                           A  4635    ; 1130	
                           A  4636    ; 1131	/* Delete. */
                           A  4637    ; 1132	void do_del(void)
                           A  4638    ; 1133	{
011480                     A  4639    _do_del:
                           A  4640    ; 1134		if (cur_char == 1)
011480 01010000            A  4641    	LD	BC,1
011484 2A 1C 55 01         A  4642    	LD	HL,(_cur_char)
011488 B7                  A  4643    	OR	A,A
011489 ED42                A  4644    	SBC	HL,BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  91


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01148B 20 1E               A  4645    	JR	NZ,L_262
                           A  4646    ; 1135			if (strlen(p_curr->p_data) <= 0
01148D FD2A 13 55 01       A  4647    	LD	IY,(_p_curr)
011492 FD0706              A  4648    	LD	BC,(IY+6)
011495 C5                  A  4649    	PUSH	BC
011496 CD 14 25 01         A  4650    	CALL	_strlen
01149A C1                  A  4651    	POP	BC
01149B E5C1                A  4652    	LD	BC,HL
01149D B7                  A  4653    	OR	A,A
01149E ED62                A  4654    	SBC	HL,HL
0114A0 B7                  A  4655    	OR	A,A
0114A1 ED42                A  4656    	SBC	HL,BC
0114A3 30 0E               A  4657    	JR	NC,L_263
                           A  4658    ; 1136				return;
                           A  4659    ; 1137			else
                           A  4660    ; 1138			{
                           A  4661    ; 1139				do_enhanced_del();
0114A5 CD B4 14 01         A  4662    	CALL	_do_enhanced_del
                           A  4663    ; 1140				
                           A  4664    ; 1141				return;
0114A9 18 08               A  4665    	JR	L_263
                           A  4666    ; 1142			}
0114AB                     A  4667    L_262:
                           A  4668    ; 1143		
                           A  4669    ; 1144		do_clf();
0114AB CD 15 0D 01         A  4670    	CALL	_do_clf
                           A  4671    ; 1145		
                           A  4672    ; 1146		do_dch();
0114AF CD 58 13 01         A  4673    	CALL	_do_dch
                           A  4674    ; 1147	}
0114B3                     A  4675    L_263:
0114B3 C9                  A  4676    	RET	
                           A  4677    
                           A  4678    
                           A  4679    ;**************************** _do_del *********
                           A  4680    ;Name                         Addr/Register   S
                           A  4681    ;_do_dch                             IMPORT  --
                           A  4682    ;_do_clf                             IMPORT  --
                           A  4683    ;_do_enhanced_del                    IMPORT  --
                           A  4684    ;_p_curr                             STATIC    
                           A  4685    ;_strlen                             IMPORT  --
                           A  4686    ;_cur_char                           STATIC    
                           A  4687    
                           A  4688    
                           A  4689    ; Stack Frame Size: 6 (bytes)
                           A  4690    ;       Spill Code: 0 (instruction)
                           A  4691    
                           A  4692    
                           A  4693    ; 1148	
                           A  4694    ; 1149	/* Enhanced Delete. Can join current li
                           A  4695    ; 1150	void do_enhanced_del(void)
                           A  4696    ; 1151	{
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  92


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0114B4                     A  4697    _do_enhanced_del:
0114B4 21AEFFFF            A  4698    	LD	HL,-82
0114B8 CD 57 25 01         A  4699    	CALL	__frameset
                           A  4700    ; 1152		char app[MAXLNLEN], i, oldPos;
                           A  4701    ; 1153		
                           A  4702    ; 1154		if (cur_line == 1)
0114BC 01010000            A  4703    	LD	BC,1
0114C0 2A 19 55 01         A  4704    	LD	HL,(_cur_line)
0114C4 B7                  A  4705    	OR	A,A
0114C5 ED42                A  4706    	SBC	HL,BC
0114C7 20 08               A  4707    	JR	NZ,L_265
                           A  4708    ; 1155		{
                           A  4709    ; 1156			Show_Cursor();
0114C9 CD 51 18 01         A  4710    	CALL	_Show_Cursor
                           A  4711    ; 1157			
                           A  4712    ; 1158			return;		
0114CD C3 72 15 01         A  4713    	JR	L_271
                           A  4714    ; 1159		}
0114D1                     A  4715    L_265:
                           A  4716    ; 1160		
                           A  4717    ; 1161		memset(app, 0, MAXLNLEN);
0114D1 01500000            A  4718    	LD	BC,80
0114D5 C5                  A  4719    	PUSH	BC
0114D6 01000000            A  4720    	LD	BC,0
0114DA C5                  A  4721    	PUSH	BC
0114DB ED65AE              A  4722    	PEA	IX+-82
0114DE CD 15 26 01         A  4723    	CALL	_memset
0114E2 C1                  A  4724    	POP	BC
0114E3 C1                  A  4725    	POP	BC
0114E4 C1                  A  4726    	POP	BC
                           A  4727    ; 1162		
                           A  4728    ; 1163		memmove(app, p_curr->p_data, strlen
0114E5 FD2A 13 55 01       A  4729    	LD	IY,(_p_curr)
0114EA FD0706              A  4730    	LD	BC,(IY+6)
0114ED C5                  A  4731    	PUSH	BC
0114EE CD 14 25 01         A  4732    	CALL	_strlen
0114F2 C1                  A  4733    	POP	BC
0114F3 E5                  A  4734    	PUSH	HL
0114F4 FD2A 13 55 01       A  4735    	LD	IY,(_p_curr)
0114F9 FD0706              A  4736    	LD	BC,(IY+6)
0114FC C5                  A  4737    	PUSH	BC
0114FD ED65AE              A  4738    	PEA	IX+-82
011500 CD 36 26 01         A  4739    	CALL	_memmove
011504 C1                  A  4740    	POP	BC
011505 C1                  A  4741    	POP	BC
011506 C1                  A  4742    	POP	BC
                           A  4743    ; 1164		
                           A  4744    ; 1165		do_dln();	
011507 CD 43 14 01         A  4745    	CALL	_do_dln
                           A  4746    ; 1166		
                           A  4747    ; 1167		do_cup();
01150B CD F5 0B 01         A  4748    	CALL	_do_cup
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  93


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  4749    ; 1168		do_endline();
01150F CD E1 15 01         A  4750    	CALL	_do_endline
                           A  4751    ; 1169		
                           A  4752    ; 1170		oldPos = cur_col;
011513 3A 22 55 01         A  4753    	LD	A,(_cur_col)
011517 DD77FE              A  4754    	LD	(IX+-2),A
01151A DD36FF00            A  4755    	LD	(IX+-1),0
                           A  4756    ; 1171		
                           A  4757    ; 1172		for (i = 0; i < strlen(app); i++)
01151E 18 1B               A  4758    	JR	L_269
011520                     A  4759    L_267:
                           A  4760    ; 1173			do_chr(app[i]);	
011520 DD7EFF              A  4761    	LD	A,(IX+-1)
011523 17ED62              A  4762    	SEXT	HL
011526 DD6EFF              A  4763    	LD	L,(IX+-1)
011529 E5C1                A  4764    	LD	BC,HL
01152B ED22AE              A  4765    	LEA	HL,IX+-82
01152E 09                  A  4766    	ADD	HL,BC
01152F 4E                  A  4767    	LD	C,(HL)
011530 0600                A  4768    	LD	B,0
011532 C5                  A  4769    	PUSH	BC
011533 CD C6 12 01         A  4770    	CALL	_do_chr
011537 C1                  A  4771    	POP	BC
011538 DD34FF              A  4772    	INC	(IX+-1)
01153B                     A  4773    L_269:
01153B ED65AE              A  4774    	PEA	IX+-82
01153E CD 14 25 01         A  4775    	CALL	_strlen
011542 C1                  A  4776    	POP	BC
011543 DD7EFF              A  4777    	LD	A,(IX+-1)
011546 E5C1                A  4778    	LD	BC,HL
011548 17ED62              A  4779    	SEXT	HL
01154B DD6EFF              A  4780    	LD	L,(IX+-1)
01154E B7                  A  4781    	OR	A,A
01154F ED42                A  4782    	SBC	HL,BC
011551 38 CD               A  4783    	JR	C,L_267
                           A  4784    ; 1174		
                           A  4785    ; 1175		paintrow();
011553 CD A8 17 01         A  4786    	CALL	_paintrow
                           A  4787    ; 1176		
                           A  4788    ; 1177		cur_col = oldPos;
011557 DD7EFE              A  4789    	LD	A,(IX+-2)
01155A 17ED62              A  4790    	SEXT	HL
01155D DD6EFE              A  4791    	LD	L,(IX+-2)
011560 22 22 55 01         A  4792    	LD	(_cur_col),HL
                           A  4793    ; 1178		cur_char = cur_col + 1;
011564 DD7EFE              A  4794    	LD	A,(IX+-2)
011567 17ED62              A  4795    	SEXT	HL
01156A DD6EFE              A  4796    	LD	L,(IX+-2)
01156D 23                  A  4797    	INC	HL
01156E 22 1C 55 01         A  4798    	LD	(_cur_char),HL
                           A  4799    ; 1179	}
011572                     A  4800    L_271:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  94


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011572 DDF9                A  4801    	LD	SP,IX
011574 DDE1                A  4802    	POP	IX
011576 C9                  A  4803    	RET	
                           A  4804    
                           A  4805    
                           A  4806    ;**************************** _do_enhanced_del 
                           A  4807    ;Name                         Addr/Register   S
                           A  4808    ;_cur_char                           STATIC    
                           A  4809    ;_paintrow                           IMPORT  --
                           A  4810    ;_do_chr                             IMPORT  --
                           A  4811    ;_cur_col                            STATIC    
                           A  4812    ;_do_endline                         IMPORT  --
                           A  4813    ;_do_cup                             IMPORT  --
                           A  4814    ;_do_dln                             IMPORT  --
                           A  4815    ;_p_curr                             STATIC    
                           A  4816    ;_strlen                             IMPORT  --
                           A  4817    ;_memmove                            IMPORT  --
                           A  4818    ;_memset                             IMPORT  --
                           A  4819    ;_Show_Cursor                        IMPORT  --
                           A  4820    ;_cur_line                           STATIC    
                           A  4821    ;app                                  IX-82    
                           A  4822    ;oldPos                                IX-2    
                           A  4823    ;i                                     IX-1    
                           A  4824    
                           A  4825    
                           A  4826    ; Stack Frame Size: 88 (bytes)
                           A  4827    ;       Spill Code: 0 (instruction)
                           A  4828    
                           A  4829    
                           A  4830    ; 1180	
                           A  4831    ; 1181	/* Go to the start of current line. */
                           A  4832    ; 1182	void do_home(void)
                           A  4833    ; 1183	{
011577                     A  4834    _do_home:
011577 21FEFFFF            A  4835    	LD	HL,-2
01157B CD 57 25 01         A  4836    	CALL	__frameset
                           A  4837    ; 1184		char ch, oldcol;
                           A  4838    ; 1185		
                           A  4839    ; 1186		if (p_curr == p_root)
01157F ED4B 10 55 01       A  4840    	LD	BC,(_p_root)
011584 2A 13 55 01         A  4841    	LD	HL,(_p_curr)
011588 B7                  A  4842    	OR	A,A
011589 ED42                A  4843    	SBC	HL,BC
01158B 28 4F               A  4844    	JR	Z,L_274
                           A  4845    ; 1187			return;
                           A  4846    ; 1188		
                           A  4847    ; 1189		ch = scn_phys[cur_row][cur_col];
01158D 2A 1F 55 01         A  4848    	LD	HL,(_cur_row)
011591 29                  A  4849    	ADD	HL,HL
011592 29                  A  4850    	ADD	HL,HL
011593 ED4B 1F 55 01       A  4851    	LD	BC,(_cur_row)
011598 09                  A  4852    	ADD	HL,BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  95


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011599 29                  A  4853    	ADD	HL,HL
01159A 29                  A  4854    	ADD	HL,HL
01159B 29                  A  4855    	ADD	HL,HL
01159C 29                  A  4856    	ADD	HL,HL
01159D 01 27 44 01         A  4857    	LD	BC,_scn_phys
0115A1 09                  A  4858    	ADD	HL,BC
0115A2 ED4B 22 55 01       A  4859    	LD	BC,(_cur_col)
0115A7 09                  A  4860    	ADD	HL,BC
0115A8 7E                  A  4861    	LD	A,(HL)
0115A9 DD77FF              A  4862    	LD	(IX+-1),A
                           A  4863    ; 1190		oldcol = cur_col;
0115AC 3A 22 55 01         A  4864    	LD	A,(_cur_col)
0115B0 DD77FE              A  4865    	LD	(IX+-2),A
                           A  4866    ; 1191		
                           A  4867    ; 1192		cur_char = 1;
0115B3 01010000            A  4868    	LD	BC,1
0115B7 ED43 1C 55 01       A  4869    	LD	(_cur_char),BC
                           A  4870    ; 1193		cur_col = 0;
0115BC 01000000            A  4871    	LD	BC,0
0115C0 ED43 22 55 01       A  4872    	LD	(_cur_col),BC
                           A  4873    ; 1194		
                           A  4874    ; 1195		plot_char(oldcol, cur_row, ch);
0115C5 DD4EFF              A  4875    	LD	C,(IX+-1)
0115C8 3A 1F 55 01         A  4876    	LD	A,(_cur_row)
0115CC 0600                A  4877    	LD	B,0
0115CE C5                  A  4878    	PUSH	BC
0115CF 4F                  A  4879    	LD	C,A
0115D0 C5                  A  4880    	PUSH	BC
0115D1 DD4EFE              A  4881    	LD	C,(IX+-2)
0115D4 C5                  A  4882    	PUSH	BC
0115D5 CD 84 02 01         A  4883    	CALL	_plot_char
0115D9 C1                  A  4884    	POP	BC
0115DA C1                  A  4885    	POP	BC
0115DB C1                  A  4886    	POP	BC
                           A  4887    ; 1196	}
0115DC                     A  4888    L_274:
0115DC DDF9                A  4889    	LD	SP,IX
0115DE DDE1                A  4890    	POP	IX
0115E0 C9                  A  4891    	RET	
                           A  4892    
                           A  4893    
                           A  4894    ;**************************** _do_home ********
                           A  4895    ;Name                         Addr/Register   S
                           A  4896    ;_plot_char                          IMPORT  --
                           A  4897    ;_cur_char                           STATIC    
                           A  4898    ;_cur_col                            STATIC    
                           A  4899    ;_cur_row                            STATIC    
                           A  4900    ;_scn_phys                           STATIC   4
                           A  4901    ;_p_root                             STATIC    
                           A  4902    ;_p_curr                             STATIC    
                           A  4903    ;oldcol                                IX-2    
                           A  4904    ;ch                                    IX-1    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  96


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  4905    
                           A  4906    
                           A  4907    ; Stack Frame Size: 8 (bytes)
                           A  4908    ;       Spill Code: 0 (instruction)
                           A  4909    
                           A  4910    
                           A  4911    ; 1197	
                           A  4912    ; 1198	/* Go to the end of current line. */
                           A  4913    ; 1199	void do_endline(void)
                           A  4914    ; 1200	{
0115E1                     A  4915    _do_endline:
0115E1 21FDFFFF            A  4916    	LD	HL,-3
0115E5 CD 57 25 01         A  4917    	CALL	__frameset
                           A  4918    ; 1201		char len, ch, oldcol;
                           A  4919    ; 1202		
                           A  4920    ; 1203		if (p_curr == p_root)
0115E9 ED4B 10 55 01       A  4921    	LD	BC,(_p_root)
0115EE 2A 13 55 01         A  4922    	LD	HL,(_p_curr)
0115F2 B7                  A  4923    	OR	A,A
0115F3 ED42                A  4924    	SBC	HL,BC
0115F5 28 69               A  4925    	JR	Z,L_277
                           A  4926    ; 1204			return;
                           A  4927    ; 1205		
                           A  4928    ; 1206		len = strlen(p_curr->p_data);	
0115F7 FD2A 13 55 01       A  4929    	LD	IY,(_p_curr)
0115FC FD0706              A  4930    	LD	BC,(IY+6)
0115FF C5                  A  4931    	PUSH	BC
011600 CD 14 25 01         A  4932    	CALL	_strlen
011604 C1                  A  4933    	POP	BC
011605 DD75FF              A  4934    	LD	(IX+-1),L
                           A  4935    ; 1207		
                           A  4936    ; 1208		ch = scn_phys[cur_row][cur_col];
011608 2A 1F 55 01         A  4937    	LD	HL,(_cur_row)
01160C 29                  A  4938    	ADD	HL,HL
01160D 29                  A  4939    	ADD	HL,HL
01160E ED4B 1F 55 01       A  4940    	LD	BC,(_cur_row)
011613 09                  A  4941    	ADD	HL,BC
011614 29                  A  4942    	ADD	HL,HL
011615 29                  A  4943    	ADD	HL,HL
011616 29                  A  4944    	ADD	HL,HL
011617 29                  A  4945    	ADD	HL,HL
011618 01 27 44 01         A  4946    	LD	BC,_scn_phys
01161C 09                  A  4947    	ADD	HL,BC
01161D ED4B 22 55 01       A  4948    	LD	BC,(_cur_col)
011622 09                  A  4949    	ADD	HL,BC
011623 7E                  A  4950    	LD	A,(HL)
011624 DD77FE              A  4951    	LD	(IX+-2),A
                           A  4952    ; 1209		oldcol = cur_col;
011627 3A 22 55 01         A  4953    	LD	A,(_cur_col)
01162B DD77FD              A  4954    	LD	(IX+-3),A
                           A  4955    ; 1210		
                           A  4956    ; 1211		cur_col = len;
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  97


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01162E DD7EFF              A  4957    	LD	A,(IX+-1)
011631 17ED62              A  4958    	SEXT	HL
011634 DD6EFF              A  4959    	LD	L,(IX+-1)
011637 22 22 55 01         A  4960    	LD	(_cur_col),HL
                           A  4961    ; 1212		cur_char = len + 1;
01163B DD7EFF              A  4962    	LD	A,(IX+-1)
01163E 17ED62              A  4963    	SEXT	HL
011641 DD6EFF              A  4964    	LD	L,(IX+-1)
011644 23                  A  4965    	INC	HL
011645 22 1C 55 01         A  4966    	LD	(_cur_char),HL
                           A  4967    ; 1213		
                           A  4968    ; 1214		plot_char(oldcol, cur_row, ch);
011649 DD4EFE              A  4969    	LD	C,(IX+-2)
01164C 3A 1F 55 01         A  4970    	LD	A,(_cur_row)
011650 0600                A  4971    	LD	B,0
011652 C5                  A  4972    	PUSH	BC
011653 4F                  A  4973    	LD	C,A
011654 C5                  A  4974    	PUSH	BC
011655 DD4EFD              A  4975    	LD	C,(IX+-3)
011658 C5                  A  4976    	PUSH	BC
011659 CD 84 02 01         A  4977    	CALL	_plot_char
01165D C1                  A  4978    	POP	BC
01165E C1                  A  4979    	POP	BC
01165F C1                  A  4980    	POP	BC
                           A  4981    ; 1215	}
011660                     A  4982    L_277:
011660 DDF9                A  4983    	LD	SP,IX
011662 DDE1                A  4984    	POP	IX
011664 C9                  A  4985    	RET	
                           A  4986    
                           A  4987    
                           A  4988    ;**************************** _do_endline *****
                           A  4989    ;Name                         Addr/Register   S
                           A  4990    ;_plot_char                          IMPORT  --
                           A  4991    ;_cur_char                           STATIC    
                           A  4992    ;_cur_col                            STATIC    
                           A  4993    ;_cur_row                            STATIC    
                           A  4994    ;_scn_phys                           STATIC   4
                           A  4995    ;_strlen                             IMPORT  --
                           A  4996    ;_p_root                             STATIC    
                           A  4997    ;_p_curr                             STATIC    
                           A  4998    ;oldcol                                IX-3    
                           A  4999    ;ch                                    IX-2    
                           A  5000    ;len                                   IX-1    
                           A  5001    
                           A  5002    
                           A  5003    ; Stack Frame Size: 9 (bytes)
                           A  5004    ;       Spill Code: 0 (instruction)
                           A  5005    
                           A  5006    
                           A  5007    ; 1216	
                           A  5008    ; 1217	/* Set insert or overwrite mode */
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  98


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  5009    ; 1218	void do_ins(void)
                           A  5010    ; 1219	{
011665                     A  5011    _do_ins:
                           A  5012    ; 1220		if (InsertMode != 0)
011665 3A 84 55 01         A  5013    	LD	A,(_InsertMode)
011669 B7                  A  5014    	OR	A,A
01166A 28 07               A  5015    	JR	Z,L_279
                           A  5016    ; 1221			InsertMode = 0;
01166C AF                  A  5017    	XOR	A,A
01166D 32 84 55 01         A  5018    	LD	(_InsertMode),A
                           A  5019    ; 1222		else
011671 18 06               A  5020    	JR	L_280
011673                     A  5021    L_279:
                           A  5022    ; 1223			InsertMode = 1;
011673 3E01                A  5023    	LD	A,1
011675 32 84 55 01         A  5024    	LD	(_InsertMode),A
011679                     A  5025    L_280:
                           A  5026    ; 1224		
                           A  5027    ; 1225		ShowInsertMode();
011679 CD 1A 19 01         A  5028    	CALL	_ShowInsertMode
                           A  5029    ; 1226		
                           A  5030    ; 1227		gotoxy(cur_col, cur_row);
01167D 3A 1F 55 01         A  5031    	LD	A,(_cur_row)
011681 4F                  A  5032    	LD	C,A
011682 3A 22 55 01         A  5033    	LD	A,(_cur_col)
011686 0600                A  5034    	LD	B,0
011688 C5                  A  5035    	PUSH	BC
011689 4F                  A  5036    	LD	C,A
01168A C5                  A  5037    	PUSH	BC
01168B CD FF 02 01         A  5038    	CALL	_gotoxy
01168F C1                  A  5039    	POP	BC
011690 C1                  A  5040    	POP	BC
                           A  5041    ; 1228		
                           A  5042    ; 1229		Show_Cursor();
011691 CD 51 18 01         A  5043    	CALL	_Show_Cursor
                           A  5044    ; 1230	}
011695 C9                  A  5045    	RET	
                           A  5046    
                           A  5047    
                           A  5048    ;**************************** _do_ins *********
                           A  5049    ;Name                         Addr/Register   S
                           A  5050    ;_Show_Cursor                        IMPORT  --
                           A  5051    ;_cur_col                            STATIC    
                           A  5052    ;_cur_row                            STATIC    
                           A  5053    ;_gotoxy                             IMPORT  --
                           A  5054    ;_ShowInsertMode                     IMPORT  --
                           A  5055    ;_InsertMode                         STATIC    
                           A  5056    
                           A  5057    
                           A  5058    ; Stack Frame Size: 6 (bytes)
                           A  5059    ;       Spill Code: 0 (instruction)
                           A  5060    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page:  99


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  5061    
                           A  5062    ; 1231	
                           A  5063    ; 1232	/* Redraws the virtual screen from scra
                           A  5064    ; 1233	void paintall(void)
                           A  5065    ; 1234	{
011696                     A  5066    _paintall:
011696 21F8FFFF            A  5067    	LD	HL,-8
01169A CD 57 25 01         A  5068    	CALL	__frameset
                           A  5069    ; 1235		register unsigned char r;
                           A  5070    ; 1236		p_line_t p = p_curr;
01169E ED4B 13 55 01       A  5071    	LD	BC,(_p_curr)
0116A3 DD0FFC              A  5072    	LD	(IX+-4),BC
                           A  5073    ; 1237		int left_pos = cur_char - cur_col;
0116A6 2A 1C 55 01         A  5074    	LD	HL,(_cur_char)
0116AA ED4B 22 55 01       A  5075    	LD	BC,(_cur_col)
0116AF B7                  A  5076    	OR	A,A
0116B0 ED42                A  5077    	SBC	HL,BC
0116B2 DD2FF8              A  5078    	LD	(IX+-8),HL
0116B5 DD36FF00            A  5079    	LD	(IX+-1),0
                           A  5080    ; 1238		unsigned char len;
                           A  5081    ; 1239		
                           A  5082    ; 1240		for (r = 0; r < cur_row; r++)
0116B9 18 0C               A  5083    	JR	L_285
0116BB                     A  5084    L_283:
                           A  5085    ; 1241			p = p->p_prev;
0116BB DD31FC              A  5086    	LD	IY,(IX+-4)
0116BE FD0700              A  5087    	LD	BC,(IY+0)
0116C1 DD0FFC              A  5088    	LD	(IX+-4),BC
0116C4 DD34FF              A  5089    	INC	(IX+-1)
0116C7                     A  5090    L_285:
0116C7 DD7EFF              A  5091    	LD	A,(IX+-1)
0116CA B7ED62              A  5092    	UEXT	HL
0116CD 6F                  A  5093    	LD	L,A
0116CE B7                  A  5094    	OR	A,A
0116CF ED4B 1F 55 01       A  5095    	LD	BC,(_cur_row)
0116D4 ED42                A  5096    	SBC	HL,BC
0116D6 FA BB 16 01         A  5097    	JP	M,L_283
                           A  5098    ; 1242		
                           A  5099    ; 1243		sc_clr();
0116DA CD 4F 07 01         A  5100    	CALL	_sc_clr
0116DE DD36FF00            A  5101    	LD	(IX+-1),0
                           A  5102    ; 1244		
                           A  5103    ; 1245		for (r = 0; r < SCNROWS; r++)
0116E2 C3 82 17 01         A  5104    	JR	L_296
0116E6                     A  5105    L_294:
                           A  5106    ; 1246		{
                           A  5107    ; 1247			if (p == p_root)
0116E6 DD07FC              A  5108    	LD	BC,(IX+-4)
0116E9 2A 10 55 01         A  5109    	LD	HL,(_p_root)
0116ED B7                  A  5110    	OR	A,A
0116EE ED42                A  5111    	SBC	HL,BC
0116F0 20 1D               A  5112    	JR	NZ,L_289
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 100


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  5113    ; 1248			{
                           A  5114    ; 1249				sc_str(r, 0, "<eof>");
0116F2 01 FD 27 01         A  5115    	LD	BC,L__207
0116F6 C5                  A  5116    	PUSH	BC
0116F7 01000000            A  5117    	LD	BC,0
0116FB C5                  A  5118    	PUSH	BC
0116FC DD4EFF              A  5119    	LD	C,(IX+-1)
0116FF 0600                A  5120    	LD	B,0
011701 C5                  A  5121    	PUSH	BC
011702 CD 12 08 01         A  5122    	CALL	_sc_str
011706 C1                  A  5123    	POP	BC
011707 C1                  A  5124    	POP	BC
011708 C1                  A  5125    	POP	BC
                           A  5126    ; 1250				
                           A  5127    ; 1251				do_cup();
011709 CD F5 0B 01         A  5128    	CALL	_do_cup
                           A  5129    ; 1252				
                           A  5130    ; 1253				break;
01170D 18 7C               A  5131    	JR	L_297
                           A  5132    ; 1254			}
01170F                     A  5133    L_289:
                           A  5134    ; 1255			
                           A  5135    ; 1256			len = strlen(p->p_data);
01170F DD31FC              A  5136    	LD	IY,(IX+-4)
011712 FD0706              A  5137    	LD	BC,(IY+6)
011715 C5                  A  5138    	PUSH	BC
011716 CD 14 25 01         A  5139    	CALL	_strlen
01171A C1                  A  5140    	POP	BC
01171B DD75FB              A  5141    	LD	(IX+-5),L
                           A  5142    ; 1257			
                           A  5143    ; 1258			if (len >= left_pos)
01171E DD7EFB              A  5144    	LD	A,(IX+-5)
011721 B7ED62              A  5145    	UEXT	HL
011724 6F                  A  5146    	LD	L,A
011725 B7                  A  5147    	OR	A,A
011726 DD07F8              A  5148    	LD	BC,(IX+-8)
011729 ED42                A  5149    	SBC	HL,BC
01172B FA 35 17 01         A  5150    	JP	M,L__211
01172F EA 59 17 01         A  5151    	JP	PE,L_292
011733 18 04               A  5152    	JR	L__212
011735                     A  5153    L__211:
011735 E2 59 17 01         A  5154    	JP	PO,L_292
011739                     A  5155    L__212:
                           A  5156    ; 1259				sc_str(r, 0, p->p_data + (l
011739 DD07F8              A  5157    	LD	BC,(IX+-8)
01173C DD31FC              A  5158    	LD	IY,(IX+-4)
01173F FD2706              A  5159    	LD	HL,(IY+6)
011742 0B                  A  5160    	DEC	BC
011743 09                  A  5161    	ADD	HL,BC
011744 E5                  A  5162    	PUSH	HL
011745 01000000            A  5163    	LD	BC,0
011749 C5                  A  5164    	PUSH	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 101


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01174A DD4EFF              A  5165    	LD	C,(IX+-1)
01174D 0600                A  5166    	LD	B,0
01174F C5                  A  5167    	PUSH	BC
011750 CD 12 08 01         A  5168    	CALL	_sc_str
011754 C1                  A  5169    	POP	BC
011755 C1                  A  5170    	POP	BC
011756 C1                  A  5171    	POP	BC
                           A  5172    ; 1260			else
011757 18 1D               A  5173    	JR	L_293
011759                     A  5174    L_292:
                           A  5175    ; 1261				if (len == 0)
011759 DD7EFB              A  5176    	LD	A,(IX+-5)
01175C B7                  A  5177    	OR	A,A
01175D 20 17               A  5178    	JR	NZ,L_293
                           A  5179    ; 1262					plot_char(0, r, ' ');
01175F 01200000            A  5180    	LD	BC,32
011763 C5                  A  5181    	PUSH	BC
011764 DD4EFF              A  5182    	LD	C,(IX+-1)
011767 0600                A  5183    	LD	B,0
011769 C5                  A  5184    	PUSH	BC
01176A 01000000            A  5185    	LD	BC,0
01176E C5                  A  5186    	PUSH	BC
01176F CD 84 02 01         A  5187    	CALL	_plot_char
011773 C1                  A  5188    	POP	BC
011774 C1                  A  5189    	POP	BC
011775 C1                  A  5190    	POP	BC
011776                     A  5191    L_293:
                           A  5192    ; 1263			
                           A  5193    ; 1264			p = p->p_next;
011776 DD31FC              A  5194    	LD	IY,(IX+-4)
011779 FD0703              A  5195    	LD	BC,(IY+3)
01177C DD0FFC              A  5196    	LD	(IX+-4),BC
01177F DD34FF              A  5197    	INC	(IX+-1)
                           A  5198    ; 1265		}
011782                     A  5199    L_296:
011782 DD7EFF              A  5200    	LD	A,(IX+-1)
011785 FE32                A  5201    	CP	A,50
011787 DA E6 16 01         A  5202    	JR	C,L_294
01178B                     A  5203    L_297:
                           A  5204    ; 1266		
                           A  5205    ; 1267		te_mov(cur_row, cur_col);
01178B 3A 22 55 01         A  5206    	LD	A,(_cur_col)
01178F 4F                  A  5207    	LD	C,A
011790 3A 1F 55 01         A  5208    	LD	A,(_cur_row)
011794 0600                A  5209    	LD	B,0
011796 C5                  A  5210    	PUSH	BC
011797 4F                  A  5211    	LD	C,A
011798 C5                  A  5212    	PUSH	BC
011799 CD 71 06 01         A  5213    	CALL	_te_mov
01179D C1                  A  5214    	POP	BC
01179E C1                  A  5215    	POP	BC
                           A  5216    ; 1268	
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 102


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  5217    ; 1269		Show_Cursor();
01179F CD 51 18 01         A  5218    	CALL	_Show_Cursor
                           A  5219    ; 1270	}
0117A3 DDF9                A  5220    	LD	SP,IX
0117A5 DDE1                A  5221    	POP	IX
0117A7 C9                  A  5222    	RET	
                           A  5223    
                           A  5224    
                           A  5225    ;**************************** _paintall *******
                           A  5226    ;Name                         Addr/Register   S
                           A  5227    ;_Show_Cursor                        IMPORT  --
                           A  5228    ;_te_mov                             IMPORT  --
                           A  5229    ;_plot_char                          IMPORT  --
                           A  5230    ;_strlen                             IMPORT  --
                           A  5231    ;_do_cup                             IMPORT  --
                           A  5232    ;_sc_str                             IMPORT  --
                           A  5233    ;_p_root                             STATIC    
                           A  5234    ;_sc_clr                             IMPORT  --
                           A  5235    ;_cur_row                            STATIC    
                           A  5236    ;_cur_col                            STATIC    
                           A  5237    ;_cur_char                           STATIC    
                           A  5238    ;_p_curr                             STATIC    
                           A  5239    ;left_pos                              IX-8    
                           A  5240    ;len                                   IX-5    
                           A  5241    ;p                                     IX-4    
                           A  5242    ;r                                     IX-1    
                           A  5243    
                           A  5244    
                           A  5245    ; Stack Frame Size: 14 (bytes)
                           A  5246    ;       Spill Code: 0 (instruction)
                           A  5247    
                           A  5248    
                           A  5249    	SEGMENT STRSECT
0127FD                     A  5250    L__207:
0127FD 3C656F66 3E         A  5251    	DB	"<eof>"
012802 00                  A  5252    	DB	0
                           A  5253    	SEGMENT CODE
                           A  5254    ; 1271	
                           A  5255    ; 1272	/* Redraws the current row of the virtu
                           A  5256    ; 1273	/* from scratch from the current settin
                           A  5257    ; 1274	void paintrow(void)
                           A  5258    ; 1275	{
0117A8                     A  5259    _paintrow:
0117A8 21FEFFFF            A  5260    	LD	HL,-2
0117AC CD 57 25 01         A  5261    	CALL	__frameset
                           A  5262    ; 1276		unsigned char left_pos = cur_char -
0117B0 3A 1C 55 01         A  5263    	LD	A,(_cur_char)
0117B4 47                  A  5264    	LD	B,A
0117B5 3A 22 55 01         A  5265    	LD	A,(_cur_col)
0117B9 4F                  A  5266    	LD	C,A
0117BA 78                  A  5267    	LD	A,B
0117BB 91                  A  5268    	SUB	A,C
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 103


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0117BC DD77FF              A  5269    	LD	(IX+-1),A
                           A  5270    ; 1277		char len;
                           A  5271    ; 1278		
                           A  5272    ; 1279		len = strlen(p_curr->p_data);
0117BF FD2A 13 55 01       A  5273    	LD	IY,(_p_curr)
0117C4 FD0706              A  5274    	LD	BC,(IY+6)
0117C7 C5                  A  5275    	PUSH	BC
0117C8 CD 14 25 01         A  5276    	CALL	_strlen
0117CC C1                  A  5277    	POP	BC
0117CD DD75FE              A  5278    	LD	(IX+-2),L
                           A  5279    ; 1280		
                           A  5280    ; 1281		sc_crw(cur_row);
0117D0 3A 1F 55 01         A  5281    	LD	A,(_cur_row)
0117D4 4F                  A  5282    	LD	C,A
0117D5 0600                A  5283    	LD	B,0
0117D7 C5                  A  5284    	PUSH	BC
0117D8 CD 66 07 01         A  5285    	CALL	_sc_crw
0117DC C1                  A  5286    	POP	BC
                           A  5287    ; 1282		
                           A  5288    ; 1283		if (p_curr == p_root)
0117DD ED4B 10 55 01       A  5289    	LD	BC,(_p_root)
0117E2 2A 13 55 01         A  5290    	LD	HL,(_p_curr)
0117E6 B7                  A  5291    	OR	A,A
0117E7 ED42                A  5292    	SBC	HL,BC
0117E9 20 1B               A  5293    	JR	NZ,L_301
                           A  5294    ; 1284			sc_str(cur_row, 0, "<eof>");
0117EB 01 03 28 01         A  5295    	LD	BC,L__215
0117EF C5                  A  5296    	PUSH	BC
0117F0 3A 1F 55 01         A  5297    	LD	A,(_cur_row)
0117F4 4F                  A  5298    	LD	C,A
0117F5 11000000            A  5299    	LD	DE,0
0117F9 D5                  A  5300    	PUSH	DE
0117FA 0600                A  5301    	LD	B,0
0117FC C5                  A  5302    	PUSH	BC
0117FD CD 12 08 01         A  5303    	CALL	_sc_str
011801 C1                  A  5304    	POP	BC
011802 C1                  A  5305    	POP	BC
011803 C1                  A  5306    	POP	BC
                           A  5307    ; 1285		else
011804 18 46               A  5308    	JR	L_302
011806                     A  5309    L_301:
                           A  5310    ; 1286			if (len >= left_pos)
011806 DD7EFE              A  5311    	LD	A,(IX+-2)
011809 DDBEFF              A  5312    	CP	A,(IX+-1)
01180C 38 3E               A  5313    	JR	C,L_302
                           A  5314    ; 1287			{
                           A  5315    ; 1288				sc_str(cur_row, 0, p_curr->
01180E DD7EFF              A  5316    	LD	A,(IX+-1)
011811 B7ED62              A  5317    	UEXT	HL
011814 6F                  A  5318    	LD	L,A
011815 E5C1                A  5319    	LD	BC,HL
011817 FD2A 13 55 01       A  5320    	LD	IY,(_p_curr)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 104


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01181C FD2706              A  5321    	LD	HL,(IY+6)
01181F 0B                  A  5322    	DEC	BC
011820 09                  A  5323    	ADD	HL,BC
011821 E5                  A  5324    	PUSH	HL
011822 3A 1F 55 01         A  5325    	LD	A,(_cur_row)
011826 4F                  A  5326    	LD	C,A
011827 11000000            A  5327    	LD	DE,0
01182B D5                  A  5328    	PUSH	DE
01182C 0600                A  5329    	LD	B,0
01182E C5                  A  5330    	PUSH	BC
01182F CD 12 08 01         A  5331    	CALL	_sc_str
011833 C1                  A  5332    	POP	BC
011834 C1                  A  5333    	POP	BC
011835 C1                  A  5334    	POP	BC
                           A  5335    ; 1289		
                           A  5336    ; 1290				gotoxy(len, cur_row);
011836 3A 1F 55 01         A  5337    	LD	A,(_cur_row)
01183A 4F                  A  5338    	LD	C,A
01183B 0600                A  5339    	LD	B,0
01183D C5                  A  5340    	PUSH	BC
01183E DD4EFE              A  5341    	LD	C,(IX+-2)
011841 C5                  A  5342    	PUSH	BC
011842 CD FF 02 01         A  5343    	CALL	_gotoxy
011846 C1                  A  5344    	POP	BC
011847 C1                  A  5345    	POP	BC
                           A  5346    ; 1291				
                           A  5347    ; 1292				clreol();
011848 CD BC 02 01         A  5348    	CALL	_clreol
                           A  5349    ; 1293			}
                           A  5350    ; 1294	}
01184C                     A  5351    L_302:
01184C DDF9                A  5352    	LD	SP,IX
01184E DDE1                A  5353    	POP	IX
011850 C9                  A  5354    	RET	
                           A  5355    
                           A  5356    
                           A  5357    ;**************************** _paintrow *******
                           A  5358    ;Name                         Addr/Register   S
                           A  5359    ;_clreol                             IMPORT  --
                           A  5360    ;_gotoxy                             IMPORT  --
                           A  5361    ;_sc_str                             IMPORT  --
                           A  5362    ;_p_root                             STATIC    
                           A  5363    ;_cur_row                            STATIC    
                           A  5364    ;_sc_crw                             IMPORT  --
                           A  5365    ;_p_curr                             STATIC    
                           A  5366    ;_strlen                             IMPORT  --
                           A  5367    ;_cur_col                            STATIC    
                           A  5368    ;_cur_char                           STATIC    
                           A  5369    ;len                                   IX-2    
                           A  5370    ;left_pos                              IX-1    
                           A  5371    
                           A  5372    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 105


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  5373    ; Stack Frame Size: 8 (bytes)
                           A  5374    ;       Spill Code: 0 (instruction)
                           A  5375    
                           A  5376    
                           A  5377    	SEGMENT STRSECT
012803                     A  5378    L__215:
012803 3C656F66 3E         A  5379    	DB	"<eof>"
012808 00                  A  5380    	DB	0
                           A  5381    	SEGMENT CODE
                           A  5382    ; 1295	
                           A  5383    ; 1296	/* Show curson on screen. */
                           A  5384    ; 1297	void Show_Cursor(void)
                           A  5385    ; 1298	{
011851                     A  5386    _Show_Cursor:
011851 21FFFFFF            A  5387    	LD	HL,-1
011855 CD 57 25 01         A  5388    	CALL	__frameset
                           A  5389    ; 1299		char ch;
                           A  5390    ; 1300		
                           A  5391    ; 1301		ch = scn_phys[cur_row][cur_col];
011859 2A 1F 55 01         A  5392    	LD	HL,(_cur_row)
01185D 29                  A  5393    	ADD	HL,HL
01185E 29                  A  5394    	ADD	HL,HL
01185F ED4B 1F 55 01       A  5395    	LD	BC,(_cur_row)
011864 09                  A  5396    	ADD	HL,BC
011865 29                  A  5397    	ADD	HL,HL
011866 29                  A  5398    	ADD	HL,HL
011867 29                  A  5399    	ADD	HL,HL
011868 29                  A  5400    	ADD	HL,HL
011869 01 27 44 01         A  5401    	LD	BC,_scn_phys
01186D 09                  A  5402    	ADD	HL,BC
01186E ED4B 22 55 01       A  5403    	LD	BC,(_cur_col)
011873 09                  A  5404    	ADD	HL,BC
011874 7E                  A  5405    	LD	A,(HL)
011875 DD77FF              A  5406    	LD	(IX+-1),A
                           A  5407    ; 1302		
                           A  5408    ; 1303		asm ("push ix");
011878 DDE5                A  5409    push ix
                           A  5410    ; 1304		asm ("ld E, 70h");
01187A 1E70                A  5411    ld E, 70h
                           A  5412    ; 1305		asm ("ld a, kr_set_pen");
01187C 3E2A                A  5413    ld a, kr_set_pen
                           A  5414    ; 1306		asm ("call.lil prose_kernal");	
01187E 5BCD200A 00         A  5415    call.lil prose_kernal
                           A  5416    ; 1307		asm ("pop ix");
011883 DDE1                A  5417    pop ix
                           A  5418    ; 1308		
                           A  5419    ; 1309		plot_char(cur_col, cur_row, ch);	011885 3A 1F 55 01         A  5420    	LD	A,(_cur_row)
011889 DD4EFF              A  5421    	LD	C,(IX+-1)
01188C 0600                A  5422    	LD	B,0
01188E C5                  A  5423    	PUSH	BC
01188F 4F                  A  5424    	LD	C,A
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 106


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011890 3A 22 55 01         A  5425    	LD	A,(_cur_col)
011894 C5                  A  5426    	PUSH	BC
011895 4F                  A  5427    	LD	C,A
011896 C5                  A  5428    	PUSH	BC
011897 CD 84 02 01         A  5429    	CALL	_plot_char
01189B C1                  A  5430    	POP	BC
01189C C1                  A  5431    	POP	BC
01189D C1                  A  5432    	POP	BC
                           A  5433    ; 1310		
                           A  5434    ; 1311		Disable_Back_Color();
01189E CD 82 19 01         A  5435    	CALL	_Disable_Back_Color
                           A  5436    ; 1312	}
0118A2 DDF9                A  5437    	LD	SP,IX
0118A4 DDE1                A  5438    	POP	IX
0118A6 C9                  A  5439    	RET	
                           A  5440    
                           A  5441    
                           A  5442    ;**************************** _Show_Cursor ****
                           A  5443    ;Name                         Addr/Register   S
                           A  5444    ;_Disable_Back_Color                 IMPORT  --
                           A  5445    ;_plot_char                          IMPORT  --
                           A  5446    ;_cur_col                            STATIC    
                           A  5447    ;_cur_row                            STATIC    
                           A  5448    ;_scn_phys                           STATIC   4
                           A  5449    ;ch                                    IX-1    
                           A  5450    
                           A  5451    
                           A  5452    ; Stack Frame Size: 7 (bytes)
                           A  5453    ;       Spill Code: 0 (instruction)
                           A  5454    
                           A  5455    
                           A  5456    ; 1313	
                           A  5457    ; 1314	/* Show PROTED men */
                           A  5458    ; 1315	void ShowMenu(void)
                           A  5459    ; 1316	{
0118A7                     A  5460    _ShowMenu:
                           A  5461    ; 1317		Enable_Back_Color();
0118A7 CD 74 19 01         A  5462    	CALL	_Enable_Back_Color
                           A  5463    ; 1318		
                           A  5464    ; 1319		gotoxy(0, 50);	
0118AB 01320000            A  5465    	LD	BC,50
0118AF C5                  A  5466    	PUSH	BC
0118B0 01000000            A  5467    	LD	BC,0
0118B4 C5                  A  5468    	PUSH	BC
0118B5 CD FF 02 01         A  5469    	CALL	_gotoxy
0118B9 C1                  A  5470    	POP	BC
0118BA C1                  A  5471    	POP	BC
                           A  5472    ; 1320		print("+===========================
0118BB 01 09 28 01         A  5473    	LD	BC,L__219
0118BF C5                  A  5474    	PUSH	BC
0118C0 CD 36 02 01         A  5475    	CALL	_print
0118C4 C1                  A  5476    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 107


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  5477    ; 1321		print("| Ln:       , Col:          
0118C5 01 5A 28 01         A  5478    	LD	BC,L__220
0118C9 C5                  A  5479    	PUSH	BC
0118CA CD 36 02 01         A  5480    	CALL	_print
0118CE C1                  A  5481    	POP	BC
                           A  5482    ; 1322		print("|                           
0118CF 01 AB 28 01         A  5483    	LD	BC,L__221
0118D3 C5                  A  5484    	PUSH	BC
0118D4 CD 36 02 01         A  5485    	CALL	_print
0118D8 C1                  A  5486    	POP	BC
                           A  5487    ; 1323		print("| Command  shortcuts:       
0118D9 01 FC 28 01         A  5488    	LD	BC,L__222
0118DD C5                  A  5489    	PUSH	BC
0118DE CD 36 02 01         A  5490    	CALL	_print
0118E2 C1                  A  5491    	POP	BC
                           A  5492    ; 1324		print("| Ctrl + L: insert a line.  
0118E3 01 4D 29 01         A  5493    	LD	BC,L__223
0118E7 C5                  A  5494    	PUSH	BC
0118E8 CD 36 02 01         A  5495    	CALL	_print
0118EC C1                  A  5496    	POP	BC
                           A  5497    ; 1325		print("| Ctrl + N: redraw screen.  
0118ED 01 9E 29 01         A  5498    	LD	BC,L__224
0118F1 C5                  A  5499    	PUSH	BC
0118F2 CD 36 02 01         A  5500    	CALL	_print
0118F6 C1                  A  5501    	POP	BC
                           A  5502    ; 1326		print("| Ctrl + B: break a line.   
0118F7 01 EF 29 01         A  5503    	LD	BC,L__225
0118FB C5                  A  5504    	PUSH	BC
0118FC CD 36 02 01         A  5505    	CALL	_print
011900 C1                  A  5506    	POP	BC
                           A  5507    ; 1327		print("|      Key enabled: Tab, Cur
011901 01 40 2A 01         A  5508    	LD	BC,L__226
011905 C5                  A  5509    	PUSH	BC
011906 CD 36 02 01         A  5510    	CALL	_print
01190A C1                  A  5511    	POP	BC
                           A  5512    ; 1328		print("+===========================
01190B 01 91 2A 01         A  5513    	LD	BC,L__227
01190F C5                  A  5514    	PUSH	BC
011910 CD 36 02 01         A  5515    	CALL	_print
011914 C1                  A  5516    	POP	BC
                           A  5517    ; 1329		
                           A  5518    ; 1330		Disable_Back_Color();
011915 CD 82 19 01         A  5519    	CALL	_Disable_Back_Color
                           A  5520    ; 1331	}
011919 C9                  A  5521    	RET	
                           A  5522    
                           A  5523    
                           A  5524    ;**************************** _ShowMenu *******
                           A  5525    ;Name                         Addr/Register   S
                           A  5526    ;_Disable_Back_Color                 IMPORT  --
                           A  5527    ;_print                              IMPORT  --
                           A  5528    ;_gotoxy                             IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 108


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  5529    ;_Enable_Back_Color                  IMPORT  --
                           A  5530    
                           A  5531    
                           A  5532    ; Stack Frame Size: 6 (bytes)
                           A  5533    ;       Spill Code: 0 (instruction)
                           A  5534    
                           A  5535    
                           A  5536    	SEGMENT STRSECT
012809                     A  5537    L__219:
012809 2B3D3D3D 3D3D3D3D   A  5538    	DB	"+==================================]PR
012811 3D3D3D3D 3D3D3D3D 
012819 3D3D3D3D 3D3D3D3D 
012821 3D3D3D3D 3D3D3D3D 
012829 3D3D3D5D 50524F54 
012831 45445B3D 3D3D3D3D 
012839 3D3D3D3D 3D3D3D3D 
012841 3D3D3D3D 3D3D3D3D 
012849 3D3D3D3D 3D3D3D3D 
012851 3D3D3D3D 3D3D3D2B 
012859 00                  A  5539    	DB	0
01285A                     A  5540    L__220:
01285A 7C204C6E 3A202020   A  5541    	DB	"| Ln:       , Col:                    
012862 20202020 2C20436F 
01286A 6C3A2020 20202020 
012872 20202020 20202020 
01287A 20202020 20202020 
012882 20202020 20202020 
01288A 20202020 20202020 
012892 20202020 20202020 
01289A 20202020 20202020 
0128A2 20202020 2020207C 
0128AA 00                  A  5542    	DB	0
0128AB                     A  5543    L__221:
0128AB 7C202020 20202020   A  5544    	DB	"|                                     
0128B3 20202020 20202020 
0128BB 20202020 20202020 
0128C3 20202020 20202020 
0128CB 20202020 20202020 
0128D3 20202020 20202020 
0128DB 20202020 20202020 
0128E3 20202020 20202020 
0128EB 20202020 20202020 
0128F3 20202020 2020207C 
0128FB 00                  A  5545    	DB	0
0128FC                     A  5546    L__222:
0128FC 7C20436F 6D6D616E   A  5547    	DB	"| Command  shortcuts:                 
012904 64202073 686F7274 
01290C 63757473 3A202020 
012914 20202020 20202020 
01291C 20202020 20202020 
012924 20202020 20202020 
01292C 20202020 20202020 
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 109


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
012934 20202020 20202020 
01293C 20202020 20202020 
012944 20202020 2020207C 
01294C 00                  A  5548    	DB	0
01294D                     A  5549    L__223:
01294D 7C204374 726C202B   A  5550    	DB	"| Ctrl + L: insert a line.   Ctrl + E:
012955 204C3A20 696E7365 
01295D 72742061 206C696E 
012965 652E2020 20437472 
01296D 6C202B20 453A2065 
012975 6E64206F 66207465 
01297D 78742E20 20204374 
012985 726C202B 204B3A20 
01298D 64656C65 74652061 
012995 206C696E 652E207C 
01299D 00                  A  5551    	DB	0
01299E                     A  5552    L__224:
01299E 7C204374 726C202B   A  5553    	DB	"| Ctrl + N: redraw screen.   Ctrl + T:
0129A6 204E3A20 72656472 
0129AE 61772073 63726565 
0129B6 6E2E2020 20437472 
0129BE 6C202B20 543A2074 
0129C6 6F70206F 66206669 
0129CE 6C652E20 20204374 
0129D6 726C202B 20533A20 
0129DE 73617665 2066696C 
0129E6 652E2020 2020207C 
0129EE 00                  A  5554    	DB	0
0129EF                     A  5555    L__225:
0129EF 7C204374 726C202B   A  5556    	DB	"| Ctrl + B: break a line.    Ctrl + R:
0129F7 20423A20 62726561 
0129FF 6B206120 6C696E65 
012A07 2E202020 20437472 
012A0F 6C202B20 523A2072 
012A17 656C6F61 64206669 
012A1F 6C652E20 20204374 
012A27 726C202B 20513A20 
012A2F 71756974 20746F20 
012A37 50524F53 452E207C 
012A3F 00                  A  5557    	DB	0
012A40                     A  5558    L__226:
012A40 7C202020 2020204B   A  5559    	DB	"|      Key enabled: Tab, Cursor Keys, 
012A48 65792065 6E61626C 
012A50 65643A20 5461622C 
012A58 20437572 736F7220 
012A60 4B657973 2C205067 
012A68 55702C20 5067446F 
012A70 776E2C20 486F6D65 
012A78 2C20456E 642C2044 
012A80 656C2C20 496E732E 
012A88 20202020 2020207C 
012A90 00                  A  5560    	DB	0
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 110


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
012A91                     A  5561    L__227:
012A91 2B3D3D3D 3D3D3D3D   A  5562    	DB	"+=====================================
012A99 3D3D3D3D 3D3D3D3D 
012AA1 3D3D3D3D 3D3D3D3D 
012AA9 3D3D3D3D 3D3D3D3D 
012AB1 3D3D3D3D 3D3D3D3D 
012AB9 3D3D3D3D 3D3D3D3D 
012AC1 3D3D3D3D 3D3D3D3D 
012AC9 3D3D3D3D 3D3D3D3D 
012AD1 3D3D3D3D 3D3D3D3D 
012AD9 3D3D3D3D 3D3D3D2B 
012AE1 00                  A  5563    	DB	0
                           A  5564    	SEGMENT CODE
                           A  5565    ; 1332	
                           A  5566    ; 1333	/* Show Type Mode */
                           A  5567    ; 1334	void ShowInsertMode(void)
                           A  5568    ; 1335	{
01191A                     A  5569    _ShowInsertMode:
                           A  5570    ; 1336		Enable_Back_Color();
01191A CD 74 19 01         A  5571    	CALL	_Enable_Back_Color
                           A  5572    ; 1337		
                           A  5573    ; 1338		gotoxy(54, 51);	
01191E 01330000            A  5574    	LD	BC,51
011922 C5                  A  5575    	PUSH	BC
011923 01360000            A  5576    	LD	BC,54
011927 C5                  A  5577    	PUSH	BC
011928 CD FF 02 01         A  5578    	CALL	_gotoxy
01192C C1                  A  5579    	POP	BC
01192D C1                  A  5580    	POP	BC
                           A  5581    ; 1339		print("                     ");
01192E 01 E2 2A 01         A  5582    	LD	BC,L__229
011932 C5                  A  5583    	PUSH	BC
011933 CD 36 02 01         A  5584    	CALL	_print
011937 C1                  A  5585    	POP	BC
                           A  5586    ; 1340		
                           A  5587    ; 1341		gotoxy(54, 51);
011938 01330000            A  5588    	LD	BC,51
01193C C5                  A  5589    	PUSH	BC
01193D 01360000            A  5590    	LD	BC,54
011941 C5                  A  5591    	PUSH	BC
011942 CD FF 02 01         A  5592    	CALL	_gotoxy
011946 C1                  A  5593    	POP	BC
011947 C1                  A  5594    	POP	BC
                           A  5595    ; 1342		print("Type mode: ");
011948 01 F8 2A 01         A  5596    	LD	BC,L__230
01194C C5                  A  5597    	PUSH	BC
01194D CD 36 02 01         A  5598    	CALL	_print
011951 C1                  A  5599    	POP	BC
                           A  5600    ; 1343		
                           A  5601    ; 1344		if (InsertMode)
011952 3A 84 55 01         A  5602    	LD	A,(_InsertMode)
011956 B7                  A  5603    	OR	A,A
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 111


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011957 28 0C               A  5604    	JR	Z,L_306
                           A  5605    ; 1345			print("Insert");
011959 01 04 2B 01         A  5606    	LD	BC,L__232
01195D C5                  A  5607    	PUSH	BC
01195E CD 36 02 01         A  5608    	CALL	_print
011962 C1                  A  5609    	POP	BC
                           A  5610    ; 1346		else
011963 18 0A               A  5611    	JR	L_307
011965                     A  5612    L_306:
                           A  5613    ; 1347			print("Overwrite");
011965 01 0B 2B 01         A  5614    	LD	BC,L__233
011969 C5                  A  5615    	PUSH	BC
01196A CD 36 02 01         A  5616    	CALL	_print
01196E C1                  A  5617    	POP	BC
01196F                     A  5618    L_307:
                           A  5619    ; 1348		
                           A  5620    ; 1349		Disable_Back_Color();
01196F CD 82 19 01         A  5621    	CALL	_Disable_Back_Color
                           A  5622    ; 1350	}
011973 C9                  A  5623    	RET	
                           A  5624    
                           A  5625    
                           A  5626    ;**************************** _ShowInsertMode *
                           A  5627    ;Name                         Addr/Register   S
                           A  5628    ;_Disable_Back_Color                 IMPORT  --
                           A  5629    ;_InsertMode                         STATIC    
                           A  5630    ;_print                              IMPORT  --
                           A  5631    ;_gotoxy                             IMPORT  --
                           A  5632    ;_Enable_Back_Color                  IMPORT  --
                           A  5633    
                           A  5634    
                           A  5635    ; Stack Frame Size: 6 (bytes)
                           A  5636    ;       Spill Code: 0 (instruction)
                           A  5637    
                           A  5638    
                           A  5639    	SEGMENT STRSECT
012AE2                     A  5640    L__229:
012AE2 20202020 20202020   A  5641    	DB	"                     "
012AEA 20202020 20202020 
012AF2 20202020 20 
012AF7 00                  A  5642    	DB	0
012AF8                     A  5643    L__230:
012AF8 54797065 206D6F64   A  5644    	DB	"Type mode: "
012B00 653A20 
012B03 00                  A  5645    	DB	0
012B04                     A  5646    L__232:
012B04 496E7365 7274       A  5647    	DB	"Insert"
012B0A 00                  A  5648    	DB	0
012B0B                     A  5649    L__233:
012B0B 4F766572 77726974   A  5650    	DB	"Overwrite"
012B13 65 
012B14 00                  A  5651    	DB	0
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 112


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  5652    	SEGMENT CODE
                           A  5653    ; 1351	
                           A  5654    ; 1352	/* Enable the background color for prin
                           A  5655    ; 1353	void Enable_Back_Color(void)
                           A  5656    ; 1354	{
011974                     A  5657    _Enable_Back_Color:
                           A  5658    ; 1355		asm ("push ix");
011974 DDE5                A  5659    push ix
                           A  5660    ; 1356		asm ("ld E, E7h");
011976 1EE7                A  5661    ld E, E7h
                           A  5662    ; 1357		asm ("ld a, kr_set_pen");
011978 3E2A                A  5663    ld a, kr_set_pen
                           A  5664    ; 1358		asm ("call.lil prose_kernal");
01197A 5BCD200A 00         A  5665    call.lil prose_kernal
                           A  5666    ; 1359		asm ("pop ix");
01197F DDE1                A  5667    pop ix
                           A  5668    ; 1360	}
011981 C9                  A  5669    	RET	
                           A  5670    
                           A  5671    
                           A  5672    ;**************************** _Enable_Back_Colo
                           A  5673    ;Name                         Addr/Register   S
                           A  5674    
                           A  5675    
                           A  5676    ; Stack Frame Size: 6 (bytes)
                           A  5677    ;       Spill Code: 0 (instruction)
                           A  5678    
                           A  5679    
                           A  5680    ; 1361	
                           A  5681    ; 1362	/* Disable the background color for pri
                           A  5682    ; 1363	void Disable_Back_Color(void)
                           A  5683    ; 1364	{
011982                     A  5684    _Disable_Back_Color:
                           A  5685    ; 1365		asm ("push ix");
011982 DDE5                A  5686    push ix
                           A  5687    ; 1366		asm ("ld E, 07h");
011984 1E07                A  5688    ld E, 07h
                           A  5689    ; 1367		asm ("ld a, kr_set_pen");
011986 3E2A                A  5690    ld a, kr_set_pen
                           A  5691    ; 1368		asm ("call.lil prose_kernal");
011988 5BCD200A 00         A  5692    call.lil prose_kernal
                           A  5693    ; 1369		asm ("pop ix");
01198D DDE1                A  5694    pop ix
                           A  5695    ; 1370	}
01198F C9                  A  5696    	RET	
                           A  5697    
                           A  5698    
                           A  5699    ;**************************** _Disable_Back_Col
                           A  5700    ;Name                         Addr/Register   S
                           A  5701    
                           A  5702    
                           A  5703    ; Stack Frame Size: 6 (bytes)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 113


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  5704    ;       Spill Code: 0 (instruction)
                           A  5705    
                           A  5706    
                           A  5707    ; 1371	
                           A  5708    ; 1372	/* Main edit loop */
                           A  5709    ; 1373	void edit(void)
                           A  5710    ; 1374	{
011990                     A  5711    _edit:
011990 21FFFFFF            A  5712    	LD	HL,-1
011994 CD 57 25 01         A  5713    	CALL	__frameset
                           A  5714    ; 1375		cur_row = 0;
011998 01000000            A  5715    	LD	BC,0
01199C ED43 1F 55 01       A  5716    	LD	(_cur_row),BC
                           A  5717    ; 1376		cur_col = 0;
0119A1 ED43 22 55 01       A  5718    	LD	(_cur_col),BC
                           A  5719    ; 1377		cur_line = 1;
0119A6 01010000            A  5720    	LD	BC,1
0119AA ED43 19 55 01       A  5721    	LD	(_cur_line),BC
                           A  5722    ; 1378		cur_char = 1;
0119AF ED43 1C 55 01       A  5723    	LD	(_cur_char),BC
                           A  5724    ; 1379		InsertMode = 1;
0119B4 3E01                A  5725    	LD	A,1
0119B6 32 84 55 01         A  5726    	LD	(_InsertMode),A
                           A  5727    ; 1380		p_curr = p_root->p_next;	
0119BA FD2A 10 55 01       A  5728    	LD	IY,(_p_root)
0119BF FD0703              A  5729    	LD	BC,(IY+3)
0119C2 ED43 13 55 01       A  5730    	LD	(_p_curr),BC
                           A  5731    ; 1381		
                           A  5732    ; 1382		paintall();
0119C7 CD 96 16 01         A  5733    	CALL	_paintall
                           A  5734    ; 1383		
                           A  5735    ; 1384		sc_fup();
0119CB CD 96 09 01         A  5736    	CALL	_sc_fup
                           A  5737    ; 1385		
                           A  5738    ; 1386		ShowInsertMode();
0119CF CD 1A 19 01         A  5739    	CALL	_ShowInsertMode
                           A  5740    ; 1387		
                           A  5741    ; 1388		while (TRUE)
0119D3                     A  5742    L_343:
                           A  5743    ; 1389		{
                           A  5744    ; 1390			char ch;
                           A  5745    ; 1391			
                           A  5746    ; 1392			sc_upd();
0119D3 CD 5B 08 01         A  5747    	CALL	_sc_upd
                           A  5748    ; 1393			
                           A  5749    ; 1394			Show_Cursor_Position();
0119D7 CD DD 1B 01         A  5750    	CALL	_Show_Cursor_Position
                           A  5751    ; 1395			
                           A  5752    ; 1396			te_mov(cur_row, cur_col);
0119DB 3A 22 55 01         A  5753    	LD	A,(_cur_col)
0119DF 4F                  A  5754    	LD	C,A
0119E0 3A 1F 55 01         A  5755    	LD	A,(_cur_row)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 114


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0119E4 0600                A  5756    	LD	B,0
0119E6 C5                  A  5757    	PUSH	BC
0119E7 4F                  A  5758    	LD	C,A
0119E8 C5                  A  5759    	PUSH	BC
0119E9 CD 71 06 01         A  5760    	CALL	_te_mov
0119ED C1                  A  5761    	POP	BC
0119EE C1                  A  5762    	POP	BC
                           A  5763    ; 1397	
                           A  5764    ; 1398			Show_Cursor();		
0119EF CD 51 18 01         A  5765    	CALL	_Show_Cursor
                           A  5766    ; 1399			
                           A  5767    ; 1400			ch = te_gch();
0119F3 CD 07 06 01         A  5768    	CALL	_te_gch
0119F7 DD77FF              A  5769    	LD	(IX+-1),A
                           A  5770    ; 1401			
                           A  5771    ; 1402			if ((' ' <= ch) && (ch <= '~'))
0119FA FE20                A  5772    	CP	A,32
0119FC FA 20 1A 01         A  5773    	JP	M,L_341
011A00 3E7E                A  5774    	LD	A,126
011A02 DDBEFF              A  5775    	CP	A,(IX+-1)
011A05 FA 0F 1A 01         A  5776    	JP	M,L__255
011A09 EA 20 1A 01         A  5777    	JP	PE,L_341
011A0D 18 04               A  5778    	JR	L__256
011A0F                     A  5779    L__255:
011A0F E2 20 1A 01         A  5780    	JP	PO,L_341
011A13                     A  5781    L__256:
                           A  5782    ; 1403				do_chr(ch);
011A13 DD4EFF              A  5783    	LD	C,(IX+-1)
011A16 0600                A  5784    	LD	B,0
011A18 C5                  A  5785    	PUSH	BC
011A19 CD C6 12 01         A  5786    	CALL	_do_chr
011A1D C1                  A  5787    	POP	BC
                           A  5788    ; 1404			else
011A1E 18 B3               A  5789    	JR	L_343
011A20                     A  5790    L_341:
                           A  5791    ; 1405				switch (ch)
011A20 DD7EFF              A  5792    	LD	A,(IX+-1)
011A23 17ED62              A  5793    	SEXT	HL
011A26 DD6EFF              A  5794    	LD	L,(IX+-1)
011A29 E5C1                A  5795    	LD	BC,HL
011A2B                     A  5796    L__240:
011A2B 11010000            A  5797    	LD	DE,1
011A2F B7                  A  5798    	OR	A,A
011A30 ED52                A  5799    	SBC	HL,DE
011A32 38 9F               A  5800    	JR	C,L_343
011A34 21140000            A  5801    	LD	HL,20
011A38 B7                  A  5802    	OR	A,A
011A39 ED42                A  5803    	SBC	HL,BC
011A3B 38 96               A  5804    	JR	C,L_343
011A3D C5E1                A  5805    	LD	HL,BC
011A3F 29                  A  5806    	ADD	HL,HL
011A40 29                  A  5807    	ADD	HL,HL
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 115


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011A41 B7                  A  5808    	OR	A,A
011A42 ED42                A  5809    	SBC	HL,BC
011A44 01 49 1A 01         A  5810    	LD	BC,L__239-3
011A48 09                  A  5811    	ADD	HL,BC
011A49 ED27                A  5812    	LD	HL,(HL)
011A4B E9                  A  5813    	JP	(HL)
011A4C                     A  5814    L__239:
011A4C 2E1B01              A  5815    	DW24	L_331	
                           A  5816    
011A4F 881A01              A  5817    	DW24	L_312	
                           A  5818    
011A52 901A01              A  5819    	DW24	L_313	
                           A  5820    
011A55 981A01              A  5821    	DW24	L_314	
                           A  5822    
011A58 A01A01              A  5823    	DW24	L_315	
                           A  5824    
011A5B AE1A01              A  5825    	DW24	L_316	
                           A  5826    
011A5E D31901              A  5827    	DW24	L_343	
                           A  5828    
011A61 B61A01              A  5829    	DW24	L_317	
                           A  5830    
011A64 BE1A01              A  5831    	DW24	L_318	
                           A  5832    
011A67 D31901              A  5833    	DW24	L_343	
                           A  5834    
011A6A C61A01              A  5835    	DW24	L_319	
                           A  5836    
011A6D CE1A01              A  5837    	DW24	L_320	
                           A  5838    
011A70 D61A01              A  5839    	DW24	L_321	
                           A  5840    
011A73 DE1A01              A  5841    	DW24	L_322	
                           A  5842    
011A76 D31901              A  5843    	DW24	L_343	
                           A  5844    
011A79 D31901              A  5845    	DW24	L_343	
                           A  5846    
011A7C FE1A01              A  5847    	DW24	L_326	
                           A  5848    
011A7F E61A01              A  5849    	DW24	L_323	
                           A  5850    
011A82 EE1A01              A  5851    	DW24	L_324	
                           A  5852    
011A85 F61A01              A  5853    	DW24	L_325	
                           A  5854    
                           A  5855    ; 1406				{
                           A  5856    ; 1407					case		2: do_enhan
011A88                     A  5857    L_312:
011A88 CD 6E 10 01         A  5858    	CALL	_do_enhanced_ret
011A8C C3 D3 19 01         A  5859    	JR	L_343
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 116


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  5860    ; 1408					case		3: do_pup()
011A90                     A  5861    L_313:
011A90 CD D6 0E 01         A  5862    	CALL	_do_pup
011A94 C3 D3 19 01         A  5863    	JR	L_343
                           A  5864    ; 1409					case		4: do_dch()
011A98                     A  5865    L_314:
011A98 CD 58 13 01         A  5866    	CALL	_do_dch
011A9C C3 D3 19 01         A  5867    	JR	L_343
                           A  5868    ; 1410					case		5: do_bot(1
011AA0                     A  5869    L_315:
011AA0 01010000            A  5870    	LD	BC,1
011AA4 C5                  A  5871    	PUSH	BC
011AA5 CD 15 12 01         A  5872    	CALL	_do_bot
011AA9 C1                  A  5873    	POP	BC
011AAA C3 D3 19 01         A  5874    	JR	L_343
                           A  5875    ; 1411					case 		6: do_pdw()
011AAE                     A  5876    L_316:
011AAE CD 19 0E 01         A  5877    	CALL	_do_pdw
011AB2 C3 D3 19 01         A  5878    	JR	L_343
                           A  5879    ; 1412					case 		8: do_del()
011AB6                     A  5880    L_317:
011AB6 CD 80 14 01         A  5881    	CALL	_do_del
011ABA C3 D3 19 01         A  5882    	JR	L_343
                           A  5883    ; 1413					case		9: do_tab()
011ABE                     A  5884    L_318:
011ABE CD 61 11 01         A  5885    	CALL	_do_tab
011AC2 C3 D3 19 01         A  5886    	JR	L_343
                           A  5887    ; 1414					case		11: do_dln(
011AC6                     A  5888    L_319:
011AC6 CD 43 14 01         A  5889    	CALL	_do_dln
011ACA C3 D3 19 01         A  5890    	JR	L_343
                           A  5891    ; 1415					case		12: do_iln(
011ACE                     A  5892    L_320:
011ACE CD CF 13 01         A  5893    	CALL	_do_iln
011AD2 C3 D3 19 01         A  5894    	JR	L_343
                           A  5895    ; 1416					case 		13: do_ret(
011AD6                     A  5896    L_321:
011AD6 CD 9A 0F 01         A  5897    	CALL	_do_ret
011ADA C3 D3 19 01         A  5898    	JR	L_343
                           A  5899    ; 1417					case		14: do_red(
011ADE                     A  5900    L_322:
011ADE CD F0 0B 01         A  5901    	CALL	_do_red
011AE2 C3 D3 19 01         A  5902    	JR	L_343
                           A  5903    ; 1418					case		18: reload_
011AE6                     A  5904    L_323:
011AE6 CD C9 1F 01         A  5905    	CALL	_reload_file
011AEA C3 D3 19 01         A  5906    	JR	L_343
                           A  5907    ; 1419					case		19: save_fi
011AEE                     A  5908    L_324:
011AEE CD 91 1E 01         A  5909    	CALL	_save_file
011AF2 C3 D3 19 01         A  5910    	JR	L_343
                           A  5911    ; 1420					case		20: do_top(
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 117


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011AF6                     A  5912    L_325:
011AF6 CD 95 11 01         A  5913    	CALL	_do_top
011AFA C3 D3 19 01         A  5914    	JR	L_343
                           A  5915    ; 1421					
                           A  5916    ; 1422					case		17: msg_win
011AFE                     A  5917    L_326:
011AFE 01 15 2B 01         A  5918    	LD	BC,L__243
011B02 C5                  A  5919    	PUSH	BC
011B03 01 19 2B 01         A  5920    	LD	BC,L__244
011B07 C5                  A  5921    	PUSH	BC
011B08 CD 70 20 01         A  5922    	CALL	_msg_window
011B0C C1                  A  5923    	POP	BC
011B0D C1                  A  5924    	POP	BC
                           A  5925    ; 1423									getch()
011B0E CD 29 01 01         A  5926    	CALL	_getch
                           A  5927    ; 1424									close_m
011B12 CD 94 22 01         A  5928    	CALL	_close_msg_window
                           A  5929    ; 1425									
                           A  5930    ; 1426									if ((As
011B16 3A 7F 55 01         A  5931    	LD	A,(_Ascii)
011B1A FE59                A  5932    	CP	A,89
011B1C CA D8 1B 01         A  5933    	JR	Z,L_329
011B20 3A 7F 55 01         A  5934    	LD	A,(_Ascii)
011B24 FE79                A  5935    	CP	A,121
011B26 C2 D3 19 01         A  5936    	JR	NZ,L_343
011B2A C3 D8 1B 01         A  5937    	JR	L_329
                           A  5938    ; 1427									 contin
                           A  5939    ; 1428									
                           A  5940    ; 1429									goto qu
                           A  5941    ; 1430						
                           A  5942    ; 1431					case		1:
011B2E                     A  5943    L_331:
                           A  5944    ; 1432						switch (Scancode)
011B2E 3A 80 55 01         A  5945    	LD	A,(_Scancode)
011B32 B7ED62              A  5946    	UEXT	HL
011B35 6F                  A  5947    	LD	L,A
011B36 E5C1                A  5948    	LD	BC,HL
011B38                     A  5949    L__249:
011B38 11700000            A  5950    	LD	DE,112
011B3C B7                  A  5951    	OR	A,A
011B3D ED52                A  5952    	SBC	HL,DE
011B3F 38 2C               A  5953    	JR	C,L__250
011B41 21750000            A  5954    	LD	HL,117
011B45 B7                  A  5955    	OR	A,A
011B46 ED42                A  5956    	SBC	HL,BC
011B48 DA D3 19 01         A  5957    	JR	C,L_343
011B4C C5E1                A  5958    	LD	HL,BC
011B4E 29                  A  5959    	ADD	HL,HL
011B4F 29                  A  5960    	ADD	HL,HL
011B50 B7                  A  5961    	OR	A,A
011B51 ED42                A  5962    	SBC	HL,BC
011B53 11 0B 1A 01         A  5963    	LD	DE,L__248-336
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 118


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011B57 19                  A  5964    	ADD	HL,DE
011B58 ED27                A  5965    	LD	HL,(HL)
011B5A E9                  A  5966    	JP	(HL)
011B5B                     A  5967    L__248:
011B5B D01B01              A  5968    	DW24	L_338	
                           A  5969    
011B5E D31901              A  5970    	DW24	L_343	
                           A  5971    
011B61 B81B01              A  5972    	DW24	L_335	
                           A  5973    
011B64 D31901              A  5974    	DW24	L_343	
                           A  5975    
011B67 A01B01              A  5976    	DW24	L_332	
                           A  5977    
011B6A B01B01              A  5978    	DW24	L_334	
                           A  5979    
011B6D                     A  5980    L__250:
011B6D 11690000            A  5981    	LD	DE,105
011B71 C5E1                A  5982    	LD	HL,BC
011B73 B7                  A  5983    	OR	A,A
011B74 ED52                A  5984    	SBC	HL,DE
011B76 DA D3 19 01         A  5985    	JR	C,L_343
011B7A 216C0000            A  5986    	LD	HL,108
011B7E B7                  A  5987    	OR	A,A
011B7F ED42                A  5988    	SBC	HL,BC
011B81 DA D3 19 01         A  5989    	JR	C,L_343
011B85 C5E1                A  5990    	LD	HL,BC
011B87 29                  A  5991    	ADD	HL,HL
011B88 29                  A  5992    	ADD	HL,HL
011B89 B7                  A  5993    	OR	A,A
011B8A ED42                A  5994    	SBC	HL,BC
011B8C 01 59 1A 01         A  5995    	LD	BC,L__247-315
011B90 09                  A  5996    	ADD	HL,BC
011B91 ED27                A  5997    	LD	HL,(HL)
011B93 E9                  A  5998    	JP	(HL)
011B94                     A  5999    L__247:
011B94 C81B01              A  6000    	DW24	L_337	
                           A  6001    
011B97 D31901              A  6002    	DW24	L_343	
                           A  6003    
011B9A A81B01              A  6004    	DW24	L_333	
                           A  6005    
011B9D C01B01              A  6006    	DW24	L_336	
                           A  6007    
                           A  6008    ; 1433						{
                           A  6009    ; 1434							case	0x74: d
011BA0                     A  6010    L_332:
011BA0 CD 97 0D 01         A  6011    	CALL	_do_crt
011BA4 C3 D3 19 01         A  6012    	JR	L_343
                           A  6013    ; 1435							case	0x6B: d
011BA8                     A  6014    L_333:
011BA8 CD 15 0D 01         A  6015    	CALL	_do_clf
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 119


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011BAC C3 D3 19 01         A  6016    	JR	L_343
                           A  6017    ; 1436							case	0x75: d
011BB0                     A  6018    L_334:
011BB0 CD F5 0B 01         A  6019    	CALL	_do_cup
011BB4 C3 D3 19 01         A  6020    	JR	L_343
                           A  6021    ; 1437							case	0x72: d
011BB8                     A  6022    L_335:
011BB8 CD 84 0C 01         A  6023    	CALL	_do_cdw
011BBC C3 D3 19 01         A  6024    	JR	L_343
                           A  6025    ; 1438							case	0x6C: d
011BC0                     A  6026    L_336:
011BC0 CD 77 15 01         A  6027    	CALL	_do_home
011BC4 C3 D3 19 01         A  6028    	JR	L_343
                           A  6029    ; 1439							case	0x69: d
011BC8                     A  6030    L_337:
011BC8 CD E1 15 01         A  6031    	CALL	_do_endline
011BCC C3 D3 19 01         A  6032    	JR	L_343
                           A  6033    ; 1440							case	0x70: d
011BD0                     A  6034    L_338:
011BD0 CD 65 16 01         A  6035    	CALL	_do_ins
011BD4 C3 D3 19 01         A  6036    	JR	L_343
011BD8                     A  6037    L_329:
                           A  6038    ; 1441						}
                           A  6039    ; 1442						break;
                           A  6040    ; 1443				}
                           A  6041    ; 1444		}
                           A  6042    ; 1445		
                           A  6043    ; 1446		quit:;
                           A  6044    ; 1447	}
011BD8 DDF9                A  6045    	LD	SP,IX
011BDA DDE1                A  6046    	POP	IX
011BDC C9                  A  6047    	RET	
                           A  6048    
                           A  6049    
                           A  6050    ;**************************** _edit ***********
                           A  6051    ;Name                         Addr/Register   S
                           A  6052    ;_do_ins                             IMPORT  --
                           A  6053    ;_do_endline                         IMPORT  --
                           A  6054    ;_do_home                            IMPORT  --
                           A  6055    ;_do_cdw                             IMPORT  --
                           A  6056    ;_do_cup                             IMPORT  --
                           A  6057    ;_do_clf                             IMPORT  --
                           A  6058    ;_do_crt                             IMPORT  --
                           A  6059    ;_Scancode                           STATIC    
                           A  6060    ;_Ascii                              STATIC    
                           A  6061    ;_close_msg_window                   IMPORT  --
                           A  6062    ;_getch                              IMPORT  --
                           A  6063    ;_msg_window                         IMPORT  --
                           A  6064    ;_do_top                             IMPORT  --
                           A  6065    ;_save_file                          IMPORT  --
                           A  6066    ;_reload_file                        IMPORT  --
                           A  6067    ;_do_red                             IMPORT  --
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 120


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  6068    ;_do_ret                             IMPORT  --
                           A  6069    ;_do_iln                             IMPORT  --
                           A  6070    ;_do_dln                             IMPORT  --
                           A  6071    ;_do_tab                             IMPORT  --
                           A  6072    ;_do_del                             IMPORT  --
                           A  6073    ;_do_pdw                             IMPORT  --
                           A  6074    ;_do_bot                             IMPORT  --
                           A  6075    ;_do_dch                             IMPORT  --
                           A  6076    ;_do_pup                             IMPORT  --
                           A  6077    ;_do_enhanced_ret                    IMPORT  --
                           A  6078    ;_do_chr                             IMPORT  --
                           A  6079    ;_te_gch                             IMPORT  --
                           A  6080    ;_Show_Cursor                        IMPORT  --
                           A  6081    ;_te_mov                             IMPORT  --
                           A  6082    ;_Show_Cursor_Position               IMPORT  --
                           A  6083    ;_sc_upd                             IMPORT  --
                           A  6084    ;_ShowInsertMode                     IMPORT  --
                           A  6085    ;_sc_fup                             IMPORT  --
                           A  6086    ;_paintall                           IMPORT  --
                           A  6087    ;_p_curr                             STATIC    
                           A  6088    ;_p_root                             STATIC    
                           A  6089    ;_InsertMode                         STATIC    
                           A  6090    ;_cur_char                           STATIC    
                           A  6091    ;_cur_line                           STATIC    
                           A  6092    ;_cur_col                            STATIC    
                           A  6093    ;_cur_row                            STATIC    
                           A  6094    ;ch                                    IX-1    
                           A  6095    
                           A  6096    
                           A  6097    ; Stack Frame Size: 7 (bytes)
                           A  6098    ;       Spill Code: 0 (instruction)
                           A  6099    
                           A  6100    
                           A  6101    	SEGMENT STRSECT
012B15                     A  6102    L__243:
012B15 592F6E              A  6103    	DB	"Y/n"
012B18 00                  A  6104    	DB	0
012B19                     A  6105    L__244:
012B19 51756974 20746F20   A  6106    	DB	"Quit to PROSE ?"
012B21 50524F53 45203F 
012B28 00                  A  6107    	DB	0
                           A  6108    	SEGMENT CODE
                           A  6109    ; 1448	
                           A  6110    ; 1449	/* Draw on screen the cursor position *
                           A  6111    ; 1450	void Show_Cursor_Position(void)
                           A  6112    ; 1451	{
011BDD                     A  6113    _Show_Cursor_Position:
                           A  6114    ; 1452		Enable_Back_Color();
011BDD CD 74 19 01         A  6115    	CALL	_Enable_Back_Color
                           A  6116    ; 1453		
                           A  6117    ; 1454		uitoa(cur_line, convBuf);
011BE1 01 98 55 01         A  6118    	LD	BC,_convBuf
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 121


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011BE5 C5                  A  6119    	PUSH	BC
011BE6 ED4B 19 55 01       A  6120    	LD	BC,(_cur_line)
011BEB C5                  A  6121    	PUSH	BC
011BEC CD 94 03 01         A  6122    	CALL	_uitoa
011BF0 C1                  A  6123    	POP	BC
011BF1 C1                  A  6124    	POP	BC
                           A  6125    ; 1455		
                           A  6126    ; 1456		gotoxy(5, 51);
011BF2 01330000            A  6127    	LD	BC,51
011BF6 C5                  A  6128    	PUSH	BC
011BF7 01050000            A  6129    	LD	BC,5
011BFB C5                  A  6130    	PUSH	BC
011BFC CD FF 02 01         A  6131    	CALL	_gotoxy
011C00 C1                  A  6132    	POP	BC
011C01 C1                  A  6133    	POP	BC
                           A  6134    ; 1457		
                           A  6135    ; 1458		print("      ");
011C02 01 29 2B 01         A  6136    	LD	BC,L__258
011C06 C5                  A  6137    	PUSH	BC
011C07 CD 36 02 01         A  6138    	CALL	_print
011C0B C1                  A  6139    	POP	BC
                           A  6140    ; 1459		
                           A  6141    ; 1460		gotoxy(5, 51);
011C0C 01330000            A  6142    	LD	BC,51
011C10 C5                  A  6143    	PUSH	BC
011C11 01050000            A  6144    	LD	BC,5
011C15 C5                  A  6145    	PUSH	BC
011C16 CD FF 02 01         A  6146    	CALL	_gotoxy
011C1A C1                  A  6147    	POP	BC
011C1B C1                  A  6148    	POP	BC
                           A  6149    ; 1461		
                           A  6150    ; 1462		print(convBuf);	
011C1C 01 98 55 01         A  6151    	LD	BC,_convBuf
011C20 C5                  A  6152    	PUSH	BC
011C21 CD 36 02 01         A  6153    	CALL	_print
011C25 C1                  A  6154    	POP	BC
                           A  6155    ; 1463		
                           A  6156    ; 1464		uitoa(cur_col + 1, convBuf);
011C26 01 98 55 01         A  6157    	LD	BC,_convBuf
011C2A C5                  A  6158    	PUSH	BC
011C2B ED4B 22 55 01       A  6159    	LD	BC,(_cur_col)
011C30 03                  A  6160    	INC	BC
011C31 C5                  A  6161    	PUSH	BC
011C32 CD 94 03 01         A  6162    	CALL	_uitoa
011C36 C1                  A  6163    	POP	BC
011C37 C1                  A  6164    	POP	BC
                           A  6165    ; 1465		
                           A  6166    ; 1466		gotoxy(18, 51);
011C38 01330000            A  6167    	LD	BC,51
011C3C C5                  A  6168    	PUSH	BC
011C3D 01120000            A  6169    	LD	BC,18
011C41 C5                  A  6170    	PUSH	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 122


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011C42 CD FF 02 01         A  6171    	CALL	_gotoxy
011C46 C1                  A  6172    	POP	BC
011C47 C1                  A  6173    	POP	BC
                           A  6174    ; 1467		
                           A  6175    ; 1468		print("         ");
011C48 01 30 2B 01         A  6176    	LD	BC,L__259
011C4C C5                  A  6177    	PUSH	BC
011C4D CD 36 02 01         A  6178    	CALL	_print
011C51 C1                  A  6179    	POP	BC
                           A  6180    ; 1469		
                           A  6181    ; 1470		gotoxy(18, 51);
011C52 01330000            A  6182    	LD	BC,51
011C56 C5                  A  6183    	PUSH	BC
011C57 01120000            A  6184    	LD	BC,18
011C5B C5                  A  6185    	PUSH	BC
011C5C CD FF 02 01         A  6186    	CALL	_gotoxy
011C60 C1                  A  6187    	POP	BC
011C61 C1                  A  6188    	POP	BC
                           A  6189    ; 1471		
                           A  6190    ; 1472		print(convBuf);	
011C62 01 98 55 01         A  6191    	LD	BC,_convBuf
011C66 C5                  A  6192    	PUSH	BC
011C67 CD 36 02 01         A  6193    	CALL	_print
011C6B C1                  A  6194    	POP	BC
                           A  6195    ; 1473		
                           A  6196    ; 1474		Disable_Back_Color();
011C6C CD 82 19 01         A  6197    	CALL	_Disable_Back_Color
                           A  6198    ; 1475	}
011C70 C9                  A  6199    	RET	
                           A  6200    
                           A  6201    
                           A  6202    ;**************************** _Show_Cursor_Posi
                           A  6203    ;Name                         Addr/Register   S
                           A  6204    ;_Disable_Back_Color                 IMPORT  --
                           A  6205    ;_cur_col                            STATIC    
                           A  6206    ;_print                              IMPORT  --
                           A  6207    ;_gotoxy                             IMPORT  --
                           A  6208    ;_cur_line                           STATIC    
                           A  6209    ;_convBuf                            STATIC    
                           A  6210    ;_uitoa                              IMPORT  --
                           A  6211    ;_Enable_Back_Color                  IMPORT  --
                           A  6212    
                           A  6213    
                           A  6214    ; Stack Frame Size: 6 (bytes)
                           A  6215    ;       Spill Code: 0 (instruction)
                           A  6216    
                           A  6217    
                           A  6218    	SEGMENT STRSECT
012B29                     A  6219    L__258:
012B29 20202020 2020       A  6220    	DB	"      "
012B2F 00                  A  6221    	DB	0
012B30                     A  6222    L__259:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 123


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
012B30 20202020 20202020   A  6223    	DB	"         "
012B38 20 
012B39 00                  A  6224    	DB	0
                           A  6225    	SEGMENT CODE
                           A  6226    ; 1476	
                           A  6227    ; 1477	/* Return 1 if the filename passed as p
                           A  6228    ; 1478	char FileExists(void)
                           A  6229    ; 1479	{
011C71                     A  6230    _FileExists:
011C71 21FFFFFF            A  6231    	LD	HL,-1
011C75 CD 57 25 01         A  6232    	CALL	__frameset
                           A  6233    ; 1480		char ret;
                           A  6234    ; 1481		
                           A  6235    ; 1482		ret = 0;
011C79 DD36FF00            A  6236    	LD	(IX+-1),0
                           A  6237    ; 1483		
                           A  6238    ; 1484		asm ("push ix");
011C7D DDE5                A  6239    push ix
                           A  6240    ; 1485		asm ("ld hl, (_K_xHL)");
011C7F 2A 85 55 01         A  6241    ld hl, (_K_xHL)
                           A  6242    ; 1486		asm ("ld a, kr_find_file");
011C83 3E0B                A  6243    ld a, kr_find_file
                           A  6244    ; 1487		asm ("call.lil prose_kernal");
011C85 5BCD200A 00         A  6245    call.lil prose_kernal
                           A  6246    ; 1488		asm ("pop ix");	
011C8A DDE1                A  6247    pop ix
                           A  6248    ; 1489		asm ("jr nz, FindError");
011C8C 20 04               A  6249    jr nz, FindError
                           A  6250    ; 1490		
                           A  6251    ; 1491		ret = 1;
011C8E DD36FF01            A  6252    	LD	(IX+-1),1
                           A  6253    ; 1492		
                           A  6254    ; 1493		asm ("FindError:");
011C92                     A  6255    FindError:
                           A  6256    ; 1494		
                           A  6257    ; 1495		return ret;
011C92 DD7EFF              A  6258    	LD	A,(IX+-1)
                           A  6259    ; 1496	}
011C95 DDF9                A  6260    	LD	SP,IX
011C97 DDE1                A  6261    	POP	IX
011C99 C9                  A  6262    	RET	
                           A  6263    
                           A  6264    
                           A  6265    ;**************************** _FileExists *****
                           A  6266    ;Name                         Addr/Register   S
                           A  6267    ;ret                                   IX-1    
                           A  6268    
                           A  6269    
                           A  6270    ; Stack Frame Size: 7 (bytes)
                           A  6271    ;       Spill Code: 0 (instruction)
                           A  6272    
                           A  6273    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 124


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  6274    ; 1497	
                           A  6275    ; 1498	/* Load file into Video Ram B, after bu
                           A  6276    ; 1499	void load_file(void)
                           A  6277    ; 1500	{
011C9A                     A  6278    _load_file:
011C9A 21F8FFFF            A  6279    	LD	HL,-8
011C9E CD 57 25 01         A  6280    	CALL	__frameset
                           A  6281    ; 1501		register unsigned int i;
                           A  6282    ; 1502		char pos = 0, len;
011CA2 DD36FF00            A  6283    	LD	(IX+-1),0
                           A  6284    ; 1503		
                           A  6285    ; 1504		msg_window("Loading file", "Please 
011CA6 01 3A 2B 01         A  6286    	LD	BC,L__262
011CAA C5                  A  6287    	PUSH	BC
011CAB 01 49 2B 01         A  6288    	LD	BC,L__263
011CAF C5                  A  6289    	PUSH	BC
011CB0 CD 70 20 01         A  6290    	CALL	_msg_window
011CB4 C1                  A  6291    	POP	BC
011CB5 C1                  A  6292    	POP	BC
                           A  6293    ; 1505		
                           A  6294    ; 1506		asm ("push ix");
011CB6 DDE5                A  6295    push ix
                           A  6296    ; 1507		asm ("ld hl, (_K_xHL)");
011CB8 2A 85 55 01         A  6297    ld hl, (_K_xHL)
                           A  6298    ; 1508		asm ("ld a, kr_find_file");
011CBC 3E0B                A  6299    ld a, kr_find_file
                           A  6300    ; 1509		asm ("call.lil prose_kernal");
011CBE 5BCD200A 00         A  6301    call.lil prose_kernal
                           A  6302    ; 1510		asm ("pop ix");	
011CC3 DDE1                A  6303    pop ix
                           A  6304    ; 1511		asm ("jr nz, LoadError");
011CC5 C2 74 1E 01         A  6305    jr nz, LoadError
                           A  6306    ; 1512		asm ("ld (_filesize), de");
011CC9 ED53 8B 55 01       A  6307    ld (_filesize), de
                           A  6308    ; 1513		
                           A  6309    ; 1514		asm ("push ix");
011CCE DDE5                A  6310    push ix
                           A  6311    ; 1515		asm ("ld de, (_filesize)");
011CD0 ED5B 8B 55 01       A  6312    ld de, (_filesize)
                           A  6313    ; 1516		asm ("ld a, kr_set_load_length");
011CD5 3E0D                A  6314    ld a, kr_set_load_length
                           A  6315    ; 1517		asm ("call.lil prose_kernal");
011CD7 5BCD200A 00         A  6316    call.lil prose_kernal
                           A  6317    ; 1518		asm ("pop ix");
011CDC DDE1                A  6318    pop ix
                           A  6319    ; 1519		
                           A  6320    ; 1520		asm ("push ix");
011CDE DDE5                A  6321    push ix
                           A  6322    ; 1521		asm ("ld hl, (_BufferFile)");
011CE0 2A A3 55 01         A  6323    ld hl, (_BufferFile)
                           A  6324    ; 1522		asm ("ld a, kr_read_file");
011CE4 3E0E                A  6325    ld a, kr_read_file
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 125


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  6326    ; 1523		asm ("call.lil prose_kernal");
011CE6 5BCD200A 00         A  6327    call.lil prose_kernal
                           A  6328    ; 1524		asm ("jr nz, LoadError");
011CEB C2 74 1E 01         A  6329    jr nz, LoadError
                           A  6330    ; 1525		asm ("pop ix");
011CEF DDE1                A  6331    pop ix
                           A  6332    ; 1526		
                           A  6333    ; 1527		memset(linbuf, 0, sizeof(linbuf));
011CF1 015A0000            A  6334    	LD	BC,90
011CF5 C5                  A  6335    	PUSH	BC
011CF6 01000000            A  6336    	LD	BC,0
011CFA C5                  A  6337    	PUSH	BC
011CFB 01 25 55 01         A  6338    	LD	BC,_linbuf
011CFF C5                  A  6339    	PUSH	BC
011D00 CD 15 26 01         A  6340    	CALL	_memset
                           A  6341    ; 1528		
                           A  6342    ; 1529		linbuf[0] = EOS;
011D04 AF                  A  6343    	XOR	A,A
011D05 32 25 55 01         A  6344    	LD	(_linbuf),A
                           A  6345    ; 1530		i = 0;	
011D09 11000000            A  6346    	LD	DE,0
011D0D C1                  A  6347    	POP	BC
011D0E C1                  A  6348    	POP	BC
011D0F C1                  A  6349    	POP	BC
011D10 DD1FFC              A  6350    	LD	(IX+-4),DE
                           A  6351    ; 1531		
                           A  6352    ; 1532		while (i <= filesize)
011D13 C3 62 1E 01         A  6353    	JR	L_361
011D17                     A  6354    L_362:
                           A  6355    ; 1533		{
                           A  6356    ; 1534			if (pos < MAXLNLEN - 1)
011D17 DD7EFF              A  6357    	LD	A,(IX+-1)
011D1A FE4F                A  6358    	CP	A,79
011D1C F2 26 1D 01         A  6359    	JP	P,L__273
011D20 EA F5 1D 01         A  6360    	JP	PE,L_360
011D24 18 04               A  6361    	JR	L__274
011D26                     A  6362    L__273:
011D26 E2 F5 1D 01         A  6363    	JP	PO,L_360
011D2A                     A  6364    L__274:
                           A  6365    ; 1535			{
                           A  6366    ; 1536				linbuf[pos] = BufferFile[i]
011D2A DD7EFF              A  6367    	LD	A,(IX+-1)
011D2D 17ED62              A  6368    	SEXT	HL
011D30 DD6EFF              A  6369    	LD	L,(IX+-1)
011D33 01 25 55 01         A  6370    	LD	BC,_linbuf
011D37 09                  A  6371    	ADD	HL,BC
011D38 DD2FF8              A  6372    	LD	(IX+-8),HL
011D3B DD07FC              A  6373    	LD	BC,(IX+-4)
011D3E 2A A3 55 01         A  6374    	LD	HL,(_BufferFile)
011D42 09                  A  6375    	ADD	HL,BC
011D43 7E                  A  6376    	LD	A,(HL)
011D44 DD27F8              A  6377    	LD	HL,(IX+-8)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 126


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011D47 77                  A  6378    	LD	(HL),A
                           A  6379    ; 1537				
                           A  6380    ; 1538				if ((linbuf[pos] == EOL) ||
011D48 DD27F8              A  6381    	LD	HL,(IX+-8)
011D4B 7E                  A  6382    	LD	A,(HL)
011D4C 47                  A  6383    	LD	B,A
011D4D 17ED62              A  6384    	SEXT	HL
011D50 68                  A  6385    	LD	L,B
011D51 B7                  A  6386    	OR	A,A
011D52 010A0000            A  6387    	LD	BC,10
011D56 ED42                A  6388    	SBC	HL,BC
011D58 28 0E               A  6389    	JR	Z,L_353
011D5A DD07FC              A  6390    	LD	BC,(IX+-4)
011D5D 2A 8B 55 01         A  6391    	LD	HL,(_filesize)
011D61 B7                  A  6392    	OR	A,A
011D62 ED42                A  6393    	SBC	HL,BC
011D64 C2 E9 1D 01         A  6394    	JR	NZ,L_354
011D68                     A  6395    L_353:
                           A  6396    ; 1539				{
                           A  6397    ; 1540					len = strlen(linbuf);
011D68 01 25 55 01         A  6398    	LD	BC,_linbuf
011D6C C5                  A  6399    	PUSH	BC
011D6D CD 14 25 01         A  6400    	CALL	_strlen
011D71 C1                  A  6401    	POP	BC
011D72 DD75FB              A  6402    	LD	(IX+-5),L
                           A  6403    ; 1541					
                           A  6404    ; 1542					if (linbuf[pos] == EOL)
011D75 DD7EFF              A  6405    	LD	A,(IX+-1)
011D78 17ED62              A  6406    	SEXT	HL
011D7B DD6EFF              A  6407    	LD	L,(IX+-1)
011D7E 01 25 55 01         A  6408    	LD	BC,_linbuf
011D82 09                  A  6409    	ADD	HL,BC
011D83 7E                  A  6410    	LD	A,(HL)
011D84 47                  A  6411    	LD	B,A
011D85 17ED62              A  6412    	SEXT	HL
011D88 68                  A  6413    	LD	L,B
011D89 B7                  A  6414    	OR	A,A
011D8A 010A0000            A  6415    	LD	BC,10
011D8E ED42                A  6416    	SBC	HL,BC
011D90 20 13               A  6417    	JR	NZ,L_350
                           A  6418    ; 1543						linbuf[len - 1] = E
011D92 DD7EFB              A  6419    	LD	A,(IX+-5)
011D95 17ED62              A  6420    	SEXT	HL
011D98 DD6EFB              A  6421    	LD	L,(IX+-5)
011D9B 2B                  A  6422    	DEC	HL
011D9C 01 25 55 01         A  6423    	LD	BC,_linbuf
011DA0 09                  A  6424    	ADD	HL,BC
011DA1 3600                A  6425    	LD	(HL),0
                           A  6426    ; 1544					else
011DA3 18 11               A  6427    	JR	L_351
011DA5                     A  6428    L_350:
                           A  6429    ; 1545						linbuf[pos + 1] = E
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 127


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011DA5 DD7EFF              A  6430    	LD	A,(IX+-1)
011DA8 17ED62              A  6431    	SEXT	HL
011DAB DD6EFF              A  6432    	LD	L,(IX+-1)
011DAE 23                  A  6433    	INC	HL
011DAF 01 25 55 01         A  6434    	LD	BC,_linbuf
011DB3 09                  A  6435    	ADD	HL,BC
011DB4 3600                A  6436    	LD	(HL),0
011DB6                     A  6437    L_351:
                           A  6438    ; 1546					
                           A  6439    ; 1547					purify(linbuf);
011DB6 C5                  A  6440    	PUSH	BC
011DB7 CD 45 05 01         A  6441    	CALL	_purify
011DBB C1                  A  6442    	POP	BC
                           A  6443    ; 1548						
                           A  6444    ; 1549					tx_ins(p_root, linbuf);
011DBC 01 25 55 01         A  6445    	LD	BC,_linbuf
011DC0 C5                  A  6446    	PUSH	BC
011DC1 ED4B 10 55 01       A  6447    	LD	BC,(_p_root)
011DC6 C5                  A  6448    	PUSH	BC
011DC7 CD 94 0A 01         A  6449    	CALL	_tx_ins
011DCB C1                  A  6450    	POP	BC
011DCC C1                  A  6451    	POP	BC
                           A  6452    ; 1550				
                           A  6453    ; 1551					pos = 0;
011DCD DD36FF00            A  6454    	LD	(IX+-1),0
                           A  6455    ; 1552					memset(linbuf, 0, sizeo
011DD1 015A0000            A  6456    	LD	BC,90
011DD5 C5                  A  6457    	PUSH	BC
011DD6 01000000            A  6458    	LD	BC,0
011DDA C5                  A  6459    	PUSH	BC
011DDB 01 25 55 01         A  6460    	LD	BC,_linbuf
011DDF C5                  A  6461    	PUSH	BC
011DE0 CD 15 26 01         A  6462    	CALL	_memset
011DE4 C1                  A  6463    	POP	BC
011DE5 C1                  A  6464    	POP	BC
011DE6 C1                  A  6465    	POP	BC
                           A  6466    ; 1553				}
                           A  6467    ; 1554				else
011DE7 18 03               A  6468    	JR	L_356
011DE9                     A  6469    L_354:
                           A  6470    ; 1555					pos++;
011DE9 DD34FF              A  6471    	INC	(IX+-1)
011DEC                     A  6472    L_356:
                           A  6473    ; 1556				
                           A  6474    ; 1557				i++;
011DEC DD07FC              A  6475    	LD	BC,(IX+-4)
011DEF 03                  A  6476    	INC	BC
011DF0 DD0FFC              A  6477    	LD	(IX+-4),BC
                           A  6478    ; 1558			}
                           A  6479    ; 1559			else
011DF3 18 6D               A  6480    	JR	L_361
011DF5                     A  6481    L_360:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 128


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  6482    ; 1560			{
                           A  6483    ; 1561				purify(linbuf);
011DF5 01 25 55 01         A  6484    	LD	BC,_linbuf
011DF9 C5                  A  6485    	PUSH	BC
011DFA CD 45 05 01         A  6486    	CALL	_purify
011DFE C1                  A  6487    	POP	BC
                           A  6488    ; 1562				
                           A  6489    ; 1563				tx_ins(p_root, linbuf);
011DFF 01 25 55 01         A  6490    	LD	BC,_linbuf
011E03 C5                  A  6491    	PUSH	BC
011E04 ED4B 10 55 01       A  6492    	LD	BC,(_p_root)
011E09 C5                  A  6493    	PUSH	BC
011E0A CD 94 0A 01         A  6494    	CALL	_tx_ins
011E0E C1                  A  6495    	POP	BC
011E0F C1                  A  6496    	POP	BC
                           A  6497    ; 1564				
                           A  6498    ; 1565				pos = 0;
011E10 DD36FF00            A  6499    	LD	(IX+-1),0
                           A  6500    ; 1566				memset(linbuf, 0, sizeof(li
011E14 015A0000            A  6501    	LD	BC,90
011E18 C5                  A  6502    	PUSH	BC
011E19 01000000            A  6503    	LD	BC,0
011E1D C5                  A  6504    	PUSH	BC
011E1E 01 25 55 01         A  6505    	LD	BC,_linbuf
011E22 C5                  A  6506    	PUSH	BC
011E23 CD 15 26 01         A  6507    	CALL	_memset
011E27 C1                  A  6508    	POP	BC
011E28 C1                  A  6509    	POP	BC
011E29 C1                  A  6510    	POP	BC
                           A  6511    ; 1567				
                           A  6512    ; 1568				if ((BufferFile[i] == 0x0D)
011E2A DD07FC              A  6513    	LD	BC,(IX+-4)
011E2D 2A A3 55 01         A  6514    	LD	HL,(_BufferFile)
011E31 09                  A  6515    	ADD	HL,BC
011E32 7E                  A  6516    	LD	A,(HL)
011E33 47                  A  6517    	LD	B,A
011E34 17ED62              A  6518    	SEXT	HL
011E37 68                  A  6519    	LD	L,B
011E38 B7                  A  6520    	OR	A,A
011E39 010D0000            A  6521    	LD	BC,13
011E3D ED42                A  6522    	SBC	HL,BC
011E3F 20 21               A  6523    	JR	NZ,L_361
011E41 DD07FC              A  6524    	LD	BC,(IX+-4)
011E44 03                  A  6525    	INC	BC
011E45 2A A3 55 01         A  6526    	LD	HL,(_BufferFile)
011E49 09                  A  6527    	ADD	HL,BC
011E4A 7E                  A  6528    	LD	A,(HL)
011E4B 47                  A  6529    	LD	B,A
011E4C 17ED62              A  6530    	SEXT	HL
011E4F 68                  A  6531    	LD	L,B
011E50 B7                  A  6532    	OR	A,A
011E51 010A0000            A  6533    	LD	BC,10
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 129


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011E55 ED42                A  6534    	SBC	HL,BC
011E57 20 09               A  6535    	JR	NZ,L_361
                           A  6536    ; 1569					i += 2;
011E59 DD31FC              A  6537    	LD	IY,(IX+-4)
011E5C ED3302              A  6538    	LEA	IY,IY+2
011E5F DD3EFC              A  6539    	LD	(IX+-4),IY
                           A  6540    ; 1570			}
                           A  6541    ; 1571		}	
011E62                     A  6542    L_361:
011E62 DD07FC              A  6543    	LD	BC,(IX+-4)
011E65 2A 8B 55 01         A  6544    	LD	HL,(_filesize)
011E69 B7                  A  6545    	OR	A,A
011E6A ED42                A  6546    	SBC	HL,BC
011E6C D2 17 1D 01         A  6547    	JR	NC,L_362
                           A  6548    ; 1572		
                           A  6549    ; 1573		asm ("jp f_end");
011E70 C3 88 1E 01         A  6550    jp f_end
                           A  6551    ; 1574		
                           A  6552    ; 1575		asm ("LoadError:");
011E74                     A  6553    LoadError:
                           A  6554    ; 1576		msg_window("Loading file", "File er
011E74 01 56 2B 01         A  6555    	LD	BC,L__271
011E78 C5                  A  6556    	PUSH	BC
011E79 01 62 2B 01         A  6557    	LD	BC,L__272
011E7D C5                  A  6558    	PUSH	BC
011E7E CD 70 20 01         A  6559    	CALL	_msg_window
011E82 C1                  A  6560    	POP	BC
011E83 C1                  A  6561    	POP	BC
                           A  6562    ; 1577		getch();	
011E84 CD 29 01 01         A  6563    	CALL	_getch
                           A  6564    ; 1578		
                           A  6565    ; 1579		asm ("f_end:");
011E88                     A  6566    f_end:
                           A  6567    ; 1580		
                           A  6568    ; 1581		close_msg_window();
011E88 CD 94 22 01         A  6569    	CALL	_close_msg_window
                           A  6570    ; 1582	}
011E8C DDF9                A  6571    	LD	SP,IX
011E8E DDE1                A  6572    	POP	IX
011E90 C9                  A  6573    	RET	
                           A  6574    
                           A  6575    
                           A  6576    ;**************************** _load_file ******
                           A  6577    ;Name                         Addr/Register   S
                           A  6578    ;_close_msg_window                   IMPORT  --
                           A  6579    ;_getch                              IMPORT  --
                           A  6580    ;_p_root                             STATIC    
                           A  6581    ;_tx_ins                             IMPORT  --
                           A  6582    ;_purify                             IMPORT  --
                           A  6583    ;_strlen                             IMPORT  --
                           A  6584    ;_filesize                           STATIC    
                           A  6585    ;_BufferFile                         STATIC    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 130


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  6586    ;_linbuf                             STATIC    
                           A  6587    ;_memset                             IMPORT  --
                           A  6588    ;_msg_window                         IMPORT  --
                           A  6589    ;len                                   IX-5    
                           A  6590    ;i                                     IX-4    
                           A  6591    ;pos                                   IX-1    
                           A  6592    
                           A  6593    
                           A  6594    ; Stack Frame Size: 14 (bytes)
                           A  6595    ;       Spill Code: 0 (instruction)
                           A  6596    
                           A  6597    
                           A  6598    	SEGMENT STRSECT
012B3A                     A  6599    L__262:
012B3A 506C6561 73652077   A  6600    	DB	"Please wait..."
012B42 6169742E 2E2E 
012B48 00                  A  6601    	DB	0
012B49                     A  6602    L__263:
012B49 4C6F6164 696E6720   A  6603    	DB	"Loading file"
012B51 66696C65 
012B55 00                  A  6604    	DB	0
012B56                     A  6605    L__271:
012B56 46696C65 20657272   A  6606    	DB	"File error!"
012B5E 6F7221 
012B61 00                  A  6607    	DB	0
012B62                     A  6608    L__272:
012B62 4C6F6164 696E6720   A  6609    	DB	"Loading file"
012B6A 66696C65 
012B6E 00                  A  6610    	DB	0
                           A  6611    	SEGMENT CODE
                           A  6612    ; 1583	
                           A  6613    ; 1584	/* From text list create the file into 
                           A  6614    ; 1585	void save_file(void)
                           A  6615    ; 1586	{
011E91                     A  6616    _save_file:
011E91 21FAFFFF            A  6617    	LD	HL,-6
011E95 CD 57 25 01         A  6618    	CALL	__frameset
                           A  6619    ; 1587		p_line_t p_line = p_root->p_next;
011E99 FD2A 10 55 01       A  6620    	LD	IY,(_p_root)
011E9E FD0703              A  6621    	LD	BC,(IY+3)
011EA1 DD0FFD              A  6622    	LD	(IX+-3),BC
                           A  6623    ; 1588		int slen;	
                           A  6624    ; 1589		
                           A  6625    ; 1590		
                           A  6626    ; 1591		if (UseFile == 0)
011EA4 3A 97 55 01         A  6627    	LD	A,(_UseFile)
011EA8 B7                  A  6628    	OR	A,A
011EA9 20 1B               A  6629    	JR	NZ,L_366
                           A  6630    ; 1592		{
                           A  6631    ; 1593			asm ("ld hl, (_NonameFile)");
011EAB 2A A6 55 01         A  6632    ld hl, (_NonameFile)
                           A  6633    ; 1594			asm ("ld (_K_xHL), hl");
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 131


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011EAF 22 85 55 01         A  6634    ld (_K_xHL), hl
                           A  6635    ; 1595			
                           A  6636    ; 1596			msg_window("Please wait, saving
011EB3 ED4B A6 55 01       A  6637    	LD	BC,(_NonameFile)
011EB8 C5                  A  6638    	PUSH	BC
011EB9 01 6F 2B 01         A  6639    	LD	BC,L__277
011EBD C5                  A  6640    	PUSH	BC
011EBE CD 70 20 01         A  6641    	CALL	_msg_window
011EC2 C1                  A  6642    	POP	BC
011EC3 C1                  A  6643    	POP	BC
                           A  6644    ; 1597		}
                           A  6645    ; 1598		else
011EC4 18 10               A  6646    	JR	L_367
011EC6                     A  6647    L_366:
                           A  6648    ; 1599			msg_window("Saving file", "Plea
011EC6 01 83 2B 01         A  6649    	LD	BC,L__278
011ECA C5                  A  6650    	PUSH	BC
011ECB 01 92 2B 01         A  6651    	LD	BC,L__279
011ECF C5                  A  6652    	PUSH	BC
011ED0 CD 70 20 01         A  6653    	CALL	_msg_window
011ED4 C1                  A  6654    	POP	BC
011ED5 C1                  A  6655    	POP	BC
011ED6                     A  6656    L_367:
                           A  6657    ; 1600		
                           A  6658    ; 1601		asm ("push ix");
011ED6 DDE5                A  6659    push ix
                           A  6660    ; 1602		asm ("ld hl, (_K_xHL)");
011ED8 2A 85 55 01         A  6661    ld hl, (_K_xHL)
                           A  6662    ; 1603		asm ("ld a, kr_erase_file");
011EDC 3E0F                A  6663    ld a, kr_erase_file
                           A  6664    ; 1604		asm ("call.lil prose_kernal");
011EDE 5BCD200A 00         A  6665    call.lil prose_kernal
                           A  6666    ; 1605		asm ("pop ix");	
011EE3 DDE1                A  6667    pop ix
                           A  6668    ; 1606		
                           A  6669    ; 1607		asm ("push ix");
011EE5 DDE5                A  6670    push ix
                           A  6671    ; 1608		asm ("ld hl, (_K_xHL)");
011EE7 2A 85 55 01         A  6672    ld hl, (_K_xHL)
                           A  6673    ; 1609		asm ("ld a, kr_create_file");
011EEB 3E11                A  6674    ld a, kr_create_file
                           A  6675    ; 1610		asm ("call.lil prose_kernal");
011EED 5BCD200A 00         A  6676    call.lil prose_kernal
                           A  6677    ; 1611		asm ("pop ix");
011EF2 DDE1                A  6678    pop ix
                           A  6679    ; 1612		asm ("jr nz, SaveError");	
011EF4 C2 AC 1F 01         A  6680    jr nz, SaveError
                           A  6681    ; 1613		
                           A  6682    ; 1614		filesize = 0;	
011EF8 01000000            A  6683    	LD	BC,0
011EFC ED43 8B 55 01       A  6684    	LD	(_filesize),BC
                           A  6685    ; 1615		
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 132


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  6686    ; 1616		while (p_line != p_root)
011F01 18 73               A  6687    	JR	L_370
011F03                     A  6688    L_371:
                           A  6689    ; 1617		{
                           A  6690    ; 1618			slen = strlen(p_line->p_data);
011F03 DD31FD              A  6691    	LD	IY,(IX+-3)
011F06 FD0706              A  6692    	LD	BC,(IY+6)
011F09 C5                  A  6693    	PUSH	BC
011F0A CD 14 25 01         A  6694    	CALL	_strlen
011F0E C1                  A  6695    	POP	BC
011F0F DD2FFA              A  6696    	LD	(IX+-6),HL
                           A  6697    ; 1619			
                           A  6698    ; 1620			if (slen > 0)
011F12 E5C1                A  6699    	LD	BC,HL
011F14 B7                  A  6700    	OR	A,A
011F15 ED62                A  6701    	SBC	HL,HL
011F17 B7                  A  6702    	OR	A,A
011F18 ED42                A  6703    	SBC	HL,BC
011F1A F2 3B 1F 01         A  6704    	JP	P,L_369
                           A  6705    ; 1621				memmove(BufferFile + filesi
011F1E DD07FA              A  6706    	LD	BC,(IX+-6)
011F21 C5                  A  6707    	PUSH	BC
011F22 DD31FD              A  6708    	LD	IY,(IX+-3)
011F25 FD0706              A  6709    	LD	BC,(IY+6)
011F28 C5                  A  6710    	PUSH	BC
011F29 ED4B 8B 55 01       A  6711    	LD	BC,(_filesize)
011F2E 2A A3 55 01         A  6712    	LD	HL,(_BufferFile)
011F32 09                  A  6713    	ADD	HL,BC
011F33 E5                  A  6714    	PUSH	HL
011F34 CD 36 26 01         A  6715    	CALL	_memmove
011F38 C1                  A  6716    	POP	BC
011F39 C1                  A  6717    	POP	BC
011F3A C1                  A  6718    	POP	BC
011F3B                     A  6719    L_369:
                           A  6720    ; 1622			
                           A  6721    ; 1623			filesize += slen;
011F3B DD07FA              A  6722    	LD	BC,(IX+-6)
011F3E 2A 8B 55 01         A  6723    	LD	HL,(_filesize)
011F42 09                  A  6724    	ADD	HL,BC
011F43 22 8B 55 01         A  6725    	LD	(_filesize),HL
                           A  6726    ; 1624			
                           A  6727    ; 1625			BufferFile[filesize] = 0x0D;
011F47 ED4B 8B 55 01       A  6728    	LD	BC,(_filesize)
011F4C 2A A3 55 01         A  6729    	LD	HL,(_BufferFile)
011F50 09                  A  6730    	ADD	HL,BC
011F51 360D                A  6731    	LD	(HL),13
                           A  6732    ; 1626			BufferFile[filesize + 1] = 0x0A
011F53 ED4B 8B 55 01       A  6733    	LD	BC,(_filesize)
011F58 03                  A  6734    	INC	BC
011F59 2A A3 55 01         A  6735    	LD	HL,(_BufferFile)
011F5D 09                  A  6736    	ADD	HL,BC
011F5E 360A                A  6737    	LD	(HL),10
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 133


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  6738    ; 1627			
                           A  6739    ; 1628			filesize += 2;
011F60 FD2A 8B 55 01       A  6740    	LD	IY,(_filesize)
011F65 ED0302              A  6741    	LEA	BC,IY+2
011F68 ED43 8B 55 01       A  6742    	LD	(_filesize),BC
                           A  6743    ; 1629			
                           A  6744    ; 1630			p_line = p_line->p_next;
011F6D DD31FD              A  6745    	LD	IY,(IX+-3)
011F70 FD0703              A  6746    	LD	BC,(IY+3)
011F73 DD0FFD              A  6747    	LD	(IX+-3),BC
                           A  6748    ; 1631		}
011F76                     A  6749    L_370:
011F76 DD07FD              A  6750    	LD	BC,(IX+-3)
011F79 2A 10 55 01         A  6751    	LD	HL,(_p_root)
011F7D B7                  A  6752    	OR	A,A
011F7E ED42                A  6753    	SBC	HL,BC
011F80 20 81               A  6754    	JR	NZ,L_371
                           A  6755    ; 1632		
                           A  6756    ; 1633		filesize -= 2;
011F82 FD2A 8B 55 01       A  6757    	LD	IY,(_filesize)
011F87 ED03FE              A  6758    	LEA	BC,IY+-2
011F8A ED43 8B 55 01       A  6759    	LD	(_filesize),BC
                           A  6760    ; 1634		
                           A  6761    ; 1635		asm ("push ix");
011F8F DDE5                A  6762    push ix
                           A  6763    ; 1636		asm ("ld hl, (_K_xHL)");
011F91 2A 85 55 01         A  6764    ld hl, (_K_xHL)
                           A  6765    ; 1637		asm ("ld de, (_BufferFile)");
011F95 ED5B A3 55 01       A  6766    ld de, (_BufferFile)
                           A  6767    ; 1638		asm ("ld bc, (_filesize)");
011F9A ED4B 8B 55 01       A  6768    ld bc, (_filesize)
                           A  6769    ; 1639		asm ("ld a, kr_write_file");
011F9F 3E12                A  6770    ld a, kr_write_file
                           A  6771    ; 1640		asm ("call.lil prose_kernal");
011FA1 5BCD200A 00         A  6772    call.lil prose_kernal
                           A  6773    ; 1641		asm ("pop ix");	
011FA6 DDE1                A  6774    pop ix
                           A  6775    ; 1642		
                           A  6776    ; 1643		asm ("jp s_end");
011FA8 C3 C0 1F 01         A  6777    jp s_end
                           A  6778    ; 1644		
                           A  6779    ; 1645		asm ("SaveError:");
011FAC                     A  6780    SaveError:
                           A  6781    ; 1646		msg_window("Saving file", "File err
011FAC 01 9E 2B 01         A  6782    	LD	BC,L__282
011FB0 C5                  A  6783    	PUSH	BC
011FB1 01 AA 2B 01         A  6784    	LD	BC,L__283
011FB5 C5                  A  6785    	PUSH	BC
011FB6 CD 70 20 01         A  6786    	CALL	_msg_window
011FBA C1                  A  6787    	POP	BC
011FBB C1                  A  6788    	POP	BC
                           A  6789    ; 1647		getch();	
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 134


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
011FBC CD 29 01 01         A  6790    	CALL	_getch
                           A  6791    ; 1648		
                           A  6792    ; 1649		asm ("s_end:");
011FC0                     A  6793    s_end:
                           A  6794    ; 1650		close_msg_window();
011FC0 CD 94 22 01         A  6795    	CALL	_close_msg_window
                           A  6796    ; 1651	}
011FC4 DDF9                A  6797    	LD	SP,IX
011FC6 DDE1                A  6798    	POP	IX
011FC8 C9                  A  6799    	RET	
                           A  6800    
                           A  6801    
                           A  6802    ;**************************** _save_file ******
                           A  6803    ;Name                         Addr/Register   S
                           A  6804    ;_close_msg_window                   IMPORT  --
                           A  6805    ;_getch                              IMPORT  --
                           A  6806    ;_BufferFile                         STATIC    
                           A  6807    ;_memmove                            IMPORT  --
                           A  6808    ;_strlen                             IMPORT  --
                           A  6809    ;_filesize                           STATIC    
                           A  6810    ;_NonameFile                         STATIC    
                           A  6811    ;_msg_window                         IMPORT  --
                           A  6812    ;_UseFile                            STATIC    
                           A  6813    ;_p_root                             STATIC    
                           A  6814    ;slen                                  IX-6    
                           A  6815    ;p_line                                IX-3    
                           A  6816    
                           A  6817    
                           A  6818    ; Stack Frame Size: 12 (bytes)
                           A  6819    ;       Spill Code: 0 (instruction)
                           A  6820    
                           A  6821    
                           A  6822    	SEGMENT STRSECT
012B6F                     A  6823    L__277:
012B6F 506C6561 73652077   A  6824    	DB	"Please wait, saving"
012B77 6169742C 20736176 
012B7F 696E67 
012B82 00                  A  6825    	DB	0
012B83                     A  6826    L__278:
012B83 506C6561 73652077   A  6827    	DB	"Please wait..."
012B8B 6169742E 2E2E 
012B91 00                  A  6828    	DB	0
012B92                     A  6829    L__279:
012B92 53617669 6E672066   A  6830    	DB	"Saving file"
012B9A 696C65 
012B9D 00                  A  6831    	DB	0
012B9E                     A  6832    L__282:
012B9E 46696C65 20657272   A  6833    	DB	"File error!"
012BA6 6F7221 
012BA9 00                  A  6834    	DB	0
012BAA                     A  6835    L__283:
012BAA 53617669 6E672066   A  6836    	DB	"Saving file"
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 135


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
012BB2 696C65 
012BB5 00                  A  6837    	DB	0
                           A  6838    	SEGMENT CODE
                           A  6839    ; 1652	
                           A  6840    ; 1653	/* Reload the file if exist */
                           A  6841    ; 1654	void reload_file(void)
                           A  6842    ; 1655	{
011FC9                     A  6843    _reload_file:
                           A  6844    ; 1656		if (UseFile == 1)
011FC9 3A 97 55 01         A  6845    	LD	A,(_UseFile)
011FCD FE01                A  6846    	CP	A,1
011FCF C2 6F 20 01         A  6847    	JR	NZ,L_379
                           A  6848    ; 1657			if (FileExists() == 1)
011FD3 CD 71 1C 01         A  6849    	CALL	_FileExists
011FD7 47                  A  6850    	LD	B,A
011FD8 17ED62              A  6851    	SEXT	HL
011FDB 68                  A  6852    	LD	L,B
011FDC B7                  A  6853    	OR	A,A
011FDD 01010000            A  6854    	LD	BC,1
011FE1 ED42                A  6855    	SBC	HL,BC
011FE3 C2 6F 20 01         A  6856    	JR	NZ,L_379
                           A  6857    ; 1658			{
                           A  6858    ; 1659				msg_window("Reload file ?",
011FE7 01 B6 2B 01         A  6859    	LD	BC,L__287
011FEB C5                  A  6860    	PUSH	BC
011FEC 01 BA 2B 01         A  6861    	LD	BC,L__288
011FF0 C5                  A  6862    	PUSH	BC
011FF1 CD 70 20 01         A  6863    	CALL	_msg_window
011FF5 C1                  A  6864    	POP	BC
011FF6 C1                  A  6865    	POP	BC
                           A  6866    ; 1660				getch();
011FF7 CD 29 01 01         A  6867    	CALL	_getch
                           A  6868    ; 1661				close_msg_window();
011FFB CD 94 22 01         A  6869    	CALL	_close_msg_window
                           A  6870    ; 1662				
                           A  6871    ; 1663				if ((Ascii != 89) && (Ascii
011FFF 3A 7F 55 01         A  6872    	LD	A,(_Ascii)
012003 FE59                A  6873    	CP	A,89
012005 28 08               A  6874    	JR	Z,L_376
012007 3A 7F 55 01         A  6875    	LD	A,(_Ascii)
01200B FE79                A  6876    	CP	A,121
01200D 20 60               A  6877    	JR	NZ,L_379
                           A  6878    ; 1664					return;
01200F                     A  6879    L_376:
                           A  6880    ; 1665				
                           A  6881    ; 1666				sc_fin();
01200F CD BA 09 01         A  6882    	CALL	_sc_fin
                           A  6883    ; 1667				te_fin();
012013 CD 4A 07 01         A  6884    	CALL	_te_fin
                           A  6885    ; 1668				
                           A  6886    ; 1669				memset(BufferFile, 0, 1024 
012017 01000008            A  6887    	LD	BC,524288
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 136


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01201B C5                  A  6888    	PUSH	BC
01201C 01000000            A  6889    	LD	BC,0
012020 C5                  A  6890    	PUSH	BC
012021 ED4B A3 55 01       A  6891    	LD	BC,(_BufferFile)
012026 C5                  A  6892    	PUSH	BC
012027 CD 15 26 01         A  6893    	CALL	_memset
01202B C1                  A  6894    	POP	BC
01202C C1                  A  6895    	POP	BC
01202D C1                  A  6896    	POP	BC
                           A  6897    ; 1670				
                           A  6898    ; 1671				te_ini();
01202E CD 40 07 01         A  6899    	CALL	_te_ini
                           A  6900    ; 1672				sc_ini();
012032 CD B1 09 01         A  6901    	CALL	_sc_ini
                           A  6902    ; 1673				tx_ini();			
012036 CD C3 09 01         A  6903    	CALL	_tx_ini
                           A  6904    ; 1674				
                           A  6905    ; 1675				load_file();
01203A CD 9A 1C 01         A  6906    	CALL	_load_file
                           A  6907    ; 1676				
                           A  6908    ; 1677				cur_row = 0;
01203E 01000000            A  6909    	LD	BC,0
012042 ED43 1F 55 01       A  6910    	LD	(_cur_row),BC
                           A  6911    ; 1678				cur_col = 0;
012047 ED43 22 55 01       A  6912    	LD	(_cur_col),BC
                           A  6913    ; 1679				cur_line = 1;
01204C 01010000            A  6914    	LD	BC,1
012050 ED43 19 55 01       A  6915    	LD	(_cur_line),BC
                           A  6916    ; 1680				cur_char = 1;
012055 ED43 1C 55 01       A  6917    	LD	(_cur_char),BC
                           A  6918    ; 1681				p_curr = p_root->p_next;	01205A FD2A 10 55 01       A  6919    	LD	IY,(_p_root)
01205F FD0703              A  6920    	LD	BC,(IY+3)
012062 ED43 13 55 01       A  6921    	LD	(_p_curr),BC
                           A  6922    ; 1682		
                           A  6923    ; 1683				paintall();
012067 CD 96 16 01         A  6924    	CALL	_paintall
                           A  6925    ; 1684		
                           A  6926    ; 1685				sc_fup();
01206B CD 96 09 01         A  6927    	CALL	_sc_fup
                           A  6928    ; 1686			}
                           A  6929    ; 1687	}
01206F                     A  6930    L_379:
01206F C9                  A  6931    	RET	
                           A  6932    
                           A  6933    
                           A  6934    ;**************************** _reload_file ****
                           A  6935    ;Name                         Addr/Register   S
                           A  6936    ;_sc_fup                             IMPORT  --
                           A  6937    ;_paintall                           IMPORT  --
                           A  6938    ;_p_curr                             STATIC    
                           A  6939    ;_p_root                             STATIC    
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 137


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  6940    ;_cur_char                           STATIC    
                           A  6941    ;_cur_line                           STATIC    
                           A  6942    ;_cur_col                            STATIC    
                           A  6943    ;_cur_row                            STATIC    
                           A  6944    ;_load_file                          IMPORT  --
                           A  6945    ;_tx_ini                             IMPORT  --
                           A  6946    ;_sc_ini                             IMPORT  --
                           A  6947    ;_te_ini                             IMPORT  --
                           A  6948    ;_BufferFile                         STATIC    
                           A  6949    ;_memset                             IMPORT  --
                           A  6950    ;_te_fin                             IMPORT  --
                           A  6951    ;_sc_fin                             IMPORT  --
                           A  6952    ;_Ascii                              STATIC    
                           A  6953    ;_close_msg_window                   IMPORT  --
                           A  6954    ;_getch                              IMPORT  --
                           A  6955    ;_msg_window                         IMPORT  --
                           A  6956    ;_FileExists                         IMPORT  --
                           A  6957    ;_UseFile                            STATIC    
                           A  6958    
                           A  6959    
                           A  6960    ; Stack Frame Size: 6 (bytes)
                           A  6961    ;       Spill Code: 0 (instruction)
                           A  6962    
                           A  6963    
                           A  6964    	SEGMENT STRSECT
012BB6                     A  6965    L__287:
012BB6 592F6E              A  6966    	DB	"Y/n"
012BB9 00                  A  6967    	DB	0
012BBA                     A  6968    L__288:
012BBA 52656C6F 61642066   A  6969    	DB	"Reload file ?"
012BC2 696C6520 3F 
012BC7 00                  A  6970    	DB	0
                           A  6971    	SEGMENT CODE
                           A  6972    ; 1688	
                           A  6973    ; 1689	/* Draw on screen the message box width
                           A  6974    ; 1690	void msg_window(char *msg1, char *msg2)
                           A  6975    ; 1691	{
012070                     A  6976    _msg_window:
012070 21FCFFFF            A  6977    	LD	HL,-4
012074 CD 57 25 01         A  6978    	CALL	__frameset
                           A  6979    ; 1692		char r, c, len, posx;
                           A  6980    ; 1693	
                           A  6981    ; 1694		memset(&backbuffer[0][0], 0, sizeof
012078 01400100            A  6982    	LD	BC,320
01207C C5                  A  6983    	PUSH	BC
01207D 01000000            A  6984    	LD	BC,0
012081 C5                  A  6985    	PUSH	BC
012082 01 C7 53 01         A  6986    	LD	BC,_backbuffer
012086 C5                  A  6987    	PUSH	BC
012087 CD 15 26 01         A  6988    	CALL	_memset
01208B C1                  A  6989    	POP	BC
01208C C1                  A  6990    	POP	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 138


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
01208D C1                  A  6991    	POP	BC
01208E DD36FE00            A  6992    	LD	(IX+-2),0
                           A  6993    ; 1695		
                           A  6994    ; 1696		for (r = 0; r < 4; r++)
012092 18 74               A  6995    	JR	L_387
012094                     A  6996    L_385:
012094 DD36FF00            A  6997    	LD	(IX+-1),0
                           A  6998    ; 1697			for (c = 0; c < SCNCOLS; c++)
012098 18 58               A  6999    	JR	L_384
01209A                     A  7000    L_382:
                           A  7001    ; 1698				backbuffer[r][c] = scn_phys
01209A DD7EFE              A  7002    	LD	A,(IX+-2)
01209D 17ED62              A  7003    	SEXT	HL
0120A0 DD6EFE              A  7004    	LD	L,(IX+-2)
0120A3 E5FDE1              A  7005    	LD	IY,HL
0120A6 ED0317              A  7006    	LEA	BC,IY+23
0120A9 C5E1                A  7007    	LD	HL,BC
0120AB 29                  A  7008    	ADD	HL,HL
0120AC 29                  A  7009    	ADD	HL,HL
0120AD 09                  A  7010    	ADD	HL,BC
0120AE 29                  A  7011    	ADD	HL,HL
0120AF 29                  A  7012    	ADD	HL,HL
0120B0 29                  A  7013    	ADD	HL,HL
0120B1 29                  A  7014    	ADD	HL,HL
0120B2 DD7EFF              A  7015    	LD	A,(IX+-1)
0120B5 01 27 44 01         A  7016    	LD	BC,_scn_phys
0120B9 09                  A  7017    	ADD	HL,BC
0120BA E5C1                A  7018    	LD	BC,HL
0120BC 17ED62              A  7019    	SEXT	HL
0120BF DD6EFF              A  7020    	LD	L,(IX+-1)
0120C2 DD7EFE              A  7021    	LD	A,(IX+-2)
0120C5 09                  A  7022    	ADD	HL,BC
0120C6 E5FDE1              A  7023    	LD	IY,HL
0120C9 17ED62              A  7024    	SEXT	HL
0120CC DD6EFE              A  7025    	LD	L,(IX+-2)
0120CF DD7EFF              A  7026    	LD	A,(IX+-1)
0120D2 E5C1                A  7027    	LD	BC,HL
0120D4 C5E1                A  7028    	LD	HL,BC
0120D6 29                  A  7029    	ADD	HL,HL
0120D7 29                  A  7030    	ADD	HL,HL
0120D8 09                  A  7031    	ADD	HL,BC
0120D9 29                  A  7032    	ADD	HL,HL
0120DA 29                  A  7033    	ADD	HL,HL
0120DB 29                  A  7034    	ADD	HL,HL
0120DC 29                  A  7035    	ADD	HL,HL
0120DD 01 C7 53 01         A  7036    	LD	BC,_backbuffer
0120E1 09                  A  7037    	ADD	HL,BC
0120E2 E5C1                A  7038    	LD	BC,HL
0120E4 17ED62              A  7039    	SEXT	HL
0120E7 DD6EFF              A  7040    	LD	L,(IX+-1)
0120EA FD7E00              A  7041    	LD	A,(IY)
0120ED 09                  A  7042    	ADD	HL,BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 139


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0120EE 77                  A  7043    	LD	(HL),A
0120EF DD34FF              A  7044    	INC	(IX+-1)
0120F2                     A  7045    L_384:
0120F2 DD7EFF              A  7046    	LD	A,(IX+-1)
0120F5 FE50                A  7047    	CP	A,80
0120F7 FA 01 21 01         A  7048    	JP	M,L__308
0120FB EA 9A 20 01         A  7049    	JP	PE,L_382
0120FF 18 04               A  7050    	JR	L__309
012101                     A  7051    L__308:
012101 E2 9A 20 01         A  7052    	JP	PO,L_382
012105                     A  7053    L__309:
012105 DD34FE              A  7054    	INC	(IX+-2)
012108                     A  7055    L_387:
012108 DD7EFE              A  7056    	LD	A,(IX+-2)
01210B FE04                A  7057    	CP	A,4
01210D FA 17 21 01         A  7058    	JP	M,L__310
012111 EA 94 20 01         A  7059    	JP	PE,L_385
012115 18 04               A  7060    	JR	L__311
012117                     A  7061    L__310:
012117 E2 94 20 01         A  7062    	JP	PO,L_385
01211B                     A  7063    L__311:
                           A  7064    ; 1699		
                           A  7065    ; 1700		Enable_Back_Color();
01211B CD 74 19 01         A  7066    	CALL	_Enable_Back_Color
                           A  7067    ; 1701		
                           A  7068    ; 1702		gotoxy(0, 23);
01211F 01170000            A  7069    	LD	BC,23
012123 C5                  A  7070    	PUSH	BC
012124 01000000            A  7071    	LD	BC,0
012128 C5                  A  7072    	PUSH	BC
012129 CD FF 02 01         A  7073    	CALL	_gotoxy
01212D C1                  A  7074    	POP	BC
01212E C1                  A  7075    	POP	BC
                           A  7076    ; 1703			
                           A  7077    ; 1704		len = strlen(msg1);
01212F DD0706              A  7078    	LD	BC,(IX+6)
012132 C5                  A  7079    	PUSH	BC
012133 CD 14 25 01         A  7080    	CALL	_strlen
012137 C1                  A  7081    	POP	BC
012138 DD75FD              A  7082    	LD	(IX+-3),L
                           A  7083    ; 1705		posx = 40 - (len / 2);
01213B DD7EFD              A  7084    	LD	A,(IX+-3)
01213E 17ED62              A  7085    	SEXT	HL
012141 DD6EFD              A  7086    	LD	L,(IX+-3)
012144 01020000            A  7087    	LD	BC,2
012148 CD C2 25 01         A  7088    	CALL	__idivs
01214C 3E28                A  7089    	LD	A,40
01214E 95                  A  7090    	SUB	A,L
01214F DD77FC              A  7091    	LD	(IX+-4),A
                           A  7092    ; 1706		
                           A  7093    ; 1707		print("+===========================
012152 01 C8 2B 01         A  7094    	LD	BC,L__294
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 140


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
012156 C5                  A  7095    	PUSH	BC
012157 CD 36 02 01         A  7096    	CALL	_print
01215B C1                  A  7097    	POP	BC
                           A  7098    ; 1708		print("|");
01215C 01 19 2C 01         A  7099    	LD	BC,L__295
012160 C5                  A  7100    	PUSH	BC
012161 CD 36 02 01         A  7101    	CALL	_print
012165 C1                  A  7102    	POP	BC
012166 DD36FF01            A  7103    	LD	(IX+-1),1
                           A  7104    ; 1709		
                           A  7105    ; 1710		for (c = 1; c < posx - 1; c++)
01216A 18 0D               A  7106    	JR	L_392
01216C                     A  7107    L_390:
                           A  7108    ; 1711			print(" ");
01216C 01 1B 2C 01         A  7109    	LD	BC,L__296
012170 C5                  A  7110    	PUSH	BC
012171 CD 36 02 01         A  7111    	CALL	_print
012175 C1                  A  7112    	POP	BC
012176 DD34FF              A  7113    	INC	(IX+-1)
012179                     A  7114    L_392:
012179 DD7EFC              A  7115    	LD	A,(IX+-4)
01217C 17ED62              A  7116    	SEXT	HL
01217F DD6EFC              A  7117    	LD	L,(IX+-4)
012182 E5C1                A  7118    	LD	BC,HL
012184 0B                  A  7119    	DEC	BC
012185 DD7EFF              A  7120    	LD	A,(IX+-1)
012188 17ED62              A  7121    	SEXT	HL
01218B DD6EFF              A  7122    	LD	L,(IX+-1)
01218E B7                  A  7123    	OR	A,A
01218F ED42                A  7124    	SBC	HL,BC
012191 FA 9B 21 01         A  7125    	JP	M,L__312
012195 EA 6C 21 01         A  7126    	JP	PE,L_390
012199 18 04               A  7127    	JR	L__313
01219B                     A  7128    L__312:
01219B E2 6C 21 01         A  7129    	JP	PO,L_390
01219F                     A  7130    L__313:
                           A  7131    ; 1712		
                           A  7132    ; 1713		print(msg1);
01219F DD0706              A  7133    	LD	BC,(IX+6)
0121A2 C5                  A  7134    	PUSH	BC
0121A3 CD 36 02 01         A  7135    	CALL	_print
0121A7 C1                  A  7136    	POP	BC
0121A8 DD7EFF              A  7137    	LD	A,(IX+-1)
0121AB DD86FD              A  7138    	ADD	A,(IX+-3)
0121AE DD77FE              A  7139    	LD	(IX+-2),A
                           A  7140    ; 1714		
                           A  7141    ; 1715		for (r = c + len; r < SCNCOLS - 1; 
0121B1 18 0D               A  7142    	JR	L_397
0121B3                     A  7143    L_395:
                           A  7144    ; 1716			print(" ");
0121B3 01 1D 2C 01         A  7145    	LD	BC,L__298
0121B7 C5                  A  7146    	PUSH	BC
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 141


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
0121B8 CD 36 02 01         A  7147    	CALL	_print
0121BC C1                  A  7148    	POP	BC
0121BD DD34FE              A  7149    	INC	(IX+-2)
0121C0                     A  7150    L_397:
0121C0 DD7EFE              A  7151    	LD	A,(IX+-2)
0121C3 FE4F                A  7152    	CP	A,79
0121C5 FA CF 21 01         A  7153    	JP	M,L__314
0121C9 EA B3 21 01         A  7154    	JP	PE,L_395
0121CD 18 04               A  7155    	JR	L__315
0121CF                     A  7156    L__314:
0121CF E2 B3 21 01         A  7157    	JP	PO,L_395
0121D3                     A  7158    L__315:
                           A  7159    ; 1717		
                           A  7160    ; 1718		print("|");
0121D3 01 1F 2C 01         A  7161    	LD	BC,L__300
0121D7 C5                  A  7162    	PUSH	BC
0121D8 CD 36 02 01         A  7163    	CALL	_print
0121DC C1                  A  7164    	POP	BC
                           A  7165    ; 1719		
                           A  7166    ; 1720		len = strlen(msg2);
0121DD DD0709              A  7167    	LD	BC,(IX+9)
0121E0 C5                  A  7168    	PUSH	BC
0121E1 CD 14 25 01         A  7169    	CALL	_strlen
0121E5 C1                  A  7170    	POP	BC
0121E6 DD75FD              A  7171    	LD	(IX+-3),L
                           A  7172    ; 1721		posx = 40 - (len / 2);
0121E9 DD7EFD              A  7173    	LD	A,(IX+-3)
0121EC 17ED62              A  7174    	SEXT	HL
0121EF DD6EFD              A  7175    	LD	L,(IX+-3)
0121F2 01020000            A  7176    	LD	BC,2
0121F6 CD C2 25 01         A  7177    	CALL	__idivs
0121FA 3E28                A  7178    	LD	A,40
0121FC 95                  A  7179    	SUB	A,L
0121FD DD77FC              A  7180    	LD	(IX+-4),A
                           A  7181    ; 1722		print("|");
012200 01 21 2C 01         A  7182    	LD	BC,L__301
012204 C5                  A  7183    	PUSH	BC
012205 CD 36 02 01         A  7184    	CALL	_print
012209 C1                  A  7185    	POP	BC
01220A DD36FF01            A  7186    	LD	(IX+-1),1
                           A  7187    ; 1723		
                           A  7188    ; 1724		for (c = 1; c < posx - 1; c++)
01220E 18 0D               A  7189    	JR	L_402
012210                     A  7190    L_400:
                           A  7191    ; 1725			print(" ");
012210 01 23 2C 01         A  7192    	LD	BC,L__302
012214 C5                  A  7193    	PUSH	BC
012215 CD 36 02 01         A  7194    	CALL	_print
012219 C1                  A  7195    	POP	BC
01221A DD34FF              A  7196    	INC	(IX+-1)
01221D                     A  7197    L_402:
01221D DD7EFC              A  7198    	LD	A,(IX+-4)
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 142


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
012220 17ED62              A  7199    	SEXT	HL
012223 DD6EFC              A  7200    	LD	L,(IX+-4)
012226 E5C1                A  7201    	LD	BC,HL
012228 0B                  A  7202    	DEC	BC
012229 DD7EFF              A  7203    	LD	A,(IX+-1)
01222C 17ED62              A  7204    	SEXT	HL
01222F DD6EFF              A  7205    	LD	L,(IX+-1)
012232 B7                  A  7206    	OR	A,A
012233 ED42                A  7207    	SBC	HL,BC
012235 FA 3F 22 01         A  7208    	JP	M,L__316
012239 EA 10 22 01         A  7209    	JP	PE,L_400
01223D 18 04               A  7210    	JR	L__317
01223F                     A  7211    L__316:
01223F E2 10 22 01         A  7212    	JP	PO,L_400
012243                     A  7213    L__317:
                           A  7214    ; 1726		
                           A  7215    ; 1727		print(msg2);
012243 DD0709              A  7216    	LD	BC,(IX+9)
012246 C5                  A  7217    	PUSH	BC
012247 CD 36 02 01         A  7218    	CALL	_print
01224B C1                  A  7219    	POP	BC
01224C DD7EFF              A  7220    	LD	A,(IX+-1)
01224F DD86FD              A  7221    	ADD	A,(IX+-3)
012252 DD77FE              A  7222    	LD	(IX+-2),A
                           A  7223    ; 1728		
                           A  7224    ; 1729		for (r = c + len; r < SCNCOLS - 1; 
012255 18 0D               A  7225    	JR	L_407
012257                     A  7226    L_405:
                           A  7227    ; 1730			print(" ");
012257 01 25 2C 01         A  7228    	LD	BC,L__304
01225B C5                  A  7229    	PUSH	BC
01225C CD 36 02 01         A  7230    	CALL	_print
012260 C1                  A  7231    	POP	BC
012261 DD34FE              A  7232    	INC	(IX+-2)
012264                     A  7233    L_407:
012264 DD7EFE              A  7234    	LD	A,(IX+-2)
012267 FE4F                A  7235    	CP	A,79
012269 FA 73 22 01         A  7236    	JP	M,L__318
01226D EA 57 22 01         A  7237    	JP	PE,L_405
012271 18 04               A  7238    	JR	L__319
012273                     A  7239    L__318:
012273 E2 57 22 01         A  7240    	JP	PO,L_405
012277                     A  7241    L__319:
                           A  7242    ; 1731		
                           A  7243    ; 1732		print("|");
012277 01 27 2C 01         A  7244    	LD	BC,L__306
01227B C5                  A  7245    	PUSH	BC
01227C CD 36 02 01         A  7246    	CALL	_print
012280 C1                  A  7247    	POP	BC
                           A  7248    ; 1733		
                           A  7249    ; 1734		print("+===========================
012281 01 29 2C 01         A  7250    	LD	BC,L__307
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 143


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
012285 C5                  A  7251    	PUSH	BC
012286 CD 36 02 01         A  7252    	CALL	_print
01228A C1                  A  7253    	POP	BC
                           A  7254    ; 1735		
                           A  7255    ; 1736		Disable_Back_Color();
01228B CD 82 19 01         A  7256    	CALL	_Disable_Back_Color
                           A  7257    ; 1737	}
01228F DDF9                A  7258    	LD	SP,IX
012291 DDE1                A  7259    	POP	IX
012293 C9                  A  7260    	RET	
                           A  7261    
                           A  7262    
                           A  7263    ;**************************** _msg_window *****
                           A  7264    ;Name                         Addr/Register   S
                           A  7265    ;_Disable_Back_Color                 IMPORT  --
                           A  7266    ;_print                              IMPORT  --
                           A  7267    ;_strlen                             IMPORT  --
                           A  7268    ;_gotoxy                             IMPORT  --
                           A  7269    ;_Enable_Back_Color                  IMPORT  --
                           A  7270    ;_scn_phys                           STATIC   4
                           A  7271    ;_backbuffer                         STATIC    
                           A  7272    ;_memset                             IMPORT  --
                           A  7273    ;posx                                  IX-4    
                           A  7274    ;len                                   IX-3    
                           A  7275    ;r                                     IX-2    
                           A  7276    ;c                                     IX-1    
                           A  7277    ;msg2                                  IX+9    
                           A  7278    ;msg1                                  IX+6    
                           A  7279    
                           A  7280    
                           A  7281    ; Stack Frame Size: 16 (bytes)
                           A  7282    ;       Spill Code: 0 (instruction)
                           A  7283    
                           A  7284    
                           A  7285    	SEGMENT STRSECT
012BC8                     A  7286    L__294:
012BC8 2B3D3D3D 3D3D3D3D   A  7287    	DB	"+==================================]PR
012BD0 3D3D3D3D 3D3D3D3D 
012BD8 3D3D3D3D 3D3D3D3D 
012BE0 3D3D3D3D 3D3D3D3D 
012BE8 3D3D3D5D 50524F54 
012BF0 45445B3D 3D3D3D3D 
012BF8 3D3D3D3D 3D3D3D3D 
012C00 3D3D3D3D 3D3D3D3D 
012C08 3D3D3D3D 3D3D3D3D 
012C10 3D3D3D3D 3D3D3D2B 
012C18 00                  A  7288    	DB	0
012C19                     A  7289    L__295:
012C19 7C                  A  7290    	DB	"|"
012C1A 00                  A  7291    	DB	0
012C1B                     A  7292    L__296:
012C1B 20                  A  7293    	DB	" "
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 144


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
012C1C 00                  A  7294    	DB	0
012C1D                     A  7295    L__298:
012C1D 20                  A  7296    	DB	" "
012C1E 00                  A  7297    	DB	0
012C1F                     A  7298    L__300:
012C1F 7C                  A  7299    	DB	"|"
012C20 00                  A  7300    	DB	0
012C21                     A  7301    L__301:
012C21 7C                  A  7302    	DB	"|"
012C22 00                  A  7303    	DB	0
012C23                     A  7304    L__302:
012C23 20                  A  7305    	DB	" "
012C24 00                  A  7306    	DB	0
012C25                     A  7307    L__304:
012C25 20                  A  7308    	DB	" "
012C26 00                  A  7309    	DB	0
012C27                     A  7310    L__306:
012C27 7C                  A  7311    	DB	"|"
012C28 00                  A  7312    	DB	0
012C29                     A  7313    L__307:
012C29 2B3D3D3D 3D3D3D3D   A  7314    	DB	"+=====================================
012C31 3D3D3D3D 3D3D3D3D 
012C39 3D3D3D3D 3D3D3D3D 
012C41 3D3D3D3D 3D3D3D3D 
012C49 3D3D3D3D 3D3D3D3D 
012C51 3D3D3D3D 3D3D3D3D 
012C59 3D3D3D3D 3D3D3D3D 
012C61 3D3D3D3D 3D3D3D3D 
012C69 3D3D3D3D 3D3D3D3D 
012C71 3D3D3D3D 3D3D3D2B 
012C79 00                  A  7315    	DB	0
                           A  7316    	SEGMENT CODE
                           A  7317    ; 1738	
                           A  7318    ; 1739	/* Close the message box */
                           A  7319    ; 1740	void close_msg_window(void)
                           A  7320    ; 1741	{
012294                     A  7321    _close_msg_window:
012294 21FEFFFF            A  7322    	LD	HL,-2
012298 CD 57 25 01         A  7323    	CALL	__frameset
                           A  7324    ; 1742		register char r, c;
                           A  7325    ; 1743		
                           A  7326    ; 1744		Disable_Back_Color();
01229C CD 82 19 01         A  7327    	CALL	_Disable_Back_Color
0122A0 DD36FF00            A  7328    	LD	(IX+-1),0
                           A  7329    ; 1745		
                           A  7330    ; 1746		for (r = 0; r < 4; r++)
0122A4 18 5A               A  7331    	JR	L_417
0122A6                     A  7332    L_415:
0122A6 DD36FE00            A  7333    	LD	(IX+-2),0
                           A  7334    ; 1747			for (c = 0; c < SCNCOLS; c++)
0122AA 18 3E               A  7335    	JR	L_414
0122AC                     A  7336    L_412:
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 145


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  7337    ; 1748				plot_char(c, r + 23, backbu
0122AC DD7EFF              A  7338    	LD	A,(IX+-1)
0122AF 17ED62              A  7339    	SEXT	HL
0122B2 DD6EFF              A  7340    	LD	L,(IX+-1)
0122B5 E5C1                A  7341    	LD	BC,HL
0122B7 C5E1                A  7342    	LD	HL,BC
0122B9 29                  A  7343    	ADD	HL,HL
0122BA 29                  A  7344    	ADD	HL,HL
0122BB 09                  A  7345    	ADD	HL,BC
0122BC 29                  A  7346    	ADD	HL,HL
0122BD 29                  A  7347    	ADD	HL,HL
0122BE 29                  A  7348    	ADD	HL,HL
0122BF 29                  A  7349    	ADD	HL,HL
0122C0 01 C7 53 01         A  7350    	LD	BC,_backbuffer
0122C4 09                  A  7351    	ADD	HL,BC
0122C5 E5C1                A  7352    	LD	BC,HL
0122C7 DD7EFE              A  7353    	LD	A,(IX+-2)
0122CA 17ED62              A  7354    	SEXT	HL
0122CD DD6EFE              A  7355    	LD	L,(IX+-2)
0122D0 09                  A  7356    	ADD	HL,BC
0122D1 4E                  A  7357    	LD	C,(HL)
0122D2 0600                A  7358    	LD	B,0
0122D4 C5                  A  7359    	PUSH	BC
0122D5 DD7EFF              A  7360    	LD	A,(IX+-1)
0122D8 C617                A  7361    	ADD	A,23
0122DA 4F                  A  7362    	LD	C,A
0122DB C5                  A  7363    	PUSH	BC
0122DC DD4EFE              A  7364    	LD	C,(IX+-2)
0122DF C5                  A  7365    	PUSH	BC
0122E0 CD 84 02 01         A  7366    	CALL	_plot_char
0122E4 C1                  A  7367    	POP	BC
0122E5 C1                  A  7368    	POP	BC
0122E6 C1                  A  7369    	POP	BC
0122E7 DD34FE              A  7370    	INC	(IX+-2)
0122EA                     A  7371    L_414:
0122EA DD7EFE              A  7372    	LD	A,(IX+-2)
0122ED FE50                A  7373    	CP	A,80
0122EF FA F9 22 01         A  7374    	JP	M,L__323
0122F3 EA AC 22 01         A  7375    	JP	PE,L_412
0122F7 18 04               A  7376    	JR	L__324
0122F9                     A  7377    L__323:
0122F9 E2 AC 22 01         A  7378    	JP	PO,L_412
0122FD                     A  7379    L__324:
0122FD DD34FF              A  7380    	INC	(IX+-1)
012300                     A  7381    L_417:
012300 DD7EFF              A  7382    	LD	A,(IX+-1)
012303 FE04                A  7383    	CP	A,4
012305 FA 0F 23 01         A  7384    	JP	M,L__325
012309 EA A6 22 01         A  7385    	JP	PE,L_415
01230D 18 04               A  7386    	JR	L__326
01230F                     A  7387    L__325:
01230F E2 A6 22 01         A  7388    	JP	PO,L_415
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 146


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
012313                     A  7389    L__326:
012313 DDF9                A  7390    	LD	SP,IX
012315 DDE1                A  7391    	POP	IX
012317 C9                  A  7392    	RET	
                           A  7393    
                           A  7394    
                           A  7395    ;**************************** _close_msg_window
                           A  7396    ;Name                         Addr/Register   S
                           A  7397    ;_backbuffer                         STATIC    
                           A  7398    ;_plot_char                          IMPORT  --
                           A  7399    ;_Disable_Back_Color                 IMPORT  --
                           A  7400    ;c                                     IX-2    
                           A  7401    ;r                                     IX-1    
                           A  7402    
                           A  7403    
                           A  7404    ; Stack Frame Size: 8 (bytes)
                           A  7405    ;       Spill Code: 0 (instruction)
                           A  7406    
                           A  7407    
                           A  7408    	XREF _strlen:ROM
                           A  7409    	XREF _memmove:ROM
                           A  7410    	XREF _memset:ROM
                           A  7411    	XREF _memcmp:ROM
                           A  7412    	XREF _strcpy:ROM
                           A  7413    	XREF _malloc:ROM
                           A  7414    	XREF _free:ROM
                           A  7415    	XREF __idivs:ROM
                           A  7416    	XREF __idivu:ROM
                           A  7417    	XREF __irems:ROM
                           A  7418    	XREF __iremu:ROM
                           A  7419    	XREF __frameset0:ROM
                           A  7420    	XREF __frameset:ROM
                           A  7421    	XDEF _close_msg_window
                           A  7422    	XDEF _msg_window
                           A  7423    	XDEF _reload_file
                           A  7424    	XDEF _save_file
                           A  7425    	XDEF _load_file
                           A  7426    	XDEF _FileExists
                           A  7427    	XDEF _Show_Cursor_Position
                           A  7428    	XDEF _edit
                           A  7429    	XDEF _Disable_Back_Color
                           A  7430    	XDEF _Enable_Back_Color
                           A  7431    	XDEF _ShowInsertMode
                           A  7432    	XDEF _ShowMenu
                           A  7433    	XDEF _Show_Cursor
                           A  7434    	XDEF _paintrow
                           A  7435    	XDEF _paintall
                           A  7436    	XDEF _do_ins
                           A  7437    	XDEF _do_endline
                           A  7438    	XDEF _do_home
                           A  7439    	XDEF _do_enhanced_del
                           A  7440    	XDEF _do_del
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 147


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  7441    	XDEF _do_dln
                           A  7442    	XDEF _do_iln
                           A  7443    	XDEF _do_dch
                           A  7444    	XDEF _do_chr
                           A  7445    	XDEF _do_bot
                           A  7446    	XDEF _do_top
                           A  7447    	XDEF _do_tab
                           A  7448    	XDEF _do_enhanced_ret
                           A  7449    	XDEF _do_ret
                           A  7450    	XDEF _do_pup
                           A  7451    	XDEF _do_pdw
                           A  7452    	XDEF _do_crt
                           A  7453    	XDEF _do_clf
                           A  7454    	XDEF _do_cdw
                           A  7455    	XDEF _do_cup
                           A  7456    	XDEF _do_red
                           A  7457    	XDEF _tx_put
                           A  7458    	XDEF _tx_get
                           A  7459    	XDEF _tx_del
                           A  7460    	XDEF _tx_ins
                           A  7461    	XDEF _tx_set
                           A  7462    	XDEF _tx_ini
                           A  7463    	XDEF _sc_fin
                           A  7464    	XDEF _sc_ini
                           A  7465    	XDEF _sc_fup
                           A  7466    	XDEF _sc_upd
                           A  7467    	XDEF _sc_str
                           A  7468    	XDEF _sc_chr
                           A  7469    	XDEF _sc_crw
                           A  7470    	XDEF _sc_clr
                           A  7471    	XDEF _te_fin
                           A  7472    	XDEF _te_ini
                           A  7473    	XDEF _te_clr
                           A  7474    	XDEF _te_cln
                           A  7475    	XDEF _te_mov
                           A  7476    	XDEF _te_str
                           A  7477    	XDEF _te_chr
                           A  7478    	XDEF _te_gch
                           A  7479    	XDEF _te_flu
                           A  7480    	XDEF _purify
                           A  7481    	XDEF _zap_trail
                           A  7482    	XDEF _blankrow
                           A  7483    	XDEF _mymalloc
                           A  7484    	XDEF _uitoa
                           A  7485    	XDEF _as
                           A  7486    	XDEF _bomb
                           A  7487    	XDEF _set_display_size
                           A  7488    	XDEF _get_prose_version
                           A  7489    	XDEF _gotoxy
                           A  7490    	XDEF _clreol
                           A  7491    	XDEF _plot_char
                           A  7492    	XDEF _get_cursor_position
Zilog eZ80 Macro Assembler Version 4.1 (10060805) RELISTED01-Aug-11     11:59:16     page: 148


PC     Object              I  Line    Source G:\eZ80P\proted\Debug\main.src
                           A  7493    	XDEF _print
                           A  7494    	XDEF _getch
                           A  7495    	XDEF _GetCh
                           A  7496    	XDEF _main
                           A  7497    	XDEF _convBuf
                           A  7498    	XDEF _UseFile
                           A  7499    	XDEF _BufferFile
                           A  7500    	XDEF _mlen
                           A  7501    	XDEF _filesize
                           A  7502    	XDEF _K_xBC
                           A  7503    	XDEF _K_xHL
                           A  7504    	XDEF _linbuf
                           A  7505    	XDEF _cur_col
                           A  7506    	XDEF _cur_row
                           A  7507    	XDEF _cur_char
                           A  7508    	XDEF _cur_line
                           A  7509    	XDEF _numlines
                           A  7510    	XDEF _p_curr
                           A  7511    	XDEF _p_root
                           A  7512    	XDEF _root
                           A  7513    	XDEF _backbuffer
                           A  7514    	XDEF _scn_phys
                           A  7515    	XDEF _scn_virt
                           A  7516    	XDEF _tebuflen
                           A  7517    	END


Errors: 0
Warnings: 0
Lines Assembled: 7518
